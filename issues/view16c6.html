<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

<!-- Mirrored from www.sigmah.org/issues/view.php?id=337&nbn=10 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 24 Jul 2018 14:42:08 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
	<link rel="stylesheet" type="text/css" href="css/default.css" />
	<script type="text/javascript"><!--
		if(document.layers) {document.write("<style>td{padding:0px;}<\/style>")}
	// --></script>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Cache-Control" content="no-cache" />
	<meta http-equiv="Pragma-directive" content="no-cache" />
	<meta http-equiv="Cache-Directive" content="no-cache" />
	<meta http-equiv="Expires" content="Tue, 24 Jul 2018 13:32:18 GMT" />
	<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
	<link rel="search" type="application/opensearchdescription+xml" title="MantisBT: Text Search" href="browser_search_plugin84ae.php?type=text" />	<link rel="search" type="application/opensearchdescription+xml" title="MantisBT: Issue Id" href="browser_search_pluginb70d.php?type=id" />	<title>0000337: Hide by default in Dashboard closed projects - Sigmah Issue Tracker</title>
<script type="text/javascript" src="javascript/min/common.js"></script>
<script type="text/javascript">var loading_lang = "Loading...";</script><script type="text/javascript" src="javascript/min/ajax.js"></script>
<link rel="stylesheet" type="text/css" href="plugin_filea93c.css?file=Source/style.css"/></head>
<body>
<div align="left"><a href="my_view_page.html"><img border="0" alt="Sigmah Issue Tracker" src="images/sigmah-logo-Mantis.png" /></a></div><table class="hide"><tr><td class="login-info-left">Anonymous | <a href="login_page697c.html?return=%2Fissues%2Fview.php%3Fid%3D337%26nbn%3D10">Login</a> | <a href="signup_page.html">Signup for a new account</a></td><td class="login-info-middle"><span class="italic">2018-07-24 15:32 CEST</span></td><td class="login-info-right"><form method="post" name="form_set_project" action="http://www.sigmah.org/issues/set_project.php">Project: <select name="project_id" class="small" onchange="document.forms.form_set_project.submit();"><option value="0" selected="selected" >All Projects</option>
<option value="1">sigmah</option>
<option value="4">Sigmah Central</option>
</select> <input type="submit" class="button-small" value="Switch" /></form><a href="200_rss_Sigmah_Issue_Tracker_-_Issuesd41d.xml?"><img src="images/rss.png" alt="RSS" style="border-style: none; margin: 5px; vertical-align: middle;" /></a></td></tr></table><table class="width100" cellspacing="0"><tr><td class="menu"><a href="my_view_page.html">My View</a> | <a href="view_all_bug_page.html">View Issues</a> | <a href="changelog_page.html">Change Log</a> | <a href="roadmap_page.html">Roadmap</a> | <a href="plugina0e2.html?page=Source/index">Repositories</a> | <a href="account_page.html">My Account</a></td><td class="menu right nowrap"><form method="post" action="http://www.sigmah.org/issues/jump_to_bug.php"><input type="text" name="bug_id" size="10" class="small" value="Issue #" onfocus="if (this.value == 'Issue #') this.value = ''" onblur="if (this.value == '') this.value = 'Issue #'" />&#160;<input type="submit" class="button-small" value="Jump" />&#160;</form></td></tr></table><br /><table class="width100" cellspacing="1"><tr><td class="form-title" colspan="3">View Issue Details&#160;<span class="small"><span class="bracket-link">[&#160;<a href="#bugnotes">Jump to Notes</a>&#160;]</span> </span></td><td class="center"><span class="small"></span></td><td class="right" colspan="2"><span class="small"><span class="bracket-link">[&#160;<a href="viewc857.html?id=337&amp;history=1#history">Issue History</a>&#160;]</span> </span><span class="small"><span class="bracket-link">[&#160;<a href="print_bug_paged4aa.html?bug_id=337">Print</a>&#160;]</span> </span></td></tr><tr><td class="category" width="15%">ID</td><td class="category" width="20%">Project</td><td class="category" width="15%">Category</td><td class="category" width="15%">View Status</td><td class="category" width="15%">Date Submitted</td><td class="category" width="20%">Last Update</td></tr><tr class="row-1"><td>0000337</td><td>sigmah</td><td>Dashboard</td><td>public</td><td>2011-06-26 17:07</td><td>2015-05-04 09:45</td></tr><tr class="spacer"><td colspan="6"></td></tr><tr class="row-2"><td class="category">Reporter</td><td>osarrat</td><td colspan="4">&#160;</td></tr><tr class="row-1"><td class="category">Assigned To</td><td>studentblue13</td><td colspan="4">&#160;</td></tr><tr class="row-2"><td class="category">Priority</td><td>normal</td><td class="category">Severity</td><td>feature</td><td class="category">Reproducibility</td><td>N/A</td></tr><tr class="row-1"><td class="category">Status</td><td bgcolor="#c9ccc4">closed</td><td class="category">Resolution</td><td>fixed</td><td colspan="2">&#160;</td></tr><tr class="row-2"><td class="category">Platform</td><td></td><td class="category">OS</td><td></td><td class="category">OS Version</td><td></td></tr><tr class="row-1"><td class="category">Product Version</td><td>1.0</td><td colspan="4">&#160;</td></tr><tr class="row-2"><td class="category">Target Version</td><td>2.0</td><td class="category">Fixed in Version</td><td>2.0</td><td colspan="2">&#160;</td></tr><tr class="spacer"><td colspan="6"></td></tr><tr class="row-1"><td class="category">Summary</td><td colspan="5">0000337: Hide by default in Dashboard closed projects</td></tr><tr class="row-2"><td class="category">Description</td><td colspan="5">A new filter on open/closed project status should be added on the Dashboard projects table. This open/closed status is described in the &quot;Interruption project phases&quot; feature (<a href="view8057.html?id=510" title="[new] Interruption project phases">0000510</a>).<br />
This new filter will be available through a new button on the left of the Export button.<br />
By default, this button will be called: &quot;Include closed projects&quot;. When clicked, it will open a menu below with the following options:<br />
- exclude closed projects<br />
- include last 6 months closed projects<br />
- include last 12 months closed projects<br />
- choose another time limit (if this last option is chosen, a text field will be given to the user to enter his own limit of months)<br />
- include all closed projects<br />
<br />
Once an option is chosen in this menu, the projects table is automatically reloaded.<br />
By default, when Sigmah is opened, the default filter will be &quot;exclude closed projects&quot; (this last part of this feature is subdued to the development of issue <a href="view6fb5.html?id=31" title="[closed] Table filters through technical migration to GXT 2.2.5" class="resolved">0000031</a>).<br />
When the user clicks on &quot;Refresh&quot;, it will refresh the projects table with the &quot;Include closed projects&quot; filter selected earlier.</td></tr><tr class="row-1"><td class="category">Tags</td><td colspan="5"><a href='tag_view_page3e0c.html?tag_id=12' title=''>Enhanced dashboard project table</a>, <a href='tag_view_page67a4.html?tag_id=16' title=''>TestLinkable</a></td></tr><tr class="spacer"><td colspan="6"></td></tr><tr class="row-2"><td class="category">User Report URL</td><td colspan="5"><a href="http://www.sigmah.org/fr/node/460">http://www.sigmah.org/fr/node/460</a> [<a href="http://www.sigmah.org/fr/node/460" target="_blank">^</a>]</td></tr><tr class="row-1"><td class="category">OS</td><td colspan="5">NA</td></tr><tr class="row-2"><td class="category">Other OS</td><td colspan="5"></td></tr><tr class="row-1"><td class="category">Browser</td><td colspan="5">NA</td></tr><tr class="row-2"><td class="category">Other browser</td><td colspan="5"></td></tr><tr class="row-1"><td class="category">ScreenURL</td><td colspan="5"></td></tr><tr class="row-2"><td class="category">(ActivityInfo) Noticed in revision</td><td colspan="5"></td></tr><tr class="spacer"><td colspan="6"></td></tr><tr class="row-1"><td class="category"><a name="attachments" id="attachments" />Attached Files</td><td colspan="5"><a href="0000337bae4.patch?file_id=109&amp;type=bug"><img src="images/fileicons/text.gif" alt="patch file icon" width="16" height="16" border="0" /></a>&#160;<a href="0000337bae4.patch?file_id=109&amp;type=bug">0000337.patch</a> [<a href="0000337bae4.patch?file_id=109&amp;type=bug" target="_blank">^</a>] (97,861 bytes) <span class="italic">2013-08-21 06:16</span><script type="text/javascript" language="JavaScript">
<!--
function swap_content( span ) {
displayType = ( document.getElementById( span ).style.display == 'none' ) ? '' : 'none';
document.getElementById( span ).style.display = displayType;
}

 -->
 </script> <span id="hideSection_109">[<a class="small" href='#' id='attmlink_109' onclick='swap_content("hideSection_109");swap_content("showSection_109");return false;'>Show Content</a>]</span> <span style='display:none' id="showSection_109">[<a class="small" href='#' id='attmlink_109' onclick='swap_content("hideSection_109");swap_content("showSection_109");return false;'>Hide Content</a>]<pre>Index: src/main/java/org/sigmah/client/i18n/UIConstants.properties
===================================================================
--- src/main/java/org/sigmah/client/i18n/UIConstants.properties	(Revision 1501)
+++ src/main/java/org/sigmah/client/i18n/UIConstants.properties	(Arbeitskopie)
@@ -909,6 +909,20 @@
 
 exportToWord = Export to Word
 
+# filter labels
+
+noneFilter = exclude all closed projects
+
+allFilter = include all closed projects
+
+sixMonthsFilter = include last 6 months
+
+twelveMonthsFilter = include last 12 months
+
+customFilter = choose past time limit
+
+closedProjectsFilterText = Closed projects filter
+
 # Not implemented feature
 featureNotImplemented = Feature not yet implemented
 
@@ -1625,6 +1639,8 @@
 
 projectDetails = Details
 
+projectClosedLabel = Closed
+
 # Details
 projectDetailsNoDetails = No detail...
 
Index: src/main/java/org/sigmah/client/page/dashboard/ProjectsListPanel.java
===================================================================
--- src/main/java/org/sigmah/client/page/dashboard/ProjectsListPanel.java	(Revision 1501)
+++ src/main/java/org/sigmah/client/page/dashboard/ProjectsListPanel.java	(Arbeitskopie)
@@ -38,14 +38,21 @@
 import org.sigmah.shared.dto.profile.ProfileUtils;
 
 import com.allen_sauer.gwt.log.client.Log;
+import com.extjs.gxt.ui.client.GXT;
+import com.extjs.gxt.ui.client.Style.Orientation;
 import com.extjs.gxt.ui.client.Style.SortDir;
 import com.extjs.gxt.ui.client.data.BaseModelData;
+import com.extjs.gxt.ui.client.data.FilterConfig;
+import com.extjs.gxt.ui.client.data.Loader;
 import com.extjs.gxt.ui.client.data.ModelData;
 import com.extjs.gxt.ui.client.data.SortInfo;
+import com.extjs.gxt.ui.client.event.BaseEvent;
 import com.extjs.gxt.ui.client.event.ButtonEvent;
 import com.extjs.gxt.ui.client.event.Events;
 import com.extjs.gxt.ui.client.event.FieldEvent;
+import com.extjs.gxt.ui.client.event.GridEvent;
 import com.extjs.gxt.ui.client.event.Listener;
+import com.extjs.gxt.ui.client.event.MenuEvent;
 import com.extjs.gxt.ui.client.event.SelectionListener;
 import com.extjs.gxt.ui.client.store.ListStore;
 import com.extjs.gxt.ui.client.store.Store;
@@ -53,6 +60,7 @@
 import com.extjs.gxt.ui.client.store.StoreFilter;
 import com.extjs.gxt.ui.client.store.StoreSorter;
 import com.extjs.gxt.ui.client.store.TreeStore;
+import com.extjs.gxt.ui.client.util.DelayedTask;
 import com.extjs.gxt.ui.client.util.Margins;
 import com.extjs.gxt.ui.client.widget.ContentPanel;
 import com.extjs.gxt.ui.client.widget.LayoutContainer;
@@ -64,10 +72,13 @@
 import com.extjs.gxt.ui.client.widget.form.RadioGroup;
 import com.extjs.gxt.ui.client.widget.grid.ColumnConfig;
 import com.extjs.gxt.ui.client.widget.grid.ColumnData;
+import com.extjs.gxt.ui.client.widget.grid.ColumnHeader;
+import com.extjs.gxt.ui.client.widget.grid.ColumnHeader.Head;
 import com.extjs.gxt.ui.client.widget.grid.ColumnModel;
 import com.extjs.gxt.ui.client.widget.grid.Grid;
 import com.extjs.gxt.ui.client.widget.grid.GridCellRenderer;
 import com.extjs.gxt.ui.client.widget.grid.filters.DateFilter;
+import com.extjs.gxt.ui.client.widget.grid.filters.Filter;
 import com.extjs.gxt.ui.client.widget.grid.filters.GridFilters;
 import com.extjs.gxt.ui.client.widget.grid.filters.ListFilter;
 import com.extjs.gxt.ui.client.widget.grid.filters.NumericFilter;
@@ -75,6 +86,11 @@
 import com.extjs.gxt.ui.client.widget.layout.FitLayout;
 import com.extjs.gxt.ui.client.widget.layout.FlowData;
 import com.extjs.gxt.ui.client.widget.layout.FlowLayout;
+import com.extjs.gxt.ui.client.widget.menu.CheckMenuItem;
+import com.extjs.gxt.ui.client.widget.menu.DateMenu;
+import com.extjs.gxt.ui.client.widget.menu.Menu;
+import com.extjs.gxt.ui.client.widget.menu.MenuItem;
+import com.extjs.gxt.ui.client.widget.menu.SeparatorMenuItem;
 import com.extjs.gxt.ui.client.widget.toolbar.FillToolItem;
 import com.extjs.gxt.ui.client.widget.toolbar.SeparatorToolItem;
 import com.extjs.gxt.ui.client.widget.toolbar.ToolBar;
@@ -91,6 +107,7 @@
 import com.google.gwt.user.client.ui.Image;
 import com.google.gwt.user.client.ui.Label;
 import com.google.gwt.user.client.ui.Widget;
+import com.google.gwt.user.datepicker.client.CalendarUtil;
 
 /**
  * A widget which display a list of projects.
@@ -100,689 +117,827 @@
  */
 public class ProjectsListPanel {
 
-    /**
-     * A tree store with some useful dedicated methods.
-     * 
-     * @author tmi
-     * 
-     */
-    public static class ProjectStore extends TreeStore&lt;ProjectDTOLight&gt; {
-    }
+	/**
+	 * A tree store with some useful dedicated methods.
+	 * 
+	 * @author tmi
+	 * 
+	 */
+	public static class ProjectStore extends TreeStore&lt;ProjectDTOLight&gt; {
+	}
 
-    /**
-     * Defines the refreshing mode.
-     * 
-     * @author tmi
-     */
-    public static enum RefreshMode {
+	/**
+	 * Defines the refreshing mode.
+	 * 
+	 * @author tmi
+	 */
+	public static enum RefreshMode {
 
-        /**
-         * The project list is refreshed each time the
-         * {@link ProjectsListPanel#refresh(boolean, Integer...)} method is
-         * called.
-         */
-        AUTOMATIC,
+		/**
+		 * The project list is refreshed each time the
+		 * {@link ProjectsListPanel#refresh(boolean, Integer...)} method is
+		 * called.
+		 */
+		AUTOMATIC,
 
-        /**
-         * The project list is refreshed each time user clicks on the refresh
-         * button.
-         */
-        BUTTON,
+		/**
+		 * The project list is refreshed each time user clicks on the refresh
+		 * button.
+		 */
+		BUTTON,
 
-        /**
-         * Refresh the project list when {@link #refresh(boolean, Integer...)}
-         * if called for the first time. Subsequent refreshs are called by the
-         * refresh button.
-         */
-        BOTH;
-    }
+		/**
+		 * Refresh the project list when {@link #refresh(boolean, Integer...)}
+		 * if called for the first time. Subsequent refreshs are called by the
+		 * refresh button.
+		 */
+		BOTH;
+	}
 
-    /**
-     * Defines the loading mode.
-     * 
-     * @author tmi
-     */
-    public static enum LoadingMode {
+	/**
+	 * Defines the loading mode.
+	 * 
+	 * @author tmi
+	 */
+	public static enum LoadingMode {
 
-        /**
-         * The projects list id loaded by one single server call.
-         */
-        ONE_TIME,
+		/**
+		 * The projects list id loaded by one single server call.
+		 */
+		ONE_TIME,
 
-        /**
-         * The projects list is loaded by chunks and a progress bar informs of
-         * the loading process.
-         */
-        CHUNK;
-    }
+		/**
+		 * The projects list is loaded by chunks and a progress bar informs of
+		 * the loading process.
+		 */
+		CHUNK;
+	}
 
-    private final Dispatcher dispatcher;
-    private final Authentication authentication;
-    private final ContentPanel projectTreePanel;
-    private final TreeGrid&lt;ProjectDTOLight&gt; projectTreeGrid;
-    private final Radio ngoRadio;
-    private final Radio fundingRadio;
-    private final Radio partnerRadio;
-    private final Button filterButton;
-    private final GridFilters gridFilters;
-    
-    /** Current projects grid parameters. */
-    private ProjectModelType currentModelType;
-    private final ArrayList&lt;Integer&gt; orgUnitsIds;
+	private final Dispatcher dispatcher;
+	private final Authentication authentication;
+	private final ContentPanel projectTreePanel;
+	private final TreeGrid&lt;ProjectDTOLight&gt; projectTreeGrid;
+	private final Radio ngoRadio;
+	private final Radio fundingRadio;
+	private final Radio partnerRadio;
+	private final Button filterButton;
+	private final GridFilters gridFilters;
 
-    /** The refreshing mode (automatic by default) */
-    private final RefreshMode refreshMode;
-    private final com.extjs.gxt.ui.client.widget.Label refreshDateLabel;
+	// private final StoreFilter&lt;ProjectDTOLight&gt; closedFilter = new
+	// StoreFilter&lt;ProjectDTOLight&gt;() {
+	//
+	// @Override
+	// public boolean select(Store&lt;ProjectDTOLight&gt; store, ProjectDTOLight
+	// parent, ProjectDTOLight item,
+	// String property) {
+	// if (item.isClosed())
+	// return false;
+	// else
+	// return true;
+	// }
+	//
+	// };
 
-    /** The loading mode (one time by default) */
-    private final LoadingMode loadingMode;
+	/** Current projects grid parameters. */
+	private ProjectModelType currentModelType;
+	private final ArrayList&lt;Integer&gt; orgUnitsIds;
 
-    /**
-     * true if {@link #refresh(boolean, Integer...)} has already been called at
-     * least one time
-     */
-    private static boolean isLoaded = false;
+	/** The refreshing mode (automatic by default) */
+	private final RefreshMode refreshMode;
+	private final com.extjs.gxt.ui.client.widget.Label refreshDateLabel;
 
-    /** The GetProjects command which will be executed for the next refresh. */
-    private GetProjects command;
+	/** The loading mode (one time by default) */
+	private final LoadingMode loadingMode;
 
-    /**
-     * Builds a new project list panel with the default refreshing mode to
-     * {@link RefreshMode#AUTOMATIC}.
-     * 
-     * @param dispatcher
-     *            The dispatcher.
-     * @param authentication
-     *            The current authentication.
-     */
-    public ProjectsListPanel(Dispatcher dispatcher, Authentication authentication, EventBus eventBus) {
-        this(dispatcher, authentication, eventBus, RefreshMode.AUTOMATIC, LoadingMode.ONE_TIME);
-    }
+	/**
+	 * true if {@link #refresh(boolean, Integer...)} has already been called at
+	 * least one time
+	 */
+	private static boolean isLoaded = false;
 
-    /**
-     * Builds a new project list panel.
-     * 
-     * @param dispatcher
-     *            The dispatcher.
-     * @param authentication
-     *            The current authentication.
-     * @param refreshMode
-     *            The refreshing mode.
-     */
-    public ProjectsListPanel(Dispatcher dispatcher, Authentication authentication, EventBus eventBus, RefreshMode refreshMode) {
-        this(dispatcher, authentication, eventBus, refreshMode, LoadingMode.ONE_TIME);
-    }
+	/** The GetProjects command which will be executed for the next refresh. */
+	private GetProjects command;
 
-    /**
-     * Builds a new project list panel.
-     * 
-     * @param dispatcher
-     *            The dispatcher.
-     * @param authentication
-     *            The current authentication.
-     * @param refreshMode
-     *            The refreshing mode.
-     * @param loadingMode
-     *            The loading mode.
-     */
-    public ProjectsListPanel(Dispatcher dispatcher, final Authentication authentication, EventBus eventBus, RefreshMode refreshMode,
-            LoadingMode loadingMode) {
+	/**
+	 * Builds a new project list panel with the default refreshing mode to
+	 * {@link RefreshMode#AUTOMATIC}.
+	 * 
+	 * @param dispatcher
+	 *            The dispatcher.
+	 * @param authentication
+	 *            The current authentication.
+	 */
+	public ProjectsListPanel(Dispatcher dispatcher, Authentication authentication, EventBus eventBus) {
+		this(dispatcher, authentication, eventBus, RefreshMode.AUTOMATIC, LoadingMode.ONE_TIME);
+	}
 
-        this.dispatcher = dispatcher;
-        this.authentication = authentication;
-        this.refreshMode = refreshMode;
-        this.loadingMode = loadingMode;
+	/**
+	 * Builds a new project list panel.
+	 * 
+	 * @param dispatcher
+	 *            The dispatcher.
+	 * @param authentication
+	 *            The current authentication.
+	 * @param refreshMode
+	 *            The refreshing mode.
+	 */
+	public ProjectsListPanel(Dispatcher dispatcher, Authentication authentication, EventBus eventBus,
+					RefreshMode refreshMode) {
+		this(dispatcher, authentication, eventBus, refreshMode, LoadingMode.ONE_TIME);
+	}
 
-        // Default filters parameters.
-        orgUnitsIds = new ArrayList&lt;Integer&gt;();
-        currentModelType = ProjectModelType.NGO;
+	/**
+	 * Builds a new project list panel.
+	 * 
+	 * @param dispatcher
+	 *            The dispatcher.
+	 * @param authentication
+	 *            The current authentication.
+	 * @param refreshMode
+	 *            The refreshing mode.
+	 * @param loadingMode
+	 *            The loading mode.
+	 */
+	public ProjectsListPanel(Dispatcher dispatcher, final Authentication authentication, EventBus eventBus,
+					RefreshMode refreshMode, LoadingMode loadingMode) {
 
-        // Store.
-        final ProjectStore projectStore = new ProjectStore();
-        projectStore.setMonitorChanges(true);
+		this.dispatcher = dispatcher;
+		this.authentication = authentication;
+		this.refreshMode = refreshMode;
+		this.loadingMode = loadingMode;
 
-        // Default sort order of the projects grid.
-        projectStore.setSortInfo(new SortInfo(&quot;name&quot;, SortDir.ASC));
+		// Default filters parameters.
+		orgUnitsIds = new ArrayList&lt;Integer&gt;();
+		currentModelType = ProjectModelType.NGO;
 
-        // Grid.
-        projectTreeGrid = new TreeGrid&lt;ProjectDTOLight&gt;(projectStore, getProjectGridColumnModel());
-        projectTreeGrid.setBorders(true);
-        projectTreeGrid.getStyle().setNodeOpenIcon(null);
-        projectTreeGrid.getStyle().setNodeCloseIcon(null);
-        projectTreeGrid.getStyle().setLeafIcon(null);
-        projectTreeGrid.setAutoExpandColumn(&quot;fullName&quot;);
-        projectTreeGrid.setTrackMouseOver(false);
-        projectTreeGrid.setAutoExpand(true);               
+		// Store.
+		final ProjectStore projectStore = new ProjectStore();
+		projectStore.setMonitorChanges(true);
 
-     // Apply grid filters
-        gridFilters = new GridFilters();       
-        projectTreeGrid.addPlugin(createGridFilters());  
+		// Default sort order of the projects grid.
+		projectStore.setSortInfo(new SortInfo(&quot;name&quot;, SortDir.ASC));
 
-        // Store.
-        projectStore.setStoreSorter(new StoreSorter&lt;ProjectDTOLight&gt;() {
-            @Override
-            public int compare(Store&lt;ProjectDTOLight&gt; store, ProjectDTOLight m1, ProjectDTOLight m2, String property) {
+		// Grid.
+		projectTreeGrid = new TreeGrid&lt;ProjectDTOLight&gt;(projectStore, getProjectGridColumnModel());
+		projectTreeGrid.setBorders(true);
+		projectTreeGrid.getStyle().setNodeOpenIcon(null);
+		projectTreeGrid.getStyle().setNodeCloseIcon(null);
+		projectTreeGrid.getStyle().setLeafIcon(null);
+		projectTreeGrid.setAutoExpandColumn(&quot;fullName&quot;);
+		projectTreeGrid.setTrackMouseOver(false);
+		projectTreeGrid.setAutoExpand(true);
 
-                if (&quot;name&quot;.equals(property)) {
-                    return m1.getName().compareToIgnoreCase(m2.getName());
-                } else if (&quot;fullName&quot;.equals(property)) {
-                    return m1.getFullName().compareToIgnoreCase(m2.getFullName());
-                } else if (&quot;phase&quot;.equals(property)) {
-                    return m1.getCurrentPhaseName().compareToIgnoreCase(m2.getCurrentPhaseName());
-                } else if (&quot;orgUnitName&quot;.equals(property)) {
-                    return m1.getOrgUnitName().compareToIgnoreCase(m2.getOrgUnitName());
-                } else if (&quot;spentBudget&quot;.equals(property)) {
-                    final Double d1 = NumberUtils.adjustRatio(NumberUtils.ratio(m1.getSpendBudget(),
-                            m1.getPlannedBudget()));
-                    final Double d2 = NumberUtils.adjustRatio(NumberUtils.ratio(m2.getSpendBudget(),
-                            m2.getPlannedBudget()));
-                    return d1.compareTo(d2);
-                } else if (&quot;time&quot;.equals(property)) {
-                    final Double d1 = m1.getElapsedTime();
-                    final Double d2 = m2.getElapsedTime();
-                    return d1.compareTo(d2);
-                } else if (&quot;activity&quot;.equals(property)) {
-                    return 0;
-                } else if (&quot;categoryElements&quot;.equals(property)) {
-                    return 0;
-                } else {
-                    return super.compare(store, m1, m2, property);
-                }
-            }
-        });
+		// Apply grid filters
+		gridFilters = new GridFilters() {
 
-        // Top panel
-        final RadioGroup group = new RadioGroup(&quot;projectTypeFilter&quot;);
-        group.setFireChangeEventOnSetValue(true);
+			private CheckMenuItem checkItem;
+			private SeparatorMenuItem seperator;
+			private Menu filterMenuO;
+			private StoreFilter&lt;ModelData&gt; currentFilterO;
 
-        ngoRadio = new Radio();
-        ngoRadio.setFireChangeEventOnSetValue(true);
-        ngoRadio.setValue(true);
-        ngoRadio.setFieldLabel(ProjectModelType.getName(ProjectModelType.NGO));
-        ngoRadio.addStyleName(&quot;toolbar-radio&quot;);
+			private DelayedTask deferredUpdateO = new DelayedTask(new Listener&lt;BaseEvent&gt;() {
+				public void handleEvent(BaseEvent be) {
+					reload();
+				}
+			});
 
-        final WidgetComponent ngoIcon = new WidgetComponent(FundingIconProvider.getProjectTypeIcon(
-                ProjectModelType.NGO, IconSize.SMALL).createImage());
-        ngoIcon.addStyleName(&quot;toolbar-icon&quot;);
+			@Override
+			protected void onContextMenu(GridEvent&lt;?&gt; be) {
+				int column = be.getColIndex();
 
-        final Label ngoLabel = new Label(ProjectModelType.getName(ProjectModelType.NGO));
-        ngoLabel.addStyleName(&quot;flexibility-element-label&quot;);
-        ngoLabel.addStyleName(&quot;project-starred-icon&quot;);
-        ngoLabel.addClickHandler(new ClickHandler() {
+				if (seperator == null) {
+					seperator = new SeparatorMenuItem();
+				}
+				seperator.removeFromParent();
 
-            @Override
-            public void onClick(ClickEvent event) {
-                ngoRadio.setValue(true);
-                fundingRadio.setValue(false);
-                partnerRadio.setValue(false);
-            }
-        });
+				if (checkItem == null) {
+					checkItem = new CheckMenuItem(getMessages().getFilterText());
 
-        fundingRadio = new Radio();
-        fundingRadio.setFireChangeEventOnSetValue(true);
-        fundingRadio.setFieldLabel(ProjectModelType.getName(ProjectModelType.FUNDING));
-        fundingRadio.addStyleName(&quot;toolbar-radio&quot;);
+					checkItem.addListener(Events.CheckChange, new Listener&lt;MenuEvent&gt;() {
+						public void handleEvent(MenuEvent me) {
+							onCheckChange(me);
+						}
+					});
+					checkItem.addListener(Events.BeforeCheckChange, new Listener&lt;MenuEvent&gt;() {
+						public void handleEvent(MenuEvent me) {
+							onBeforeCheck(me);
+						}
+					});
+				}
+				checkItem.removeFromParent();
+				checkItem.setData(&quot;index&quot;, column);
 
-        final WidgetComponent fundingIcon = new WidgetComponent(FundingIconProvider.getProjectTypeIcon(
-                ProjectModelType.FUNDING, IconSize.SMALL).createImage());
-        fundingIcon.addStyleName(&quot;toolbar-icon&quot;);
+				Filter f = getFilter(grid.getColumnModel().getColumn(column).getDataIndex());
+				if (f != null) {
+					checkItem.show();
 
-        final Label fundingLabel = new Label(ProjectModelType.getName(ProjectModelType.FUNDING));
-        fundingLabel.addStyleName(&quot;flexibility-element-label&quot;);
-        fundingLabel.addStyleName(&quot;project-starred-icon&quot;);
-        fundingLabel.addClickHandler(new ClickHandler() {
+					filterMenuO = f.getMenu();
+					checkItem.setChecked(f.isActive(), true);
+					checkItem.setSubMenu(filterMenuO);
 
-            @Override
-            public void onClick(ClickEvent event) {
-                ngoRadio.setValue(false);
-                fundingRadio.setValue(true);
-                partnerRadio.setValue(false);
-            }
-        });
+					Menu menu = be.getMenu();
+					menu.add(seperator);
+					if (columnModel.getDataIndex(column).equals(&quot;time&quot;))
+						checkItem.setText(I18N.CONSTANTS.closedProjectsFilterText());
+					else
+						checkItem.setText(GXT.MESSAGES.gridFilters_filterText());
+					menu.add(checkItem);
+				}
+			}
 
-        partnerRadio = new Radio();
-        partnerRadio.setFireChangeEventOnSetValue(true);
-        partnerRadio.setFieldLabel(ProjectModelType.getName(ProjectModelType.LOCAL_PARTNER));
-        partnerRadio.addStyleName(&quot;toolbar-radio&quot;);
+			@Override
+			protected void onStateChange(Filter filter) {
+				if (checkItem != null &amp;&amp; checkItem.isAttached()) {
+					checkItem.setChecked(filter.isActive(), true);
+				}
+				if ((isAutoReload() || isLocal())) {
+					deferredUpdateO.delay(getUpdateBuffer());
+				}
+				updateColumnHeadings();
+			}
 
-        final WidgetComponent partnerIcon = new WidgetComponent(FundingIconProvider.getProjectTypeIcon(
-                ProjectModelType.LOCAL_PARTNER, IconSize.SMALL).createImage());
-        partnerIcon.addStyleName(&quot;toolbar-icon&quot;);
+			@Override
+			protected void reload() {
+				if (isLocal()) {
+					if (currentFilterO != null) {
+						getStore().removeFilter(currentFilterO);
+					}
+					currentFilterO = getModelFilter();
+					getStore().addFilter(currentFilterO);
+					if (!getStore().isFiltered()) {
+						getStore().applyFilters(&quot;&quot;);
+					}
+				} else {
+					deferredUpdateO.cancel();
 
-        final Label partnerLabel = new Label(ProjectModelType.getName(ProjectModelType.LOCAL_PARTNER));
-        partnerLabel.addStyleName(&quot;flexibility-element-label&quot;);
-        partnerLabel.addStyleName(&quot;project-starred-icon&quot;);
-        partnerLabel.addClickHandler(new ClickHandler() {
+					Loader&lt;?&gt; l = getLoader(getStore());
+					if (l != null) {
+						l.load();
+					}
+				}
+			}
 
-            @Override
-            public void onClick(ClickEvent event) {
-                ngoRadio.setValue(false);
-                fundingRadio.setValue(false);
-                partnerRadio.setValue(true);
-            }
-        });
+			@Override
+			public void updateColumnHeadings() {
+				int cols = grid.getColumnModel().getColumnCount();
+				for (int i = 0; i &lt; cols; i++) {
+					ColumnConfig config = grid.getColumnModel().getColumn(i);
+					if (!config.isHidden()) {
+						ColumnHeader header = grid.getView().getHeader();
+						if (header != null) {
+							Head h = header.getHead(i);
+							if (h != null &amp;&amp; h.isRendered()) {
+								Filter f = getFilter(config.getDataIndex());
+								if (f != null) {
+									h.el().setStyleName(&quot;filtered-column-header&quot;, f.isActive());
 
-        final HTML headLabel = new HTML(&quot;&amp;nbsp;&amp;nbsp;&quot; + I18N.CONSTANTS.projectTypeFilter() + &quot;: &quot;);
-        headLabel.addStyleName(&quot;flexibility-element-label&quot;);
+								}
+							}
+						}
+					}
+				}
+			}
+		};
 
-        group.add(ngoRadio);
-        group.add(fundingRadio);
-        group.add(partnerRadio);
-        group.setAutoWidth(true);
+		projectTreeGrid.addPlugin(createGridFilters());
 
-        // Expand all button.
-        final Button expandButton = new Button(&quot;&quot;, IconImageBundle.ICONS.expand(),
-                new SelectionListener&lt;ButtonEvent&gt;() {
+		// Store.
+		projectStore.setStoreSorter(new StoreSorter&lt;ProjectDTOLight&gt;() {
+			@Override
+			public int compare(Store&lt;ProjectDTOLight&gt; store, ProjectDTOLight m1, ProjectDTOLight m2, String property) {
 
-                    @Override
-                    public void componentSelected(ButtonEvent ce) {
-                        projectTreeGrid.expandAll();
-                    }
-                });
+				if (&quot;name&quot;.equals(property)) {
+					return m1.getName().compareToIgnoreCase(m2.getName());
+				} else if (&quot;fullName&quot;.equals(property)) {
+					return m1.getFullName().compareToIgnoreCase(m2.getFullName());
+				} else if (&quot;phase&quot;.equals(property)) {
+					return m1.getCurrentPhaseName().compareToIgnoreCase(m2.getCurrentPhaseName());
+				} else if (&quot;orgUnitName&quot;.equals(property)) {
+					return m1.getOrgUnitName().compareToIgnoreCase(m2.getOrgUnitName());
+				} else if (&quot;spentBudget&quot;.equals(property)) {
+					final Double d1 = NumberUtils.adjustRatio(NumberUtils.ratio(m1.getSpendBudget(),
+									m1.getPlannedBudget()));
+					final Double d2 = NumberUtils.adjustRatio(NumberUtils.ratio(m2.getSpendBudget(),
+									m2.getPlannedBudget()));
+					return d1.compareTo(d2);
+				} else if (&quot;time&quot;.equals(property)) {
+					final Double d1 = m1.getElapsedTime();
+					final Double d2 = m2.getElapsedTime();
+					return d1.compareTo(d2);
+				} else if (&quot;activity&quot;.equals(property)) {
+					return 0;
+				} else if (&quot;categoryElements&quot;.equals(property)) {
+					return 0;
+				} else {
+					return super.compare(store, m1, m2, property);
+				}
+			}
+		});
 
-        // Collapse all button.
-        final Button collapseButton = new Button(&quot;&quot;, IconImageBundle.ICONS.collapse(),
-                new SelectionListener&lt;ButtonEvent&gt;() {
+		// Top panel
+		final RadioGroup group = new RadioGroup(&quot;projectTypeFilter&quot;);
+		group.setFireChangeEventOnSetValue(true);
 
-                    @Override
-                    public void componentSelected(ButtonEvent ce) {
-                        projectTreeGrid.collapseAll();
-                    }
-                });
+		ngoRadio = new Radio();
+		ngoRadio.setFireChangeEventOnSetValue(true);
+		ngoRadio.setValue(true);
+		ngoRadio.setFieldLabel(ProjectModelType.getName(ProjectModelType.NGO));
+		ngoRadio.addStyleName(&quot;toolbar-radio&quot;);
 
-        // Filter button.
-        filterButton = new Button(I18N.CONSTANTS.filter(), IconImageBundle.ICONS.filter());
+		final WidgetComponent ngoIcon = new WidgetComponent(FundingIconProvider.getProjectTypeIcon(
+						ProjectModelType.NGO, IconSize.SMALL).createImage());
+		ngoIcon.addStyleName(&quot;toolbar-icon&quot;);
 
-        // Refresh button.
-        final Button refreshButton = new Button(I18N.CONSTANTS.refreshProjectList(), IconImageBundle.ICONS.refresh(),
-                new SelectionListener&lt;ButtonEvent&gt;() {
+		final Label ngoLabel = new Label(ProjectModelType.getName(ProjectModelType.NGO));
+		ngoLabel.addStyleName(&quot;flexibility-element-label&quot;);
+		ngoLabel.addStyleName(&quot;project-starred-icon&quot;);
+		ngoLabel.addClickHandler(new ClickHandler() {
 
-                    @Override
-                    public void componentSelected(ButtonEvent ce) {
-                        // Explicit refresh.
-                        refreshProjectGrid(command);
-                    }
-                });
-        refreshButton.setToolTip(I18N.CONSTANTS.refreshProjectListDetails());
-        refreshButton.addStyleName(&quot;project-refresh-button&quot;);
+			@Override
+			public void onClick(ClickEvent event) {
+				ngoRadio.setValue(true);
+				fundingRadio.setValue(false);
+				partnerRadio.setValue(false);
+			}
+		});
 
-        // Refresh date.
-        refreshDateLabel = new com.extjs.gxt.ui.client.widget.Label();
-        
-        eventBus.addListener(AppEvents.DeleteProject, new Listener&lt;ProjectEvent&gt;() {
+		fundingRadio = new Radio();
+		fundingRadio.setFireChangeEventOnSetValue(true);
+		fundingRadio.setFieldLabel(ProjectModelType.getName(ProjectModelType.FUNDING));
+		fundingRadio.addStyleName(&quot;toolbar-radio&quot;);
 
-            @Override
-            public void handleEvent(ProjectEvent be) {
-                refreshProjectGrid(command);
-            }
-        });
-        
-        
+		final WidgetComponent fundingIcon = new WidgetComponent(FundingIconProvider.getProjectTypeIcon(
+						ProjectModelType.FUNDING, IconSize.SMALL).createImage());
+		fundingIcon.addStyleName(&quot;toolbar-icon&quot;);
 
-        final ToolBar toolbar = new ToolBar();
-        if (refreshMode == RefreshMode.BUTTON || refreshMode == RefreshMode.BOTH) {
-            toolbar.add(refreshButton);
-            toolbar.add(refreshDateLabel);
-            toolbar.add(new SeparatorToolItem());
-        }
-        toolbar.add(expandButton);
-        toolbar.add(collapseButton);
-        toolbar.add(new SeparatorToolItem());
-        toolbar.add(filterButton);
-        toolbar.add(new WidgetComponent(headLabel));
-        toolbar.add(ngoRadio);
-        toolbar.add(ngoIcon);
-        toolbar.add(new WidgetComponent(ngoLabel));
-        toolbar.add(fundingRadio);
-        toolbar.add(fundingIcon);
-        toolbar.add(new WidgetComponent(fundingLabel));
-        toolbar.add(partnerRadio);
-        toolbar.add(partnerIcon);
-        toolbar.add(new WidgetComponent(partnerLabel));       
-        
-        if(ProfileUtils.isGranted(authentication, GlobalPermissionEnum.GLOBAL_EXPORT)){
-        	 final GlobalExportForm globalExportForm=
-             	new GlobalExportForm(authentication.getOrganizationId(),dispatcher);
-        	 toolbar.add(new FillToolItem());
-             toolbar.add(globalExportForm.getButton());
-             toolbar.add(globalExportForm.getExportForm());
-        }
-       
+		final Label fundingLabel = new Label(ProjectModelType.getName(ProjectModelType.FUNDING));
+		fundingLabel.addStyleName(&quot;flexibility-element-label&quot;);
+		fundingLabel.addStyleName(&quot;project-starred-icon&quot;);
+		fundingLabel.addClickHandler(new ClickHandler() {
 
-        // Panel
-        projectTreePanel = new ContentPanel(new FitLayout());
-        projectTreePanel.setHeading(I18N.CONSTANTS.projects());
+			@Override
+			public void onClick(ClickEvent event) {
+				ngoRadio.setValue(false);
+				fundingRadio.setValue(true);
+				partnerRadio.setValue(false);
+			}
+		});
 
-        projectTreePanel.setTopComponent(toolbar);
+		partnerRadio = new Radio();
+		partnerRadio.setFireChangeEventOnSetValue(true);
+		partnerRadio.setFieldLabel(ProjectModelType.getName(ProjectModelType.LOCAL_PARTNER));
+		partnerRadio.addStyleName(&quot;toolbar-radio&quot;);
 
-        if (ProfileUtils.isGranted(authentication, GlobalPermissionEnum.VIEW_PROJECT)) {
-            projectTreePanel.add(projectTreeGrid);
-        } else {
-            final HTML insufficient = new HTML(I18N.CONSTANTS.permViewProjectsInsufficient());
-            insufficient.addStyleName(&quot;important-label&quot;);
-            projectTreePanel.add(insufficient);
-        }
+		final WidgetComponent partnerIcon = new WidgetComponent(FundingIconProvider.getProjectTypeIcon(
+						ProjectModelType.LOCAL_PARTNER, IconSize.SMALL).createImage());
+		partnerIcon.addStyleName(&quot;toolbar-icon&quot;);
 
-        addListeners();
-        addFilters();
-    }
+		final Label partnerLabel = new Label(ProjectModelType.getName(ProjectModelType.LOCAL_PARTNER));
+		partnerLabel.addStyleName(&quot;flexibility-element-label&quot;);
+		partnerLabel.addStyleName(&quot;project-starred-icon&quot;);
+		partnerLabel.addClickHandler(new ClickHandler() {
 
-    /**
-     * Builds and returns the columns model for the projects tree grid.
-     * 
-     * @return The project tree grid columns model.
-     */
-    private ColumnModel getProjectGridColumnModel() {
+			@Override
+			public void onClick(ClickEvent event) {
+				ngoRadio.setValue(false);
+				fundingRadio.setValue(false);
+				partnerRadio.setValue(true);
+			}
+		});
 
-        final DateTimeFormat format = DateUtils.DATE_SHORT;
+		final HTML headLabel = new HTML(&quot;&amp;nbsp;&amp;nbsp;&quot; + I18N.CONSTANTS.projectTypeFilter() + &quot;: &quot;);
+		headLabel.addStyleName(&quot;flexibility-element-label&quot;);
 
-        // Starred icon
-        final ColumnConfig starredIconColumn = new ColumnConfig(&quot;starred&quot;, &quot;&quot;, 30);
-        starredIconColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
-            private final DashboardImageBundle imageBundle = GWT.create(DashboardImageBundle.class);
+		group.add(ngoRadio);
+		group.add(fundingRadio);
+		group.add(partnerRadio);
+		group.setAutoWidth(true);
 
-            @Override
-            public Object render(final ProjectDTOLight model, String property, ColumnData config, int rowIndex,
-                    int colIndex, final ListStore&lt;ProjectDTOLight&gt; store, final Grid&lt;ProjectDTOLight&gt; grid) {
-            	
-            	//A star icon
-                final Image icon;
-                                             
-                if (isFavoriteProject(authentication.getUserId(),model)) {
-                	//star
-                    icon = imageBundle.star().createImage();
-                    icon.setTitle(&quot;Favorite&quot;);
-                } else {
-                	//empty start
-                    icon = imageBundle.emptyStar().createImage();
-                    icon.setTitle(&quot;Non-favorite&quot;);
-                }
+		// Expand all button.
+		final Button expandButton = new Button(&quot;&quot;, IconImageBundle.ICONS.expand(),
+						new SelectionListener&lt;ButtonEvent&gt;() {
 
-                //Star icon click-handler
-                icon.addClickHandler(new ClickHandler() {
+							@Override
+							public void componentSelected(ButtonEvent ce) {
+								projectTreeGrid.expandAll();
+							}
+						});
 
-                    @Override
-                    public void onClick(ClickEvent event) {
+		// Collapse all button.
+		final Button collapseButton = new Button(&quot;&quot;, IconImageBundle.ICONS.collapse(),
+						new SelectionListener&lt;ButtonEvent&gt;() {
 
-                    	UpdateProjectFavorite updateCmd ;
-                    	
-                    	//Get the project's id
-                    	int projectId = model.getId();
-                		if(projectId&lt;0) {
-                			projectId = (Integer) model.get(&quot;pid&quot;);
-                		}
-                		
-                    	
-                    	if(isFavoriteProject(authentication.getUserId(),model))
-                    	{//Remove the favorite user from project favorite user list
-                    	              	   
-                    		 updateCmd = new UpdateProjectFavorite(projectId,UpdateProjectFavorite.UpdateType.REMOVE);
-                    		                    		
-                    	}
-                    	else
-                    	{//Add current user into the favorite user list of the project
-                    		
-                    		 updateCmd = new UpdateProjectFavorite(projectId,UpdateProjectFavorite.UpdateType.ADD);                   		
-                    		
-                    	}
-                    	
-                    	//RPC to change the favorite tag
-                    	dispatcher.execute(updateCmd, new MaskingAsyncMonitor(projectTreePanel, I18N.CONSTANTS.loading()), new AsyncCallback&lt;CreateResult&gt;(){
-
 							@Override
-							public void onFailure(Throwable caught) {
-								
-								  Log.error(
-	                                        &quot;[execute] Error while setting the favorite status of the project #&quot;
-	                                                + model.getId(), caught);
-	                                MessageBox.alert(I18N.CONSTANTS.projectStarredError(),
-	                                        I18N.CONSTANTS.projectStarredErrorDetails(), null);
-	                            
-								
+							public void componentSelected(ButtonEvent ce) {
+								projectTreeGrid.collapseAll();
 							}
+						});
 
+		// Filter button.
+		filterButton = new Button(I18N.CONSTANTS.filter(), IconImageBundle.ICONS.filter());
+
+		// Refresh button.
+		final Button refreshButton = new Button(I18N.CONSTANTS.refreshProjectList(), IconImageBundle.ICONS.refresh(),
+						new SelectionListener&lt;ButtonEvent&gt;() {
+
 							@Override
-							public void onSuccess(CreateResult result) {
-								
-								if(result==null || result.getEntity()==null)
-								{
-		                                MessageBox.alert(I18N.CONSTANTS.projectStarredError(),
-		                                        I18N.CONSTANTS.projectStarredErrorDetails(), null);
-								}
-								else
-								{
-									//Update local store
-									ProjectDTOLight resultProject =(ProjectDTOLight) result.getEntity();
-									model.setFavoriteUsers(resultProject.getFavoriteUsers());
-									store.update(model);
-									
-									Notification.show(I18N.CONSTANTS.infoConfirmation(),
-                                            I18N.CONSTANTS.projectStarred());
-								 
-																													
-								}
-								
-								
+							public void componentSelected(ButtonEvent ce) {
+								// Explicit refresh.
+								refreshProjectGrid(command);
 							}
-                			
-                		});
-                    	                    	
-                 
-                    }
-                });
+						});
+		refreshButton.setToolTip(I18N.CONSTANTS.refreshProjectListDetails());
+		refreshButton.addStyleName(&quot;project-refresh-button&quot;);
 
-                icon.addStyleName(&quot;project-starred-icon&quot;);
+		// Refresh date.
+		refreshDateLabel = new com.extjs.gxt.ui.client.widget.Label();
 
-                return icon;
-            }
-        });
+		eventBus.addListener(AppEvents.DeleteProject, new Listener&lt;ProjectEvent&gt;() {
 
-        // Code
-        final ColumnConfig codeColumn = new ColumnConfig(&quot;name&quot;, I18N.CONSTANTS.projectName(), 110);
-        codeColumn.setRenderer(new WidgetTreeGridCellRenderer&lt;ProjectDTOLight&gt;() {
-            @Override
-            public Widget getWidget(ProjectDTOLight model, String property, ColumnData config, int rowIndex,
-                    int colIndex, ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+			@Override
+			public void handleEvent(ProjectEvent be) {
+				refreshProjectGrid(command);
+			}
+		});
 
-                Integer id = model.get(&quot;id&quot;);
-                if (id &lt;= 0) {
-                    id = model.get(&quot;pid&quot;);
-                }
+		final ToolBar toolbar = new ToolBar();
+		if (refreshMode == RefreshMode.BUTTON || refreshMode == RefreshMode.BOTH) {
+			toolbar.add(refreshButton);
+			toolbar.add(refreshDateLabel);
+			toolbar.add(new SeparatorToolItem());
+		}
+		toolbar.add(expandButton);
+		toolbar.add(collapseButton);
+		toolbar.add(new SeparatorToolItem());
+		toolbar.add(filterButton);
+		toolbar.add(new WidgetComponent(headLabel));
+		toolbar.add(ngoRadio);
+		toolbar.add(ngoIcon);
+		toolbar.add(new WidgetComponent(ngoLabel));
+		toolbar.add(fundingRadio);
+		toolbar.add(fundingIcon);
+		toolbar.add(new WidgetComponent(fundingLabel));
+		toolbar.add(partnerRadio);
+		toolbar.add(partnerIcon);
+		toolbar.add(new WidgetComponent(partnerLabel));
 
-                final Hyperlink h = new Hyperlink((String) model.get(property), true, ProjectPresenter.PAGE_ID
-                        .toString() + '!' + String.valueOf(id));
-                if (!model.isLeaf()) {
-                    h.addStyleName(&quot;project-grid-node&quot;);
-                } else {
-                    h.addStyleName(&quot;project-grid-leaf&quot;);
-                }
+		if (ProfileUtils.isGranted(authentication, GlobalPermissionEnum.GLOBAL_EXPORT)) {
+			final GlobalExportForm globalExportForm = new GlobalExportForm(authentication.getOrganizationId(),
+							dispatcher);
+			toolbar.add(new FillToolItem());
+			toolbar.add(globalExportForm.getButton());
+			toolbar.add(globalExportForm.getExportForm());
+		}
 
-                final com.google.gwt.user.client.ui.Grid panel = new com.google.gwt.user.client.ui.Grid(1, 2);
-                panel.setCellPadding(0);
-                panel.setCellSpacing(0);
+		// Panel
+		projectTreePanel = new ContentPanel(new FitLayout());
+		projectTreePanel.setHeading(I18N.CONSTANTS.projects());
 
-                panel.setWidget(
-                        0,
-                        0,
-                        FundingIconProvider.getProjectTypeIcon(
-                                model.getProjectModelType(authentication.getOrganizationId()), IconSize.SMALL_MEIDUM)
-                                .createImage());
-                panel.getCellFormatter().addStyleName(0, 0, &quot;project-grid-code-icon&quot;);
-                panel.setWidget(0, 1, h);
-                panel.getCellFormatter().addStyleName(0, 1, &quot;project-grid-code&quot;);
+		projectTreePanel.setTopComponent(toolbar);
 
-                return panel;
-            }
-        });
+		if (ProfileUtils.isGranted(authentication, GlobalPermissionEnum.VIEW_PROJECT)) {
+			projectTreePanel.add(projectTreeGrid);
+		} else {
+			final HTML insufficient = new HTML(I18N.CONSTANTS.permViewProjectsInsufficient());
+			insufficient.addStyleName(&quot;important-label&quot;);
+			projectTreePanel.add(insufficient);
+		}
 
-        // Title
-        final ColumnConfig titleColumn = new ColumnConfig(&quot;fullName&quot;, I18N.CONSTANTS.projectFullName(), 230);
-        titleColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+		// getProjectsStore().addFilter(closedFilter);
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                String title = (String) model.get(property);
-                if (model.getParent() != null) {
-                    title = &quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot; + title;
-                }
-                return createProjectGridText(model, title);
-            }
-        });
+		addListeners();
+		addFilters();
 
-        // Current phase
-        final ColumnConfig currentPhaseName = new ColumnConfig(&quot;currentPhaseName&quot;, I18N.CONSTANTS.projectActivePhase(), 150);
-        currentPhaseName.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                return createProjectGridText(model, (String) model.get(property));
-            }
-        });
+		getProjectsPanel().addListener(Events.AfterLayout, new Listener&lt;BaseEvent&gt;() {
 
-        // Org Unit
-        final ColumnConfig orgUnitColumn = new ColumnConfig(&quot;orgUnitName&quot;, I18N.CONSTANTS.orgunit(), 150);
-        orgUnitColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+			@Override
+			public void handleEvent(BaseEvent be) {
+				gridFilters.getFilter(&quot;time&quot;).setActive(true, false);
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                return createProjectGridText(model, (String) model.get(property));
-            }
-        });
+			}
+		});
 
-        // Ratio budget
-        final ColumnConfig spentBudgetColumn = new ColumnConfig(&quot;spentBudget&quot;, I18N.CONSTANTS.projectSpendBudget(), 100);
-        spentBudgetColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+	}
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                return new RatioBar(NumberUtils.ratio(model.getSpendBudget(), model.getPlannedBudget()));
-            }
-        });
+	/**
+	 * Builds and returns the columns model for the projects tree grid.
+	 * 
+	 * @return The project tree grid columns model.
+	 */
+	private ColumnModel getProjectGridColumnModel() {
 
-        // Planned budget
-        final ColumnConfig plannedBudgetColumn = new ColumnConfig(&quot;plannedBudget&quot;,
-                I18N.CONSTANTS.projectPlannedBudget(), 75);
-        plannedBudgetColumn.setHidden(true);
+		final DateTimeFormat format = DateUtils.DATE_SHORT;
 
-        // Spend budget
-        final ColumnConfig spendBudgetColumn = new ColumnConfig(&quot;spendBudget&quot;, I18N.CONSTANTS.projectSpendBudget(), 75);
-        spendBudgetColumn.setHidden(true);
+		// Starred icon
+		final ColumnConfig starredIconColumn = new ColumnConfig(&quot;starred&quot;, &quot;&quot;, 30);
+		starredIconColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+			private final DashboardImageBundle imageBundle = GWT.create(DashboardImageBundle.class);
 
-        // Received budget
-        final ColumnConfig receivedBudgetColumn = new ColumnConfig(&quot;receivedBudget&quot;,
-                I18N.CONSTANTS.projectReceivedBudget(), 75);
-        receivedBudgetColumn.setHidden(true);
+			@Override
+			public Object render(final ProjectDTOLight model, String property, ColumnData config, int rowIndex,
+							int colIndex, final ListStore&lt;ProjectDTOLight&gt; store, final Grid&lt;ProjectDTOLight&gt; grid) {
 
-        // Time
-        final ColumnConfig timeColumn = new ColumnConfig(&quot;time&quot;, I18N.CONSTANTS.projectTime(), 100);
-        timeColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+				// A star icon
+				final Image icon;
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                return new RatioBar(model.getElapsedTime());
-            }
-        });
+				if (isFavoriteProject(authentication.getUserId(), model)) {
+					// star
+					icon = imageBundle.star().createImage();
+					icon.setTitle(&quot;Favorite&quot;);
+				} else {
+					// empty start
+					icon = imageBundle.emptyStar().createImage();
+					icon.setTitle(&quot;Non-favorite&quot;);
+				}
 
-        // Start date
-        final ColumnConfig startDateColumn = new ColumnConfig(&quot;startDate&quot;, I18N.CONSTANTS.projectStartDate(), 75);
-        startDateColumn.setHidden(true);
-        startDateColumn.setDateTimeFormat(format);
-        startDateColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+				// Star icon click-handler
+				icon.addClickHandler(new ClickHandler() {
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                final Date d = (Date) model.get(property);
-                return createProjectGridText(model, d != null ? format.format(d) : &quot;&quot;);
-            }
-        });
+					@Override
+					public void onClick(ClickEvent event) {
 
-        // End date
-        final ColumnConfig endDateColumn = new ColumnConfig(&quot;endDate&quot;, I18N.CONSTANTS.projectEndDate(), 75);
-        endDateColumn.setDateTimeFormat(format);
-        endDateColumn.setHidden(true);
-        endDateColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+						UpdateProjectFavorite updateCmd;
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                final Date d = (Date) model.get(property);
-                return createProjectGridText(model, d != null ? format.format(d) : &quot;&quot;);
-            }
-        });
+						// Get the project's id
+						int projectId = model.getId();
+						if (projectId &lt; 0) {
+							projectId = (Integer) model.get(&quot;pid&quot;);
+						}
 
-        // Close date
-        final ColumnConfig closeDateColumn = new ColumnConfig(&quot;closeDate&quot;, I18N.CONSTANTS.projectClosedDate(), 75);
-        closeDateColumn.setDateTimeFormat(format);
-        closeDateColumn.setHidden(true);
-        closeDateColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+						if (isFavoriteProject(authentication.getUserId(), model)) {// Remove
+																					// the
+																					// favorite
+																					// user
+																					// from
+																					// project
+																					// favorite
+																					// user
+																					// list
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                final Date d = (Date) model.get(property);
-                return createProjectGridText(model, d != null ? format.format(d) : &quot;&quot;);
-            }
-        });
+							updateCmd = new UpdateProjectFavorite(projectId, UpdateProjectFavorite.UpdateType.REMOVE);
 
-        // Activity
-        final ColumnConfig activityColumn = new ColumnConfig(&quot;activity&quot;, I18N.CONSTANTS.logFrameActivity(), 100);
-        activityColumn.setSortable(false);
-        activityColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+						} else {// Add current user into the favorite user list
+								// of the project
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                return new RatioBar(model.getActivityAdvancement() != null ? model.getActivityAdvancement() : 0);
-            }
-        });
+							updateCmd = new UpdateProjectFavorite(projectId, UpdateProjectFavorite.UpdateType.ADD);
 
-        // Category
-        final ColumnConfig categoryColumn = new ColumnConfig(&quot;categoryElements&quot;, I18N.CONSTANTS.category(), 150);
-        categoryColumn.setSortable(false);
-        categoryColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+						}
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+						// RPC to change the favorite tag
+						dispatcher.execute(updateCmd,
+										new MaskingAsyncMonitor(projectTreePanel, I18N.CONSTANTS.loading()),
+										new AsyncCallback&lt;CreateResult&gt;() {
 
-                final Set&lt;CategoryElementDTO&gt; elements = model.getCategoryElements();
-                final LayoutContainer panel = new LayoutContainer();
-                panel.setLayout(new FlowLayout());
-                final FlowData data = new FlowData(new Margins(0, 5, 0, 0));
+											@Override
+											public void onFailure(Throwable caught) {
 
-                if (elements != null) {
-                    for (final CategoryElementDTO element : elements) {
-                        panel.add(CategoryIconProvider.getIcon(element), data);
-                    }
-                }
+												Log.error(&quot;[execute] Error while setting the favorite status of the project #&quot;
+																+ model.getId(), caught);
+												MessageBox.alert(I18N.CONSTANTS.projectStarredError(),
+																I18N.CONSTANTS.projectStarredErrorDetails(), null);
 
-                return panel;
-            }
-        });
+											}
 
-        return new ColumnModel(Arrays.asList(starredIconColumn, codeColumn, titleColumn, currentPhaseName,
-                orgUnitColumn, spentBudgetColumn, plannedBudgetColumn, spendBudgetColumn, receivedBudgetColumn,
-                startDateColumn, endDateColumn, closeDateColumn, timeColumn, activityColumn, categoryColumn));
-    }
-    
-    /*
-     * Grid filters for projects' TreeGrid  
-     */
+											@Override
+											public void onSuccess(CreateResult result) {
+
+												if (result == null || result.getEntity() == null) {
+													MessageBox.alert(I18N.CONSTANTS.projectStarredError(),
+																	I18N.CONSTANTS.projectStarredErrorDetails(), null);
+												} else {
+													// Update local store
+													ProjectDTOLight resultProject = (ProjectDTOLight) result
+																	.getEntity();
+													model.setFavoriteUsers(resultProject.getFavoriteUsers());
+													store.update(model);
+
+													Notification.show(I18N.CONSTANTS.infoConfirmation(),
+																	I18N.CONSTANTS.projectStarred());
+
+												}
+
+											}
+
+										});
+
+					}
+				});
+
+				icon.addStyleName(&quot;project-starred-icon&quot;);
+
+				return icon;
+			}
+		});
+
+		// Code
+		final ColumnConfig codeColumn = new ColumnConfig(&quot;name&quot;, I18N.CONSTANTS.projectName(), 110);
+		codeColumn.setRenderer(new WidgetTreeGridCellRenderer&lt;ProjectDTOLight&gt;() {
+			@Override
+			public Widget getWidget(ProjectDTOLight model, String property, ColumnData config, int rowIndex,
+							int colIndex, ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+
+				Integer id = model.get(&quot;id&quot;);
+				if (id &lt;= 0) {
+					id = model.get(&quot;pid&quot;);
+				}
+
+				final Hyperlink h = new Hyperlink((String) model.get(property), true, ProjectPresenter.PAGE_ID
+								.toString() + '!' + String.valueOf(id));
+				if (!model.isLeaf()) {
+					h.addStyleName(&quot;project-grid-node&quot;);
+				} else {
+					h.addStyleName(&quot;project-grid-leaf&quot;);
+				}
+
+				final com.google.gwt.user.client.ui.Grid panel = new com.google.gwt.user.client.ui.Grid(1, 2);
+				panel.setCellPadding(0);
+				panel.setCellSpacing(0);
+
+				panel.setWidget(0,
+								0,
+								FundingIconProvider.getProjectTypeIcon(
+												model.getProjectModelType(authentication.getOrganizationId()),
+												IconSize.SMALL_MEIDUM).createImage());
+				panel.getCellFormatter().addStyleName(0, 0, &quot;project-grid-code-icon&quot;);
+				panel.setWidget(0, 1, h);
+				panel.getCellFormatter().addStyleName(0, 1, &quot;project-grid-code&quot;);
+
+				return panel;
+			}
+		});
+
+		// Title
+		final ColumnConfig titleColumn = new ColumnConfig(&quot;fullName&quot;, I18N.CONSTANTS.projectFullName(), 230);
+		titleColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				String title = (String) model.get(property);
+				if (model.getParent() != null) {
+					title = &quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot; + title;
+				}
+				return createProjectGridText(model, title);
+			}
+		});
+
+		// Current phase
+		final ColumnConfig currentPhaseName = new ColumnConfig(&quot;currentPhaseName&quot;, I18N.CONSTANTS.projectActivePhase(),
+						150);
+		currentPhaseName.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				return createProjectGridText(model, (String) model.get(property));
+			}
+		});
+
+		// Org Unit
+		final ColumnConfig orgUnitColumn = new ColumnConfig(&quot;orgUnitName&quot;, I18N.CONSTANTS.orgunit(), 150);
+		orgUnitColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				return createProjectGridText(model, (String) model.get(property));
+			}
+		});
+
+		// Ratio budget
+		final ColumnConfig spentBudgetColumn = new ColumnConfig(&quot;spentBudget&quot;, I18N.CONSTANTS.projectSpendBudget(), 100);
+		spentBudgetColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				return new RatioBar(NumberUtils.ratio(model.getSpendBudget(), model.getPlannedBudget()));
+			}
+		});
+
+		// Planned budget
+		final ColumnConfig plannedBudgetColumn = new ColumnConfig(&quot;plannedBudget&quot;,
+						I18N.CONSTANTS.projectPlannedBudget(), 75);
+		plannedBudgetColumn.setHidden(true);
+
+		// Spend budget
+		final ColumnConfig spendBudgetColumn = new ColumnConfig(&quot;spendBudget&quot;, I18N.CONSTANTS.projectSpendBudget(), 75);
+		spendBudgetColumn.setHidden(true);
+
+		// Received budget
+		final ColumnConfig receivedBudgetColumn = new ColumnConfig(&quot;receivedBudget&quot;,
+						I18N.CONSTANTS.projectReceivedBudget(), 75);
+		receivedBudgetColumn.setHidden(true);
+
+		// Time
+		final ColumnConfig timeColumn = new ColumnConfig(&quot;time&quot;, I18N.CONSTANTS.projectTime(), 100);
+		timeColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				if (!model.isClosed())
+					return new RatioBar(model.getElapsedTime());
+				else
+					return new Label(I18N.CONSTANTS.projectClosedLabel());
+			}
+		});
+
+		// Start date
+		final ColumnConfig startDateColumn = new ColumnConfig(&quot;startDate&quot;, I18N.CONSTANTS.projectStartDate(), 75);
+		startDateColumn.setHidden(true);
+		startDateColumn.setDateTimeFormat(format);
+		startDateColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				final Date d = (Date) model.get(property);
+				return createProjectGridText(model, d != null ? format.format(d) : &quot;&quot;);
+			}
+		});
+
+		// End date
+		final ColumnConfig endDateColumn = new ColumnConfig(&quot;endDate&quot;, I18N.CONSTANTS.projectEndDate(), 75);
+		endDateColumn.setDateTimeFormat(format);
+		endDateColumn.setHidden(true);
+		endDateColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				final Date d = (Date) model.get(property);
+				return createProjectGridText(model, d != null ? format.format(d) : &quot;&quot;);
+			}
+		});
+
+		// Close date
+		final ColumnConfig closeDateColumn = new ColumnConfig(&quot;closeDate&quot;, I18N.CONSTANTS.projectClosedDate(), 75);
+		closeDateColumn.setDateTimeFormat(format);
+		closeDateColumn.setHidden(true);
+		closeDateColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				final Date d = (Date) model.get(property);
+				return createProjectGridText(model, d != null ? format.format(d) : &quot;&quot;);
+			}
+		});
+
+		// Activity
+		final ColumnConfig activityColumn = new ColumnConfig(&quot;activity&quot;, I18N.CONSTANTS.logFrameActivity(), 100);
+		activityColumn.setSortable(false);
+		activityColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				return new RatioBar(model.getActivityAdvancement() != null ? model.getActivityAdvancement() : 0);
+			}
+		});
+
+		// Category
+		final ColumnConfig categoryColumn = new ColumnConfig(&quot;categoryElements&quot;, I18N.CONSTANTS.category(), 150);
+		categoryColumn.setSortable(false);
+		categoryColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+
+				final Set&lt;CategoryElementDTO&gt; elements = model.getCategoryElements();
+				final LayoutContainer panel = new LayoutContainer();
+				panel.setLayout(new FlowLayout());
+				final FlowData data = new FlowData(new Margins(0, 5, 0, 0));
+
+				if (elements != null) {
+					for (final CategoryElementDTO element : elements) {
+						panel.add(CategoryIconProvider.getIcon(element), data);
+					}
+				}
+
+				return panel;
+			}
+		});
+
+		return new ColumnModel(Arrays.asList(starredIconColumn, codeColumn, titleColumn, currentPhaseName,
+						orgUnitColumn, spentBudgetColumn, plannedBudgetColumn, spendBudgetColumn, receivedBudgetColumn,
+						startDateColumn, endDateColumn, closeDateColumn, timeColumn, activityColumn, categoryColumn));
+	}
+
+	/*
+	 * Grid filters for projects' TreeGrid
+	 */
 	private GridFilters createGridFilters() {
 
 		gridFilters.setLocal(true);
 
-		/*		 
-		 * Data index of each filter should be identical with column id 
-		 * in ColumnConfig of TreeGrid
+		/*
+		 * Data index of each filter should be identical with column id in
+		 * ColumnConfig of TreeGrid
 		 */
-		
-		//Common filters
+
+		// Common filters
 		gridFilters.addFilter(new StringFilter(&quot;name&quot;));
 		gridFilters.addFilter(new StringFilter(&quot;fullName&quot;));
 		gridFilters.addFilter(new StringFilter(&quot;currentPhaseName&quot;));
@@ -795,7 +950,7 @@
 		gridFilters.addFilter(new DateFilter(&quot;closeDate&quot;));
 
 		// Custom filter for category elements' list
-		ListFilter categoryListFilter = new ListFilter(&quot;categoryElements&quot;,new ListStore&lt;ModelData&gt;()) {
+		ListFilter categoryListFilter = new ListFilter(&quot;categoryElements&quot;, new ListStore&lt;ModelData&gt;()) {
 			@SuppressWarnings(&quot;unchecked&quot;)
 			@Override
 			public boolean validateModel(ModelData model) {
@@ -806,7 +961,7 @@
 				if (elementsPerProject != null) {
 					String label = null;
 					for (final CategoryElementDTO element : elementsPerProject) {
-						label = element.getLabel() + &quot; (&quot;+ element.getParentCategoryDTO().getLabel()+ &quot;)&quot;;
+						label = element.getLabel() + &quot; (&quot; + element.getParentCategoryDTO().getLabel() + &quot;)&quot;;
 						if (filterLabels.contains(label)) {
 							return true;
 						}
@@ -820,49 +975,78 @@
 		};
 		categoryListFilter.setDisplayProperty(&quot;categoryFilter&quot;);
 		gridFilters.addFilter(categoryListFilter);
-		
+
+		ClosedFilter closed = new ClosedFilter(&quot;time&quot;);
+		gridFilters.addFilter(closed);
+
+		// gridFilters.addFilter(new DateFilter(&quot;time&quot;));
+
+		// closed.addListener(Events.Activate, new Listener&lt;BaseEvent&gt;() {
+		//
+		// @Override
+		// public void handleEvent(BaseEvent be) {
+		// if (getProjectsStore().getFilters().contains(closedFilter)) {
+		// getProjectsStore().removeFilter(closedFilter);
+		// applyProjectFilters();
+		//
+		// }
+		//
+		// }
+		// });
+
+		// closed.addListener(Events.Deactivate, new Listener&lt;BaseEvent&gt;() {
+		//
+		// @Override
+		// public void handleEvent(BaseEvent be) {
+		// if (!getProjectsStore().getFilters().contains(closedFilter)) {
+		// getProjectsStore().addFilter(closedFilter);
+		// applyProjectFilters();
+		//
+		// }
+		//
+		// }
+		// });
+
 		return gridFilters;
 	}
-	
 
 	/*
-	 * Fetches categories in active user's organization and
-	 * fills {@link ListFilter} store of a category column  
+	 * Fetches categories in active user's organization and fills {@link
+	 * ListFilter} store of a category column
 	 */
 	private void reloadCategoryListFilterStore() {
-		dispatcher.execute(new GetCategories(), null,
-				new AsyncCallback&lt;CategoriesListResult&gt;() {
+		dispatcher.execute(new GetCategories(), null, new AsyncCallback&lt;CategoriesListResult&gt;() {
 
-					@Override
-					public void onFailure(Throwable e) {
-						Log.error(&quot;[GetCategories command] Error while getting categories.&quot;,e);
-					}
+			@Override
+			public void onFailure(Throwable e) {
+				Log.error(&quot;[GetCategories command] Error while getting categories.&quot;, e);
+			}
 
-					@SuppressWarnings(&quot;unchecked&quot;)
-					@Override
-					public void onSuccess(CategoriesListResult result) {
-						ListFilter categoryListFilter = (ListFilter) gridFilters.getFilter(&quot;categoryElements&quot;);
-						ListStore&lt;ModelData&gt; filterStore = categoryListFilter.getStore();						
- 						List&lt;CategoryTypeDTO&gt; categories = result.getList();
-						
-						for (CategoryTypeDTO category : categories) {
-							List&lt;CategoryElementDTO&gt; categoryElements = category.getCategoryElementsDTO();
-							for (CategoryElementDTO element : categoryElements) {
-								String filterLabel = element.getLabel() + &quot; (&quot;+ category.getLabel() + &quot;)&quot;;
-								boolean exist=false;
- 								 for(ModelData model : filterStore.getModels()){
-										if(model.get(&quot;categoryFilter&quot;).equals(filterLabel)){
-											exist=true;
-											break;
-										}
-								  }
- 								 if(!exist){
- 									 filterStore.add(getFilterModelData(filterLabel));
- 								 }
+			@SuppressWarnings(&quot;unchecked&quot;)
+			@Override
+			public void onSuccess(CategoriesListResult result) {
+				ListFilter categoryListFilter = (ListFilter) gridFilters.getFilter(&quot;categoryElements&quot;);
+				ListStore&lt;ModelData&gt; filterStore = categoryListFilter.getStore();
+				List&lt;CategoryTypeDTO&gt; categories = result.getList();
+
+				for (CategoryTypeDTO category : categories) {
+					List&lt;CategoryElementDTO&gt; categoryElements = category.getCategoryElementsDTO();
+					for (CategoryElementDTO element : categoryElements) {
+						String filterLabel = element.getLabel() + &quot; (&quot; + category.getLabel() + &quot;)&quot;;
+						boolean exist = false;
+						for (ModelData model : filterStore.getModels()) {
+							if (model.get(&quot;categoryFilter&quot;).equals(filterLabel)) {
+								exist = true;
+								break;
 							}
-						} 
+						}
+						if (!exist) {
+							filterStore.add(getFilterModelData(filterLabel));
+						}
 					}
-				});
+				}
+			}
+		});
 	}
 
 	private ModelData getFilterModelData(String filterLabel) {
@@ -871,323 +1055,541 @@
 		return model;
 	}
 
-    private Object createProjectGridText(ProjectDTOLight model, String content) {
-        final Text label = new Text(content);
-        if (!model.isLeaf()) {
-            label.addStyleName(&quot;project-grid-node&quot;);
-        } else {
-            label.addStyleName(&quot;project-grid-leaf&quot;);
-        }
-        return label;
-    }
+	private Object createProjectGridText(ProjectDTOLight model, String content) {
+		final Text label = new Text(content);
+		if (!model.isLeaf()) {
+			label.addStyleName(&quot;project-grid-node&quot;);
+		} else {
+			label.addStyleName(&quot;project-grid-leaf&quot;);
+		}
+		return label;
+	}
 
-    private void addListeners() {
+	private void addListeners() {
 
-        // Updates the projects grid heading when the store is filtered.
-        projectTreeGrid.getTreeStore().addListener(Store.Filter, new Listener&lt;StoreEvent&lt;ProjectDTOLight&gt;&gt;() {
+		// Updates the projects grid heading when the store is filtered.
+		projectTreeGrid.getTreeStore().addListener(Store.Filter, new Listener&lt;StoreEvent&lt;ProjectDTOLight&gt;&gt;() {
 
-            @Override
-            public void handleEvent(StoreEvent&lt;ProjectDTOLight&gt; be) {
-                projectTreePanel.setHeading(I18N.CONSTANTS.projects() + &quot; (&quot;
-                        + projectTreeGrid.getTreeStore().getChildCount() + ')');
-            }
-        });
+			@Override
+			public void handleEvent(StoreEvent&lt;ProjectDTOLight&gt; be) {
+				projectTreePanel.setHeading(I18N.CONSTANTS.projects() + &quot; (&quot;
+								+ projectTreeGrid.getTreeStore().getChildCount() + ')');
+			}
+		});
 
-        // Adds actions on filter by model type.
-        for (final ProjectModelType type : ProjectModelType.values()) {
-            getRadioFilter(type).addListener(Events.Change, new Listener&lt;FieldEvent&gt;() {
+		// Adds actions on filter by model type.
+		for (final ProjectModelType type : ProjectModelType.values()) {
+			getRadioFilter(type).addListener(Events.Change, new Listener&lt;FieldEvent&gt;() {
 
-                @Override
-                public void handleEvent(FieldEvent be) {
-                    if (Boolean.TRUE.equals(be.getValue())) {
-                        currentModelType = type;
-                        applyProjectFilters();
-                    }
-                }
-            });
-        }
-    }
+				@Override
+				public void handleEvent(FieldEvent be) {
+					if (Boolean.TRUE.equals(be.getValue())) {
+						currentModelType = type;
+						applyProjectFilters();
+					}
+				}
+			});
+		}
 
-    private void addFilters() {
+	}
 
-        // The filter by model type.
-        final StoreFilter&lt;ProjectDTOLight&gt; typeFilter = new StoreFilter&lt;ProjectDTOLight&gt;() {
+	private void addFilters() {
 
-            @Override
-            public boolean select(Store&lt;ProjectDTOLight&gt; store, ProjectDTOLight parent, ProjectDTOLight item,
-                    String property) {
+		// The filter by model type.
+		final StoreFilter&lt;ProjectDTOLight&gt; typeFilter = new StoreFilter&lt;ProjectDTOLight&gt;() {
 
-                boolean selected = false;
+			@Override
+			public boolean select(Store&lt;ProjectDTOLight&gt; store, ProjectDTOLight parent, ProjectDTOLight item,
+							String property) {
 
-                // Root item.
-                if (item.getParent() == null) {
-                    // A root item is filtered if its type doesn't match the
-                    // current type.
-                    selected = item.getVisibility(authentication.getOrganizationId()) == currentModelType;
-                }
-                // Child item
-                else {
-                    // A child item is filtered if its parent is filtered.
-                    selected = ((ProjectDTOLight) item.getParent()).getVisibility(authentication.getOrganizationId()) == currentModelType;
-                }
+				boolean selected = false;
 
-                return selected;
-            }
-        };
+				// Root item.
+				if (item.getParent() == null) {
+					// A root item is filtered if its type doesn't match the
+					// current type.
+					selected = item.getVisibility(authentication.getOrganizationId()) == currentModelType;
+				}
+				// Child item
+				else {
+					// A child item is filtered if its parent is filtered.
+					selected = ((ProjectDTOLight) item.getParent()).getVisibility(authentication.getOrganizationId()) == currentModelType;
+				}
 
-        getProjectsStore().addFilter(typeFilter);
+				return selected;
+			}
+		};
 
-        // Filters aren't used for the moment.
-        filterButton.setVisible(false);
-    }
+		getProjectsStore().addFilter(typeFilter);
 
-    private void applyProjectFilters() {
-        getProjectsStore().applyFilters(null);
-    }
+		// Filters aren't used for the moment.
+		filterButton.setVisible(false);
+	}
 
-    private Radio getRadioFilter(ProjectModelType type) {
+	private void applyProjectFilters() {
+		getProjectsStore().applyFilters(null);
+	}
 
-        if (type != null) {
-            switch (type) {
-            case NGO:
-                return ngoRadio;
-            case FUNDING:
-                return fundingRadio;
-            case LOCAL_PARTNER:
-                return partnerRadio;
-            }
-        }
+	private Radio getRadioFilter(ProjectModelType type) {
 
-        return null;
-    }
+		if (type != null) {
+			switch (type) {
+			case NGO:
+				return ngoRadio;
+			case FUNDING:
+				return fundingRadio;
+			case LOCAL_PARTNER:
+				return partnerRadio;
+			}
+		}
 
-    /**
-     * Display the given date as the last refreshed date.
-     * 
-     * @param date
-     *            The last refreshed date.
-     */
-    @SuppressWarnings(&quot;deprecation&quot;)
-    private void updateRefreshingDate(Date date) {
-        if (date != null) {
-            refreshDateLabel.setText(&quot;(&quot; + (date.getHours() &lt; 10 ? &quot;0&quot; + date.getHours() : date.getHours()) + &quot;h&quot;
-                    + (date.getMinutes() &lt; 10 ? &quot;0&quot; + date.getMinutes() : date.getMinutes()) + &quot;)&quot;);
-        }
-    }
+		return null;
+	}
 
-    /**
-     * Refreshes the projects grid with the current parameters.
-     * 
-     * @param cmd
-     *            The {@link GetProjects} command to execute.
-     */
-    private void refreshProjectGrid(GetProjects cmd) {
+	/**
+	 * Display the given date as the last refreshed date.
+	 * 
+	 * @param date
+	 *            The last refreshed date.
+	 */
+	@SuppressWarnings(&quot;deprecation&quot;)
+	private void updateRefreshingDate(Date date) {
+		if (date != null) {
+			refreshDateLabel.setText(&quot;(&quot; + (date.getHours() &lt; 10 ? &quot;0&quot; + date.getHours() : date.getHours()) + &quot;h&quot;
+							+ (date.getMinutes() &lt; 10 ? &quot;0&quot; + date.getMinutes() : date.getMinutes()) + &quot;)&quot;);
+		}
+	}
 
-        // Checks that the user can view projects.
-        if (!ProfileUtils.isGranted(authentication, GlobalPermissionEnum.VIEW_PROJECT)) {
-            return;
-        }
+	/**
+	 * Refreshes the projects grid with the current parameters.
+	 * 
+	 * @param cmd
+	 *            The {@link GetProjects} command to execute.
+	 */
+	private void refreshProjectGrid(GetProjects cmd) {
 
-        if (cmd == null) {
-            return;
-        }
+		// Checks that the user can view projects.
+		if (!ProfileUtils.isGranted(authentication, GlobalPermissionEnum.VIEW_PROJECT)) {
+			return;
+		}
 
-        //Reload filter labels for category filter list store
-        reloadCategoryListFilterStore();
-        
-        if (loadingMode == LoadingMode.ONE_TIME) {
+		if (cmd == null) {
+			return;
+		}
 
-            dispatcher.execute(cmd, new MaskingAsyncMonitor(projectTreePanel, I18N.CONSTANTS.loading()),
-                    new AsyncCallback&lt;ProjectListResult&gt;() {
+		// Reload filter labels for category filter list store
+		reloadCategoryListFilterStore();
 
-                        @Override
-                        public void onFailure(Throwable e) {
-                            Log.error(&quot;[GetProjects command] Error while getting projects.&quot;, e);
-                            // nothing
-                        }
+		if (loadingMode == LoadingMode.ONE_TIME) {
 
-                        @Override
-                        public void onSuccess(ProjectListResult result) {
+			dispatcher.execute(cmd, new MaskingAsyncMonitor(projectTreePanel, I18N.CONSTANTS.loading()),
+							new AsyncCallback&lt;ProjectListResult&gt;() {
 
-                            getProjectsStore().removeAll();
-                            getProjectsStore().clearFilters();
+								@Override
+								public void onFailure(Throwable e) {
+									Log.error(&quot;[GetProjects command] Error while getting projects.&quot;, e);
+									// nothing
+								}
 
-                            if (result != null) {
-                                final List&lt;ProjectDTOLight&gt; resultList = result.getListProjectsLightDTO();
-                                int i = -1;
-                                for (final ProjectDTOLight p : resultList) {
-                                    try {
-                                        // Project id.
-                                        p.setProjectId(p.getId());
-                                        // Tree id.
-                                        p.setId(i--);
+								@Override
+								public void onSuccess(ProjectListResult result) {
 
-                                        for (final ProjectDTOLight c : p.getChildrenProjects()) {
-                                            // Project id.
-                                            if (c != null) {
+									getProjectsStore().removeAll();
+									getProjectsStore().clearFilters();
 
-                                                c.setProjectId(c.getId());
-                                                // Tree id.
-                                                c.setId(i--);
+									if (result != null) {
+										final List&lt;ProjectDTOLight&gt; resultList = result.getListProjectsLightDTO();
+										int i = -1;
+										for (final ProjectDTOLight p : resultList) {
+											try {
+												// Project id.
+												p.setProjectId(p.getId());
+												// Tree id.
+												p.setId(i--);
 
-                                            }
-                                        }
-                                    } catch (Exception e) {
-                                        e.printStackTrace();
-                                    }
-                                }
-                                getProjectsStore().add(resultList, true);
-                            }
+												for (final ProjectDTOLight c : p.getChildrenProjects()) {
+													// Project id.
+													if (c != null) {
 
-                            applyProjectFilters();
-                            updateRefreshingDate(new Date());
-                        }
-                    });
-        } else if (loadingMode == LoadingMode.CHUNK) {
+														c.setProjectId(c.getId());
+														// Tree id.
+														c.setId(i--);
 
-            // Builds a new chunks worker.
+													}
+												}
+											} catch (Exception e) {
+												e.printStackTrace();
+											}
+										}
+										getProjectsStore().add(resultList, true);
+									}
 
-            int chunSize = 2;
-            try {
-                chunSize = Integer.parseInt(Window.Location.getParameter(&quot;chunk&quot;));
-                if (chunSize &lt;= 0) {
-                    chunSize = 2;
-                }
-            } catch (Throwable e) {
-                // swallow exception.
-            }
+									applyProjectFilters();
+									updateRefreshingDate(new Date());
+								}
+							});
+		} else if (loadingMode == LoadingMode.CHUNK) {
 
-            final GetProjectsWorker worker = new GetProjectsWorker(dispatcher, cmd, projectTreePanel, chunSize);
-            worker.addWorkerListener(new GetProjectsWorker.WorkerListener() {
+			// Builds a new chunks worker.
 
-                private int index = -1;
+			int chunSize = 2;
+			try {
+				chunSize = Integer.parseInt(Window.Location.getParameter(&quot;chunk&quot;));
+				if (chunSize &lt;= 0) {
+					chunSize = 2;
+				}
+			} catch (Throwable e) {
+				// swallow exception.
+			}
 
-                @Override
-                public void serverError(Throwable error) {
-                    Log.error(&quot;[GetProjectsWorker] Error while getting projects by chunks.&quot;, error);
-                    applyProjectFilters();
-                    updateRefreshingDate(new Date());
-                    MessageBox.alert(I18N.CONSTANTS.error(), I18N.CONSTANTS.refreshProjectListError(), null);
-                }
+			final GetProjectsWorker worker = new GetProjectsWorker(dispatcher, cmd, projectTreePanel, chunSize);
+			worker.addWorkerListener(new GetProjectsWorker.WorkerListener() {
 
-                @Override
-                public void chunkRetrieved(List&lt;ProjectDTOLight&gt; projects) {
+				private int index = -1;
 
-                    if (projects != null) {
-                        for (final ProjectDTOLight p : projects) {
-                            try {
-                                // Project id.
-                                p.setProjectId(p.getId());
-                                // Tree id.
-                                p.setId(index--);
+				@Override
+				public void serverError(Throwable error) {
+					Log.error(&quot;[GetProjectsWorker] Error while getting projects by chunks.&quot;, error);
+					applyProjectFilters();
+					updateRefreshingDate(new Date());
+					MessageBox.alert(I18N.CONSTANTS.error(), I18N.CONSTANTS.refreshProjectListError(), null);
+				}
 
-                                for (final ProjectDTOLight c : p.getChildrenProjects()) {
-                                    // Project id.
-                                    if (c != null) {
+				@Override
+				public void chunkRetrieved(List&lt;ProjectDTOLight&gt; projects) {
 
-                                        c.setProjectId(c.getId());
-                                        // Tree id.
-                                        c.setId(index--);
+					if (projects != null) {
+						for (final ProjectDTOLight p : projects) {
+							try {
+								// Project id.
+								p.setProjectId(p.getId());
+								// Tree id.
+								p.setId(index--);
 
-                                    }
-                                }
-                            } catch (Exception e) {
-                                e.printStackTrace();
-                            }
-                        }
-                        getProjectsStore().add(projects, true);
-                    }
-                }
+								for (final ProjectDTOLight c : p.getChildrenProjects()) {
+									// Project id.
+									if (c != null) {
 
-                @Override
-                public void ended() {
-                    applyProjectFilters();
-                    updateRefreshingDate(new Date());
-                }
-            });
+										c.setProjectId(c.getId());
+										// Tree id.
+										c.setId(index--);
 
-            // Runs the worker.
-            getProjectsStore().removeAll();
-            getProjectsStore().clearFilters();
-            worker.run();
-        }
-    }
+									}
+								}
+							} catch (Exception e) {
+								e.printStackTrace();
+							}
+						}
+						getProjectsStore().add(projects, true);
+					}
+				}
 
-    public ContentPanel getProjectsPanel() {
-        return projectTreePanel;
-    }
+				@Override
+				public void ended() {
+					applyProjectFilters();
+					updateRefreshingDate(new Date());
+				}
+			});
 
-    public TreeGrid&lt;ProjectDTOLight&gt; getProjectsTreeGrid() {
-        return projectTreeGrid;
-    }
+			// Runs the worker.
+			getProjectsStore().removeAll();
+			getProjectsStore().clearFilters();
 
-    public ProjectStore getProjectsStore() {
-        return (ProjectStore) projectTreeGrid.getTreeStore();
-    }
+			worker.run();
+		}
+	}
 
-    public RefreshMode getRefreshMode() {
-        return refreshMode;
-    }
+	public ContentPanel getProjectsPanel() {
+		return projectTreePanel;
+	}
 
-    /**
-     * Asks for a refresh of the projects list. If the refreshing mode is set to
-     * {@link RefreshMode#AUTOMATIC}, the list will be refreshed immediately.
-     * Otherwise, the list will be refreshed depending on the selected
-     * refreshing mode.
-     * 
-     * @param viewOwnOrManage
-     *            If the projects that the user own or manage must be included
-     *            in the list (no matter of their organizational units).
-     * @param orgUnitsIds
-     *            The list of ids of the organizational units for which the
-     *            projects will be retrieved. The projects of each the
-     *            sub-organizational units are retrieved automatically.
-     */
-    public void refresh(boolean viewOwnOrManage, Integer... orgUnitsIds) {
+	public TreeGrid&lt;ProjectDTOLight&gt; getProjectsTreeGrid() {
+		return projectTreeGrid;
+	}
 
-        final List&lt;Integer&gt; orgUnitsIdsAsList = Arrays.asList(orgUnitsIds);
+	public ProjectStore getProjectsStore() {
+		return (ProjectStore) projectTreeGrid.getTreeStore();
+	}
 
-        this.orgUnitsIds.clear();
-        this.orgUnitsIds.addAll(orgUnitsIdsAsList);
+	public RefreshMode getRefreshMode() {
+		return refreshMode;
+	}
 
-        // Builds the next refresh command.
-        command = new GetProjects();
-        command.setOrgUnitsIds(orgUnitsIdsAsList);
-        command.setViewOwnOrManage(viewOwnOrManage);
+	/**
+	 * Asks for a refresh of the projects list. If the refreshing mode is set to
+	 * {@link RefreshMode#AUTOMATIC}, the list will be refreshed immediately.
+	 * Otherwise, the list will be refreshed depending on the selected
+	 * refreshing mode.
+	 * 
+	 * @param viewOwnOrManage
+	 *            If the projects that the user own or manage must be included
+	 *            in the list (no matter of their organizational units).
+	 * @param orgUnitsIds
+	 *            The list of ids of the organizational units for which the
+	 *            projects will be retrieved. The projects of each the
+	 *            sub-organizational units are retrieved automatically.
+	 */
+	public void refresh(boolean viewOwnOrManage, Integer... orgUnitsIds) {
 
-        // If the mode is automatic, the list is refreshed immediately.
-        if (refreshMode == RefreshMode.AUTOMATIC || (refreshMode == RefreshMode.BOTH &amp;&amp; !isLoaded)) {
-            refreshProjectGrid(command);
-            isLoaded = true;
-        }
-    }
-    
-    /**
-     * 
-     * Check if the project is a favorite project of the current user.
-     * 
-     * @param userId
-     * 
-     * @param project
-     * 
-     * @return 
-     * 
-     * @author  HUZHE(zhe.hu32@gmail.com)	  
-     */
-    public boolean isFavoriteProject(int userId,ProjectDTOLight project)
-    {
-       if(project.getFavoriteUsers()==null)
-    	   return false;
-    	
-    	for(UserDTO u : project.getFavoriteUsers())
-    	{
-    		if(u.getId()==userId)   		
-    			return true;
-    		
-    	}
-    	
-    	return false;
-    }
-    
-    
+		final List&lt;Integer&gt; orgUnitsIdsAsList = Arrays.asList(orgUnitsIds);
+
+		this.orgUnitsIds.clear();
+		this.orgUnitsIds.addAll(orgUnitsIdsAsList);
+
+		// Builds the next refresh command.
+		command = new GetProjects();
+		command.setOrgUnitsIds(orgUnitsIdsAsList);
+		command.setViewOwnOrManage(viewOwnOrManage);
+
+		// If the mode is automatic, the list is refreshed immediately.
+		if (refreshMode == RefreshMode.AUTOMATIC || (refreshMode == RefreshMode.BOTH &amp;&amp; !isLoaded)) {
+			refreshProjectGrid(command);
+			isLoaded = true;
+		}
+	}
+
+	/**
+	 * 
+	 * Check if the project is a favorite project of the current user.
+	 * 
+	 * @param userId
+	 * 
+	 * @param project
+	 * 
+	 * @return
+	 * 
+	 * @author HUZHE(zhe.hu32@gmail.com)
+	 */
+	public boolean isFavoriteProject(int userId, ProjectDTOLight project) {
+		if (project.getFavoriteUsers() == null)
+			return false;
+
+		for (UserDTO u : project.getFavoriteUsers()) {
+			if (u.getId() == userId)
+				return true;
+
+		}
+
+		return false;
+	}
+
+	private class ClosedFilter extends Filter {
+
+		private Radio noneFilter, allFilter, sixMonthsFilter, twelveMonthsFilter, customFilter;
+		private DateMenu dateMenu;
+		private MenuItem hidden;
+
+		final private static String none = &quot;none&quot;;
+		final private static String all = &quot;all&quot;;
+		final private static String twelveMonths = &quot;twelve Months&quot;;
+		final private static String sixMonths = &quot;six Months&quot;;
+		final private static String custom = &quot;custom&quot;;
+
+		private RadioGroup radioGroup;
+
+		private Listener&lt;MenuEvent&gt; menuListener = new Listener&lt;MenuEvent&gt;() {
+			public void handleEvent(MenuEvent be) {
+				// if (be.getType() == Events.CheckChange) {
+				// onCheckChange(be);
+				// } else
+				if (be.getType() == Events.Select) {
+					onMenuSelect(be);
+				}
+			}
+		};
+
+		private Listener&lt;FieldEvent&gt; radioListener = new Listener&lt;FieldEvent&gt;() {
+
+			@Override
+			public void handleEvent(FieldEvent be) {
+
+				final RadioGroup radioGroupTemp;
+				final Radio clickedRadioBtn;
+
+				if (be.getSource() instanceof RadioGroup) {
+
+					radioGroupTemp = (RadioGroup) be.getSource();
+
+					clickedRadioBtn = radioGroupTemp.getValue();
+
+					if (clickedRadioBtn.getValueAttribute().equals(custom)) {
+
+						hidden.expandMenu();
+
+					} else {
+						menu.hide(true);
+						dateMenu.hide();
+						fireUpdate();
+					}
+
+					return;
+				}
+
+				if (be.getSource() instanceof Radio) {
+
+					clickedRadioBtn = (Radio) be.getSource();
+
+					if (be.getType() == Events.Focus &amp;&amp; clickedRadioBtn.getValueAttribute().equals(custom)) {
+
+						hidden.expandMenu();
+					}
+				}
+
+			}
+		};
+
+		public ClosedFilter(String dataIndex) {
+			super(dataIndex);
+
+			menu = new Menu();
+
+			noneFilter = new Radio();
+			noneFilter.setBoxLabel(I18N.CONSTANTS.noneFilter());
+			noneFilter.setValueAttribute(none);
+			noneFilter.setValue(true);
+
+			allFilter = new Radio();
+			allFilter.setBoxLabel(I18N.CONSTANTS.allFilter());
+			allFilter.setValueAttribute(all);
+
+			sixMonthsFilter = new Radio();
+			sixMonthsFilter.setBoxLabel(I18N.CONSTANTS.sixMonthsFilter());
+			sixMonthsFilter.setValueAttribute(sixMonths);
+
+			twelveMonthsFilter = new Radio();
+			twelveMonthsFilter.setBoxLabel(I18N.CONSTANTS.twelveMonthsFilter());
+			twelveMonthsFilter.setValueAttribute(twelveMonths);
+
+			customFilter = new Radio();
+			customFilter.setBoxLabel(I18N.CONSTANTS.customFilter());
+			customFilter.setValueAttribute(custom);
+			customFilter.addListener(Events.Focus, radioListener);
+
+			radioGroup = new RadioGroup();
+			radioGroup.setOrientation(Orientation.VERTICAL);
+
+			radioGroup.add(noneFilter);
+			radioGroup.add(sixMonthsFilter);
+			radioGroup.add(twelveMonthsFilter);
+
+			radioGroup.add(customFilter);
+
+			radioGroup.add(allFilter);
+
+			// menu.add(noneFilter);
+			//
+			// menu.add(sixMonthsFilter);
+			//
+			// menu.add(twelveMonthsFilter);
+			//
+			// menu.add(customFilter);
+			//
+			// menu.add(allFilter);
+			menu.add(radioGroup);
+			hidden = new MenuItem() {
+				@Override
+				public void expandMenu() {
+					if (isEnabled() &amp;&amp; subMenu != null) {
+						subMenu.setFocusOnShow(true);
+						subMenu.show(customFilter.getElement(), &quot;tl-tr?&quot;);
+					}
+				}
+			};
+			dateMenu = new DateMenu();
+
+			dateMenu.setDate(new Date());
+			dateMenu.addListener(Events.Select, menuListener);
+			hidden.setSubMenu(dateMenu);
+
+			menu.add(hidden);
+			hidden.hide();
+			radioGroup.addListener(Events.Change, radioListener);
+
+		}
+
+		protected void onMenuSelect(MenuEvent be) {
+			DateMenu d = null;
+
+			if (be.getMenu() == dateMenu) {
+				d = (DateMenu) be.getMenu();
+				d.hide(true);
+
+				fireUpdate();
+			}
+
+		}
+
+		@Override
+		public List&lt;FilterConfig&gt; getSerialArgs() {
+			// TODO Auto-generated method stub
+			return null;
+		}
+
+		@Override
+		public Object getValue() {
+			// TODO Auto-generated method stub
+
+			return null;
+		}
+
+		@Override
+		public void setValue(Object value) {
+			// TODO Auto-generated method stub
+
+		}
+
+		@Override
+		public boolean isActivatable() {
+
+			return true;
+		}
+
+		@Override
+		public boolean validateModel(ModelData model) {
+
+			final Radio clickedRadioBtn = radioGroup.getValue();
+
+			Date d = model.get(&quot;closeDate&quot;);
+			if (d == null) {
+				return true;
+			} else {
+
+				if (clickedRadioBtn.getValueAttribute().equals(all))
+					return true;
+				if (clickedRadioBtn.getValueAttribute().equals(none))
+					return false;
+				if (clickedRadioBtn.getValueAttribute().equals(sixMonths)) {
+					Date dateTemp = new Date();
+					CalendarUtil.addMonthsToDate(dateTemp, -6);
+					if (d.before(dateTemp))
+						return false;
+					else
+						return true;
+
+				}
+				if (clickedRadioBtn.getValueAttribute().equals(twelveMonths)) {
+					Date dateTemp = new Date();
+					CalendarUtil.addMonthsToDate(dateTemp, -12);
+					if (d.before(dateTemp))
+						return false;
+					else
+						return true;
+
+				}
+
+				if (clickedRadioBtn.getValueAttribute().equals(custom)) {
+
+					if (d.before(dateMenu.getDate()))
+						return false;
+					else
+						return true;
+				}
+
+				return false;
+
+			}
+
+		}
+
+	}
 }
Index: src/main/java/org/sigmah/public/sigmah.css
===================================================================
--- src/main/java/org/sigmah/public/sigmah.css	(Revision 1501)
+++ src/main/java/org/sigmah/public/sigmah.css	(Arbeitskopie)
@@ -36,8 +36,8 @@
 
 #alert {
 	clear: both;
-    overflow: hidden;
-    padding: 10px 15px 0;
+	overflow: hidden;
+	padding: 10px 15px 0;
 }
 
 .message {
@@ -45,7 +45,7 @@
 	border: 1px solid #EBAE7F;
 	padding: 4px 0 3px 30px;
 	color: #D85D01;
-	font: 11px arial,tahoma,helvetica,sans-serif;
+	font: 11px arial, tahoma, helvetica, sans-serif;
 }
 
 #username {
@@ -361,7 +361,7 @@
 
 .module-background {
 	background-color: #FFFFFF !important;
-	overflow : visible !important;
+	overflow: visible !important;
 }
 
 .panel-background {
@@ -373,23 +373,23 @@
 }
 
 .width-of-parent {
-	width : inherit !important;
+	width: inherit !important;
 }
 
 .height-of-parent {
-	height : inherit !important;	
+	height: inherit !important;
 }
 
 .form-radio label {
-    padding-left: 6px;
+	padding-left: 6px;
 }
 
 .form-text {
-	font: 12px tahoma,arial,helvetica,sans-serif;
+	font: 12px tahoma, arial, helvetica, sans-serif;
 }
 
-.form-radio &gt; input {
-	margin-left : 7px;
+.form-radio&gt;input {
+	margin-left: 7px;
 }
 
 .hyperlink a,.hyperlink a:active,.hyperlink a:hover,.hyperlink a:focus,.hyperlink a:link,.hyperlink a:visited
@@ -443,22 +443,20 @@
 
 .project-linkedProject-editButton {
 	width: 13px;
-    Height: 13px;
+	Height: 13px;
 }
 
 .project-linkedProject-editButton-down-hovering {
-    border: border-width : 1px;
+	border: border-width:  1px;
 	border-style: solid;
-	border-bottom-color:#FFFCEC;
+	border-bottom-color: #FFFCEC;
 	border-right-color: #FFFCEC;
 	border-top-color: #FFF8D7;
-	border-left-color:#FFF8D7;
-	
+	border-left-color: #FFF8D7;
 }
 
 .project-linkedProject-editButton-up-hovering {
-	
-	border: border-width : 1px;
+	border: border-width:  1px;
 	border-style: solid;
 	border-bottom-color: #FFF8D7;
 	border-right-color: #FFF8D7;
@@ -466,9 +464,6 @@
 	border-left-color: #FFFCEC;
 }
 
-
-
-
 .toolbar-title {
 	font-weight: bold !important;
 	margin-left: 4px;
@@ -856,16 +851,17 @@
 	background-image: url(./image/context_menu_icon_orange.png);
 }
 
-.log-frame-indicators-table{
-table-layout: fixed;
-margin-bottom: 8px;
+.log-frame-indicators-table {
+	table-layout: fixed;
+	margin-bottom: 8px;
 }
-.log-frame-indicators-table-cell{
-white-space: normal;
-width: 50%;
-overflow:hidden;
-border-bottom: solid 1px #EDEDED;
-padding: 5px 0 2px 2px;
+
+.log-frame-indicators-table-cell {
+	white-space: normal;
+	width: 50%;
+	overflow: hidden;
+	border-bottom: solid 1px #EDEDED;
+	padding: 5px 0 2px 2px;
 }
 /* --------------------------------------------- Reports */
 .project-report {
@@ -879,14 +875,14 @@
 	font-size: 10pt;
 	color: white;
 	width: 100%;
-	margin: 0 ;
+	margin: 0;
 	background-color: rgb(74, 63, 43);
 	padding-left: 8px;
 	padding-right: 24px;
 	line-height: 32px;
 }
 
-.project-report-personalDraft {	
+.project-report-personalDraft {
 	font-weight: bold;
 }
 
@@ -1060,20 +1056,19 @@
 	height: 8px;
 }
 
-
 /*----------------------------------------------- Password reset*/
-.update-form-message-title{
-font-family: tahoma, arial, helvetica, sans-serif;
+.update-form-message-title {
+	font-family: tahoma, arial, helvetica, sans-serif;
 	font-size: 13px;
 	font-weight: bold;
 	color: white;
-	padding:0 0 8px 8px;
+	padding: 0 0 8px 8px;
 }
 
-.update-form-message-content{
-font-family: tahoma, arial, helvetica, sans-serif;
+.update-form-message-content {
+	font-family: tahoma, arial, helvetica, sans-serif;
 	font-size: 12px;
- 	color: white;
+	color: white;
 	text-align: justify;
 }
 
@@ -1110,7 +1105,8 @@
 .blockStat {
 	border: 1px solid #B9A48F;
 	padding: 1px;
-	background: transparent url(image/ratio-bar-bg.png) repeat-x scroll 0 1px;
+	background: transparent url(image/ratio-bar-bg.png) repeat-x scroll 0
+		1px;
 }
 
 .blockStat div {
@@ -1182,7 +1178,6 @@
 	font-size: 10px;
 }
 
-
 .credits-manager-header {
 	font-weight: bold;
 }
@@ -1223,41 +1218,46 @@
 .credits-developer {
 	margin-left: 15px;
 	padding-top: 3px;
-	font-weight:bold;
+	font-weight: bold;
 }
 
 .credits-developer-email {
 	margin-left: 50px;
 }
 
-.backup-label{
-	background-color: F5F5DC	
+.backup-label {
+	background-color: F5F5DC
 }
-.orgunitModel-grid-nameLink{
+
+.orgunitModel-grid-nameLink {
 	text-decoration: underline;
 	cursor: pointer;
 	color: #4B3E2D;
 }
 
-.delete-anchor{
+.delete-anchor {
 	background: url(&quot;image/remove.png&quot;) no-repeat;
 	padding-left: 20px;
 }
 
-.export-spreadsheet-anchor{
+.export-spreadsheet-anchor {
 	background: url(&quot;image/excel.png&quot;) no-repeat;
 	padding-left: 20px;
 }
 
-
 .global-export-fields-table {
 	border: 1px solid lightgrey;
 	margin-bottom: 13px;
-    margin-top: 5px;	
+	margin-top: 5px;
 }
 
+.filtered-column-header {
+	background: url(&quot;image/filter.png&quot;) no-repeat left;
+	padding-left: 20px;
+}
+
 /*------------------------------------------------------ Linked Project Form*/
 .x-combo-list-item-disabled {
-	font-weight:bold !important;
-	text-align:center;
+	font-weight: bold !important;
+	text-align: center;
 }
\ No newline at end of file
</pre></span>
<br />
<a href="MockUp_337_third702e.zip?file_id=110&amp;type=bug"><img src="images/fileicons/zip.gif" alt="zip file icon" width="16" height="16" border="0" /></a>&#160;<a href="MockUp_337_third702e.zip?file_id=110&amp;type=bug">MockUp_337_third.zip</a> [<a href="MockUp_337_third702e.zip?file_id=110&amp;type=bug" target="_blank">^</a>] (100,048 bytes) <span class="italic">2013-08-21 06:17</span><br />
<a href="Menu-with-RadioButtonse190.png?file_id=111&amp;type=bug"><img src="images/fileicons/png.gif" alt="png file icon" width="16" height="16" border="0" /></a>&#160;<a href="Menu-with-RadioButtonse190.png?file_id=111&amp;type=bug">Menu-with-RadioButtons.png</a> [<a href="Menu-with-RadioButtonse190.png?file_id=111&amp;type=bug" target="_blank">^</a>] (12,666 bytes) <span class="italic">2013-08-22 09:47</span>
<br /><a href="Menu-with-RadioButtonse190.png?file_id=111&amp;type=bug"><img alt="" style="border: 0; max-height:250px;" src="Menu-with-RadioButtons8899.png?file_id=111&amp;type=bug&amp;show_inline=1&amp;file_show_inline_token=20180724202f293e914db2f3941606a98b8ca317040ef180" /></a><br />
<br /><a href="0000552_addition55fd.patch?file_id=117&amp;type=bug"><img src="images/fileicons/text.gif" alt="patch file icon" width="16" height="16" border="0" /></a>&#160;<a href="0000552_addition55fd.patch?file_id=117&amp;type=bug">0000552_addition.patch</a> [<a href="0000552_addition55fd.patch?file_id=117&amp;type=bug" target="_blank">^</a>] (2,027 bytes) <span class="italic">2013-08-26 07:14</span><script type="text/javascript" language="JavaScript">
<!--
function swap_content( span ) {
displayType = ( document.getElementById( span ).style.display == 'none' ) ? '' : 'none';
document.getElementById( span ).style.display = displayType;
}

 -->
 </script> <span id="hideSection_117">[<a class="small" href='#' id='attmlink_117' onclick='swap_content("hideSection_117");swap_content("showSection_117");return false;'>Show Content</a>]</span> <span style='display:none' id="showSection_117">[<a class="small" href='#' id='attmlink_117' onclick='swap_content("hideSection_117");swap_content("showSection_117");return false;'>Hide Content</a>]<pre>Index: src/main/java/org/sigmah/client/i18n/UIConstants.properties
===================================================================
--- src/main/java/org/sigmah/client/i18n/UIConstants.properties	(Revision 1501)
+++ src/main/java/org/sigmah/client/i18n/UIConstants.properties	(Arbeitskopie)
@@ -47,6 +47,15 @@
 # Global permissions
 VIEW_PROJECT = View project
 
+VIEW_LOGFRAME = View logframe
+
+EDIT_LOGFRAME = Edit logframe
+
+categoryProject = Project
+
+categoryNotMapped = Not in any Category
+
+
 acronym = Acronym
 
 activities = Activities
Index: src/main/java/org/sigmah/shared/domain/profile/GlobalPermissionEnum.java
===================================================================
--- src/main/java/org/sigmah/shared/domain/profile/GlobalPermissionEnum.java	(Revision 1501)
+++ src/main/java/org/sigmah/shared/domain/profile/GlobalPermissionEnum.java	(Arbeitskopie)
@@ -71,6 +71,18 @@
 	/**
 	 * Show global export button in projects list
 	 */
+
+	VIEW_LOGFRAME,
+	/**
+	 * for viewing the logframe sub-tab
+	 */
+
+	EDIT_LOGFRAME,
+
+	/**
+	 * for creating/modifying/deleting objectives, expected results, activities,
+	 * hypothesis or linking/unlinking indicators to the logframe
+	 */
 	GLOBAL_EXPORT;
 
 	public static String getName(GlobalPermissionEnum gp) {
@@ -112,10 +124,31 @@
 		case GLOBAL_EXPORT:
 			gpName = I18N.CONSTANTS.globalExport();
 			break;
+		case VIEW_LOGFRAME:
+			gpName = I18N.CONSTANTS.VIEW_LOGFRAME();
+			break;
+		case EDIT_LOGFRAME:
+			gpName = I18N.CONSTANTS.EDIT_LOGFRAME();
+			break;
 		default:
 			gpName = null;
 		}
 
 		return gpName;
 	}
+
+	public static String getCategory(GlobalPermissionEnum gp) {
+		String gpCategory = I18N.CONSTANTS.categoryNotMapped();
+		switch (gp) {
+		case VIEW_LOGFRAME:
+			gpCategory = I18N.CONSTANTS.categoryProject();
+			break;
+		case EDIT_LOGFRAME:
+			gpCategory = I18N.CONSTANTS.categoryProject();
+			break;
+		}
+
+		return gpCategory;
+	}
+
 }
</pre></span>
<br />
<a href="0000337_update3026.patch?file_id=121&amp;type=bug"><img src="images/fileicons/text.gif" alt="patch file icon" width="16" height="16" border="0" /></a>&#160;<a href="0000337_update3026.patch?file_id=121&amp;type=bug">0000337_update.patch</a> [<a href="0000337_update3026.patch?file_id=121&amp;type=bug" target="_blank">^</a>] (133,446 bytes) <span class="italic">2013-08-26 09:12</span><script type="text/javascript" language="JavaScript">
<!--
function swap_content( span ) {
displayType = ( document.getElementById( span ).style.display == 'none' ) ? '' : 'none';
document.getElementById( span ).style.display = displayType;
}

 -->
 </script> <span id="hideSection_121">[<a class="small" href='#' id='attmlink_121' onclick='swap_content("hideSection_121");swap_content("showSection_121");return false;'>Show Content</a>]</span> <span style='display:none' id="showSection_121">[<a class="small" href='#' id='attmlink_121' onclick='swap_content("hideSection_121");swap_content("showSection_121");return false;'>Hide Content</a>]<pre>Index: src/main/java/org/sigmah/client/i18n/UIConstants.properties
===================================================================
--- src/main/java/org/sigmah/client/i18n/UIConstants.properties	(Revision 1501)
+++ src/main/java/org/sigmah/client/i18n/UIConstants.properties	(Arbeitskopie)
@@ -47,6 +47,14 @@
 # Global permissions
 VIEW_PROJECT = View project
 
+categoryAdministration = Administration
+
+categoryProject = Project
+
+categoryOthers = Others
+
+categoryNotMapped = Not in any Category
+
 acronym = Acronym
 
 activities = Activities
@@ -909,6 +917,20 @@
 
 exportToWord = Export to Word
 
+# filter labels
+
+noneFilter = exclude all closed projects
+
+allFilter = include all closed projects
+
+sixMonthsFilter = include last 6 months
+
+twelveMonthsFilter = include last 12 months
+
+customFilter = choose past time limit
+
+closedProjectsFilterText = Closed projects filter
+
 # Not implemented feature
 featureNotImplemented = Feature not yet implemented
 
@@ -1625,6 +1647,8 @@
 
 projectDetails = Details
 
+projectClosedLabel = Closed
+
 # Details
 projectDetailsNoDetails = No detail...
 
Index: src/main/java/org/sigmah/client/page/admin/users/form/ProfileSigmahForm.java
===================================================================
--- src/main/java/org/sigmah/client/page/admin/users/form/ProfileSigmahForm.java	(Revision 1506)
+++ src/main/java/org/sigmah/client/page/admin/users/form/ProfileSigmahForm.java	(Arbeitskopie)
@@ -12,21 +12,40 @@
 import java.util.Map;
 import java.util.Set;
 
+import org.sigmah.client.cache.UserLocalCache;
+import org.sigmah.client.dispatch.Dispatcher;
+import org.sigmah.client.i18n.I18N;
+import org.sigmah.client.i18n.UIConstants;
+import org.sigmah.client.ui.ClickableLabel;
+import org.sigmah.client.util.Notification;
+import org.sigmah.shared.command.CreateEntity;
+import org.sigmah.shared.command.GetPrivacyGroups;
+import org.sigmah.shared.command.result.CreateResult;
+import org.sigmah.shared.command.result.PrivacyGroupsListResult;
+import org.sigmah.shared.domain.profile.GlobalPermissionEnum;
+import org.sigmah.shared.domain.profile.PrivacyGroupPermissionEnum;
+import org.sigmah.shared.dto.profile.PrivacyGroupDTO;
+import org.sigmah.shared.dto.profile.PrivacyGroupPermDTO;
+import org.sigmah.shared.dto.profile.ProfileDTO;
+
 import com.extjs.gxt.ui.client.Style.Orientation;
-import com.extjs.gxt.ui.client.Style.Scroll;
 import com.extjs.gxt.ui.client.event.ButtonEvent;
 import com.extjs.gxt.ui.client.event.Events;
 import com.extjs.gxt.ui.client.event.Listener;
 import com.extjs.gxt.ui.client.store.ListStore;
+import com.extjs.gxt.ui.client.widget.LayoutContainer;
 import com.extjs.gxt.ui.client.widget.MessageBox;
 import com.extjs.gxt.ui.client.widget.button.Button;
 import com.extjs.gxt.ui.client.widget.form.CheckBox;
 import com.extjs.gxt.ui.client.widget.form.CheckBoxGroup;
 import com.extjs.gxt.ui.client.widget.form.ComboBox;
+import com.extjs.gxt.ui.client.widget.form.ComboBox.TriggerAction;
 import com.extjs.gxt.ui.client.widget.form.FormPanel;
 import com.extjs.gxt.ui.client.widget.form.LabelField;
 import com.extjs.gxt.ui.client.widget.form.TextField;
-import com.extjs.gxt.ui.client.widget.form.ComboBox.TriggerAction;
+import com.extjs.gxt.ui.client.widget.layout.ColumnData;
+import com.extjs.gxt.ui.client.widget.layout.ColumnLayout;
+import com.extjs.gxt.ui.client.widget.layout.FormData;
 import com.extjs.gxt.ui.client.widget.layout.FormLayout;
 import com.google.gwt.core.client.GWT;
 import com.google.gwt.event.dom.client.ClickEvent;
@@ -34,22 +53,6 @@
 import com.google.gwt.user.client.rpc.AsyncCallback;
 import com.google.gwt.user.client.ui.Grid;
 
-import org.sigmah.client.cache.UserLocalCache;
-import org.sigmah.client.i18n.I18N;
-import org.sigmah.client.i18n.UIConstants;
-import org.sigmah.client.ui.ClickableLabel;
-import org.sigmah.client.util.Notification;
-import org.sigmah.client.dispatch.Dispatcher;
-import org.sigmah.shared.command.CreateEntity;
-import org.sigmah.shared.command.GetPrivacyGroups;
-import org.sigmah.shared.command.result.CreateResult;
-import org.sigmah.shared.command.result.PrivacyGroupsListResult;
-import org.sigmah.shared.domain.profile.GlobalPermissionEnum;
-import org.sigmah.shared.domain.profile.PrivacyGroupPermissionEnum;
-import org.sigmah.shared.dto.profile.PrivacyGroupDTO;
-import org.sigmah.shared.dto.profile.PrivacyGroupPermDTO;
-import org.sigmah.shared.dto.profile.ProfileDTO;
-
 /**
  * Create profile form.
  * 
@@ -58,298 +61,415 @@
  */
 public class ProfileSigmahForm extends FormPanel {
 
-    private final TextField&lt;String&gt; nameField;
-    private final ProfileDTO profileToUpdate;
-    private final List&lt;CheckBoxGroup&gt; checkGlobalPermissions;
-    private final ComboBox&lt;PrivacyGroupDTO&gt; privacyGroupsListCombo;
-    private final ComboBox&lt;PrivacyGroupPermDTO&gt; privacyGroupsPermissionsListCombo;
-    private final Map&lt;PrivacyGroupDTO, PrivacyGroupPermissionEnum&gt; privacyGroupsPerms = new HashMap&lt;PrivacyGroupDTO, PrivacyGroupPermissionEnum&gt;();
-    private final Map&lt;Integer, ClickableLabel&gt; selectedPrivacyGroups = new HashMap&lt;Integer, ClickableLabel&gt;();
-    private final List&lt;Integer&gt; selectedPrivacyGroupsIds = new ArrayList&lt;Integer&gt;();
-    private int num = 0;
-    private final Dispatcher dispatcher;
+	private final TextField&lt;String&gt; nameField;
+	private final ProfileDTO profileToUpdate;
+	private final List&lt;CheckBoxGroup&gt; checkGlobalPermissions;
+	private final ComboBox&lt;PrivacyGroupDTO&gt; privacyGroupsListCombo;
+	private final ComboBox&lt;PrivacyGroupPermDTO&gt; privacyGroupsPermissionsListCombo;
+	private final Map&lt;PrivacyGroupDTO, PrivacyGroupPermissionEnum&gt; privacyGroupsPerms = new HashMap&lt;PrivacyGroupDTO, PrivacyGroupPermissionEnum&gt;();
+	private final Map&lt;Integer, ClickableLabel&gt; selectedPrivacyGroups = new HashMap&lt;Integer, ClickableLabel&gt;();
+	private final List&lt;Integer&gt; selectedPrivacyGroupsIds = new ArrayList&lt;Integer&gt;();
+	private int num = 0;
+	private final Dispatcher dispatcher;
 
-    private final static int LABEL_WIDTH = 90;
-    private final static int MAX_PRIVACY_GROUPS_TENTATIVES_PER_USER = 100;
-    private final static String PRIVACY_GROUP = &quot;idPrivacyGroup&quot;;
+	private final static int LABEL_WIDTH = 90;
+	private final static int MAX_PRIVACY_GROUPS_TENTATIVES_PER_USER = 100;
+	private final static String PRIVACY_GROUP = &quot;idPrivacyGroup&quot;;
 
-    public ProfileSigmahForm(Dispatcher dispatcher, UserLocalCache userCache,
-            final AsyncCallback&lt;CreateResult&gt; callback, ProfileDTO profileToUpdate) {
+	public ProfileSigmahForm(Dispatcher dispatcher, UserLocalCache userCache,
+					final AsyncCallback&lt;CreateResult&gt; callback, ProfileDTO profileToUpdate) {
 
-        this.dispatcher = dispatcher;
-        this.profileToUpdate = profileToUpdate;
-        UIConstants constants = GWT.create(UIConstants.class);
+		this.dispatcher = dispatcher;
+		this.profileToUpdate = profileToUpdate;
+		UIConstants constants = GWT.create(UIConstants.class);
 
-        FormLayout layout = new FormLayout();
-        layout.setLabelWidth(LABEL_WIDTH);
-        setLayout(layout);
-        setScrollMode(Scroll.AUTOY);
+		FormLayout layoutTop = new FormLayout();
+		layoutTop.setLabelWidth(LABEL_WIDTH);
+		// setLayout(layout);
+		// setScrollMode(Scroll.AUTOY);
 
-        nameField = new TextField&lt;String&gt;();
-        nameField.setFieldLabel(constants.adminProfilesName());
-        nameField.setAllowBlank(false);
-        if (profileToUpdate != null &amp;&amp; !profileToUpdate.getName().isEmpty())
-            nameField.setValue(profileToUpdate.getName());
-        add(nameField);
+		LayoutContainer top = new LayoutContainer();
+		top.setLayout(layoutTop);
 
-        /*
-         * ************************************Global Permissions
-         * *******************************************
-         */
+		LayoutContainer main = new LayoutContainer();
+		main.setLayout(new ColumnLayout());
 
-        checkGlobalPermissions = new ArrayList&lt;CheckBoxGroup&gt;();
-        CheckBoxGroup checkGPGroup = new CheckBoxGroup();
-        checkGPGroup.setOrientation(Orientation.VERTICAL);
-        checkGPGroup.setFieldLabel(I18N.CONSTANTS.adminProfilesGlobalPermissions());
-        String label = &quot;&quot;;
-        for (GlobalPermissionEnum enumItem : GlobalPermissionEnum.values()) {
-            label = GlobalPermissionEnum.getName(enumItem);
-            CheckBox box = createCheckBox(enumItem.toString(), label);
-            if (profileToUpdate != null &amp;&amp; profileToUpdate.getGlobalPermissions() != null
-                    &amp;&amp; profileToUpdate.getGlobalPermissions().contains(enumItem)) {
-                box.setValue(true);
-            }
-            checkGPGroup.add(box);
-        }
-        checkGlobalPermissions.add(checkGPGroup);
-        add(checkGPGroup);
+		LayoutContainer left = new LayoutContainer();
+		left.setStyleAttribute(&quot;padding&quot;, &quot;5px 0px 5px 0px&quot;);
+		FormLayout layoutLeft = new FormLayout();
+		layoutLeft.setLabelAlign(LabelAlign.TOP);
+		// left.setStyleAttribute(&quot;margin&quot;, &quot;3px 0px 0px 3px&quot;);
+		// left.setAutoWidth(true);
+		left.setLayout(layoutLeft);
 
-        /*
-         * ************************************Privacy Groups
-         * *******************************************
-         */
-        // Add hidden empty labels
-        for (int i1 = 0; i1 &lt; MAX_PRIVACY_GROUPS_TENTATIVES_PER_USER; i1++) {
-            final ClickableLabel pglabel = new ClickableLabel();
-            pglabel.hide();
-            pglabel.addClickHandler(new ClickHandler() {
-                @Override
-                public void onClick(ClickEvent arg0) {
-                    pglabel.removeFromParent();
+		LayoutContainer middle = new LayoutContainer();
+		middle.setStyleAttribute(&quot;padding&quot;, &quot;5px 0px 5px 0px&quot;);
+		FormLayout layoutMiddle = new FormLayout();
+		layoutMiddle.setLabelAlign(LabelAlign.TOP);
+		// middle.setStyleAttribute(&quot;margin&quot;, &quot;3px 0px 0px 3px&quot;);
+		// middle.setAutoWidth(true);
+		middle.setLayout(layoutMiddle);
 
-                    selectedPrivacyGroupsIds.remove(new Integer(((PrivacyGroupDTO) pglabel.getData(PRIVACY_GROUP))
-                            .getId()));
-                    if (privacyGroupsPerms.containsKey((PrivacyGroupDTO) pglabel.getData(PRIVACY_GROUP))) {
-                    }
-                    privacyGroupsPerms.remove((PrivacyGroupDTO) pglabel.getData(PRIVACY_GROUP));
-                }
+		LayoutContainer right = new LayoutContainer();
+		right.setStyleAttribute(&quot;padding&quot;, &quot;5px 0px 5px 0px&quot;);
+		FormLayout layoutRight = new FormLayout();
+		layoutRight.setLabelAlign(LabelAlign.TOP);
+		// right.setStyleAttribute(&quot;margin&quot;, &quot;3px 0px 0px 3px&quot;);
+		// right.setAutoWidth(true);
+		right.setLayout(layoutRight);
 
-            });
-            selectedPrivacyGroups.put(i1, pglabel);
-        }
+		LayoutContainer bottom = new LayoutContainer();
+		FormLayout layoutBottom = new FormLayout();
+		layoutBottom.setLabelWidth(LABEL_WIDTH);
+		bottom.setLayout(layoutBottom);
 
-        // List all types of permissions
-        privacyGroupsPermissionsListCombo = new ComboBox&lt;PrivacyGroupPermDTO&gt;();
-        privacyGroupsPermissionsListCombo.setDisplayField(&quot;permission&quot;);
-        privacyGroupsPermissionsListCombo.setValueField(&quot;id&quot;);
-        privacyGroupsPermissionsListCombo.setEditable(false);
-        privacyGroupsPermissionsListCombo.setTriggerAction(TriggerAction.ALL);
-        int j = 0;
-        ListStore&lt;PrivacyGroupPermDTO&gt; permsStore = new ListStore&lt;PrivacyGroupPermDTO&gt;();
-        for (PrivacyGroupPermissionEnum enumItem : PrivacyGroupPermissionEnum.values()) {
-            j++;
-            PrivacyGroupPermDTO perm = new PrivacyGroupPermDTO();
-            perm.setId(j);
-            perm.setPermission(PrivacyGroupPermissionEnum.getName(enumItem));
-            if (!PrivacyGroupPermissionEnum.NONE.equals(enumItem))
-                permsStore.add(perm);
-        }
-        privacyGroupsPermissionsListCombo.setStore(permsStore);
+		nameField = new TextField&lt;String&gt;();
+		nameField.setFieldLabel(constants.adminProfilesName());
+		nameField.setAllowBlank(false);
 
-        privacyGroupsListCombo = new ComboBox&lt;PrivacyGroupDTO&gt;();
-        privacyGroupsListCombo.setDisplayField(&quot;title&quot;);
-        privacyGroupsListCombo.setValueField(&quot;id&quot;);
-        privacyGroupsListCombo.setEditable(false);
-        privacyGroupsListCombo.setTriggerAction(TriggerAction.ALL);
-        final ListStore&lt;PrivacyGroupDTO&gt; privacyGroupsStore = new ListStore&lt;PrivacyGroupDTO&gt;();
-        dispatcher.execute(new GetPrivacyGroups(), null, new AsyncCallback&lt;PrivacyGroupsListResult&gt;() {
+		if (profileToUpdate != null &amp;&amp; !profileToUpdate.getName().isEmpty())
+			nameField.setValue(profileToUpdate.getName());
+		top.add(nameField);
 
-            @Override
-            public void onFailure(Throwable arg0) {
-                privacyGroupsListCombo.setEmptyText(I18N.CONSTANTS.adminChoiceProblem());
-            }
+		/*
+		 * ************************************Global Permissions
+		 * *******************************************
+		 */
 
-            @Override
-            public void onSuccess(PrivacyGroupsListResult result) {
-                privacyGroupsListCombo.setEmptyText(I18N.CONSTANTS.adminPrivacyGroupChoice());
-                privacyGroupsStore.removeAll();
-                if (result != null) {
-                    privacyGroupsStore.add(result.getList());
-                    privacyGroupsStore.commitChanges();
-                }
-            }
-        });
+		checkGlobalPermissions = new ArrayList&lt;CheckBoxGroup&gt;();
 
-        privacyGroupsListCombo.setStore(privacyGroupsStore);
+		CheckBoxGroup checkGPGroupLabel = new CheckBoxGroup();
+		checkGPGroupLabel.setOrientation(Orientation.VERTICAL);
+		checkGPGroupLabel.setFieldLabel(I18N.CONSTANTS.adminProfilesGlobalPermissions());
 
-        final Grid privacyGroupsAddSelectionGrid = new Grid(1, 4);
+		CheckBoxGroup checkGPGroupAdmin = new CheckBoxGroup();
+		checkGPGroupAdmin.setOrientation(Orientation.VERTICAL);
+		checkGPGroupAdmin.setFieldLabel(I18N.CONSTANTS.categoryAdministration());
+		checkGPGroupAdmin.setStyleAttribute(&quot;margin-bottom&quot;, &quot;5px&quot;);
+		checkGPGroupAdmin.setLabelStyle(&quot;font-weight:bold;&quot;);
 
-        privacyGroupsAddSelectionGrid.getCellFormatter().setWidth(0, 0, (LABEL_WIDTH + 5) + &quot;px&quot;);
-        privacyGroupsAddSelectionGrid.setCellPadding(0);
-        privacyGroupsAddSelectionGrid.setCellSpacing(0);
-        privacyGroupsAddSelectionGrid
-                .setWidget(0, 0, new LabelField(I18N.CONSTANTS.adminProfilesPrivacyGroups() + &quot;:&quot;));
-        privacyGroupsAddSelectionGrid.setWidget(0, 1, privacyGroupsListCombo);
-        privacyGroupsAddSelectionGrid.setWidget(0, 2, privacyGroupsPermissionsListCombo);
-        privacyGroupsListCombo.setHideLabel(false);
+		CheckBoxGroup checkGPGroupProject = new CheckBoxGroup();
+		checkGPGroupProject.setOrientation(Orientation.VERTICAL);
+		checkGPGroupProject.setFieldLabel(I18N.CONSTANTS.categoryProject());
+		checkGPGroupProject.setLabelStyle(&quot;font-weight:bold;&quot;);
 
-        // Case Edit Profile add ids
-        if (profileToUpdate != null &amp;&amp; profileToUpdate.getPrivacyGroups() != null) {
-            Set&lt;PrivacyGroupDTO&gt; usedPrivacyGroups = profileToUpdate.getPrivacyGroups().keySet();
-            for (PrivacyGroupDTO usedPrivacyGroup : usedPrivacyGroups) {
-                selectedPrivacyGroupsIds.add(new Integer(usedPrivacyGroup.getId()));
-                privacyGroupsPerms.put(usedPrivacyGroup, profileToUpdate.getPrivacyGroups().get(usedPrivacyGroup));
-            }
-        }
+		CheckBoxGroup checkGPGroupOthers = new CheckBoxGroup();
+		checkGPGroupOthers.setOrientation(Orientation.VERTICAL);
+		checkGPGroupOthers.setFieldLabel(I18N.CONSTANTS.categoryOthers());
+		checkGPGroupOthers.setLabelStyle(&quot;font-weight:bold;&quot;);
 
-        final Button addButton = new Button(I18N.CONSTANTS.addItem());
-        addButton.addListener(Events.OnClick, new Listener&lt;ButtonEvent&gt;() {
-            @Override
-            public void handleEvent(ButtonEvent be) {
-                if (privacyGroupsListCombo.getValue() != null) {
+		CheckBoxGroup checkGPGroupNotMapped = new CheckBoxGroup();
+		checkGPGroupNotMapped.setOrientation(Orientation.VERTICAL);
+		checkGPGroupNotMapped.setFieldLabel(I18N.CONSTANTS.categoryNotMapped());
+		checkGPGroupNotMapped.setLabelStyle(&quot;font-weight:bold;&quot;);
 
-                    if (!selectedPrivacyGroupsIds.contains(new Integer(privacyGroupsListCombo.getValue().getId()))) {
-                        if (num &lt; MAX_PRIVACY_GROUPS_TENTATIVES_PER_USER) {
-                            selectedPrivacyGroups.get(num).setData(PRIVACY_GROUP, privacyGroupsListCombo.getValue());
-                            selectedPrivacyGroups.get(num).setText(
-                                    privacyGroupsListCombo.getValue().getCode() + &quot;-&quot;
-                                            + privacyGroupsListCombo.getValue().getTitle() + &quot; : &quot;
-                                            + privacyGroupsPermissionsListCombo.getValue().getPermission());
-                            selectedPrivacyGroups.get(num).show();
-                            num++;
-                            selectedPrivacyGroupsIds.add(new Integer(privacyGroupsListCombo.getValue().getId()));
-                            privacyGroupsPerms.put(privacyGroupsListCombo.getValue(),
-                                    PrivacyGroupPermissionEnum.translatePGPermission(privacyGroupsPermissionsListCombo
-                                            .getValue().getPermission()));
+		// checkGPGroup.setOrientation(Orientation.VERTICAL);
+		// checkGPGroup.setFieldLabel(I18N.CONSTANTS.adminProfilesGlobalPermissions());
 
-                        } else {
-                            MessageBox.alert(I18N.CONSTANTS.adminMaxAttempts(),
-                                    I18N.CONSTANTS.adminMaxAttemptsProfiles(), null);
-                            ProfileSigmahForm.this.hide();
-                        }
-                    }
-                }
-            }
-        });
+		boolean notMappedEmpty = true;
 
-        privacyGroupsAddSelectionGrid.setWidget(0, 3, addButton);
-        add(privacyGroupsAddSelectionGrid);
+		String label = &quot;&quot;;
+		for (GlobalPermissionEnum enumItem : GlobalPermissionEnum.values()) {
+			label = GlobalPermissionEnum.getName(enumItem);
+			CheckBox box = createCheckBox(enumItem.toString(), label);
+			if (profileToUpdate != null &amp;&amp; profileToUpdate.getGlobalPermissions() != null
+							&amp;&amp; profileToUpdate.getGlobalPermissions().contains(enumItem)) {
+				box.setValue(true);
+			}
+			if (GlobalPermissionEnum.getCategory(enumItem).equals(I18N.CONSTANTS.categoryAdministration())) {
+				checkGPGroupAdmin.add(box);
+				continue;
+			}
 
-        // Case Edit Profile : display used privacy groups
-        if (profileToUpdate != null &amp;&amp; profileToUpdate.getPrivacyGroups() != null) {
-            Set&lt;PrivacyGroupDTO&gt; usedPrivacyGroups = profileToUpdate.getPrivacyGroups().keySet();
-            for (PrivacyGroupDTO usedPrivacyGroup : usedPrivacyGroups) {
-                if (num &lt; MAX_PRIVACY_GROUPS_TENTATIVES_PER_USER) {
-                    selectedPrivacyGroups.get(num).setData(PRIVACY_GROUP, usedPrivacyGroup);
-                    selectedPrivacyGroups.get(num).setText(
-                            usedPrivacyGroup.getCode()
-                                    + &quot;-&quot;
-                                    + usedPrivacyGroup.getTitle()
-                                    + &quot; : &quot;
-                                    + PrivacyGroupPermissionEnum.getName(profileToUpdate.getPrivacyGroups().get(
-                                            usedPrivacyGroup)));
-                    selectedPrivacyGroups.get(num).show();
-                    num++;
-                } else {
-                    MessageBox.alert(&quot;Maximum Attempts&quot;,
-                            &quot;Maximum attempts to modify user's profiles have been reached. Try again&quot;, null);
-                    ProfileSigmahForm.this.hide();
-                }
-            }
-        }
+			if (GlobalPermissionEnum.getCategory(enumItem).equals(I18N.CONSTANTS.categoryProject())) {
+				checkGPGroupProject.add(box);
+				continue;
+			}
+			if (GlobalPermissionEnum.getCategory(enumItem).equals(I18N.CONSTANTS.categoryOthers())) {
+				checkGPGroupOthers.add(box);
+				continue;
+			}
+			if (GlobalPermissionEnum.getCategory(enumItem).equals(I18N.CONSTANTS.categoryNotMapped())) {
+				checkGPGroupNotMapped.add(box);
+				notMappedEmpty = false;
+				continue;
+			}
+		}
+		checkGlobalPermissions.add(checkGPGroupAdmin);
+		checkGlobalPermissions.add(checkGPGroupProject);
+		checkGlobalPermissions.add(checkGPGroupOthers);
+		if (!notMappedEmpty)
+			checkGlobalPermissions.add(checkGPGroupNotMapped);
+		// left.add(new Label(I18N.CONSTANTS.categoryProject()));
 
-        for (ClickableLabel selected : selectedPrivacyGroups.values()) {
-            ProfileSigmahForm.this.add(selected);
-        }
+		left.add(checkGPGroupLabel);
 
-        // Create button.
-        final Button createButton = new Button(I18N.CONSTANTS.save());
-        createButton.addListener(Events.OnClick, new Listener&lt;ButtonEvent&gt;() {
-            @Override
-            public void handleEvent(ButtonEvent be) {
-                createProfile(callback);
-            }
-        });
-        add(createButton);
-    }
+		middle.add(checkGPGroupProject);
 
-    protected CheckBox createCheckBox(String property, String label) {
-        CheckBox box = new CheckBox();
-        box.setName(property);
-        box.setBoxLabel(label);
-        return box;
-    }
+		// right.add(new Label(I18N.CONSTANTS.categoryAdministration()));
+		right.add(checkGPGroupAdmin);
 
-    private void createProfile(final AsyncCallback&lt;CreateResult&gt; callback) {
+		// right.add(new Label(I18N.CONSTANTS.categoryOthers()));
+		right.add(checkGPGroupOthers);
 
-        mask(I18N.CONSTANTS.saving());
+		if (!notMappedEmpty) {
+			// right.add(new Label(I18N.CONSTANTS.categoryNotMapped()));
+			checkGPGroupOthers.setStyleAttribute(&quot;margin-bottom&quot;, &quot;5px&quot;);
+			right.add(checkGPGroupNotMapped);
+		}
 
-        if (!this.isValid()) {
-            MessageBox.alert(I18N.CONSTANTS.createFormIncomplete(),
-                    I18N.MESSAGES.createFormIncompleteDetails(I18N.MESSAGES.adminStandardProfile()), null);
-            unmask();
-            return;
-        }
+		// main.add(left, new ColumnData(.333));
+		// main.add(middle, new ColumnData(.333));
+		// main.add(right, new ColumnData(.333));
 
-        ProfileDTO profileToSave = new ProfileDTO();
-        HashMap&lt;String, Object&gt; newProfileProperties = new HashMap&lt;String, Object&gt;();
+		main.add(left, new ColumnData(.20));
+		main.add(middle, new ColumnData(.30));
+		main.add(right, new ColumnData(.30));
 
-        if (profileToUpdate != null) {
-            profileToSave.setId(profileToUpdate.getId());
-        }
-        // name
-        final String name = nameField.getValue();
-        profileToSave.setName(name);
+		/*
+		 * ************************************Privacy Groups
+		 * *******************************************
+		 */
+		// Add hidden empty labels
+		for (int i1 = 0; i1 &lt; MAX_PRIVACY_GROUPS_TENTATIVES_PER_USER; i1++) {
+			final ClickableLabel pglabel = new ClickableLabel();
+			pglabel.hide();
+			pglabel.addClickHandler(new ClickHandler() {
+				@Override
+				public void onClick(ClickEvent arg0) {
+					pglabel.removeFromParent();
 
-        // global permissions
-        final Set&lt;GlobalPermissionEnum&gt; globalPerms = new HashSet&lt;GlobalPermissionEnum&gt;();
-        for (CheckBoxGroup checkGPGroup : checkGlobalPermissions) {
-            List&lt;CheckBox&gt; checkedGlobalPermissions = checkGPGroup.getValues();
-            for (CheckBox checkedGlobalPermission : checkedGlobalPermissions) {
-                globalPerms.add(GlobalPermissionEnum.valueOf(checkedGlobalPermission.getName()));
-            }
-        }
-        profileToSave.setGlobalPermissions(globalPerms);
-        profileToSave.setPrivacyGroups(privacyGroupsPerms);
-        newProfileProperties.put(&quot;profile&quot;, profileToSave);
-        dispatcher.execute(new CreateEntity(&quot;Profile&quot;, newProfileProperties), null, new AsyncCallback&lt;CreateResult&gt;() {
-            public void onFailure(Throwable caught) {
-                MessageBox.alert(
-                        I18N.CONSTANTS.adminProfileCreationBox(),
-                        I18N.MESSAGES.adminStandardCreationFailure(I18N.MESSAGES.adminStandardProfile() + &quot; '&quot; + name
-                                + &quot;'&quot;), null);
-                callback.onFailure(caught);
-                unmask();
-            }
+					selectedPrivacyGroupsIds.remove(new Integer(((PrivacyGroupDTO) pglabel.getData(PRIVACY_GROUP))
+									.getId()));
+					if (privacyGroupsPerms.containsKey((PrivacyGroupDTO) pglabel.getData(PRIVACY_GROUP))) {
+					}
+					privacyGroupsPerms.remove((PrivacyGroupDTO) pglabel.getData(PRIVACY_GROUP));
+				}
 
-            @Override
-            public void onSuccess(CreateResult result) {
-                if (result != null) {
-                    callback.onSuccess(result);
-                    if (profileToUpdate != null) {
-                        Notification.show(
-                                I18N.CONSTANTS.adminProfileCreationBox(),
-                                I18N.MESSAGES.adminStandardUpdateSuccess(I18N.MESSAGES.adminStandardProfile() + &quot; '&quot;
-                                        + result.getEntity().get(&quot;name&quot;) + &quot;'&quot;));
-                    } else {
-                        Notification.show(
-                                I18N.CONSTANTS.adminProfileCreationBox(),
-                                I18N.MESSAGES.adminStandardCreationSuccess(I18N.MESSAGES.adminStandardProfile() + &quot; '&quot;
-                                        + result.getEntity().get(&quot;name&quot;) + &quot;'&quot;));
-                    }
+			});
+			selectedPrivacyGroups.put(i1, pglabel);
+		}
 
-                } else {
-                    Throwable t = new Throwable(&quot;ProfileSigmahForm : creation result is null&quot;);
-                    callback.onFailure(t);
-                    MessageBox.alert(
-                            I18N.CONSTANTS.adminProfileCreationBox(),
-                            I18N.MESSAGES.adminStandardCreationNull(I18N.MESSAGES.adminStandardProfile() + &quot; '&quot; + name
-                                    + &quot;'&quot;), null);
-                }
-                unmask();
-            }
-        });
+		// List all types of permissions
+		privacyGroupsPermissionsListCombo = new ComboBox&lt;PrivacyGroupPermDTO&gt;();
+		privacyGroupsPermissionsListCombo.setDisplayField(&quot;permission&quot;);
+		privacyGroupsPermissionsListCombo.setValueField(&quot;id&quot;);
+		privacyGroupsPermissionsListCombo.setEditable(false);
+		privacyGroupsPermissionsListCombo.setTriggerAction(TriggerAction.ALL);
+		int j = 0;
+		ListStore&lt;PrivacyGroupPermDTO&gt; permsStore = new ListStore&lt;PrivacyGroupPermDTO&gt;();
+		for (PrivacyGroupPermissionEnum enumItem : PrivacyGroupPermissionEnum.values()) {
+			j++;
+			PrivacyGroupPermDTO perm = new PrivacyGroupPermDTO();
+			perm.setId(j);
+			perm.setPermission(PrivacyGroupPermissionEnum.getName(enumItem));
+			if (!PrivacyGroupPermissionEnum.NONE.equals(enumItem))
+				permsStore.add(perm);
+		}
+		privacyGroupsPermissionsListCombo.setStore(permsStore);
 
-    }
+		privacyGroupsListCombo = new ComboBox&lt;PrivacyGroupDTO&gt;();
+		privacyGroupsListCombo.setDisplayField(&quot;title&quot;);
+		privacyGroupsListCombo.setValueField(&quot;id&quot;);
+		privacyGroupsListCombo.setEditable(false);
+		privacyGroupsListCombo.setTriggerAction(TriggerAction.ALL);
+		final ListStore&lt;PrivacyGroupDTO&gt; privacyGroupsStore = new ListStore&lt;PrivacyGroupDTO&gt;();
+		dispatcher.execute(new GetPrivacyGroups(), null, new AsyncCallback&lt;PrivacyGroupsListResult&gt;() {
 
+			@Override
+			public void onFailure(Throwable arg0) {
+				privacyGroupsListCombo.setEmptyText(I18N.CONSTANTS.adminChoiceProblem());
+			}
+
+			@Override
+			public void onSuccess(PrivacyGroupsListResult result) {
+				privacyGroupsListCombo.setEmptyText(I18N.CONSTANTS.adminPrivacyGroupChoice());
+				privacyGroupsStore.removeAll();
+				if (result != null) {
+					privacyGroupsStore.add(result.getList());
+					privacyGroupsStore.commitChanges();
+				}
+			}
+		});
+
+		privacyGroupsListCombo.setStore(privacyGroupsStore);
+
+		final Grid privacyGroupsAddSelectionGrid = new Grid(1, 4);
+
+		privacyGroupsAddSelectionGrid.getCellFormatter().setWidth(0, 0, (LABEL_WIDTH + 5) + &quot;px&quot;);
+		privacyGroupsAddSelectionGrid.setCellPadding(0);
+		privacyGroupsAddSelectionGrid.setCellSpacing(0);
+		privacyGroupsAddSelectionGrid
+						.setWidget(0, 0, new LabelField(I18N.CONSTANTS.adminProfilesPrivacyGroups() + &quot;:&quot;));
+		privacyGroupsAddSelectionGrid.setWidget(0, 1, privacyGroupsListCombo);
+		privacyGroupsAddSelectionGrid.setWidget(0, 2, privacyGroupsPermissionsListCombo);
+		privacyGroupsListCombo.setHideLabel(false);
+
+		// Case Edit Profile add ids
+		if (profileToUpdate != null &amp;&amp; profileToUpdate.getPrivacyGroups() != null) {
+			Set&lt;PrivacyGroupDTO&gt; usedPrivacyGroups = profileToUpdate.getPrivacyGroups().keySet();
+			for (PrivacyGroupDTO usedPrivacyGroup : usedPrivacyGroups) {
+				selectedPrivacyGroupsIds.add(new Integer(usedPrivacyGroup.getId()));
+				privacyGroupsPerms.put(usedPrivacyGroup, profileToUpdate.getPrivacyGroups().get(usedPrivacyGroup));
+			}
+		}
+
+		final Button addButton = new Button(I18N.CONSTANTS.addItem());
+		addButton.addListener(Events.OnClick, new Listener&lt;ButtonEvent&gt;() {
+			@Override
+			public void handleEvent(ButtonEvent be) {
+				if (privacyGroupsListCombo.getValue() != null) {
+
+					if (!selectedPrivacyGroupsIds.contains(new Integer(privacyGroupsListCombo.getValue().getId()))) {
+						if (num &lt; MAX_PRIVACY_GROUPS_TENTATIVES_PER_USER) {
+							selectedPrivacyGroups.get(num).setData(PRIVACY_GROUP, privacyGroupsListCombo.getValue());
+							selectedPrivacyGroups.get(num).setText(
+											privacyGroupsListCombo.getValue().getCode()
+															+ &quot;-&quot;
+															+ privacyGroupsListCombo.getValue().getTitle()
+															+ &quot; : &quot;
+															+ privacyGroupsPermissionsListCombo.getValue()
+																			.getPermission());
+							selectedPrivacyGroups.get(num).show();
+							num++;
+							selectedPrivacyGroupsIds.add(new Integer(privacyGroupsListCombo.getValue().getId()));
+							privacyGroupsPerms.put(privacyGroupsListCombo.getValue(), PrivacyGroupPermissionEnum
+											.translatePGPermission(privacyGroupsPermissionsListCombo.getValue()
+															.getPermission()));
+
+						} else {
+							MessageBox.alert(I18N.CONSTANTS.adminMaxAttempts(),
+											I18N.CONSTANTS.adminMaxAttemptsProfiles(), null);
+							ProfileSigmahForm.this.hide();
+						}
+					}
+				}
+			}
+		});
+
+		privacyGroupsAddSelectionGrid.setWidget(0, 3, addButton);
+		bottom.add(privacyGroupsAddSelectionGrid);
+
+		// Case Edit Profile : display used privacy groups
+		if (profileToUpdate != null &amp;&amp; profileToUpdate.getPrivacyGroups() != null) {
+			Set&lt;PrivacyGroupDTO&gt; usedPrivacyGroups = profileToUpdate.getPrivacyGroups().keySet();
+			for (PrivacyGroupDTO usedPrivacyGroup : usedPrivacyGroups) {
+				if (num &lt; MAX_PRIVACY_GROUPS_TENTATIVES_PER_USER) {
+					selectedPrivacyGroups.get(num).setData(PRIVACY_GROUP, usedPrivacyGroup);
+					selectedPrivacyGroups.get(num).setText(
+									usedPrivacyGroup.getCode()
+													+ &quot;-&quot;
+													+ usedPrivacyGroup.getTitle()
+													+ &quot; : &quot;
+													+ PrivacyGroupPermissionEnum.getName(profileToUpdate
+																	.getPrivacyGroups().get(usedPrivacyGroup)));
+					selectedPrivacyGroups.get(num).show();
+					num++;
+				} else {
+					MessageBox.alert(&quot;Maximum Attempts&quot;,
+									&quot;Maximum attempts to modify user's profiles have been reached. Try again&quot;, null);
+					ProfileSigmahForm.this.hide();
+				}
+			}
+		}
+
+		for (ClickableLabel selected : selectedPrivacyGroups.values()) {
+			bottom.add(selected);
+		}
+
+		// Create button.
+		final Button createButton = new Button(I18N.CONSTANTS.save());
+		createButton.addListener(Events.OnClick, new Listener&lt;ButtonEvent&gt;() {
+			@Override
+			public void handleEvent(ButtonEvent be) {
+				createProfile(callback);
+			}
+		});
+		bottom.add(createButton);
+
+		add(top, new FormData(&quot;100%&quot;));
+		add(main, new FormData(&quot;100%&quot;));
+		add(bottom, new FormData(&quot;100%&quot;));
+
+	}
+
+	protected CheckBox createCheckBox(String property, String label) {
+		CheckBox box = new CheckBox();
+		box.setName(property);
+		box.setBoxLabel(label);
+		return box;
+	}
+
+	private void createProfile(final AsyncCallback&lt;CreateResult&gt; callback) {
+
+		mask(I18N.CONSTANTS.saving());
+
+		if (!this.isValid()) {
+			MessageBox.alert(I18N.CONSTANTS.createFormIncomplete(),
+							I18N.MESSAGES.createFormIncompleteDetails(I18N.MESSAGES.adminStandardProfile()), null);
+			unmask();
+			return;
+		}
+
+		ProfileDTO profileToSave = new ProfileDTO();
+		HashMap&lt;String, Object&gt; newProfileProperties = new HashMap&lt;String, Object&gt;();
+
+		if (profileToUpdate != null) {
+			profileToSave.setId(profileToUpdate.getId());
+		}
+		// name
+		final String name = nameField.getValue();
+		profileToSave.setName(name);
+
+		// global permissions
+		final Set&lt;GlobalPermissionEnum&gt; globalPerms = new HashSet&lt;GlobalPermissionEnum&gt;();
+		for (CheckBoxGroup checkGPGroup : checkGlobalPermissions) {
+			List&lt;CheckBox&gt; checkedGlobalPermissions = checkGPGroup.getValues();
+			for (CheckBox checkedGlobalPermission : checkedGlobalPermissions) {
+				globalPerms.add(GlobalPermissionEnum.valueOf(checkedGlobalPermission.getName()));
+			}
+		}
+		profileToSave.setGlobalPermissions(globalPerms);
+		profileToSave.setPrivacyGroups(privacyGroupsPerms);
+		newProfileProperties.put(&quot;profile&quot;, profileToSave);
+		dispatcher.execute(new CreateEntity(&quot;Profile&quot;, newProfileProperties), null, new AsyncCallback&lt;CreateResult&gt;() {
+			public void onFailure(Throwable caught) {
+				MessageBox.alert(
+								I18N.CONSTANTS.adminProfileCreationBox(),
+								I18N.MESSAGES.adminStandardCreationFailure(I18N.MESSAGES.adminStandardProfile() + &quot; '&quot;
+												+ name + &quot;'&quot;), null);
+				callback.onFailure(caught);
+				unmask();
+			}
+
+			@Override
+			public void onSuccess(CreateResult result) {
+				if (result != null) {
+					callback.onSuccess(result);
+					if (profileToUpdate != null) {
+						Notification.show(
+										I18N.CONSTANTS.adminProfileCreationBox(),
+										I18N.MESSAGES.adminStandardUpdateSuccess(I18N.MESSAGES.adminStandardProfile()
+														+ &quot; '&quot; + result.getEntity().get(&quot;name&quot;) + &quot;'&quot;));
+					} else {
+						Notification.show(
+										I18N.CONSTANTS.adminProfileCreationBox(),
+										I18N.MESSAGES.adminStandardCreationSuccess(I18N.MESSAGES.adminStandardProfile()
+														+ &quot; '&quot; + result.getEntity().get(&quot;name&quot;) + &quot;'&quot;));
+					}
+
+				} else {
+					Throwable t = new Throwable(&quot;ProfileSigmahForm : creation result is null&quot;);
+					callback.onFailure(t);
+					MessageBox.alert(
+									I18N.CONSTANTS.adminProfileCreationBox(),
+									I18N.MESSAGES.adminStandardCreationNull(I18N.MESSAGES.adminStandardProfile() + &quot; '&quot;
+													+ name + &quot;'&quot;), null);
+				}
+				unmask();
+			}
+		});
+
+	}
+
 }
Index: src/main/java/org/sigmah/client/page/dashboard/ProjectsListPanel.java
===================================================================
--- src/main/java/org/sigmah/client/page/dashboard/ProjectsListPanel.java	(Revision 1501)
+++ src/main/java/org/sigmah/client/page/dashboard/ProjectsListPanel.java	(Arbeitskopie)
@@ -38,14 +38,20 @@
 import org.sigmah.shared.dto.profile.ProfileUtils;
 
 import com.allen_sauer.gwt.log.client.Log;
+import com.extjs.gxt.ui.client.GXT;
 import com.extjs.gxt.ui.client.Style.SortDir;
 import com.extjs.gxt.ui.client.data.BaseModelData;
+import com.extjs.gxt.ui.client.data.FilterConfig;
+import com.extjs.gxt.ui.client.data.Loader;
 import com.extjs.gxt.ui.client.data.ModelData;
 import com.extjs.gxt.ui.client.data.SortInfo;
+import com.extjs.gxt.ui.client.event.BaseEvent;
 import com.extjs.gxt.ui.client.event.ButtonEvent;
 import com.extjs.gxt.ui.client.event.Events;
 import com.extjs.gxt.ui.client.event.FieldEvent;
+import com.extjs.gxt.ui.client.event.GridEvent;
 import com.extjs.gxt.ui.client.event.Listener;
+import com.extjs.gxt.ui.client.event.MenuEvent;
 import com.extjs.gxt.ui.client.event.SelectionListener;
 import com.extjs.gxt.ui.client.store.ListStore;
 import com.extjs.gxt.ui.client.store.Store;
@@ -53,6 +59,7 @@
 import com.extjs.gxt.ui.client.store.StoreFilter;
 import com.extjs.gxt.ui.client.store.StoreSorter;
 import com.extjs.gxt.ui.client.store.TreeStore;
+import com.extjs.gxt.ui.client.util.DelayedTask;
 import com.extjs.gxt.ui.client.util.Margins;
 import com.extjs.gxt.ui.client.widget.ContentPanel;
 import com.extjs.gxt.ui.client.widget.LayoutContainer;
@@ -64,10 +71,13 @@
 import com.extjs.gxt.ui.client.widget.form.RadioGroup;
 import com.extjs.gxt.ui.client.widget.grid.ColumnConfig;
 import com.extjs.gxt.ui.client.widget.grid.ColumnData;
+import com.extjs.gxt.ui.client.widget.grid.ColumnHeader;
+import com.extjs.gxt.ui.client.widget.grid.ColumnHeader.Head;
 import com.extjs.gxt.ui.client.widget.grid.ColumnModel;
 import com.extjs.gxt.ui.client.widget.grid.Grid;
 import com.extjs.gxt.ui.client.widget.grid.GridCellRenderer;
 import com.extjs.gxt.ui.client.widget.grid.filters.DateFilter;
+import com.extjs.gxt.ui.client.widget.grid.filters.Filter;
 import com.extjs.gxt.ui.client.widget.grid.filters.GridFilters;
 import com.extjs.gxt.ui.client.widget.grid.filters.ListFilter;
 import com.extjs.gxt.ui.client.widget.grid.filters.NumericFilter;
@@ -75,6 +85,10 @@
 import com.extjs.gxt.ui.client.widget.layout.FitLayout;
 import com.extjs.gxt.ui.client.widget.layout.FlowData;
 import com.extjs.gxt.ui.client.widget.layout.FlowLayout;
+import com.extjs.gxt.ui.client.widget.menu.CheckMenuItem;
+import com.extjs.gxt.ui.client.widget.menu.DateMenu;
+import com.extjs.gxt.ui.client.widget.menu.Menu;
+import com.extjs.gxt.ui.client.widget.menu.SeparatorMenuItem;
 import com.extjs.gxt.ui.client.widget.toolbar.FillToolItem;
 import com.extjs.gxt.ui.client.widget.toolbar.SeparatorToolItem;
 import com.extjs.gxt.ui.client.widget.toolbar.ToolBar;
@@ -91,6 +105,7 @@
 import com.google.gwt.user.client.ui.Image;
 import com.google.gwt.user.client.ui.Label;
 import com.google.gwt.user.client.ui.Widget;
+import com.google.gwt.user.datepicker.client.CalendarUtil;
 
 /**
  * A widget which display a list of projects.
@@ -100,689 +115,826 @@
  */
 public class ProjectsListPanel {
 
-    /**
-     * A tree store with some useful dedicated methods.
-     * 
-     * @author tmi
-     * 
-     */
-    public static class ProjectStore extends TreeStore&lt;ProjectDTOLight&gt; {
-    }
+	/**
+	 * A tree store with some useful dedicated methods.
+	 * 
+	 * @author tmi
+	 * 
+	 */
+	public static class ProjectStore extends TreeStore&lt;ProjectDTOLight&gt; {
+	}
 
-    /**
-     * Defines the refreshing mode.
-     * 
-     * @author tmi
-     */
-    public static enum RefreshMode {
+	/**
+	 * Defines the refreshing mode.
+	 * 
+	 * @author tmi
+	 */
+	public static enum RefreshMode {
 
-        /**
-         * The project list is refreshed each time the
-         * {@link ProjectsListPanel#refresh(boolean, Integer...)} method is
-         * called.
-         */
-        AUTOMATIC,
+		/**
+		 * The project list is refreshed each time the
+		 * {@link ProjectsListPanel#refresh(boolean, Integer...)} method is
+		 * called.
+		 */
+		AUTOMATIC,
 
-        /**
-         * The project list is refreshed each time user clicks on the refresh
-         * button.
-         */
-        BUTTON,
+		/**
+		 * The project list is refreshed each time user clicks on the refresh
+		 * button.
+		 */
+		BUTTON,
 
-        /**
-         * Refresh the project list when {@link #refresh(boolean, Integer...)}
-         * if called for the first time. Subsequent refreshs are called by the
-         * refresh button.
-         */
-        BOTH;
-    }
+		/**
+		 * Refresh the project list when {@link #refresh(boolean, Integer...)}
+		 * if called for the first time. Subsequent refreshs are called by the
+		 * refresh button.
+		 */
+		BOTH;
+	}
 
-    /**
-     * Defines the loading mode.
-     * 
-     * @author tmi
-     */
-    public static enum LoadingMode {
+	/**
+	 * Defines the loading mode.
+	 * 
+	 * @author tmi
+	 */
+	public static enum LoadingMode {
 
-        /**
-         * The projects list id loaded by one single server call.
-         */
-        ONE_TIME,
+		/**
+		 * The projects list id loaded by one single server call.
+		 */
+		ONE_TIME,
 
-        /**
-         * The projects list is loaded by chunks and a progress bar informs of
-         * the loading process.
-         */
-        CHUNK;
-    }
+		/**
+		 * The projects list is loaded by chunks and a progress bar informs of
+		 * the loading process.
+		 */
+		CHUNK;
+	}
 
-    private final Dispatcher dispatcher;
-    private final Authentication authentication;
-    private final ContentPanel projectTreePanel;
-    private final TreeGrid&lt;ProjectDTOLight&gt; projectTreeGrid;
-    private final Radio ngoRadio;
-    private final Radio fundingRadio;
-    private final Radio partnerRadio;
-    private final Button filterButton;
-    private final GridFilters gridFilters;
-    
-    /** Current projects grid parameters. */
-    private ProjectModelType currentModelType;
-    private final ArrayList&lt;Integer&gt; orgUnitsIds;
+	private final Dispatcher dispatcher;
+	private final Authentication authentication;
+	private final ContentPanel projectTreePanel;
+	private final TreeGrid&lt;ProjectDTOLight&gt; projectTreeGrid;
+	private final Radio ngoRadio;
+	private final Radio fundingRadio;
+	private final Radio partnerRadio;
+	private final Button filterButton;
+	private final GridFilters gridFilters;
 
-    /** The refreshing mode (automatic by default) */
-    private final RefreshMode refreshMode;
-    private final com.extjs.gxt.ui.client.widget.Label refreshDateLabel;
+	// private final StoreFilter&lt;ProjectDTOLight&gt; closedFilter = new
+	// StoreFilter&lt;ProjectDTOLight&gt;() {
+	//
+	// @Override
+	// public boolean select(Store&lt;ProjectDTOLight&gt; store, ProjectDTOLight
+	// parent, ProjectDTOLight item,
+	// String property) {
+	// if (item.isClosed())
+	// return false;
+	// else
+	// return true;
+	// }
+	//
+	// };
 
-    /** The loading mode (one time by default) */
-    private final LoadingMode loadingMode;
+	/** Current projects grid parameters. */
+	private ProjectModelType currentModelType;
+	private final ArrayList&lt;Integer&gt; orgUnitsIds;
 
-    /**
-     * true if {@link #refresh(boolean, Integer...)} has already been called at
-     * least one time
-     */
-    private static boolean isLoaded = false;
+	/** The refreshing mode (automatic by default) */
+	private final RefreshMode refreshMode;
+	private final com.extjs.gxt.ui.client.widget.Label refreshDateLabel;
 
-    /** The GetProjects command which will be executed for the next refresh. */
-    private GetProjects command;
+	/** The loading mode (one time by default) */
+	private final LoadingMode loadingMode;
 
-    /**
-     * Builds a new project list panel with the default refreshing mode to
-     * {@link RefreshMode#AUTOMATIC}.
-     * 
-     * @param dispatcher
-     *            The dispatcher.
-     * @param authentication
-     *            The current authentication.
-     */
-    public ProjectsListPanel(Dispatcher dispatcher, Authentication authentication, EventBus eventBus) {
-        this(dispatcher, authentication, eventBus, RefreshMode.AUTOMATIC, LoadingMode.ONE_TIME);
-    }
+	/**
+	 * true if {@link #refresh(boolean, Integer...)} has already been called at
+	 * least one time
+	 */
+	private static boolean isLoaded = false;
 
-    /**
-     * Builds a new project list panel.
-     * 
-     * @param dispatcher
-     *            The dispatcher.
-     * @param authentication
-     *            The current authentication.
-     * @param refreshMode
-     *            The refreshing mode.
-     */
-    public ProjectsListPanel(Dispatcher dispatcher, Authentication authentication, EventBus eventBus, RefreshMode refreshMode) {
-        this(dispatcher, authentication, eventBus, refreshMode, LoadingMode.ONE_TIME);
-    }
+	/** The GetProjects command which will be executed for the next refresh. */
+	private GetProjects command;
 
-    /**
-     * Builds a new project list panel.
-     * 
-     * @param dispatcher
-     *            The dispatcher.
-     * @param authentication
-     *            The current authentication.
-     * @param refreshMode
-     *            The refreshing mode.
-     * @param loadingMode
-     *            The loading mode.
-     */
-    public ProjectsListPanel(Dispatcher dispatcher, final Authentication authentication, EventBus eventBus, RefreshMode refreshMode,
-            LoadingMode loadingMode) {
+	/**
+	 * Builds a new project list panel with the default refreshing mode to
+	 * {@link RefreshMode#AUTOMATIC}.
+	 * 
+	 * @param dispatcher
+	 *            The dispatcher.
+	 * @param authentication
+	 *            The current authentication.
+	 */
+	public ProjectsListPanel(Dispatcher dispatcher, Authentication authentication, EventBus eventBus) {
+		this(dispatcher, authentication, eventBus, RefreshMode.AUTOMATIC, LoadingMode.ONE_TIME);
+	}
 
-        this.dispatcher = dispatcher;
-        this.authentication = authentication;
-        this.refreshMode = refreshMode;
-        this.loadingMode = loadingMode;
+	/**
+	 * Builds a new project list panel.
+	 * 
+	 * @param dispatcher
+	 *            The dispatcher.
+	 * @param authentication
+	 *            The current authentication.
+	 * @param refreshMode
+	 *            The refreshing mode.
+	 */
+	public ProjectsListPanel(Dispatcher dispatcher, Authentication authentication, EventBus eventBus,
+					RefreshMode refreshMode) {
+		this(dispatcher, authentication, eventBus, refreshMode, LoadingMode.ONE_TIME);
+	}
 
-        // Default filters parameters.
-        orgUnitsIds = new ArrayList&lt;Integer&gt;();
-        currentModelType = ProjectModelType.NGO;
+	/**
+	 * Builds a new project list panel.
+	 * 
+	 * @param dispatcher
+	 *            The dispatcher.
+	 * @param authentication
+	 *            The current authentication.
+	 * @param refreshMode
+	 *            The refreshing mode.
+	 * @param loadingMode
+	 *            The loading mode.
+	 */
+	public ProjectsListPanel(Dispatcher dispatcher, final Authentication authentication, EventBus eventBus,
+					RefreshMode refreshMode, LoadingMode loadingMode) {
 
-        // Store.
-        final ProjectStore projectStore = new ProjectStore();
-        projectStore.setMonitorChanges(true);
+		this.dispatcher = dispatcher;
+		this.authentication = authentication;
+		this.refreshMode = refreshMode;
+		this.loadingMode = loadingMode;
 
-        // Default sort order of the projects grid.
-        projectStore.setSortInfo(new SortInfo(&quot;name&quot;, SortDir.ASC));
+		// Default filters parameters.
+		orgUnitsIds = new ArrayList&lt;Integer&gt;();
+		currentModelType = ProjectModelType.NGO;
 
-        // Grid.
-        projectTreeGrid = new TreeGrid&lt;ProjectDTOLight&gt;(projectStore, getProjectGridColumnModel());
-        projectTreeGrid.setBorders(true);
-        projectTreeGrid.getStyle().setNodeOpenIcon(null);
-        projectTreeGrid.getStyle().setNodeCloseIcon(null);
-        projectTreeGrid.getStyle().setLeafIcon(null);
-        projectTreeGrid.setAutoExpandColumn(&quot;fullName&quot;);
-        projectTreeGrid.setTrackMouseOver(false);
-        projectTreeGrid.setAutoExpand(true);               
+		// Store.
+		final ProjectStore projectStore = new ProjectStore();
+		projectStore.setMonitorChanges(true);
 
-     // Apply grid filters
-        gridFilters = new GridFilters();       
-        projectTreeGrid.addPlugin(createGridFilters());  
+		// Default sort order of the projects grid.
+		projectStore.setSortInfo(new SortInfo(&quot;name&quot;, SortDir.ASC));
 
-        // Store.
-        projectStore.setStoreSorter(new StoreSorter&lt;ProjectDTOLight&gt;() {
-            @Override
-            public int compare(Store&lt;ProjectDTOLight&gt; store, ProjectDTOLight m1, ProjectDTOLight m2, String property) {
+		// Grid.
+		projectTreeGrid = new TreeGrid&lt;ProjectDTOLight&gt;(projectStore, getProjectGridColumnModel());
+		projectTreeGrid.setBorders(true);
+		projectTreeGrid.getStyle().setNodeOpenIcon(null);
+		projectTreeGrid.getStyle().setNodeCloseIcon(null);
+		projectTreeGrid.getStyle().setLeafIcon(null);
+		projectTreeGrid.setAutoExpandColumn(&quot;fullName&quot;);
+		projectTreeGrid.setTrackMouseOver(false);
+		projectTreeGrid.setAutoExpand(true);
 
-                if (&quot;name&quot;.equals(property)) {
-                    return m1.getName().compareToIgnoreCase(m2.getName());
-                } else if (&quot;fullName&quot;.equals(property)) {
-                    return m1.getFullName().compareToIgnoreCase(m2.getFullName());
-                } else if (&quot;phase&quot;.equals(property)) {
-                    return m1.getCurrentPhaseName().compareToIgnoreCase(m2.getCurrentPhaseName());
-                } else if (&quot;orgUnitName&quot;.equals(property)) {
-                    return m1.getOrgUnitName().compareToIgnoreCase(m2.getOrgUnitName());
-                } else if (&quot;spentBudget&quot;.equals(property)) {
-                    final Double d1 = NumberUtils.adjustRatio(NumberUtils.ratio(m1.getSpendBudget(),
-                            m1.getPlannedBudget()));
-                    final Double d2 = NumberUtils.adjustRatio(NumberUtils.ratio(m2.getSpendBudget(),
-                            m2.getPlannedBudget()));
-                    return d1.compareTo(d2);
-                } else if (&quot;time&quot;.equals(property)) {
-                    final Double d1 = m1.getElapsedTime();
-                    final Double d2 = m2.getElapsedTime();
-                    return d1.compareTo(d2);
-                } else if (&quot;activity&quot;.equals(property)) {
-                    return 0;
-                } else if (&quot;categoryElements&quot;.equals(property)) {
-                    return 0;
-                } else {
-                    return super.compare(store, m1, m2, property);
-                }
-            }
-        });
+		// Apply grid filters
+		gridFilters = new GridFilters() {
 
-        // Top panel
-        final RadioGroup group = new RadioGroup(&quot;projectTypeFilter&quot;);
-        group.setFireChangeEventOnSetValue(true);
+			private CheckMenuItem checkItem;
+			private SeparatorMenuItem seperator;
+			private Menu filterMenuO;
+			private StoreFilter&lt;ModelData&gt; currentFilterO;
 
-        ngoRadio = new Radio();
-        ngoRadio.setFireChangeEventOnSetValue(true);
-        ngoRadio.setValue(true);
-        ngoRadio.setFieldLabel(ProjectModelType.getName(ProjectModelType.NGO));
-        ngoRadio.addStyleName(&quot;toolbar-radio&quot;);
+			private DelayedTask deferredUpdateO = new DelayedTask(new Listener&lt;BaseEvent&gt;() {
+				public void handleEvent(BaseEvent be) {
+					reload();
+				}
+			});
 
-        final WidgetComponent ngoIcon = new WidgetComponent(FundingIconProvider.getProjectTypeIcon(
-                ProjectModelType.NGO, IconSize.SMALL).createImage());
-        ngoIcon.addStyleName(&quot;toolbar-icon&quot;);
+			@Override
+			protected void onContextMenu(GridEvent&lt;?&gt; be) {
+				int column = be.getColIndex();
 
-        final Label ngoLabel = new Label(ProjectModelType.getName(ProjectModelType.NGO));
-        ngoLabel.addStyleName(&quot;flexibility-element-label&quot;);
-        ngoLabel.addStyleName(&quot;project-starred-icon&quot;);
-        ngoLabel.addClickHandler(new ClickHandler() {
+				if (seperator == null) {
+					seperator = new SeparatorMenuItem();
+				}
+				seperator.removeFromParent();
 
-            @Override
-            public void onClick(ClickEvent event) {
-                ngoRadio.setValue(true);
-                fundingRadio.setValue(false);
-                partnerRadio.setValue(false);
-            }
-        });
+				if (checkItem == null) {
+					checkItem = new CheckMenuItem(getMessages().getFilterText());
 
-        fundingRadio = new Radio();
-        fundingRadio.setFireChangeEventOnSetValue(true);
-        fundingRadio.setFieldLabel(ProjectModelType.getName(ProjectModelType.FUNDING));
-        fundingRadio.addStyleName(&quot;toolbar-radio&quot;);
+					checkItem.addListener(Events.CheckChange, new Listener&lt;MenuEvent&gt;() {
+						public void handleEvent(MenuEvent me) {
+							onCheckChange(me);
+						}
+					});
+					checkItem.addListener(Events.BeforeCheckChange, new Listener&lt;MenuEvent&gt;() {
+						public void handleEvent(MenuEvent me) {
+							onBeforeCheck(me);
+						}
+					});
+				}
+				checkItem.removeFromParent();
+				checkItem.setData(&quot;index&quot;, column);
 
-        final WidgetComponent fundingIcon = new WidgetComponent(FundingIconProvider.getProjectTypeIcon(
-                ProjectModelType.FUNDING, IconSize.SMALL).createImage());
-        fundingIcon.addStyleName(&quot;toolbar-icon&quot;);
+				Filter f = getFilter(grid.getColumnModel().getColumn(column).getDataIndex());
+				if (f != null) {
+					checkItem.show();
 
-        final Label fundingLabel = new Label(ProjectModelType.getName(ProjectModelType.FUNDING));
-        fundingLabel.addStyleName(&quot;flexibility-element-label&quot;);
-        fundingLabel.addStyleName(&quot;project-starred-icon&quot;);
-        fundingLabel.addClickHandler(new ClickHandler() {
+					filterMenuO = f.getMenu();
+					checkItem.setChecked(f.isActive(), true);
+					checkItem.setSubMenu(filterMenuO);
 
-            @Override
-            public void onClick(ClickEvent event) {
-                ngoRadio.setValue(false);
-                fundingRadio.setValue(true);
-                partnerRadio.setValue(false);
-            }
-        });
+					Menu menu = be.getMenu();
+					menu.add(seperator);
+					if (columnModel.getDataIndex(column).equals(&quot;time&quot;))
+						checkItem.setText(I18N.CONSTANTS.closedProjectsFilterText());
+					else
+						checkItem.setText(GXT.MESSAGES.gridFilters_filterText());
+					menu.add(checkItem);
+				}
+			}
 
-        partnerRadio = new Radio();
-        partnerRadio.setFireChangeEventOnSetValue(true);
-        partnerRadio.setFieldLabel(ProjectModelType.getName(ProjectModelType.LOCAL_PARTNER));
-        partnerRadio.addStyleName(&quot;toolbar-radio&quot;);
+			@Override
+			protected void onStateChange(Filter filter) {
+				if (checkItem != null &amp;&amp; checkItem.isAttached()) {
+					checkItem.setChecked(filter.isActive(), true);
+				}
+				if ((isAutoReload() || isLocal())) {
+					deferredUpdateO.delay(getUpdateBuffer());
+				}
+				updateColumnHeadings();
+			}
 
-        final WidgetComponent partnerIcon = new WidgetComponent(FundingIconProvider.getProjectTypeIcon(
-                ProjectModelType.LOCAL_PARTNER, IconSize.SMALL).createImage());
-        partnerIcon.addStyleName(&quot;toolbar-icon&quot;);
+			@Override
+			protected void reload() {
+				if (isLocal()) {
+					if (currentFilterO != null) {
+						getStore().removeFilter(currentFilterO);
+					}
+					currentFilterO = getModelFilter();
+					getStore().addFilter(currentFilterO);
+					if (!getStore().isFiltered()) {
+						getStore().applyFilters(&quot;&quot;);
+					}
+				} else {
+					deferredUpdateO.cancel();
 
-        final Label partnerLabel = new Label(ProjectModelType.getName(ProjectModelType.LOCAL_PARTNER));
-        partnerLabel.addStyleName(&quot;flexibility-element-label&quot;);
-        partnerLabel.addStyleName(&quot;project-starred-icon&quot;);
-        partnerLabel.addClickHandler(new ClickHandler() {
+					Loader&lt;?&gt; l = getLoader(getStore());
+					if (l != null) {
+						l.load();
+					}
+				}
+			}
 
-            @Override
-            public void onClick(ClickEvent event) {
-                ngoRadio.setValue(false);
-                fundingRadio.setValue(false);
-                partnerRadio.setValue(true);
-            }
-        });
+			@Override
+			public void updateColumnHeadings() {
+				int cols = grid.getColumnModel().getColumnCount();
+				for (int i = 0; i &lt; cols; i++) {
+					ColumnConfig config = grid.getColumnModel().getColumn(i);
+					if (!config.isHidden()) {
+						ColumnHeader header = grid.getView().getHeader();
+						if (header != null) {
+							Head h = header.getHead(i);
+							if (h != null &amp;&amp; h.isRendered()) {
+								Filter f = getFilter(config.getDataIndex());
+								if (f != null) {
+									h.el().setStyleName(&quot;filtered-column-header&quot;, f.isActive());
+								}
+							}
+						}
+					}
+				}
+			}
+		};
 
-        final HTML headLabel = new HTML(&quot;&amp;nbsp;&amp;nbsp;&quot; + I18N.CONSTANTS.projectTypeFilter() + &quot;: &quot;);
-        headLabel.addStyleName(&quot;flexibility-element-label&quot;);
+		projectTreeGrid.addPlugin(createGridFilters());
 
-        group.add(ngoRadio);
-        group.add(fundingRadio);
-        group.add(partnerRadio);
-        group.setAutoWidth(true);
+		// Store.
+		projectStore.setStoreSorter(new StoreSorter&lt;ProjectDTOLight&gt;() {
+			@Override
+			public int compare(Store&lt;ProjectDTOLight&gt; store, ProjectDTOLight m1, ProjectDTOLight m2, String property) {
 
-        // Expand all button.
-        final Button expandButton = new Button(&quot;&quot;, IconImageBundle.ICONS.expand(),
-                new SelectionListener&lt;ButtonEvent&gt;() {
+				if (&quot;name&quot;.equals(property)) {
+					return m1.getName().compareToIgnoreCase(m2.getName());
+				} else if (&quot;fullName&quot;.equals(property)) {
+					return m1.getFullName().compareToIgnoreCase(m2.getFullName());
+				} else if (&quot;phase&quot;.equals(property)) {
+					return m1.getCurrentPhaseName().compareToIgnoreCase(m2.getCurrentPhaseName());
+				} else if (&quot;orgUnitName&quot;.equals(property)) {
+					return m1.getOrgUnitName().compareToIgnoreCase(m2.getOrgUnitName());
+				} else if (&quot;spentBudget&quot;.equals(property)) {
+					final Double d1 = NumberUtils.adjustRatio(NumberUtils.ratio(m1.getSpendBudget(),
+									m1.getPlannedBudget()));
+					final Double d2 = NumberUtils.adjustRatio(NumberUtils.ratio(m2.getSpendBudget(),
+									m2.getPlannedBudget()));
+					return d1.compareTo(d2);
+				} else if (&quot;time&quot;.equals(property)) {
+					final Double d1 = m1.getElapsedTime();
+					final Double d2 = m2.getElapsedTime();
+					return d1.compareTo(d2);
+				} else if (&quot;activity&quot;.equals(property)) {
+					return 0;
+				} else if (&quot;categoryElements&quot;.equals(property)) {
+					return 0;
+				} else {
+					return super.compare(store, m1, m2, property);
+				}
+			}
+		});
 
-                    @Override
-                    public void componentSelected(ButtonEvent ce) {
-                        projectTreeGrid.expandAll();
-                    }
-                });
+		// Top panel
+		final RadioGroup group = new RadioGroup(&quot;projectTypeFilter&quot;);
+		group.setFireChangeEventOnSetValue(true);
 
-        // Collapse all button.
-        final Button collapseButton = new Button(&quot;&quot;, IconImageBundle.ICONS.collapse(),
-                new SelectionListener&lt;ButtonEvent&gt;() {
+		ngoRadio = new Radio();
+		ngoRadio.setFireChangeEventOnSetValue(true);
+		ngoRadio.setValue(true);
+		ngoRadio.setFieldLabel(ProjectModelType.getName(ProjectModelType.NGO));
+		ngoRadio.addStyleName(&quot;toolbar-radio&quot;);
 
-                    @Override
-                    public void componentSelected(ButtonEvent ce) {
-                        projectTreeGrid.collapseAll();
-                    }
-                });
+		final WidgetComponent ngoIcon = new WidgetComponent(FundingIconProvider.getProjectTypeIcon(
+						ProjectModelType.NGO, IconSize.SMALL).createImage());
+		ngoIcon.addStyleName(&quot;toolbar-icon&quot;);
 
-        // Filter button.
-        filterButton = new Button(I18N.CONSTANTS.filter(), IconImageBundle.ICONS.filter());
+		final Label ngoLabel = new Label(ProjectModelType.getName(ProjectModelType.NGO));
+		ngoLabel.addStyleName(&quot;flexibility-element-label&quot;);
+		ngoLabel.addStyleName(&quot;project-starred-icon&quot;);
+		ngoLabel.addClickHandler(new ClickHandler() {
 
-        // Refresh button.
-        final Button refreshButton = new Button(I18N.CONSTANTS.refreshProjectList(), IconImageBundle.ICONS.refresh(),
-                new SelectionListener&lt;ButtonEvent&gt;() {
+			@Override
+			public void onClick(ClickEvent event) {
+				ngoRadio.setValue(true);
+				fundingRadio.setValue(false);
+				partnerRadio.setValue(false);
+			}
+		});
 
-                    @Override
-                    public void componentSelected(ButtonEvent ce) {
-                        // Explicit refresh.
-                        refreshProjectGrid(command);
-                    }
-                });
-        refreshButton.setToolTip(I18N.CONSTANTS.refreshProjectListDetails());
-        refreshButton.addStyleName(&quot;project-refresh-button&quot;);
+		fundingRadio = new Radio();
+		fundingRadio.setFireChangeEventOnSetValue(true);
+		fundingRadio.setFieldLabel(ProjectModelType.getName(ProjectModelType.FUNDING));
+		fundingRadio.addStyleName(&quot;toolbar-radio&quot;);
 
-        // Refresh date.
-        refreshDateLabel = new com.extjs.gxt.ui.client.widget.Label();
-        
-        eventBus.addListener(AppEvents.DeleteProject, new Listener&lt;ProjectEvent&gt;() {
+		final WidgetComponent fundingIcon = new WidgetComponent(FundingIconProvider.getProjectTypeIcon(
+						ProjectModelType.FUNDING, IconSize.SMALL).createImage());
+		fundingIcon.addStyleName(&quot;toolbar-icon&quot;);
 
-            @Override
-            public void handleEvent(ProjectEvent be) {
-                refreshProjectGrid(command);
-            }
-        });
-        
-        
+		final Label fundingLabel = new Label(ProjectModelType.getName(ProjectModelType.FUNDING));
+		fundingLabel.addStyleName(&quot;flexibility-element-label&quot;);
+		fundingLabel.addStyleName(&quot;project-starred-icon&quot;);
+		fundingLabel.addClickHandler(new ClickHandler() {
 
-        final ToolBar toolbar = new ToolBar();
-        if (refreshMode == RefreshMode.BUTTON || refreshMode == RefreshMode.BOTH) {
-            toolbar.add(refreshButton);
-            toolbar.add(refreshDateLabel);
-            toolbar.add(new SeparatorToolItem());
-        }
-        toolbar.add(expandButton);
-        toolbar.add(collapseButton);
-        toolbar.add(new SeparatorToolItem());
-        toolbar.add(filterButton);
-        toolbar.add(new WidgetComponent(headLabel));
-        toolbar.add(ngoRadio);
-        toolbar.add(ngoIcon);
-        toolbar.add(new WidgetComponent(ngoLabel));
-        toolbar.add(fundingRadio);
-        toolbar.add(fundingIcon);
-        toolbar.add(new WidgetComponent(fundingLabel));
-        toolbar.add(partnerRadio);
-        toolbar.add(partnerIcon);
-        toolbar.add(new WidgetComponent(partnerLabel));       
-        
-        if(ProfileUtils.isGranted(authentication, GlobalPermissionEnum.GLOBAL_EXPORT)){
-        	 final GlobalExportForm globalExportForm=
-             	new GlobalExportForm(authentication.getOrganizationId(),dispatcher);
-        	 toolbar.add(new FillToolItem());
-             toolbar.add(globalExportForm.getButton());
-             toolbar.add(globalExportForm.getExportForm());
-        }
-       
+			@Override
+			public void onClick(ClickEvent event) {
+				ngoRadio.setValue(false);
+				fundingRadio.setValue(true);
+				partnerRadio.setValue(false);
+			}
+		});
 
-        // Panel
-        projectTreePanel = new ContentPanel(new FitLayout());
-        projectTreePanel.setHeading(I18N.CONSTANTS.projects());
+		partnerRadio = new Radio();
+		partnerRadio.setFireChangeEventOnSetValue(true);
+		partnerRadio.setFieldLabel(ProjectModelType.getName(ProjectModelType.LOCAL_PARTNER));
+		partnerRadio.addStyleName(&quot;toolbar-radio&quot;);
 
-        projectTreePanel.setTopComponent(toolbar);
+		final WidgetComponent partnerIcon = new WidgetComponent(FundingIconProvider.getProjectTypeIcon(
+						ProjectModelType.LOCAL_PARTNER, IconSize.SMALL).createImage());
+		partnerIcon.addStyleName(&quot;toolbar-icon&quot;);
 
-        if (ProfileUtils.isGranted(authentication, GlobalPermissionEnum.VIEW_PROJECT)) {
-            projectTreePanel.add(projectTreeGrid);
-        } else {
-            final HTML insufficient = new HTML(I18N.CONSTANTS.permViewProjectsInsufficient());
-            insufficient.addStyleName(&quot;important-label&quot;);
-            projectTreePanel.add(insufficient);
-        }
+		final Label partnerLabel = new Label(ProjectModelType.getName(ProjectModelType.LOCAL_PARTNER));
+		partnerLabel.addStyleName(&quot;flexibility-element-label&quot;);
+		partnerLabel.addStyleName(&quot;project-starred-icon&quot;);
+		partnerLabel.addClickHandler(new ClickHandler() {
 
-        addListeners();
-        addFilters();
-    }
+			@Override
+			public void onClick(ClickEvent event) {
+				ngoRadio.setValue(false);
+				fundingRadio.setValue(false);
+				partnerRadio.setValue(true);
+			}
+		});
 
-    /**
-     * Builds and returns the columns model for the projects tree grid.
-     * 
-     * @return The project tree grid columns model.
-     */
-    private ColumnModel getProjectGridColumnModel() {
+		final HTML headLabel = new HTML(&quot;&amp;nbsp;&amp;nbsp;&quot; + I18N.CONSTANTS.projectTypeFilter() + &quot;: &quot;);
+		headLabel.addStyleName(&quot;flexibility-element-label&quot;);
 
-        final DateTimeFormat format = DateUtils.DATE_SHORT;
+		group.add(ngoRadio);
+		group.add(fundingRadio);
+		group.add(partnerRadio);
+		group.setAutoWidth(true);
 
-        // Starred icon
-        final ColumnConfig starredIconColumn = new ColumnConfig(&quot;starred&quot;, &quot;&quot;, 30);
-        starredIconColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
-            private final DashboardImageBundle imageBundle = GWT.create(DashboardImageBundle.class);
+		// Expand all button.
+		final Button expandButton = new Button(&quot;&quot;, IconImageBundle.ICONS.expand(),
+						new SelectionListener&lt;ButtonEvent&gt;() {
 
-            @Override
-            public Object render(final ProjectDTOLight model, String property, ColumnData config, int rowIndex,
-                    int colIndex, final ListStore&lt;ProjectDTOLight&gt; store, final Grid&lt;ProjectDTOLight&gt; grid) {
-            	
-            	//A star icon
-                final Image icon;
-                                             
-                if (isFavoriteProject(authentication.getUserId(),model)) {
-                	//star
-                    icon = imageBundle.star().createImage();
-                    icon.setTitle(&quot;Favorite&quot;);
-                } else {
-                	//empty start
-                    icon = imageBundle.emptyStar().createImage();
-                    icon.setTitle(&quot;Non-favorite&quot;);
-                }
+							@Override
+							public void componentSelected(ButtonEvent ce) {
+								projectTreeGrid.expandAll();
+							}
+						});
 
-                //Star icon click-handler
-                icon.addClickHandler(new ClickHandler() {
+		// Collapse all button.
+		final Button collapseButton = new Button(&quot;&quot;, IconImageBundle.ICONS.collapse(),
+						new SelectionListener&lt;ButtonEvent&gt;() {
 
-                    @Override
-                    public void onClick(ClickEvent event) {
-
-                    	UpdateProjectFavorite updateCmd ;
-                    	
-                    	//Get the project's id
-                    	int projectId = model.getId();
-                		if(projectId&lt;0) {
-                			projectId = (Integer) model.get(&quot;pid&quot;);
-                		}
-                		
-                    	
-                    	if(isFavoriteProject(authentication.getUserId(),model))
-                    	{//Remove the favorite user from project favorite user list
-                    	              	   
-                    		 updateCmd = new UpdateProjectFavorite(projectId,UpdateProjectFavorite.UpdateType.REMOVE);
-                    		                    		
-                    	}
-                    	else
-                    	{//Add current user into the favorite user list of the project
-                    		
-                    		 updateCmd = new UpdateProjectFavorite(projectId,UpdateProjectFavorite.UpdateType.ADD);                   		
-                    		
-                    	}
-                    	
-                    	//RPC to change the favorite tag
-                    	dispatcher.execute(updateCmd, new MaskingAsyncMonitor(projectTreePanel, I18N.CONSTANTS.loading()), new AsyncCallback&lt;CreateResult&gt;(){
-
 							@Override
-							public void onFailure(Throwable caught) {
-								
-								  Log.error(
-	                                        &quot;[execute] Error while setting the favorite status of the project #&quot;
-	                                                + model.getId(), caught);
-	                                MessageBox.alert(I18N.CONSTANTS.projectStarredError(),
-	                                        I18N.CONSTANTS.projectStarredErrorDetails(), null);
-	                            
-								
+							public void componentSelected(ButtonEvent ce) {
+								projectTreeGrid.collapseAll();
 							}
+						});
 
+		// Filter button.
+		filterButton = new Button(I18N.CONSTANTS.filter(), IconImageBundle.ICONS.filter());
+
+		// Refresh button.
+		final Button refreshButton = new Button(I18N.CONSTANTS.refreshProjectList(), IconImageBundle.ICONS.refresh(),
+						new SelectionListener&lt;ButtonEvent&gt;() {
+
 							@Override
-							public void onSuccess(CreateResult result) {
-								
-								if(result==null || result.getEntity()==null)
-								{
-		                                MessageBox.alert(I18N.CONSTANTS.projectStarredError(),
-		                                        I18N.CONSTANTS.projectStarredErrorDetails(), null);
-								}
-								else
-								{
-									//Update local store
-									ProjectDTOLight resultProject =(ProjectDTOLight) result.getEntity();
-									model.setFavoriteUsers(resultProject.getFavoriteUsers());
-									store.update(model);
-									
-									Notification.show(I18N.CONSTANTS.infoConfirmation(),
-                                            I18N.CONSTANTS.projectStarred());
-								 
-																													
-								}
-								
-								
+							public void componentSelected(ButtonEvent ce) {
+								// Explicit refresh.
+								refreshProjectGrid(command);
 							}
-                			
-                		});
-                    	                    	
-                 
-                    }
-                });
+						});
+		refreshButton.setToolTip(I18N.CONSTANTS.refreshProjectListDetails());
+		refreshButton.addStyleName(&quot;project-refresh-button&quot;);
 
-                icon.addStyleName(&quot;project-starred-icon&quot;);
+		// Refresh date.
+		refreshDateLabel = new com.extjs.gxt.ui.client.widget.Label();
 
-                return icon;
-            }
-        });
+		eventBus.addListener(AppEvents.DeleteProject, new Listener&lt;ProjectEvent&gt;() {
 
-        // Code
-        final ColumnConfig codeColumn = new ColumnConfig(&quot;name&quot;, I18N.CONSTANTS.projectName(), 110);
-        codeColumn.setRenderer(new WidgetTreeGridCellRenderer&lt;ProjectDTOLight&gt;() {
-            @Override
-            public Widget getWidget(ProjectDTOLight model, String property, ColumnData config, int rowIndex,
-                    int colIndex, ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+			@Override
+			public void handleEvent(ProjectEvent be) {
+				refreshProjectGrid(command);
+			}
+		});
 
-                Integer id = model.get(&quot;id&quot;);
-                if (id &lt;= 0) {
-                    id = model.get(&quot;pid&quot;);
-                }
+		final ToolBar toolbar = new ToolBar();
+		if (refreshMode == RefreshMode.BUTTON || refreshMode == RefreshMode.BOTH) {
+			toolbar.add(refreshButton);
+			toolbar.add(refreshDateLabel);
+			toolbar.add(new SeparatorToolItem());
+		}
+		toolbar.add(expandButton);
+		toolbar.add(collapseButton);
+		toolbar.add(new SeparatorToolItem());
+		toolbar.add(filterButton);
+		toolbar.add(new WidgetComponent(headLabel));
+		toolbar.add(ngoRadio);
+		toolbar.add(ngoIcon);
+		toolbar.add(new WidgetComponent(ngoLabel));
+		toolbar.add(fundingRadio);
+		toolbar.add(fundingIcon);
+		toolbar.add(new WidgetComponent(fundingLabel));
+		toolbar.add(partnerRadio);
+		toolbar.add(partnerIcon);
+		toolbar.add(new WidgetComponent(partnerLabel));
 
-                final Hyperlink h = new Hyperlink((String) model.get(property), true, ProjectPresenter.PAGE_ID
-                        .toString() + '!' + String.valueOf(id));
-                if (!model.isLeaf()) {
-                    h.addStyleName(&quot;project-grid-node&quot;);
-                } else {
-                    h.addStyleName(&quot;project-grid-leaf&quot;);
-                }
+		if (ProfileUtils.isGranted(authentication, GlobalPermissionEnum.GLOBAL_EXPORT)) {
+			final GlobalExportForm globalExportForm = new GlobalExportForm(authentication.getOrganizationId(),
+							dispatcher);
+			toolbar.add(new FillToolItem());
+			toolbar.add(globalExportForm.getButton());
+			toolbar.add(globalExportForm.getExportForm());
+		}
 
-                final com.google.gwt.user.client.ui.Grid panel = new com.google.gwt.user.client.ui.Grid(1, 2);
-                panel.setCellPadding(0);
-                panel.setCellSpacing(0);
+		// Panel
+		projectTreePanel = new ContentPanel(new FitLayout());
+		projectTreePanel.setHeading(I18N.CONSTANTS.projects());
 
-                panel.setWidget(
-                        0,
-                        0,
-                        FundingIconProvider.getProjectTypeIcon(
-                                model.getProjectModelType(authentication.getOrganizationId()), IconSize.SMALL_MEIDUM)
-                                .createImage());
-                panel.getCellFormatter().addStyleName(0, 0, &quot;project-grid-code-icon&quot;);
-                panel.setWidget(0, 1, h);
-                panel.getCellFormatter().addStyleName(0, 1, &quot;project-grid-code&quot;);
+		projectTreePanel.setTopComponent(toolbar);
 
-                return panel;
-            }
-        });
+		if (ProfileUtils.isGranted(authentication, GlobalPermissionEnum.VIEW_PROJECT)) {
+			projectTreePanel.add(projectTreeGrid);
+		} else {
+			final HTML insufficient = new HTML(I18N.CONSTANTS.permViewProjectsInsufficient());
+			insufficient.addStyleName(&quot;important-label&quot;);
+			projectTreePanel.add(insufficient);
+		}
 
-        // Title
-        final ColumnConfig titleColumn = new ColumnConfig(&quot;fullName&quot;, I18N.CONSTANTS.projectFullName(), 230);
-        titleColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+		// getProjectsStore().addFilter(closedFilter);
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                String title = (String) model.get(property);
-                if (model.getParent() != null) {
-                    title = &quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot; + title;
-                }
-                return createProjectGridText(model, title);
-            }
-        });
+		addListeners();
+		addFilters();
 
-        // Current phase
-        final ColumnConfig currentPhaseName = new ColumnConfig(&quot;currentPhaseName&quot;, I18N.CONSTANTS.projectActivePhase(), 150);
-        currentPhaseName.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                return createProjectGridText(model, (String) model.get(property));
-            }
-        });
+		getProjectsPanel().addListener(Events.AfterLayout, new Listener&lt;BaseEvent&gt;() {
 
-        // Org Unit
-        final ColumnConfig orgUnitColumn = new ColumnConfig(&quot;orgUnitName&quot;, I18N.CONSTANTS.orgunit(), 150);
-        orgUnitColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+			@Override
+			public void handleEvent(BaseEvent be) {
+				gridFilters.getFilter(&quot;time&quot;).setActive(true, false);
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                return createProjectGridText(model, (String) model.get(property));
-            }
-        });
+			}
+		});
 
-        // Ratio budget
-        final ColumnConfig spentBudgetColumn = new ColumnConfig(&quot;spentBudget&quot;, I18N.CONSTANTS.projectSpendBudget(), 100);
-        spentBudgetColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+	}
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                return new RatioBar(NumberUtils.ratio(model.getSpendBudget(), model.getPlannedBudget()));
-            }
-        });
+	/**
+	 * Builds and returns the columns model for the projects tree grid.
+	 * 
+	 * @return The project tree grid columns model.
+	 */
+	private ColumnModel getProjectGridColumnModel() {
 
-        // Planned budget
-        final ColumnConfig plannedBudgetColumn = new ColumnConfig(&quot;plannedBudget&quot;,
-                I18N.CONSTANTS.projectPlannedBudget(), 75);
-        plannedBudgetColumn.setHidden(true);
+		final DateTimeFormat format = DateUtils.DATE_SHORT;
 
-        // Spend budget
-        final ColumnConfig spendBudgetColumn = new ColumnConfig(&quot;spendBudget&quot;, I18N.CONSTANTS.projectSpendBudget(), 75);
-        spendBudgetColumn.setHidden(true);
+		// Starred icon
+		final ColumnConfig starredIconColumn = new ColumnConfig(&quot;starred&quot;, &quot;&quot;, 30);
+		starredIconColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+			private final DashboardImageBundle imageBundle = GWT.create(DashboardImageBundle.class);
 
-        // Received budget
-        final ColumnConfig receivedBudgetColumn = new ColumnConfig(&quot;receivedBudget&quot;,
-                I18N.CONSTANTS.projectReceivedBudget(), 75);
-        receivedBudgetColumn.setHidden(true);
+			@Override
+			public Object render(final ProjectDTOLight model, String property, ColumnData config, int rowIndex,
+							int colIndex, final ListStore&lt;ProjectDTOLight&gt; store, final Grid&lt;ProjectDTOLight&gt; grid) {
 
-        // Time
-        final ColumnConfig timeColumn = new ColumnConfig(&quot;time&quot;, I18N.CONSTANTS.projectTime(), 100);
-        timeColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+				// A star icon
+				final Image icon;
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                return new RatioBar(model.getElapsedTime());
-            }
-        });
+				if (isFavoriteProject(authentication.getUserId(), model)) {
+					// star
+					icon = imageBundle.star().createImage();
+					icon.setTitle(&quot;Favorite&quot;);
+				} else {
+					// empty start
+					icon = imageBundle.emptyStar().createImage();
+					icon.setTitle(&quot;Non-favorite&quot;);
+				}
 
-        // Start date
-        final ColumnConfig startDateColumn = new ColumnConfig(&quot;startDate&quot;, I18N.CONSTANTS.projectStartDate(), 75);
-        startDateColumn.setHidden(true);
-        startDateColumn.setDateTimeFormat(format);
-        startDateColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+				// Star icon click-handler
+				icon.addClickHandler(new ClickHandler() {
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                final Date d = (Date) model.get(property);
-                return createProjectGridText(model, d != null ? format.format(d) : &quot;&quot;);
-            }
-        });
+					@Override
+					public void onClick(ClickEvent event) {
 
-        // End date
-        final ColumnConfig endDateColumn = new ColumnConfig(&quot;endDate&quot;, I18N.CONSTANTS.projectEndDate(), 75);
-        endDateColumn.setDateTimeFormat(format);
-        endDateColumn.setHidden(true);
-        endDateColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+						UpdateProjectFavorite updateCmd;
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                final Date d = (Date) model.get(property);
-                return createProjectGridText(model, d != null ? format.format(d) : &quot;&quot;);
-            }
-        });
+						// Get the project's id
+						int projectId = model.getId();
+						if (projectId &lt; 0) {
+							projectId = (Integer) model.get(&quot;pid&quot;);
+						}
 
-        // Close date
-        final ColumnConfig closeDateColumn = new ColumnConfig(&quot;closeDate&quot;, I18N.CONSTANTS.projectClosedDate(), 75);
-        closeDateColumn.setDateTimeFormat(format);
-        closeDateColumn.setHidden(true);
-        closeDateColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+						if (isFavoriteProject(authentication.getUserId(), model)) {// Remove
+																					// the
+																					// favorite
+																					// user
+																					// from
+																					// project
+																					// favorite
+																					// user
+																					// list
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                final Date d = (Date) model.get(property);
-                return createProjectGridText(model, d != null ? format.format(d) : &quot;&quot;);
-            }
-        });
+							updateCmd = new UpdateProjectFavorite(projectId, UpdateProjectFavorite.UpdateType.REMOVE);
 
-        // Activity
-        final ColumnConfig activityColumn = new ColumnConfig(&quot;activity&quot;, I18N.CONSTANTS.logFrameActivity(), 100);
-        activityColumn.setSortable(false);
-        activityColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+						} else {// Add current user into the favorite user list
+								// of the project
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
-                return new RatioBar(model.getActivityAdvancement() != null ? model.getActivityAdvancement() : 0);
-            }
-        });
+							updateCmd = new UpdateProjectFavorite(projectId, UpdateProjectFavorite.UpdateType.ADD);
 
-        // Category
-        final ColumnConfig categoryColumn = new ColumnConfig(&quot;categoryElements&quot;, I18N.CONSTANTS.category(), 150);
-        categoryColumn.setSortable(false);
-        categoryColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+						}
 
-            @Override
-            public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
-                    ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+						// RPC to change the favorite tag
+						dispatcher.execute(updateCmd,
+										new MaskingAsyncMonitor(projectTreePanel, I18N.CONSTANTS.loading()),
+										new AsyncCallback&lt;CreateResult&gt;() {
 
-                final Set&lt;CategoryElementDTO&gt; elements = model.getCategoryElements();
-                final LayoutContainer panel = new LayoutContainer();
-                panel.setLayout(new FlowLayout());
-                final FlowData data = new FlowData(new Margins(0, 5, 0, 0));
+											@Override
+											public void onFailure(Throwable caught) {
 
-                if (elements != null) {
-                    for (final CategoryElementDTO element : elements) {
-                        panel.add(CategoryIconProvider.getIcon(element), data);
-                    }
-                }
+												Log.error(&quot;[execute] Error while setting the favorite status of the project #&quot;
+																+ model.getId(), caught);
+												MessageBox.alert(I18N.CONSTANTS.projectStarredError(),
+																I18N.CONSTANTS.projectStarredErrorDetails(), null);
 
-                return panel;
-            }
-        });
+											}
 
-        return new ColumnModel(Arrays.asList(starredIconColumn, codeColumn, titleColumn, currentPhaseName,
-                orgUnitColumn, spentBudgetColumn, plannedBudgetColumn, spendBudgetColumn, receivedBudgetColumn,
-                startDateColumn, endDateColumn, closeDateColumn, timeColumn, activityColumn, categoryColumn));
-    }
-    
-    /*
-     * Grid filters for projects' TreeGrid  
-     */
+											@Override
+											public void onSuccess(CreateResult result) {
+
+												if (result == null || result.getEntity() == null) {
+													MessageBox.alert(I18N.CONSTANTS.projectStarredError(),
+																	I18N.CONSTANTS.projectStarredErrorDetails(), null);
+												} else {
+													// Update local store
+													ProjectDTOLight resultProject = (ProjectDTOLight) result
+																	.getEntity();
+													model.setFavoriteUsers(resultProject.getFavoriteUsers());
+													store.update(model);
+
+													Notification.show(I18N.CONSTANTS.infoConfirmation(),
+																	I18N.CONSTANTS.projectStarred());
+
+												}
+
+											}
+
+										});
+
+					}
+				});
+
+				icon.addStyleName(&quot;project-starred-icon&quot;);
+
+				return icon;
+			}
+		});
+
+		// Code
+		final ColumnConfig codeColumn = new ColumnConfig(&quot;name&quot;, I18N.CONSTANTS.projectName(), 110);
+		codeColumn.setRenderer(new WidgetTreeGridCellRenderer&lt;ProjectDTOLight&gt;() {
+			@Override
+			public Widget getWidget(ProjectDTOLight model, String property, ColumnData config, int rowIndex,
+							int colIndex, ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+
+				Integer id = model.get(&quot;id&quot;);
+				if (id &lt;= 0) {
+					id = model.get(&quot;pid&quot;);
+				}
+
+				final Hyperlink h = new Hyperlink((String) model.get(property), true, ProjectPresenter.PAGE_ID
+								.toString() + '!' + String.valueOf(id));
+				if (!model.isLeaf()) {
+					h.addStyleName(&quot;project-grid-node&quot;);
+				} else {
+					h.addStyleName(&quot;project-grid-leaf&quot;);
+				}
+
+				final com.google.gwt.user.client.ui.Grid panel = new com.google.gwt.user.client.ui.Grid(1, 2);
+				panel.setCellPadding(0);
+				panel.setCellSpacing(0);
+
+				panel.setWidget(0,
+								0,
+								FundingIconProvider.getProjectTypeIcon(
+												model.getProjectModelType(authentication.getOrganizationId()),
+												IconSize.SMALL_MEIDUM).createImage());
+				panel.getCellFormatter().addStyleName(0, 0, &quot;project-grid-code-icon&quot;);
+				panel.setWidget(0, 1, h);
+				panel.getCellFormatter().addStyleName(0, 1, &quot;project-grid-code&quot;);
+
+				return panel;
+			}
+		});
+
+		// Title
+		final ColumnConfig titleColumn = new ColumnConfig(&quot;fullName&quot;, I18N.CONSTANTS.projectFullName(), 230);
+		titleColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				String title = (String) model.get(property);
+				if (model.getParent() != null) {
+					title = &quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot; + title;
+				}
+				return createProjectGridText(model, title);
+			}
+		});
+
+		// Current phase
+		final ColumnConfig currentPhaseName = new ColumnConfig(&quot;currentPhaseName&quot;, I18N.CONSTANTS.projectActivePhase(),
+						150);
+		currentPhaseName.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				return createProjectGridText(model, (String) model.get(property));
+			}
+		});
+
+		// Org Unit
+		final ColumnConfig orgUnitColumn = new ColumnConfig(&quot;orgUnitName&quot;, I18N.CONSTANTS.orgunit(), 150);
+		orgUnitColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				return createProjectGridText(model, (String) model.get(property));
+			}
+		});
+
+		// Ratio budget
+		final ColumnConfig spentBudgetColumn = new ColumnConfig(&quot;spentBudget&quot;, I18N.CONSTANTS.projectSpendBudget(), 100);
+		spentBudgetColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				return new RatioBar(NumberUtils.ratio(model.getSpendBudget(), model.getPlannedBudget()));
+			}
+		});
+
+		// Planned budget
+		final ColumnConfig plannedBudgetColumn = new ColumnConfig(&quot;plannedBudget&quot;,
+						I18N.CONSTANTS.projectPlannedBudget(), 75);
+		plannedBudgetColumn.setHidden(true);
+
+		// Spend budget
+		final ColumnConfig spendBudgetColumn = new ColumnConfig(&quot;spendBudget&quot;, I18N.CONSTANTS.projectSpendBudget(), 75);
+		spendBudgetColumn.setHidden(true);
+
+		// Received budget
+		final ColumnConfig receivedBudgetColumn = new ColumnConfig(&quot;receivedBudget&quot;,
+						I18N.CONSTANTS.projectReceivedBudget(), 75);
+		receivedBudgetColumn.setHidden(true);
+
+		// Time
+		final ColumnConfig timeColumn = new ColumnConfig(&quot;time&quot;, I18N.CONSTANTS.projectTime(), 100);
+		timeColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				if (!model.isClosed())
+					return new RatioBar(model.getElapsedTime());
+				else
+					return new Label(I18N.CONSTANTS.projectClosedLabel());
+			}
+		});
+
+		// Start date
+		final ColumnConfig startDateColumn = new ColumnConfig(&quot;startDate&quot;, I18N.CONSTANTS.projectStartDate(), 75);
+		startDateColumn.setHidden(true);
+		startDateColumn.setDateTimeFormat(format);
+		startDateColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				final Date d = (Date) model.get(property);
+				return createProjectGridText(model, d != null ? format.format(d) : &quot;&quot;);
+			}
+		});
+
+		// End date
+		final ColumnConfig endDateColumn = new ColumnConfig(&quot;endDate&quot;, I18N.CONSTANTS.projectEndDate(), 75);
+		endDateColumn.setDateTimeFormat(format);
+		endDateColumn.setHidden(true);
+		endDateColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				final Date d = (Date) model.get(property);
+				return createProjectGridText(model, d != null ? format.format(d) : &quot;&quot;);
+			}
+		});
+
+		// Close date
+		final ColumnConfig closeDateColumn = new ColumnConfig(&quot;closeDate&quot;, I18N.CONSTANTS.projectClosedDate(), 75);
+		closeDateColumn.setDateTimeFormat(format);
+		closeDateColumn.setHidden(true);
+		closeDateColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				final Date d = (Date) model.get(property);
+				return createProjectGridText(model, d != null ? format.format(d) : &quot;&quot;);
+			}
+		});
+
+		// Activity
+		final ColumnConfig activityColumn = new ColumnConfig(&quot;activity&quot;, I18N.CONSTANTS.logFrameActivity(), 100);
+		activityColumn.setSortable(false);
+		activityColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+				return new RatioBar(model.getActivityAdvancement() != null ? model.getActivityAdvancement() : 0);
+			}
+		});
+
+		// Category
+		final ColumnConfig categoryColumn = new ColumnConfig(&quot;categoryElements&quot;, I18N.CONSTANTS.category(), 150);
+		categoryColumn.setSortable(false);
+		categoryColumn.setRenderer(new GridCellRenderer&lt;ProjectDTOLight&gt;() {
+
+			@Override
+			public Object render(ProjectDTOLight model, String property, ColumnData config, int rowIndex, int colIndex,
+							ListStore&lt;ProjectDTOLight&gt; store, Grid&lt;ProjectDTOLight&gt; grid) {
+
+				final Set&lt;CategoryElementDTO&gt; elements = model.getCategoryElements();
+				final LayoutContainer panel = new LayoutContainer();
+				panel.setLayout(new FlowLayout());
+				final FlowData data = new FlowData(new Margins(0, 5, 0, 0));
+
+				if (elements != null) {
+					for (final CategoryElementDTO element : elements) {
+						panel.add(CategoryIconProvider.getIcon(element), data);
+					}
+				}
+
+				return panel;
+			}
+		});
+
+		return new ColumnModel(Arrays.asList(starredIconColumn, codeColumn, titleColumn, currentPhaseName,
+						orgUnitColumn, spentBudgetColumn, plannedBudgetColumn, spendBudgetColumn, receivedBudgetColumn,
+						startDateColumn, endDateColumn, closeDateColumn, timeColumn, activityColumn, categoryColumn));
+	}
+
+	/*
+	 * Grid filters for projects' TreeGrid
+	 */
 	private GridFilters createGridFilters() {
 
 		gridFilters.setLocal(true);
 
-		/*		 
-		 * Data index of each filter should be identical with column id 
-		 * in ColumnConfig of TreeGrid
+		/*
+		 * Data index of each filter should be identical with column id in
+		 * ColumnConfig of TreeGrid
 		 */
-		
-		//Common filters
+
+		// Common filters
 		gridFilters.addFilter(new StringFilter(&quot;name&quot;));
 		gridFilters.addFilter(new StringFilter(&quot;fullName&quot;));
 		gridFilters.addFilter(new StringFilter(&quot;currentPhaseName&quot;));
@@ -795,7 +947,7 @@
 		gridFilters.addFilter(new DateFilter(&quot;closeDate&quot;));
 
 		// Custom filter for category elements' list
-		ListFilter categoryListFilter = new ListFilter(&quot;categoryElements&quot;,new ListStore&lt;ModelData&gt;()) {
+		ListFilter categoryListFilter = new ListFilter(&quot;categoryElements&quot;, new ListStore&lt;ModelData&gt;()) {
 			@SuppressWarnings(&quot;unchecked&quot;)
 			@Override
 			public boolean validateModel(ModelData model) {
@@ -806,7 +958,7 @@
 				if (elementsPerProject != null) {
 					String label = null;
 					for (final CategoryElementDTO element : elementsPerProject) {
-						label = element.getLabel() + &quot; (&quot;+ element.getParentCategoryDTO().getLabel()+ &quot;)&quot;;
+						label = element.getLabel() + &quot; (&quot; + element.getParentCategoryDTO().getLabel() + &quot;)&quot;;
 						if (filterLabels.contains(label)) {
 							return true;
 						}
@@ -820,49 +972,78 @@
 		};
 		categoryListFilter.setDisplayProperty(&quot;categoryFilter&quot;);
 		gridFilters.addFilter(categoryListFilter);
-		
+
+		ClosedFilter closed = new ClosedFilter(&quot;time&quot;);
+		gridFilters.addFilter(closed);
+
+		// gridFilters.addFilter(new DateFilter(&quot;time&quot;));
+
+		// closed.addListener(Events.Activate, new Listener&lt;BaseEvent&gt;() {
+		//
+		// @Override
+		// public void handleEvent(BaseEvent be) {
+		// if (getProjectsStore().getFilters().contains(closedFilter)) {
+		// getProjectsStore().removeFilter(closedFilter);
+		// applyProjectFilters();
+		//
+		// }
+		//
+		// }
+		// });
+
+		// closed.addListener(Events.Deactivate, new Listener&lt;BaseEvent&gt;() {
+		//
+		// @Override
+		// public void handleEvent(BaseEvent be) {
+		// if (!getProjectsStore().getFilters().contains(closedFilter)) {
+		// getProjectsStore().addFilter(closedFilter);
+		// applyProjectFilters();
+		//
+		// }
+		//
+		// }
+		// });
+
 		return gridFilters;
 	}
-	
 
 	/*
-	 * Fetches categories in active user's organization and
-	 * fills {@link ListFilter} store of a category column  
+	 * Fetches categories in active user's organization and fills {@link
+	 * ListFilter} store of a category column
 	 */
 	private void reloadCategoryListFilterStore() {
-		dispatcher.execute(new GetCategories(), null,
-				new AsyncCallback&lt;CategoriesListResult&gt;() {
+		dispatcher.execute(new GetCategories(), null, new AsyncCallback&lt;CategoriesListResult&gt;() {
 
-					@Override
-					public void onFailure(Throwable e) {
-						Log.error(&quot;[GetCategories command] Error while getting categories.&quot;,e);
-					}
+			@Override
+			public void onFailure(Throwable e) {
+				Log.error(&quot;[GetCategories command] Error while getting categories.&quot;, e);
+			}
 
-					@SuppressWarnings(&quot;unchecked&quot;)
-					@Override
-					public void onSuccess(CategoriesListResult result) {
-						ListFilter categoryListFilter = (ListFilter) gridFilters.getFilter(&quot;categoryElements&quot;);
-						ListStore&lt;ModelData&gt; filterStore = categoryListFilter.getStore();						
- 						List&lt;CategoryTypeDTO&gt; categories = result.getList();
-						
-						for (CategoryTypeDTO category : categories) {
-							List&lt;CategoryElementDTO&gt; categoryElements = category.getCategoryElementsDTO();
-							for (CategoryElementDTO element : categoryElements) {
-								String filterLabel = element.getLabel() + &quot; (&quot;+ category.getLabel() + &quot;)&quot;;
-								boolean exist=false;
- 								 for(ModelData model : filterStore.getModels()){
-										if(model.get(&quot;categoryFilter&quot;).equals(filterLabel)){
-											exist=true;
-											break;
-										}
-								  }
- 								 if(!exist){
- 									 filterStore.add(getFilterModelData(filterLabel));
- 								 }
+			@SuppressWarnings(&quot;unchecked&quot;)
+			@Override
+			public void onSuccess(CategoriesListResult result) {
+				ListFilter categoryListFilter = (ListFilter) gridFilters.getFilter(&quot;categoryElements&quot;);
+				ListStore&lt;ModelData&gt; filterStore = categoryListFilter.getStore();
+				List&lt;CategoryTypeDTO&gt; categories = result.getList();
+
+				for (CategoryTypeDTO category : categories) {
+					List&lt;CategoryElementDTO&gt; categoryElements = category.getCategoryElementsDTO();
+					for (CategoryElementDTO element : categoryElements) {
+						String filterLabel = element.getLabel() + &quot; (&quot; + category.getLabel() + &quot;)&quot;;
+						boolean exist = false;
+						for (ModelData model : filterStore.getModels()) {
+							if (model.get(&quot;categoryFilter&quot;).equals(filterLabel)) {
+								exist = true;
+								break;
 							}
-						} 
+						}
+						if (!exist) {
+							filterStore.add(getFilterModelData(filterLabel));
+						}
 					}
-				});
+				}
+			}
+		});
 	}
 
 	private ModelData getFilterModelData(String filterLabel) {
@@ -871,323 +1052,495 @@
 		return model;
 	}
 
-    private Object createProjectGridText(ProjectDTOLight model, String content) {
-        final Text label = new Text(content);
-        if (!model.isLeaf()) {
-            label.addStyleName(&quot;project-grid-node&quot;);
-        } else {
-            label.addStyleName(&quot;project-grid-leaf&quot;);
-        }
-        return label;
-    }
+	private Object createProjectGridText(ProjectDTOLight model, String content) {
+		final Text label = new Text(content);
+		if (!model.isLeaf()) {
+			label.addStyleName(&quot;project-grid-node&quot;);
+		} else {
+			label.addStyleName(&quot;project-grid-leaf&quot;);
+		}
+		return label;
+	}
 
-    private void addListeners() {
+	private void addListeners() {
 
-        // Updates the projects grid heading when the store is filtered.
-        projectTreeGrid.getTreeStore().addListener(Store.Filter, new Listener&lt;StoreEvent&lt;ProjectDTOLight&gt;&gt;() {
+		// Updates the projects grid heading when the store is filtered.
+		projectTreeGrid.getTreeStore().addListener(Store.Filter, new Listener&lt;StoreEvent&lt;ProjectDTOLight&gt;&gt;() {
 
-            @Override
-            public void handleEvent(StoreEvent&lt;ProjectDTOLight&gt; be) {
-                projectTreePanel.setHeading(I18N.CONSTANTS.projects() + &quot; (&quot;
-                        + projectTreeGrid.getTreeStore().getChildCount() + ')');
-            }
-        });
+			@Override
+			public void handleEvent(StoreEvent&lt;ProjectDTOLight&gt; be) {
+				projectTreePanel.setHeading(I18N.CONSTANTS.projects() + &quot; (&quot;
+								+ projectTreeGrid.getTreeStore().getChildCount() + ')');
+			}
+		});
 
-        // Adds actions on filter by model type.
-        for (final ProjectModelType type : ProjectModelType.values()) {
-            getRadioFilter(type).addListener(Events.Change, new Listener&lt;FieldEvent&gt;() {
+		// Adds actions on filter by model type.
+		for (final ProjectModelType type : ProjectModelType.values()) {
+			getRadioFilter(type).addListener(Events.Change, new Listener&lt;FieldEvent&gt;() {
 
-                @Override
-                public void handleEvent(FieldEvent be) {
-                    if (Boolean.TRUE.equals(be.getValue())) {
-                        currentModelType = type;
-                        applyProjectFilters();
-                    }
-                }
-            });
-        }
-    }
+				@Override
+				public void handleEvent(FieldEvent be) {
+					if (Boolean.TRUE.equals(be.getValue())) {
+						currentModelType = type;
+						applyProjectFilters();
+					}
+				}
+			});
+		}
 
-    private void addFilters() {
+	}
 
-        // The filter by model type.
-        final StoreFilter&lt;ProjectDTOLight&gt; typeFilter = new StoreFilter&lt;ProjectDTOLight&gt;() {
+	private void addFilters() {
 
-            @Override
-            public boolean select(Store&lt;ProjectDTOLight&gt; store, ProjectDTOLight parent, ProjectDTOLight item,
-                    String property) {
+		// The filter by model type.
+		final StoreFilter&lt;ProjectDTOLight&gt; typeFilter = new StoreFilter&lt;ProjectDTOLight&gt;() {
 
-                boolean selected = false;
+			@Override
+			public boolean select(Store&lt;ProjectDTOLight&gt; store, ProjectDTOLight parent, ProjectDTOLight item,
+							String property) {
 
-                // Root item.
-                if (item.getParent() == null) {
-                    // A root item is filtered if its type doesn't match the
-                    // current type.
-                    selected = item.getVisibility(authentication.getOrganizationId()) == currentModelType;
-                }
-                // Child item
-                else {
-                    // A child item is filtered if its parent is filtered.
-                    selected = ((ProjectDTOLight) item.getParent()).getVisibility(authentication.getOrganizationId()) == currentModelType;
-                }
+				boolean selected = false;
 
-                return selected;
-            }
-        };
+				// Root item.
+				if (item.getParent() == null) {
+					// A root item is filtered if its type doesn't match the
+					// current type.
+					selected = item.getVisibility(authentication.getOrganizationId()) == currentModelType;
+				}
+				// Child item
+				else {
+					// A child item is filtered if its parent is filtered.
+					selected = ((ProjectDTOLight) item.getParent()).getVisibility(authentication.getOrganizationId()) == currentModelType;
+				}
 
-        getProjectsStore().addFilter(typeFilter);
+				return selected;
+			}
+		};
 
-        // Filters aren't used for the moment.
-        filterButton.setVisible(false);
-    }
+		getProjectsStore().addFilter(typeFilter);
 
-    private void applyProjectFilters() {
-        getProjectsStore().applyFilters(null);
-    }
+		// Filters aren't used for the moment.
+		filterButton.setVisible(false);
+	}
 
-    private Radio getRadioFilter(ProjectModelType type) {
+	private void applyProjectFilters() {
+		getProjectsStore().applyFilters(null);
+	}
 
-        if (type != null) {
-            switch (type) {
-            case NGO:
-                return ngoRadio;
-            case FUNDING:
-                return fundingRadio;
-            case LOCAL_PARTNER:
-                return partnerRadio;
-            }
-        }
+	private Radio getRadioFilter(ProjectModelType type) {
 
-        return null;
-    }
+		if (type != null) {
+			switch (type) {
+			case NGO:
+				return ngoRadio;
+			case FUNDING:
+				return fundingRadio;
+			case LOCAL_PARTNER:
+				return partnerRadio;
+			}
+		}
 
-    /**
-     * Display the given date as the last refreshed date.
-     * 
-     * @param date
-     *            The last refreshed date.
-     */
-    @SuppressWarnings(&quot;deprecation&quot;)
-    private void updateRefreshingDate(Date date) {
-        if (date != null) {
-            refreshDateLabel.setText(&quot;(&quot; + (date.getHours() &lt; 10 ? &quot;0&quot; + date.getHours() : date.getHours()) + &quot;h&quot;
-                    + (date.getMinutes() &lt; 10 ? &quot;0&quot; + date.getMinutes() : date.getMinutes()) + &quot;)&quot;);
-        }
-    }
+		return null;
+	}
 
-    /**
-     * Refreshes the projects grid with the current parameters.
-     * 
-     * @param cmd
-     *            The {@link GetProjects} command to execute.
-     */
-    private void refreshProjectGrid(GetProjects cmd) {
+	/**
+	 * Display the given date as the last refreshed date.
+	 * 
+	 * @param date
+	 *            The last refreshed date.
+	 */
+	@SuppressWarnings(&quot;deprecation&quot;)
+	private void updateRefreshingDate(Date date) {
+		if (date != null) {
+			refreshDateLabel.setText(&quot;(&quot; + (date.getHours() &lt; 10 ? &quot;0&quot; + date.getHours() : date.getHours()) + &quot;h&quot;
+							+ (date.getMinutes() &lt; 10 ? &quot;0&quot; + date.getMinutes() : date.getMinutes()) + &quot;)&quot;);
+		}
+	}
 
-        // Checks that the user can view projects.
-        if (!ProfileUtils.isGranted(authentication, GlobalPermissionEnum.VIEW_PROJECT)) {
-            return;
-        }
+	/**
+	 * Refreshes the projects grid with the current parameters.
+	 * 
+	 * @param cmd
+	 *            The {@link GetProjects} command to execute.
+	 */
+	private void refreshProjectGrid(GetProjects cmd) {
 
-        if (cmd == null) {
-            return;
-        }
+		// Checks that the user can view projects.
+		if (!ProfileUtils.isGranted(authentication, GlobalPermissionEnum.VIEW_PROJECT)) {
+			return;
+		}
 
-        //Reload filter labels for category filter list store
-        reloadCategoryListFilterStore();
-        
-        if (loadingMode == LoadingMode.ONE_TIME) {
+		if (cmd == null) {
+			return;
+		}
 
-            dispatcher.execute(cmd, new MaskingAsyncMonitor(projectTreePanel, I18N.CONSTANTS.loading()),
-                    new AsyncCallback&lt;ProjectListResult&gt;() {
+		// Reload filter labels for category filter list store
+		reloadCategoryListFilterStore();
 
-                        @Override
-                        public void onFailure(Throwable e) {
-                            Log.error(&quot;[GetProjects command] Error while getting projects.&quot;, e);
-                            // nothing
-                        }
+		if (loadingMode == LoadingMode.ONE_TIME) {
 
-                        @Override
-                        public void onSuccess(ProjectListResult result) {
+			dispatcher.execute(cmd, new MaskingAsyncMonitor(projectTreePanel, I18N.CONSTANTS.loading()),
+							new AsyncCallback&lt;ProjectListResult&gt;() {
 
-                            getProjectsStore().removeAll();
-                            getProjectsStore().clearFilters();
+								@Override
+								public void onFailure(Throwable e) {
+									Log.error(&quot;[GetProjects command] Error while getting projects.&quot;, e);
+									// nothing
+								}
 
-                            if (result != null) {
-                                final List&lt;ProjectDTOLight&gt; resultList = result.getListProjectsLightDTO();
-                                int i = -1;
-                                for (final ProjectDTOLight p : resultList) {
-                                    try {
-                                        // Project id.
-                                        p.setProjectId(p.getId());
-                                        // Tree id.
-                                        p.setId(i--);
+								@Override
+								public void onSuccess(ProjectListResult result) {
 
-                                        for (final ProjectDTOLight c : p.getChildrenProjects()) {
-                                            // Project id.
-                                            if (c != null) {
+									getProjectsStore().removeAll();
+									getProjectsStore().clearFilters();
 
-                                                c.setProjectId(c.getId());
-                                                // Tree id.
-                                                c.setId(i--);
+									if (result != null) {
+										final List&lt;ProjectDTOLight&gt; resultList = result.getListProjectsLightDTO();
+										int i = -1;
+										for (final ProjectDTOLight p : resultList) {
+											try {
+												// Project id.
+												p.setProjectId(p.getId());
+												// Tree id.
+												p.setId(i--);
 
-                                            }
-                                        }
-                                    } catch (Exception e) {
-                                        e.printStackTrace();
-                                    }
-                                }
-                                getProjectsStore().add(resultList, true);
-                            }
+												for (final ProjectDTOLight c : p.getChildrenProjects()) {
+													// Project id.
+													if (c != null) {
 
-                            applyProjectFilters();
-                            updateRefreshingDate(new Date());
-                        }
-                    });
-        } else if (loadingMode == LoadingMode.CHUNK) {
+														c.setProjectId(c.getId());
+														// Tree id.
+														c.setId(i--);
 
-            // Builds a new chunks worker.
+													}
+												}
+											} catch (Exception e) {
+												e.printStackTrace();
+											}
+										}
+										getProjectsStore().add(resultList, true);
+									}
 
-            int chunSize = 2;
-            try {
-                chunSize = Integer.parseInt(Window.Location.getParameter(&quot;chunk&quot;));
-                if (chunSize &lt;= 0) {
-                    chunSize = 2;
-                }
-            } catch (Throwable e) {
-                // swallow exception.
-            }
+									applyProjectFilters();
+									updateRefreshingDate(new Date());
+								}
+							});
+		} else if (loadingMode == LoadingMode.CHUNK) {
 
-            final GetProjectsWorker worker = new GetProjectsWorker(dispatcher, cmd, projectTreePanel, chunSize);
-            worker.addWorkerListener(new GetProjectsWorker.WorkerListener() {
+			// Builds a new chunks worker.
 
-                private int index = -1;
+			int chunSize = 2;
+			try {
+				chunSize = Integer.parseInt(Window.Location.getParameter(&quot;chunk&quot;));
+				if (chunSize &lt;= 0) {
+					chunSize = 2;
+				}
+			} catch (Throwable e) {
+				// swallow exception.
+			}
 
-                @Override
-                public void serverError(Throwable error) {
-                    Log.error(&quot;[GetProjectsWorker] Error while getting projects by chunks.&quot;, error);
-                    applyProjectFilters();
-                    updateRefreshingDate(new Date());
-                    MessageBox.alert(I18N.CONSTANTS.error(), I18N.CONSTANTS.refreshProjectListError(), null);
-                }
+			final GetProjectsWorker worker = new GetProjectsWorker(dispatcher, cmd, projectTreePanel, chunSize);
+			worker.addWorkerListener(new GetProjectsWorker.WorkerListener() {
 
-                @Override
-                public void chunkRetrieved(List&lt;ProjectDTOLight&gt; projects) {
+				private int index = -1;
 
-                    if (projects != null) {
-                        for (final ProjectDTOLight p : projects) {
-                            try {
-                                // Project id.
-                                p.setProjectId(p.getId());
-                                // Tree id.
-                                p.setId(index--);
+				@Override
+				public void serverError(Throwable error) {
+					Log.error(&quot;[GetProjectsWorker] Error while getting projects by chunks.&quot;, error);
+					applyProjectFilters();
+					updateRefreshingDate(new Date());
+					MessageBox.alert(I18N.CONSTANTS.error(), I18N.CONSTANTS.refreshProjectListError(), null);
+				}
 
-                                for (final ProjectDTOLight c : p.getChildrenProjects()) {
-                                    // Project id.
-                                    if (c != null) {
+				@Override
+				public void chunkRetrieved(List&lt;ProjectDTOLight&gt; projects) {
 
-                                        c.setProjectId(c.getId());
-                                        // Tree id.
-                                        c.setId(index--);
+					if (projects != null) {
+						for (final ProjectDTOLight p : projects) {
+							try {
+								// Project id.
+								p.setProjectId(p.getId());
+								// Tree id.
+								p.setId(index--);
 
-                                    }
-                                }
-                            } catch (Exception e) {
-                                e.printStackTrace();
-                            }
-                        }
-                        getProjectsStore().add(projects, true);
-                    }
-                }
+								for (final ProjectDTOLight c : p.getChildrenProjects()) {
+									// Project id.
+									if (c != null) {
 
-                @Override
-                public void ended() {
-                    applyProjectFilters();
-                    updateRefreshingDate(new Date());
-                }
-            });
+										c.setProjectId(c.getId());
+										// Tree id.
+										c.setId(index--);
 
-            // Runs the worker.
-            getProjectsStore().removeAll();
-            getProjectsStore().clearFilters();
-            worker.run();
-        }
-    }
+									}
+								}
+							} catch (Exception e) {
+								e.printStackTrace();
+							}
+						}
+						getProjectsStore().add(projects, true);
+					}
+				}
 
-    public ContentPanel getProjectsPanel() {
-        return projectTreePanel;
-    }
+				@Override
+				public void ended() {
+					applyProjectFilters();
+					updateRefreshingDate(new Date());
+				}
+			});
 
-    public TreeGrid&lt;ProjectDTOLight&gt; getProjectsTreeGrid() {
-        return projectTreeGrid;
-    }
+			// Runs the worker.
+			getProjectsStore().removeAll();
+			getProjectsStore().clearFilters();
 
-    public ProjectStore getProjectsStore() {
-        return (ProjectStore) projectTreeGrid.getTreeStore();
-    }
+			worker.run();
+		}
+	}
 
-    public RefreshMode getRefreshMode() {
-        return refreshMode;
-    }
+	public ContentPanel getProjectsPanel() {
+		return projectTreePanel;
+	}
 
-    /**
-     * Asks for a refresh of the projects list. If the refreshing mode is set to
-     * {@link RefreshMode#AUTOMATIC}, the list will be refreshed immediately.
-     * Otherwise, the list will be refreshed depending on the selected
-     * refreshing mode.
-     * 
-     * @param viewOwnOrManage
-     *            If the projects that the user own or manage must be included
-     *            in the list (no matter of their organizational units).
-     * @param orgUnitsIds
-     *            The list of ids of the organizational units for which the
-     *            projects will be retrieved. The projects of each the
-     *            sub-organizational units are retrieved automatically.
-     */
-    public void refresh(boolean viewOwnOrManage, Integer... orgUnitsIds) {
+	public TreeGrid&lt;ProjectDTOLight&gt; getProjectsTreeGrid() {
+		return projectTreeGrid;
+	}
 
-        final List&lt;Integer&gt; orgUnitsIdsAsList = Arrays.asList(orgUnitsIds);
+	public ProjectStore getProjectsStore() {
+		return (ProjectStore) projectTreeGrid.getTreeStore();
+	}
 
-        this.orgUnitsIds.clear();
-        this.orgUnitsIds.addAll(orgUnitsIdsAsList);
+	public RefreshMode getRefreshMode() {
+		return refreshMode;
+	}
 
-        // Builds the next refresh command.
-        command = new GetProjects();
-        command.setOrgUnitsIds(orgUnitsIdsAsList);
-        command.setViewOwnOrManage(viewOwnOrManage);
+	/**
+	 * Asks for a refresh of the projects list. If the refreshing mode is set to
+	 * {@link RefreshMode#AUTOMATIC}, the list will be refreshed immediately.
+	 * Otherwise, the list will be refreshed depending on the selected
+	 * refreshing mode.
+	 * 
+	 * @param viewOwnOrManage
+	 *            If the projects that the user own or manage must be included
+	 *            in the list (no matter of their organizational units).
+	 * @param orgUnitsIds
+	 *            The list of ids of the organizational units for which the
+	 *            projects will be retrieved. The projects of each the
+	 *            sub-organizational units are retrieved automatically.
+	 */
+	public void refresh(boolean viewOwnOrManage, Integer... orgUnitsIds) {
 
-        // If the mode is automatic, the list is refreshed immediately.
-        if (refreshMode == RefreshMode.AUTOMATIC || (refreshMode == RefreshMode.BOTH &amp;&amp; !isLoaded)) {
-            refreshProjectGrid(command);
-            isLoaded = true;
-        }
-    }
-    
-    /**
-     * 
-     * Check if the project is a favorite project of the current user.
-     * 
-     * @param userId
-     * 
-     * @param project
-     * 
-     * @return 
-     * 
-     * @author  HUZHE(zhe.hu32@gmail.com)	  
-     */
-    public boolean isFavoriteProject(int userId,ProjectDTOLight project)
-    {
-       if(project.getFavoriteUsers()==null)
-    	   return false;
-    	
-    	for(UserDTO u : project.getFavoriteUsers())
-    	{
-    		if(u.getId()==userId)   		
-    			return true;
-    		
-    	}
-    	
-    	return false;
-    }
-    
-    
+		final List&lt;Integer&gt; orgUnitsIdsAsList = Arrays.asList(orgUnitsIds);
+
+		this.orgUnitsIds.clear();
+		this.orgUnitsIds.addAll(orgUnitsIdsAsList);
+
+		// Builds the next refresh command.
+		command = new GetProjects();
+		command.setOrgUnitsIds(orgUnitsIdsAsList);
+		command.setViewOwnOrManage(viewOwnOrManage);
+
+		// If the mode is automatic, the list is refreshed immediately.
+		if (refreshMode == RefreshMode.AUTOMATIC || (refreshMode == RefreshMode.BOTH &amp;&amp; !isLoaded)) {
+			refreshProjectGrid(command);
+			isLoaded = true;
+		}
+	}
+
+	/**
+	 * 
+	 * Check if the project is a favorite project of the current user.
+	 * 
+	 * @param userId
+	 * 
+	 * @param project
+	 * 
+	 * @return
+	 * 
+	 * @author HUZHE(zhe.hu32@gmail.com)
+	 */
+	public boolean isFavoriteProject(int userId, ProjectDTOLight project) {
+		if (project.getFavoriteUsers() == null)
+			return false;
+
+		for (UserDTO u : project.getFavoriteUsers()) {
+			if (u.getId() == userId)
+				return true;
+
+		}
+
+		return false;
+	}
+
+	private class ClosedFilter extends Filter {
+
+		private CheckMenuItem noneFilter, sixMonthsFilter, twelveMonthsFilter, customFilter;
+		private DateMenu dateMenu;
+
+		private CheckMenuItem currentItem;
+
+		private Listener&lt;MenuEvent&gt; handler = new Listener&lt;MenuEvent&gt;() {
+			@Override
+			public void handleEvent(MenuEvent be) {
+
+				currentItem = (CheckMenuItem) be.getItem();
+				fireUpdate();
+
+			}
+
+		};
+
+		private Listener&lt;MenuEvent&gt; menuListener = new Listener&lt;MenuEvent&gt;() {
+			public void handleEvent(MenuEvent be) {
+				// if (be.getType() == Events.CheckChange) {
+				// onCheckChange(be);
+				// } else
+
+				if (be.getType() == Events.Select) {
+					onMenuSelect(be);
+				}
+			}
+		};
+
+		public ClosedFilter(String dataIndex) {
+			super(dataIndex);
+
+			menu = new Menu();
+
+			noneFilter = new CheckMenuItem(I18N.CONSTANTS.noneFilter());
+			noneFilter.setGroup(&quot;radios&quot;);
+			noneFilter.setChecked(true);
+			menu.add(noneFilter);
+
+			sixMonthsFilter = new CheckMenuItem(I18N.CONSTANTS.sixMonthsFilter());
+			sixMonthsFilter.setGroup(&quot;radios&quot;);
+			menu.add(sixMonthsFilter);
+
+			twelveMonthsFilter = new CheckMenuItem(I18N.CONSTANTS.twelveMonthsFilter());
+			twelveMonthsFilter.setGroup(&quot;radios&quot;);
+			menu.add(twelveMonthsFilter);
+
+			customFilter = new CheckMenuItem(I18N.CONSTANTS.customFilter());
+			customFilter.setGroup(&quot;radios&quot;);
+			menu.add(customFilter);
+
+			dateMenu = new DateMenu();
+
+			dateMenu.setDate(new Date());
+			dateMenu.addListener(Events.Select, menuListener);
+			// hidden.setSubMenu(dateMenu);
+			//
+			// menu.add(hidden);
+			// hidden.hide();
+
+			customFilter.setSubMenu(dateMenu);
+
+			customFilter.addListener(Events.Select, handler);
+			sixMonthsFilter.addListener(Events.Select, handler);
+			twelveMonthsFilter.addListener(Events.Select, handler);
+			noneFilter.addListener(Events.Select, handler);
+			// // menu.addListener(Events.Select, handler);
+			// menu.addListener(Events.Change, handler);
+			// menu.addListener(Events.CheckChange, handler);
+			// menu.addListener(Events.CheckChanged, handler);
+			// menu.addListener(Events.SelectionChange, handler);
+			currentItem = noneFilter;
+
+		}
+
+		protected void onMenuSelect(MenuEvent be) {
+
+			// MessageBox.alert(&quot;Menulistener&quot;, be.getType().toString(), null);
+
+			DateMenu d = null;
+
+			if (currentItem != null) {
+				currentItem.setChecked(false, true);
+			} else {
+
+				MessageBox.alert(&quot;Null&quot;, &quot;current item null&quot;, null);
+
+			}
+			currentItem = customFilter;
+			customFilter.setChecked(true, true);
+
+			if (be.getMenu() == dateMenu) {
+				d = (DateMenu) be.getMenu();
+				d.hide(true);
+
+				fireUpdate();
+			}
+
+		}
+
+		@Override
+		public List&lt;FilterConfig&gt; getSerialArgs() {
+			// TODO Auto-generated method stub
+			return null;
+		}
+
+		@Override
+		public Object getValue() {
+			// TODO Auto-generated method stub
+
+			return null;
+		}
+
+		@Override
+		public void setValue(Object value) {
+			// TODO Auto-generated method stub
+
+		}
+
+		@Override
+		public boolean isActivatable() {
+
+			return true;
+		}
+
+		@Override
+		public boolean validateModel(ModelData model) {
+
+			Date d = model.get(&quot;closeDate&quot;);
+			if (d == null) {
+				return true;
+			} else {
+
+				if (currentItem == customFilter) {
+					if (d.before(dateMenu.getDate()))
+						return false;
+					else
+						return true;
+
+				}
+
+				if (currentItem == sixMonthsFilter) {
+
+					Date dateTemp = new Date();
+					CalendarUtil.addMonthsToDate(dateTemp, -6);
+					if (d.before(dateTemp))
+						return false;
+					else
+						return true;
+
+				}
+
+				if (currentItem == noneFilter) {
+					return false;
+				}
+
+				if (currentItem == twelveMonthsFilter) {
+					Date dateTemp = new Date();
+					CalendarUtil.addMonthsToDate(dateTemp, -12);
+					if (d.before(dateTemp))
+						return false;
+					else
+						return true;
+
+				}
+			}
+
+			return false;
+
+		}
+
+	}
 }
Index: src/main/java/org/sigmah/public/sigmah.css
===================================================================
--- src/main/java/org/sigmah/public/sigmah.css	(Revision 1501)
+++ src/main/java/org/sigmah/public/sigmah.css	(Arbeitskopie)
@@ -36,8 +36,8 @@
 
 #alert {
 	clear: both;
-    overflow: hidden;
-    padding: 10px 15px 0;
+	overflow: hidden;
+	padding: 10px 15px 0;
 }
 
 .message {
@@ -45,7 +45,7 @@
 	border: 1px solid #EBAE7F;
 	padding: 4px 0 3px 30px;
 	color: #D85D01;
-	font: 11px arial,tahoma,helvetica,sans-serif;
+	font: 11px arial, tahoma, helvetica, sans-serif;
 }
 
 #username {
@@ -361,7 +361,7 @@
 
 .module-background {
 	background-color: #FFFFFF !important;
-	overflow : visible !important;
+	overflow: visible !important;
 }
 
 .panel-background {
@@ -373,23 +373,23 @@
 }
 
 .width-of-parent {
-	width : inherit !important;
+	width: inherit !important;
 }
 
 .height-of-parent {
-	height : inherit !important;	
+	height: inherit !important;
 }
 
 .form-radio label {
-    padding-left: 6px;
+	padding-left: 6px;
 }
 
 .form-text {
-	font: 12px tahoma,arial,helvetica,sans-serif;
+	font: 12px tahoma, arial, helvetica, sans-serif;
 }
 
-.form-radio &gt; input {
-	margin-left : 7px;
+.form-radio&gt;input {
+	margin-left: 7px;
 }
 
 .hyperlink a,.hyperlink a:active,.hyperlink a:hover,.hyperlink a:focus,.hyperlink a:link,.hyperlink a:visited
@@ -443,22 +443,20 @@
 
 .project-linkedProject-editButton {
 	width: 13px;
-    Height: 13px;
+	Height: 13px;
 }
 
 .project-linkedProject-editButton-down-hovering {
-    border: border-width : 1px;
+	border: border-width:                                1px;
 	border-style: solid;
-	border-bottom-color:#FFFCEC;
+	border-bottom-color: #FFFCEC;
 	border-right-color: #FFFCEC;
 	border-top-color: #FFF8D7;
-	border-left-color:#FFF8D7;
-	
+	border-left-color: #FFF8D7;
 }
 
 .project-linkedProject-editButton-up-hovering {
-	
-	border: border-width : 1px;
+	border: border-width:                                1px;
 	border-style: solid;
 	border-bottom-color: #FFF8D7;
 	border-right-color: #FFF8D7;
@@ -466,9 +464,6 @@
 	border-left-color: #FFFCEC;
 }
 
-
-
-
 .toolbar-title {
 	font-weight: bold !important;
 	margin-left: 4px;
@@ -856,16 +851,17 @@
 	background-image: url(./image/context_menu_icon_orange.png);
 }
 
-.log-frame-indicators-table{
-table-layout: fixed;
-margin-bottom: 8px;
+.log-frame-indicators-table {
+	table-layout: fixed;
+	margin-bottom: 8px;
 }
-.log-frame-indicators-table-cell{
-white-space: normal;
-width: 50%;
-overflow:hidden;
-border-bottom: solid 1px #EDEDED;
-padding: 5px 0 2px 2px;
+
+.log-frame-indicators-table-cell {
+	white-space: normal;
+	width: 50%;
+	overflow: hidden;
+	border-bottom: solid 1px #EDEDED;
+	padding: 5px 0 2px 2px;
 }
 /* --------------------------------------------- Reports */
 .project-report {
@@ -879,14 +875,14 @@
 	font-size: 10pt;
 	color: white;
 	width: 100%;
-	margin: 0 ;
+	margin: 0;
 	background-color: rgb(74, 63, 43);
 	padding-left: 8px;
 	padding-right: 24px;
 	line-height: 32px;
 }
 
-.project-report-personalDraft {	
+.project-report-personalDraft {
 	font-weight: bold;
 }
 
@@ -1060,20 +1056,19 @@
 	height: 8px;
 }
 
-
 /*----------------------------------------------- Password reset*/
-.update-form-message-title{
-font-family: tahoma, arial, helvetica, sans-serif;
+.update-form-message-title {
+	font-family: tahoma, arial, helvetica, sans-serif;
 	font-size: 13px;
 	font-weight: bold;
 	color: white;
-	padding:0 0 8px 8px;
+	padding: 0 0 8px 8px;
 }
 
-.update-form-message-content{
-font-family: tahoma, arial, helvetica, sans-serif;
+.update-form-message-content {
+	font-family: tahoma, arial, helvetica, sans-serif;
 	font-size: 12px;
- 	color: white;
+	color: white;
 	text-align: justify;
 }
 
@@ -1110,7 +1105,8 @@
 .blockStat {
 	border: 1px solid #B9A48F;
 	padding: 1px;
-	background: transparent url(image/ratio-bar-bg.png) repeat-x scroll 0 1px;
+	background: transparent url(image/ratio-bar-bg.png) repeat-x scroll 0
+		1px;
 }
 
 .blockStat div {
@@ -1182,7 +1178,6 @@
 	font-size: 10px;
 }
 
-
 .credits-manager-header {
 	font-weight: bold;
 }
@@ -1223,41 +1218,48 @@
 .credits-developer {
 	margin-left: 15px;
 	padding-top: 3px;
-	font-weight:bold;
+	font-weight: bold;
 }
 
 .credits-developer-email {
 	margin-left: 50px;
 }
 
-.backup-label{
-	background-color: F5F5DC	
+.backup-label {
+	background-color: F5F5DC
 }
-.orgunitModel-grid-nameLink{
+
+.orgunitModel-grid-nameLink {
 	text-decoration: underline;
 	cursor: pointer;
 	color: #4B3E2D;
 }
 
-.delete-anchor{
+.delete-anchor {
 	background: url(&quot;image/remove.png&quot;) no-repeat;
 	padding-left: 20px;
 }
 
-.export-spreadsheet-anchor{
+.export-spreadsheet-anchor {
 	background: url(&quot;image/excel.png&quot;) no-repeat;
 	padding-left: 20px;
 }
 
-
 .global-export-fields-table {
 	border: 1px solid lightgrey;
 	margin-bottom: 13px;
-    margin-top: 5px;	
+	margin-top: 5px;
 }
 
+.filtered-column-header {
+	font-weight: bold;
+	font-style: italic;
+	background: url(&quot;image/filter.png&quot;) no-repeat left;
+	padding-left: 20px;
+}
+
 /*------------------------------------------------------ Linked Project Form*/
 .x-combo-list-item-disabled {
-	font-weight:bold !important;
-	text-align:center;
+	font-weight: bold !important;
+	text-align: center;
 }
\ No newline at end of file
Index: src/main/java/org/sigmah/shared/domain/profile/GlobalPermissionEnum.java
===================================================================
--- src/main/java/org/sigmah/shared/domain/profile/GlobalPermissionEnum.java	(Revision 1501)
+++ src/main/java/org/sigmah/shared/domain/profile/GlobalPermissionEnum.java	(Arbeitskopie)
@@ -118,4 +118,50 @@
 
 		return gpName;
 	}
+
+	public static String getCategory(GlobalPermissionEnum gp) {
+		String gpCategory = I18N.CONSTANTS.categoryNotMapped();
+		switch (gp) {
+		case VIEW_PROJECT:
+			gpCategory = I18N.CONSTANTS.categoryProject();
+			break;
+		case EDIT_PROJECT:
+			gpCategory = I18N.CONSTANTS.categoryProject();
+			break;
+		case CREATE_PROJECT:
+			gpCategory = I18N.CONSTANTS.categoryProject();
+			break;
+		case DELETE_PROJECT:
+			gpCategory = I18N.CONSTANTS.categoryProject();
+			break;
+		case CHANGE_PHASE:
+			gpCategory = I18N.CONSTANTS.categoryProject();
+			break;
+		case VIEW_ADMIN:
+			gpCategory = I18N.CONSTANTS.categoryAdministration();
+			break;
+		case MANAGE_USER:
+			gpCategory = I18N.CONSTANTS.categoryAdministration();
+			break;
+		case MANAGE_UNIT:
+			gpCategory = I18N.CONSTANTS.categoryAdministration();
+			break;
+		case REMOVE_FILE:
+			gpCategory = I18N.CONSTANTS.categoryOthers();
+			break;
+		// case VIEW_ACTIVITYINFO:
+		// gpName = I18N.CONSTANTS.VIEW_ACTIVITYINFO();
+		// break;
+		case VALID_AMENDEMENT:
+			gpCategory = I18N.CONSTANTS.categoryProject();
+			break;
+		case GLOBAL_EXPORT:
+			gpCategory = I18N.CONSTANTS.categoryOthers();
+			break;
+		default:
+			break;
+		}
+
+		return gpCategory;
+	}
 }
</pre></span>
</td></tr><tr align="center"><td align="center" colspan="6"><table><tr class="vcenter"><td class="center"></td><td class="center"></td><td class="center"></td><td class="center"></td></tr></table></td></tr></table><br />

<div id="relationships_open"><table class="width100" cellspacing="1">
<tr class="row-2" valign="top">
	<td width="15%" class="form-title" colspan="2">
		<a href="#" onclick="ToggleDiv( 'relationships' ); return false;"
			><img border="0" src="images/minus.png" alt="-" /></a>&#160;Relationships	</td>
</tr>
<tr>
	<td colspan="2"><table border="0" width="100%" cellpadding="0" cellspacing="1"><tr bgcolor="#c9ccc4"><td><span class="nowrap">related to</span>&#160;</td><td><a href="view6fb5.html?id=31">0000031</a></td><td><span class="issue-status" title="fixed">closed</span></td><td><span class="nowrap"><a href="view_user_page6fb5.html?id=31">sherzod</a></span>&#160;</td><td>Table filters through technical migration to GXT 2.2.5&#160;</td></tr>
<tr bgcolor="#fcbdbd"><td><span class="nowrap">related to</span>&#160;</td><td><a href="view8057.html?id=510">0000510</a></td><td><span class="issue-status" title="open">new</span></td><td>&#160;</td><td>Interruption project phases&#160;</td></tr>
<tr bgcolor="#c9ccc4"><td><span class="nowrap">related to</span>&#160;</td><td><a href="view14aa.html?id=585">0000585</a></td><td><span class="issue-status" title="fixed">closed</span></td><td><span class="nowrap"><a href="view_user_pagea9e4.html?id=55">studentblue13</a></span>&#160;</td><td>Add a filter symbol on filtered columns of the Dashboard projects table&#160;</td></tr>
</table></td>
</tr>
</table>

</div><div id="relationships_closed" class="hidden"><table class="width100" cellspacing="1">
<tr>
	<td class="form-title">
		<a href="#" onclick="ToggleDiv( 'relationships' ); return false;"
			><img border="0" src="images/plus.png" alt="+" /></a>&#160;Relationships	</td>
</tr>
</table>

</div>
<a name="bugnotes" id="bugnotes" /><br />

<div id="bugnotes_open"><table class="width100" cellspacing="1">
<tr>
	<td class="form-title" colspan="2">
<a href="#" onclick="ToggleDiv( 'bugnotes' ); return false;"
			><img border="0" src="images/minus.png" alt="-" /></a>&#160;		Notes	</td>
</tr>
<tr class="bugnote" id="c1328">
        <td class="bugnote-public">
				<span class="small">(<a href="view8bdf.html?id=337#c1328" title="Direct link to note">0001328)</a></span><br />
		<a href="view_user_page0b30.html?id=2">osarrat</a>		<span class="small">(administrator)</span>
				<br />
		<span class="small">2013-08-13 19:16</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		studentblue13, the reply to the question you made on IRC today (=&gt; i got confused about what &quot;closed project&quot; means : as i understand it it's linked to a not yet implemented feature &quot;0000510: Interruption project phases&quot; so the &quot;Closed project status phase&quot; is not there yet. As it is now, how can i then assume that a project is closed ?) is: a project which has its &quot;close_date&quot; column filled.<br />
<br />
Currently, a project is closed when the last phase of a project is closed. When this last phase is closed, the system stores in the close_date column the timestamp of the closure of the project.<br />
When feature <a href="view8057.html?id=510" title="[new] Interruption project phases">0000510</a> will be develop, this behavior to closed project will be changed as you've noticed. But you can already develop safely this closed project hiding feature with the current project closing behavior.	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1329">
        <td class="bugnote-public">
				<span class="small">(<a href="view8bdf.html?id=337#c1329" title="Direct link to note">0001329)</a></span><br />
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>		<span class="small">(developer)</span>
				<br />
		<span class="small">2013-08-14 17:47</span><br />
		<span class="small">edited on:&#32;2013-08-14 17:48</span><br />		<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		added a mockup for the new menu<br />
<br />
	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1330">
        <td class="bugnote-public">
				<span class="small">(<a href="view8bdf.html?id=337#c1330" title="Direct link to note">0001330)</a></span><br />
		<a href="view_user_page0b30.html?id=2">osarrat</a>		<span class="small">(administrator)</span>
				<br />
		<span class="small">2013-08-14 19:24</span><br />
		<span class="small">edited on:&#32;2013-08-15 10:06</span><br />		<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		Thanks for those mockups !<br />
From this basis, I've looked in depth in this topic, including a new reading of issue <a href="view8057.html?id=510" title="[new] Interruption project phases">0000510</a> to include as much ideas as possible.<br />
The main idea I think it will be good to include in the graphical design of this feature comes from <a href="view8057.html?id=510" title="[new] Interruption project phases">0000510</a> and is: &quot;The Close/Open status should be available by default in the Project Table : closed projects will have a 'Closed' label printed in place of the time consumption progress bar.&quot;<br />
<br />
Here is then what I propose:<br />
- the Time column behavior should be changed: if a project is closed, a &quot;Closed&quot; label should replace the time consumption progress bar<br />
- the closed project filters should be moved as filter of the &quot;Time&quot; column<br />
- by default, when loading the projects table for the first time, the Time column will be filtered to exclude all closed projects and will appear as filtered<br />
- in feature <a href="view14aa.html?id=585" title="[closed] Add a filter symbol on filtered columns of the Dashboard projects table" class="resolved">0000585</a>, users have requested to have more visible filtered columns: your funnel icon could be used to magnify this filtered state of all columns and will be visible by default on the Time column<br />
- when opening the Time column menu, a new checkbox menu item &quot;Closed projects filter&quot; will be available, like the &quot;Filter&quot; menu item of the Category or Title columns (this checkbox menu item will be checked by default)<br />
- this &quot;Closed projects filter&quot; checkbox menu item will open a sub-menu with the 5 radiobutton menu items: &quot;exclude all closed projects&quot; (default option), &quot;include last 6 months&quot;, &quot;include last 12 months&quot;, &quot;choose past time limit&quot;, &quot;include all closed projects&quot;<br />
- the &quot;choose past time limit&quot; will open a sub-sub-menu with a calendar to select a date as in your mockup<br />
<br />
What is your opinion about this behavior?<br />
Are you ok with and develop also the (easier ;) <a href="view14aa.html?id=585" title="[closed] Add a filter symbol on filtered columns of the Dashboard projects table" class="resolved">0000585</a> feature with your funnel icon?<br />
Is it possible to develop this &quot;Closed projects filter&quot; with its specific projects table reloading behavior? (all other filters on the projects table are just filtering dynamically on the client side the content of the table, this &quot;Closed projects filter&quot; will work differently and force a reload of the data contained in the table)<br />
<br />
<i>Note:</i> For more information about radiobutton menu item, you can look at: <a href="http://www.sencha.com/examples/#ExamplePlace:basictoolbar">http://www.sencha.com/examples/#ExamplePlace:basictoolbar</a> [<a href="http://www.sencha.com/examples/#ExamplePlace:basictoolbar" target="_blank">^</a>]<br />
<br />
	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1333">
        <td class="bugnote-public">
				<span class="small">(<a href="view8bdf.html?id=337#c1333" title="Direct link to note">0001333)</a></span><br />
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>		<span class="small">(developer)</span>
				<br />
		<span class="small">2013-08-21 06:19</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		Added patch and Mock-up, also includes feature  <a href="view14aa.html?id=585">http://www.sigmah.org/issues/view.php?id=585</a> [<a href="view14aa.html?id=585" target="_blank">^</a>]	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1337">
        <td class="bugnote-public">
				<span class="small">(<a href="view8bdf.html?id=337#c1337" title="Direct link to note">0001337)</a></span><br />
		<a href="view_user_page0b30.html?id=2">osarrat</a>		<span class="small">(administrator)</span>
				<br />
		<span class="small">2013-08-22 09:46</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		Great job! I think we are getting very close to a very good behavior for the end user. :)<br />
<br />
Here are my new comments:<br />
- First of all, no need to delete the previous version of your mockup when you add a new one. Issue pages are good also to keep all the history of a development to understand in the end how all decisions have been taken. So you can keep different version of the mockups like you are doing, especially if you are using a good naming policy like you do with a version number in the file name. :)<br />
- The menu radio buttons might look nicer if you could use the radiobutton menu items provided with GXT (see file attached coming from sencha.com demo).<br />
- To make things simpler, I think we can remove the &quot;include all closed projects&quot; menu item in the filter because this filter option means actually we want to remove all filtering... and then, the user has just to uncheck the &quot;Closed projects filter&quot; checkbox.<br />
<br />
Does it seem good to you?	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1342">
        <td class="bugnote-public">
				<span class="small">(<a href="view8bdf.html?id=337#c1342" title="Direct link to note">0001342)</a></span><br />
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>		<span class="small">(developer)</span>
				<br />
		<span class="small">2013-08-23 07:41</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		yes, i'm on it.	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1343">
        <td class="bugnote-public">
				<span class="small">(<a href="view8bdf.html?id=337#c1343" title="Direct link to note">0001343)</a></span><br />
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>		<span class="small">(developer)</span>
				<br />
		<span class="small">2013-08-26 07:16</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		because i added a category selection function i added a (small)patch for resolved issue <a href="viewc1e3.html?id=552" title="[closed] Advanced logframe management privileges" class="resolved">0000552</a>	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1347">
        <td class="bugnote-public">
				<span class="small">(<a href="view8bdf.html?id=337#c1347" title="Direct link to note">0001347)</a></span><br />
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>		<span class="small">(developer)</span>
				<br />
		<span class="small">2013-08-26 09:14</span><br />
		<span class="small">edited on:&#32;2013-08-26 09:18</span><br />		<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		added updated version of my patch it includes now the category behaviour wanted in profile form window. If this patch will be accepted into 1.3 a category should be set for any new privilege added, if not it will be mapped into the &quot;not mapped category&quot;.<br />
<br />
	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1350">
        <td class="bugnote-public">
				<span class="small">(<a href="view8bdf.html?id=337#c1350" title="Direct link to note">0001350)</a></span><br />
		<a href="view_user_page5255.html?id=9">svn_mantis-robot</a>		<span class="small">(developer)</span>
				<br />
		<span class="small">2013-08-26 18:11</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		Patch by studentblue13 : Adds a filter in project's list on dashboard page for closed projects (fixes issue <a href="view8bdf.html?id=337" title="[closed] Hide by default in Dashboard closed projects" class="resolved">0000337</a>)<br />
<br />
Modified : /trunk/sigmah/src/main/java/org/sigmah/client/i18n/UIConstants.properties<br />
Modified : /trunk/sigmah/src/main/java/org/sigmah/client/page/dashboard/ProjectsListPanel.java<br />
Modified : /trunk/sigmah/src/main/java/org/sigmah/public/sigmah.css<br />
	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1664">
        <td class="bugnote-public">
				<span class="small">(<a href="view8bdf.html?id=337#c1664" title="Direct link to note">0001664)</a></span><br />
		<a href="view_user_page0b30.html?id=2">osarrat</a>		<span class="small">(administrator)</span>
				<br />
		<span class="small">2015-05-04 09:45</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		Issue closed because correct behavior checked on v2.0-rc1, except reported issue <a href="view5a73.html?id=644" title="[closed] Filter on the time column of the Dashboard projects table not working" class="resolved">0000644</a>.	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
</table>

</div><div id="bugnotes_closed" class="hidden">
<table class="width100" cellspacing="1">
<tr>
	<td class="form-title" colspan="2">
		<a href="#" onclick="ToggleDiv( 'bugnotes' ); return false;"
			><img border="0" src="images/plus.png" alt="+" /></a>&#160;		Notes	</td>
</tr>
</table>
</div>
<a name="history" id="history" /><br />

<div id="history_open"><table class="width100" cellspacing="0">
<tr>
	<td class="form-title" colspan="4">
<a href="#" onclick="ToggleDiv( 'history' ); return false;"
			><img border="0" src="images/minus.png" alt="-" /></a>&#160;Issue History	</td>
</tr>
<tr class="row-category-history">
	<td class="small-caption">
		Date Modified	</td>
	<td class="small-caption">
		Username	</td>
	<td class="small-caption">
		Field	</td>
	<td class="small-caption">
		Change	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2011-06-26 17:07	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		New Issue	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2011-06-26 17:08	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Description Updated	</td>
	<td class="small-caption">
		<a href="bug_revision_view_page2e68.html?rev_id=119#r119">View Revisions</a>	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2011-06-26 17:08	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Relationship added	</td>
	<td class="small-caption">
		child of 0000031	</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-02-05 11:53	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Relationship deleted	</td>
	<td class="small-caption">
		child of 0000031	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-02-05 11:53	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Relationship added	</td>
	<td class="small-caption">
		related to 0000031	</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-02-25 12:52	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Target Version	</td>
	<td class="small-caption">
		unplanned =&gt; 3.0	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-02-25 12:52	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Description Updated	</td>
	<td class="small-caption">
		<a href="bug_revision_view_page1a17.html?rev_id=311#r311">View Revisions</a>	</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-02-25 12:53	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Relationship added	</td>
	<td class="small-caption">
		related to 0000510	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-02-26 15:31	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Tag Attached: Enhanced dashboard project table	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-07-19 14:44	</td>
	<td class="small-caption">
		<a href="view_user_paged61c.html?id=5">tmiette</a>	</td>
	<td class="small-caption">
		Assigned To	</td>
	<td class="small-caption">
		 =&gt; studentblue13	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-07-19 14:44	</td>
	<td class="small-caption">
		<a href="view_user_paged61c.html?id=5">tmiette</a>	</td>
	<td class="small-caption">
		Status	</td>
	<td class="small-caption">
		new =&gt; assigned	</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-08-13 19:16	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Note Added: 0001328	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-08-14 17:47	</td>
	<td class="small-caption">
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>	</td>
	<td class="small-caption">
		Note Added: 0001329	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-08-14 17:48	</td>
	<td class="small-caption">
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>	</td>
	<td class="small-caption">
		Note Edited: 0001329	</td>
	<td class="small-caption">
		<a href="bug_revision_view_page27d8.html?bugnote_id=1329#r424">View Revisions</a>	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-08-14 17:48	</td>
	<td class="small-caption">
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>	</td>
	<td class="small-caption">
		File Added: mockup_337.zip	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-08-14 19:24	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Note Added: 0001330	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-08-14 19:25	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Target Version	</td>
	<td class="small-caption">
		3.0 =&gt; 2.0	</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-08-15 10:06	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Note Edited: 0001330	</td>
	<td class="small-caption">
		<a href="bug_revision_view_page7740.html?bugnote_id=1330#r426">View Revisions</a>	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-08-18 03:15	</td>
	<td class="small-caption">
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>	</td>
	<td class="small-caption">
		File Deleted: mockup_337.zip	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-08-18 03:21	</td>
	<td class="small-caption">
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>	</td>
	<td class="small-caption">
		File Added: mockup_337_second.zip	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-08-18 03:23	</td>
	<td class="small-caption">
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>	</td>
	<td class="small-caption">
		File Added: 0000337.patch	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-08-21 05:40	</td>
	<td class="small-caption">
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>	</td>
	<td class="small-caption">
		File Deleted: mockup_337_second.zip	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-08-21 05:40	</td>
	<td class="small-caption">
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>	</td>
	<td class="small-caption">
		File Deleted: 0000337.patch	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-08-21 06:16	</td>
	<td class="small-caption">
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>	</td>
	<td class="small-caption">
		File Added: 0000337.patch	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-08-21 06:17	</td>
	<td class="small-caption">
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>	</td>
	<td class="small-caption">
		File Added: MockUp_337_third.zip	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-08-21 06:19	</td>
	<td class="small-caption">
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>	</td>
	<td class="small-caption">
		Note Added: 0001333	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-08-22 09:05	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Relationship added	</td>
	<td class="small-caption">
		related to 0000585	</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-08-22 09:46	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Note Added: 0001337	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-08-22 09:47	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		File Added: Menu-with-RadioButtons.png	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-08-23 07:41	</td>
	<td class="small-caption">
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>	</td>
	<td class="small-caption">
		Note Added: 0001342	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-08-26 07:14	</td>
	<td class="small-caption">
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>	</td>
	<td class="small-caption">
		File Added: 0000552_addition.patch	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-08-26 07:16	</td>
	<td class="small-caption">
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>	</td>
	<td class="small-caption">
		Note Added: 0001343	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-08-26 09:12	</td>
	<td class="small-caption">
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>	</td>
	<td class="small-caption">
		File Added: 0000337_update.patch	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-08-26 09:14	</td>
	<td class="small-caption">
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>	</td>
	<td class="small-caption">
		Note Added: 0001347	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-08-26 09:18	</td>
	<td class="small-caption">
		<a href="view_user_pagea9e4.html?id=55">studentblue13</a>	</td>
	<td class="small-caption">
		Note Edited: 0001347	</td>
	<td class="small-caption">
		<a href="bug_revision_view_page9f50.html?bugnote_id=1347#r430">View Revisions</a>	</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-08-26 18:11	</td>
	<td class="small-caption">
		<a href="view_user_page5255.html?id=9">svn_mantis-robot</a>	</td>
	<td class="small-caption">
		Checkin	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-08-26 18:11	</td>
	<td class="small-caption">
		<a href="view_user_page5255.html?id=9">svn_mantis-robot</a>	</td>
	<td class="small-caption">
		Note Added: 0001350	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2013-08-26 18:11	</td>
	<td class="small-caption">
		<a href="view_user_page5255.html?id=9">svn_mantis-robot</a>	</td>
	<td class="small-caption">
		Status	</td>
	<td class="small-caption">
		assigned =&gt; resolved	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2013-08-26 18:11	</td>
	<td class="small-caption">
		<a href="view_user_page5255.html?id=9">svn_mantis-robot</a>	</td>
	<td class="small-caption">
		Resolution	</td>
	<td class="small-caption">
		open =&gt; fixed	</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2015-02-17 17:47	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Tag Attached: TestLinkable	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2015-05-04 09:45	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		OS	</td>
	<td class="small-caption">
		Windows Vista =&gt; NA	</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2015-05-04 09:45	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Browser	</td>
	<td class="small-caption">
		Mozilla Firefox 4.0 =&gt; NA	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2015-05-04 09:45	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Note Added: 0001664	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2015-05-04 09:45	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Status	</td>
	<td class="small-caption">
		resolved =&gt; closed	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2015-05-04 09:45	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Fixed in Version	</td>
	<td class="small-caption">
		 =&gt; 2.0	</td>
</tr>
</table>
</div><div id="history_closed" class="hidden"><table class="width100" cellspacing="0">
<tr>
	<td class="form-title" colspan="4">
	<a href="#" onclick="ToggleDiv( 'history' ); return false;"
			><img border="0" src="images/plus.png" alt="+" /></a>&#160;Issue History	</td>
</tr>
</table>

</div>	<br />
	<hr size="1" />
<table border="0" width="100%" cellspacing="0" cellpadding="0"><tr valign="top"><td>	<address>Copyright &copy; 2000 - 2018 MantisBT Team</address>
</td><td>
	<div align="right"><a href="http://www.mantisbt.org/" title="Free Web Based Bug Tracker"><img src="images/mantis_logo.png" width="145" height="50" alt="Powered by Mantis Bugtracker" border="0" /></a></div>
</td></tr></table>
</body>

<!-- Mirrored from www.sigmah.org/issues/view.php?id=337&nbn=10 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 24 Jul 2018 14:42:09 GMT -->
</html>
