<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

<!-- Mirrored from www.sigmah.org/issues/view.php?id=612 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 25 Jul 2018 14:55:21 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
	<link rel="stylesheet" type="text/css" href="css/default.css" />
	<script type="text/javascript"><!--
		if(document.layers) {document.write("<style>td{padding:0px;}<\/style>")}
	// --></script>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Cache-Control" content="no-cache" />
	<meta http-equiv="Pragma-directive" content="no-cache" />
	<meta http-equiv="Cache-Directive" content="no-cache" />
	<meta http-equiv="Expires" content="Wed, 25 Jul 2018 14:05:17 GMT" />
	<link rel="shortcut icon" href="images/favicon.html" type="image/x-icon" />
	<link rel="search" type="application/opensearchdescription+xml" title="MantisBT: Text Search" href="browser_search_plugin84ae.html?type=text" />	<link rel="search" type="application/opensearchdescription+xml" title="MantisBT: Issue Id" href="browser_search_pluginb70d.html?type=id" />	<title>0000612: Project Map sub-tab with OpenStreetMap and Project Location - Sigmah Issue Tracker</title>
<script type="text/javascript" src="javascript/min/common.html"></script>
<script type="text/javascript">var loading_lang = "Loading...";</script><script type="text/javascript" src="javascript/min/ajax.js"></script>
<link rel="stylesheet" type="text/css" href="plugin_filea93c.css?file=Source/style.css"/></head>
<body>
<div align="left"><a href="my_view_page.html"><img border="0" alt="Sigmah Issue Tracker" src="images/sigmah-logo-Mantis.html" /></a></div><table class="hide"><tr><td class="login-info-left">Anonymous | <a href="login_pageba37.php?return=%2Fissues%2Fview.php%3Fid%3D612">Login</a> | <a href="signup_page.html">Signup for a new account</a></td><td class="login-info-middle"><span class="italic">2018-07-25 16:05 CEST</span></td><td class="login-info-right"><form method="post" name="form_set_project" action="http://www.sigmah.org/issues/set_project.php">Project: <select name="project_id" class="small" onchange="document.forms.form_set_project.submit();"><option value="0" selected="selected" >All Projects</option>
<option value="1">sigmah</option>
<option value="4">Sigmah Central</option>
</select> <input type="submit" class="button-small" value="Switch" /></form><a href="200_rss_Sigmah_Issue_Tracker_-_Issuesd41d.xml?"><img src="images/rss.html" alt="RSS" style="border-style: none; margin: 5px; vertical-align: middle;" /></a></td></tr></table><table class="width100" cellspacing="0"><tr><td class="menu"><a href="my_view_page.html">My View</a> | <a href="view_all_bug_page.html">View Issues</a> | <a href="changelog_page.html">Change Log</a> | <a href="roadmap_page.html">Roadmap</a> | <a href="plugina0e2.html?page=Source/index">Repositories</a> | <a href="account_page.html">My Account</a></td><td class="menu right nowrap"><form method="post" action="http://www.sigmah.org/issues/jump_to_bug.php"><input type="text" name="bug_id" size="10" class="small" value="Issue #" onfocus="if (this.value == 'Issue #') this.value = ''" onblur="if (this.value == '') this.value = 'Issue #'" />&#160;<input type="submit" class="button-small" value="Jump" />&#160;</form></td></tr></table><br /><table class="width100" cellspacing="1"><tr><td class="form-title" colspan="3">View Issue Details&#160;<span class="small"><span class="bracket-link">[&#160;<a href="#bugnotes">Jump to Notes</a>&#160;]</span> </span></td><td class="center"><span class="small"></span></td><td class="right" colspan="2"><span class="small"><span class="bracket-link">[&#160;<a href="view8ea2.php?id=612&amp;history=1#history">Issue History</a>&#160;]</span> </span><span class="small"><span class="bracket-link">[&#160;<a href="print_bug_page39e2.php?bug_id=612">Print</a>&#160;]</span> </span></td></tr><tr><td class="category" width="15%">ID</td><td class="category" width="20%">Project</td><td class="category" width="15%">Category</td><td class="category" width="15%">View Status</td><td class="category" width="15%">Date Submitted</td><td class="category" width="20%">Last Update</td></tr><tr class="row-1"><td>0000612</td><td>sigmah</td><td>Project</td><td>public</td><td>2014-02-10 11:28</td><td>2015-05-04 09:15</td></tr><tr class="spacer"><td colspan="6"></td></tr><tr class="row-2"><td class="category">Reporter</td><td>osarrat</td><td colspan="4">&#160;</td></tr><tr class="row-1"><td class="category">Assigned To</td><td>somzzz</td><td colspan="4">&#160;</td></tr><tr class="row-2"><td class="category">Priority</td><td>normal</td><td class="category">Severity</td><td>feature</td><td class="category">Reproducibility</td><td>N/A</td></tr><tr class="row-1"><td class="category">Status</td><td bgcolor="#c9ccc4">closed</td><td class="category">Resolution</td><td>fixed</td><td colspan="2">&#160;</td></tr><tr class="row-2"><td class="category">Platform</td><td></td><td class="category">OS</td><td></td><td class="category">OS Version</td><td></td></tr><tr class="row-1"><td class="category">Product Version</td><td>1.2</td><td colspan="4">&#160;</td></tr><tr class="row-2"><td class="category">Target Version</td><td>2.0</td><td class="category">Fixed in Version</td><td>2.0</td><td colspan="2">&#160;</td></tr><tr class="spacer"><td colspan="6"></td></tr><tr class="row-1"><td class="category">Summary</td><td colspan="5">0000612: Project Map sub-tab with OpenStreetMap and Project Location</td></tr><tr class="row-2"><td class="category">Description</td><td colspan="5">Sites management in the &quot;indicator management&quot; sub-tab was uneasy for many users.<br />
To make things easier, a &quot;Map&quot; sub-tab should be added.<br />
In this map sub-tab, support for OpenStreetMap basemap and to pin a Project Location (Main site) would be two good features to have.</td></tr><tr class="row-1"><td class="category">Tags</td><td colspan="5">No tags attached.</td></tr><tr class="spacer"><td colspan="6"></td></tr><tr class="row-2"><td class="category">User Report URL</td><td colspan="5"></td></tr><tr class="row-1"><td class="category">OS</td><td colspan="5">NA</td></tr><tr class="row-2"><td class="category">Other OS</td><td colspan="5"></td></tr><tr class="row-1"><td class="category">Browser</td><td colspan="5">NA</td></tr><tr class="row-2"><td class="category">Other browser</td><td colspan="5"></td></tr><tr class="row-1"><td class="category">ScreenURL</td><td colspan="5"></td></tr><tr class="row-2"><td class="category">(ActivityInfo) Noticed in revision</td><td colspan="5"></td></tr><tr class="spacer"><td colspan="6"></td></tr><tr class="row-1"><td class="category"><a name="attachments" id="attachments" />Attached Files</td><td colspan="5"><a href="file_download20ef.php?file_id=180&amp;type=bug"><img src="images/fileicons/png.gif" alt="png file icon" width="16" height="16" border="0" /></a>&#160;<a href="file_download20ef.php?file_id=180&amp;type=bug">GenericMap.png</a> [<a href="file_download20ef.php?file_id=180&amp;type=bug" target="_blank">^</a>] (158,018 bytes) <span class="italic">2014-06-18 17:24</span>
<br /><a href="file_download20ef.php?file_id=180&amp;type=bug"><img alt="" style="border: 0; max-height:250px;" src="file_download0444.php?file_id=180&amp;type=bug&amp;show_inline=1&amp;file_show_inline_token=2018072537878e24d63adcfe980b094e68176eec75b25d31" /></a><br />
<br /><a href="file_download12d8.php?file_id=217&amp;type=bug"><img src="images/fileicons/png.gif" alt="png file icon" width="16" height="16" border="0" /></a>&#160;<a href="file_download12d8.php?file_id=217&amp;type=bug">empty.png</a> [<a href="file_download12d8.php?file_id=217&amp;type=bug" target="_blank">^</a>] (163,986 bytes) <span class="italic">2014-08-12 17:30</span>
<br /><a href="file_download12d8.php?file_id=217&amp;type=bug"><img alt="" style="border: 0; max-height:250px;" src="file_downloadebb4.php?file_id=217&amp;type=bug&amp;show_inline=1&amp;file_show_inline_token=20180725e5eac03c316368a0c43098f68e1595e5ae4faa0e" /></a><br />
<br /><a href="file_downloadbfa7.php?file_id=218&amp;type=bug"><img src="images/fileicons/png.gif" alt="png file icon" width="16" height="16" border="0" /></a>&#160;<a href="file_downloadbfa7.php?file_id=218&amp;type=bug">main_site.png</a> [<a href="file_downloadbfa7.php?file_id=218&amp;type=bug" target="_blank">^</a>] (339,845 bytes) <span class="italic">2014-08-12 17:31</span><br />
<a href="file_download5576.php?file_id=219&amp;type=bug"><img src="images/fileicons/png.gif" alt="png file icon" width="16" height="16" border="0" /></a>&#160;<a href="file_download5576.php?file_id=219&amp;type=bug">layer_tool.png</a> [<a href="file_download5576.php?file_id=219&amp;type=bug" target="_blank">^</a>] (301,771 bytes) <span class="italic">2014-08-12 17:31</span><br />
<a href="file_download8c40.php?file_id=221&amp;type=bug"><img src="images/fileicons/png.gif" alt="png file icon" width="16" height="16" border="0" /></a>&#160;<a href="file_download8c40.php?file_id=221&amp;type=bug">popup.png</a> [<a href="file_download8c40.php?file_id=221&amp;type=bug" target="_blank">^</a>] (71,691 bytes) <span class="italic">2014-08-12 17:53</span>
<br /><a href="file_download8c40.php?file_id=221&amp;type=bug"><img alt="" style="border: 0; max-height:250px;" src="file_download45fa.php?file_id=221&amp;type=bug&amp;show_inline=1&amp;file_show_inline_token=20180725e034f20acf79cd0620668eff27ff128d0f534d04" /></a><br />
<br /><a href="file_download2fe8.php?file_id=226&amp;type=bug"><img src="images/fileicons/text.html" alt="patch file icon" width="16" height="16" border="0" /></a>&#160;<a href="file_download2fe8.php?file_id=226&amp;type=bug">0000612.patch</a> [<a href="file_download2fe8.php?file_id=226&amp;type=bug" target="_blank">^</a>] (105,082 bytes) <span class="italic">2014-12-05 21:50</span><script type="text/javascript" language="JavaScript">
<!--
function swap_content( span ) {
displayType = ( document.getElementById( span ).style.display == 'none' ) ? '' : 'none';
document.getElementById( span ).style.display = displayType;
}

 -->
 </script> <span id="hideSection_226">[<a class="small" href='#' id='attmlink_226' onclick='swap_content("hideSection_226");swap_content("showSection_226");return false;'>Show Content</a>]</span> <span style='display:none' id="showSection_226">[<a class="small" href='#' id='attmlink_226' onclick='swap_content("hideSection_226");swap_content("showSection_226");return false;'>Hide Content</a>]<pre>Index: /src/main/java/org/sigmah/client/event/SiteEvent.java
===================================================================
--- /src/main/java/org/sigmah/client/event/SiteEvent.java	(revision 1591)
+++ /src/main/java/org/sigmah/client/event/SiteEvent.java	(working copy)
@@ -27,6 +27,10 @@
 	public static final EventType CREATED = new EventBus.NamedEventType(&quot;SiteCreated&quot;);
     public static final EventType UPDATED = new EventBus.NamedEventType(&quot;SiteChanged&quot;);
 	public static final EventType SELECTED = new EventBus.NamedEventType(&quot;SiteSelected&quot;);
+	public static final EventType DELETED = new EventBus.NamedEventType(&quot;SiteDeleted&quot;);
+	
+	public static final EventType MAIN_SITE_UPDATED = new EventBus.NamedEventType(&quot;MainSiteUpdated&quot;);
+	public static final EventType MAIN_SITE_CREATED = new EventBus.NamedEventType(&quot;MainSiteCreated&quot;);
 
     /**
      *
Index: /src/main/java/org/sigmah/client/i18n/UIConstants.properties
===================================================================
--- /src/main/java/org/sigmah/client/i18n/UIConstants.properties	(revision 1591)
+++ /src/main/java/org/sigmah/client/i18n/UIConstants.properties	(working copy)
@@ -65,6 +65,14 @@
 
 EDIT_ALL_REMINDERS = Edit all reminders
 
+VIEW_MAPTAB = View project map
+
+MANAGE_MAIN_SITE = Manage main site
+
+MANAGE_SITES = Manage sites
+
+EXPORT_HXL = Export HXL
+
 acronym = Acronym
 
 activities = Activities
@@ -619,8 +627,6 @@
 
 average = Average
 
-axe = Axe
-
 goToIndicatorsList = Go to indicators list
 
 backgroundMap = Background map
@@ -1259,8 +1265,6 @@
 
 locale = Language
 
-location = Location
-
 locationType = Location Type 
 
 # Log frame
@@ -2437,3 +2441,36 @@
 dayInMonth = Day in Month
 dayInWeek = Day in Week
 
+# Project &gt; Map page
+# Name displayed on the Project tab-selector
+projectMap = Map
+# Title of the component handling sites on Project &gt; Map
+projectSitesManagement = Sites
+# Title of the tab element displaying OpenStreet Maps
+openStreetMap = OpenStreetMap
+# Title of the tab element displaying Google Maps
+googleMaps = Google Maps
+# Title of set/edit Main Site window
+projectMainSite = Project main location (main site)
+# Label of the button opening the Main location (Site) window
+createMainSiteButton = Set project location
+editMainSiteButton = Edit project location
+# Label for map markers (on hover)
+mainSiteLabel = Main location
+# Message for the status label below the OpenStreetMap display gadget
+loadingOSM = Loading OpenStreet Map...
+# Name of the basic OSM layer for the OSMSiteMap layer-switcher tool
+basicOSMLayer = Basic OSM
+# Name of the Humanitarian OSM layer for the OSMSiteMap layer-switcher tool
+humanitarianOSMLayer = Humanitarian
+# Name of the layer displaying project site markers for the OSMSiteMap layer-switcher tool 
+projectSitesLayer = Project sites
+# Site grid column title &amp; Site popup field label (!!! change old property in other files -&gt; location)
+location = Site name
+# Title of the LocationFieldSet (on the new site form)
+locationTitle = Location
+# Site grid column title &amp; New site popup field label (remove old property from other files -&gt; axe)
+axeColumnTitle = Road
+axeFieldLabel = Road (optional)
+
+
Index: /src/main/java/org/sigmah/client/icon/IconImageBundle.java
===================================================================
--- /src/main/java/org/sigmah/client/icon/IconImageBundle.java	(revision 1591)
+++ /src/main/java/org/sigmah/client/icon/IconImageBundle.java	(working copy)
@@ -203,4 +203,11 @@
     AbstractImagePrototype ods();
     
     AbstractImagePrototype csv();
+    
+    @Resource(value = &quot;star.png&quot;)
+    AbstractImagePrototype mainSite();
+    
+    @Resource(value = &quot;markerStar.png&quot;)
+    AbstractImagePrototype markerStar();
+    
 }
Index: /src/main/java/org/sigmah/client/page/common/toolbar/UIActions.java
===================================================================
--- /src/main/java/org/sigmah/client/page/common/toolbar/UIActions.java	(revision 1591)
+++ /src/main/java/org/sigmah/client/page/common/toolbar/UIActions.java	(working copy)
@@ -49,6 +49,8 @@
     public static final String exportData = &quot;exportData&quot;;
     
     public static final String deleteModel =&quot;deleteModel&quot;;
+    
+    public static final String manageMainSite = &quot;mainSite&quot;;
     	
     	
 }
Index: /src/main/java/org/sigmah/client/page/config/design/ProjectSiteGridPanel.java
===================================================================
--- /src/main/java/org/sigmah/client/page/config/design/ProjectSiteGridPanel.java	(revision 1591)
+++ /src/main/java/org/sigmah/client/page/config/design/ProjectSiteGridPanel.java	(working copy)
@@ -2,6 +2,7 @@
 
 import org.sigmah.client.EventBus;
 import org.sigmah.client.dispatch.Dispatcher;
+import org.sigmah.client.dispatch.remote.Authentication;
 import org.sigmah.client.page.entry.SiteGridPanel;
 import org.sigmah.client.page.project.SubPresenter;
 import org.sigmah.client.util.state.IStateManager;
@@ -12,8 +13,9 @@
 public class ProjectSiteGridPanel extends SiteGridPanel implements SubPresenter {
 
     @Inject
-    public ProjectSiteGridPanel(EventBus eventBus, Dispatcher service, IStateManager stateMgr) {
-        super(eventBus, service, stateMgr);
+    public ProjectSiteGridPanel(EventBus eventBus, Dispatcher service, 
+    		Authentication authentication, IStateManager stateMgr) {
+        super(eventBus, service, authentication, stateMgr);
         setHeaderVisible(false);
 
     }
Index: /src/main/java/org/sigmah/client/page/entry/editor/AdminFieldSet.java
===================================================================
--- /src/main/java/org/sigmah/client/page/entry/editor/AdminFieldSet.java	(revision 1591)
+++ /src/main/java/org/sigmah/client/page/entry/editor/AdminFieldSet.java	(working copy)
@@ -28,7 +28,7 @@
             new HashMap&lt;Integer, ComboBox&lt;AdminEntityDTO&gt;&gt;();
 
     public AdminFieldSet(List&lt;AdminLevelDTO&gt; adminLevels) {
-        super(I18N.CONSTANTS.location(), 100, 200);
+        super(I18N.CONSTANTS.locationTitle(), 100, 200);
 
         for(final AdminLevelDTO level : adminLevels) {
             final int levelId = level.getId();
Index: /src/main/java/org/sigmah/client/page/entry/editor/LocationFieldSet.java
===================================================================
--- /src/main/java/org/sigmah/client/page/entry/editor/LocationFieldSet.java	(revision 1591)
+++ /src/main/java/org/sigmah/client/page/entry/editor/LocationFieldSet.java	(working copy)
@@ -29,7 +29,7 @@
 
         TextField&lt;String&gt; axeField = new TextField&lt;String&gt;();
         axeField.setName(&quot;locationAxe&quot;);
-        axeField.setFieldLabel(I18N.CONSTANTS.axe());
+        axeField.setFieldLabel(I18N.CONSTANTS.axeFieldLabel());
         add(axeField);
     }
 }
Index: /src/main/java/org/sigmah/client/page/entry/OSMSiteMap.java
===================================================================
--- /src/main/java/org/sigmah/client/page/entry/OSMSiteMap.java	(revision 0)
+++ /src/main/java/org/sigmah/client/page/entry/OSMSiteMap.java	(working copy)
@@ -0,0 +1,342 @@
+package org.sigmah.client.page.entry;
+
+import java.util.ArrayList;
+import java.util.HashMap;
+import java.util.Map;
+
+import org.sigmah.client.EventBus;
+import org.sigmah.client.dispatch.Dispatcher;
+import org.sigmah.client.dispatch.monitor.MaskingAsyncMonitor;
+import org.sigmah.client.event.SiteEvent;
+import org.sigmah.client.i18n.I18N;
+import org.sigmah.client.icon.IconImageBundle;
+import org.sigmah.client.map.AdminBoundsHelper;
+import org.sigmah.client.page.common.Shutdownable;
+import org.sigmah.shared.command.GetSitePoints;
+import org.sigmah.shared.command.result.SitePointList;
+import org.sigmah.shared.dao.Filter;
+import org.sigmah.shared.dto.ActivityDTO;
+import org.sigmah.shared.dto.BoundingBoxDTO;
+import org.sigmah.shared.dto.CountryDTO;
+import org.sigmah.shared.dto.SiteDTO;
+import org.sigmah.shared.dto.SitePointDTO;
+
+import com.extjs.gxt.ui.client.event.Listener;
+import com.google.gwt.dom.client.Style.Unit;
+import com.google.gwt.user.client.rpc.AsyncCallback;
+import com.google.gwt.user.client.Command;
+import com.google.gwt.user.client.DeferredCommand;
+import com.google.gwt.user.client.ui.DockLayoutPanel;
+import com.google.gwt.user.client.ui.Label;
+import com.google.inject.Inject;
+
+import org.gwtopenmaps.openlayers.client.Bounds;
+import org.gwtopenmaps.openlayers.client.control.LayerSwitcher;
+import org.gwtopenmaps.openlayers.client.feature.VectorFeature;
+import org.gwtopenmaps.openlayers.client.geometry.Point;
+import org.gwtopenmaps.openlayers.client.Icon;
+import org.gwtopenmaps.openlayers.client.LonLat; 
+import org.gwtopenmaps.openlayers.client.layer.OSM;
+import org.gwtopenmaps.openlayers.client.layer.Vector;
+import org.gwtopenmaps.openlayers.client.layer.XYZ;
+import org.gwtopenmaps.openlayers.client.layer.OSMOptions;
+import org.gwtopenmaps.openlayers.client.MapOptions;
+import org.gwtopenmaps.openlayers.client.MapWidget;
+import org.gwtopenmaps.openlayers.client.Style;
+
+
+public class OSMSiteMap extends DockLayoutPanel implements Shutdownable {
+
+	private final EventBus eventBus;
+	private final Dispatcher dispatcher;
+	private Filter filter;
+
+	private MapWidget mapWidget = null;
+	private Label status;
+
+	private Map&lt;Integer, VectorFeature&gt; sites;
+	private SitePointList sitePoints;
+	private Listener&lt;SiteEvent&gt; siteListener;
+
+	private Vector vectorLayer;
+	private Bounds bounds;
+	
+	private CountryDTO country;
+	private Integer mainSiteId;
+	
+	public OSMSiteMap(EventBus eventBus, Dispatcher dispatcher) {
+		super(Unit.PX);
+		
+		this.eventBus = eventBus;
+		this.dispatcher = dispatcher;
+		
+		status = new Label();
+		status.setStyleName(&quot;project-map-Label&quot;);
+		addSouth(status, 25);
+	}
+
+	public void loadSites(ActivityDTO activity) {
+		loadSites(activity.getDatabase().getCountry(), Filter.filter()
+				.onActivity(activity.getId()));
+	}
+
+	public void loadSites(CountryDTO country, Filter filter) {
+		this.country = country;
+		this.filter = filter;
+		
+		if (mapWidget == null) {
+			loadMap();
+		} else {
+			doLoadSites();
+		}
+	}
+
+	private void loadMap() {
+		status.setText(I18N.CONSTANTS.loadingOSM());
+
+		MapOptions defaultMapOptions = new MapOptions();
+		this.mapWidget = new MapWidget(&quot;100%&quot;, &quot;100%&quot;, defaultMapOptions);
+		
+		// HOT layer = Humanitarian OpenStreetMap
+		OSMOptions hotOption = new OSMOptions();
+		hotOption.setIsBaseLayer(true);
+		hotOption.crossOriginFix();
+		hotOption.setSphericalMercator(true);
+
+		XYZ HOTLayer = new XYZ(I18N.CONSTANTS.humanitarianOSMLayer(), &quot;http://a.tile.openstreetmap.fr/hot/${z}/${x}/${y}.png&quot;, hotOption);
+		mapWidget.getMap().addLayer(HOTLayer);
+				
+		// Basic layer
+		OSM osmMapnik = OSM.Mapnik(I18N.CONSTANTS.basicOSMLayer());
+		osmMapnik.setIsBaseLayer(true);
+		mapWidget.getMap().addLayer(osmMapnik);
+		 
+		vectorLayer = new Vector(I18N.CONSTANTS.projectSitesLayer());
+		
+		mapWidget.getMap().addControl(new LayerSwitcher());
+
+		// Center &amp; zoom
+		LonLat lonLat = new LonLat(0, 0);
+		lonLat.transform(&quot;EPSG:4326&quot;, mapWidget.getMap().getProjection());
+		mapWidget.getMap().setCenter(lonLat, 1);
+		mapWidget.getMap().updateSize();
+
+		add(mapWidget);
+		
+		addSiteEventListeners();
+		doLoadSites();
+	}
+
+	private void doLoadSites() {
+		status.setText(I18N.CONSTANTS.loading());
+
+		dispatcher.execute(new GetSitePoints(filter), null,
+				new AsyncCallback&lt;SitePointList&gt;() {
+					@Override
+					public void onFailure(Throwable throwable) {
+						status.setText(I18N.CONSTANTS.serverError());
+					}
+
+					@Override
+					public void onSuccess(SitePointList points) {
+						status.setText(I18N.MESSAGES.siteLoadStatus(Integer
+								.toString(points.getPoints().size()), Integer
+								.toString(points.getWithoutCoordinates())));
+
+						sitePoints = points;
+						addSitesToMap(points);
+					}
+				});
+	}
+
+	public void addSitesToMap(final SitePointList points) {
+		vectorLayer.removeAllFeatures();  
+	
+		sites = new HashMap&lt;Integer, VectorFeature&gt;();
+
+		Style siteStyle = new Style();
+		siteStyle.setExternalGraphic(&quot;http://www.google.com/mapfiles/marker.png&quot;);
+		siteStyle.setGraphicSize(20, 34);
+		siteStyle.setGraphicOffset(-10, -34); // anchor on bottom center
+		siteStyle.setFillOpacity(1.0);
+		
+		Style mainSiteStyle = new Style();
+		mainSiteStyle.setExternalGraphic(&quot;https://raw.githubusercontent.com/somzzz/Sigmah_resources/master/resources/markerStar.png&quot;);
+		mainSiteStyle.setGraphicSize(20, 34);
+		mainSiteStyle.setGraphicOffset(-10, -34); // anchor on bottom center
+		mainSiteStyle.setFillOpacity(1.0);
+
+		for (SitePointDTO point : points.getPoints()) {		
+			LonLat lonLat = new LonLat(point.getX(), point.getY());
+			lonLat.transform(&quot;EPSG:4326&quot;, mapWidget.getMap().getProjection());
+			
+			Point p = new Point(lonLat.lon(), lonLat.lat());
+			VectorFeature pointFeature;
+			
+			if (mainSiteId != null &amp;&amp; point.getSiteId() == mainSiteId) {		
+				pointFeature = new VectorFeature(p, mainSiteStyle);
+			} else {
+				pointFeature = new VectorFeature(p, siteStyle);
+			}
+			
+			vectorLayer.addFeature(pointFeature);
+			sites.put(point.getSiteId(), pointFeature);
+		}
+
+		mapWidget.getMap().addLayer(vectorLayer);
+		
+        DeferredCommand.addCommand(new Command() {	
+			@Override
+			public void execute() {
+				refresh(points);
+			}
+        });
+	}
+	
+	public void refreshView() {
+        DeferredCommand.addCommand(new Command() {	
+			@Override
+			public void execute() {
+				refresh(sitePoints);
+			}
+        });
+	}
+	
+	private void refresh(SitePointList points) {
+		if (points.getPoints().size() == 0) {
+			LonLat lonLat = new LonLat(0, 0);
+			lonLat.transform(&quot;EPSG:4326&quot;, mapWidget.getMap().getProjection());
+
+			mapWidget.getMap().setCenter(lonLat, 1);
+		} else if (points.getPoints().size() == 1) {
+			SitePointDTO point = points.getPoints().get(0);
+
+			LonLat lonLat = new LonLat(point.getX(), point.getY());
+			lonLat.transform(&quot;EPSG:4326&quot;, mapWidget.getMap().getProjection());
+
+			mapWidget.getMap().setCenter(lonLat, 8);
+			mapWidget.getMap().updateSize();
+		} else {
+			zoomToBounds(points.getBounds());
+		}
+	}
+	
+    private void zoomToBounds(BoundingBoxDTO bbBoxBounds) {
+    	LonLat lower = new LonLat(bbBoxBounds.getX1(), bbBoxBounds.getY1());
+    	lower.transform(&quot;EPSG:4326&quot;, mapWidget.getMap().getProjection());
+    	LonLat upper = new LonLat(bbBoxBounds.getX2(), bbBoxBounds.getY2());
+    	upper.transform(&quot;EPSG:4326&quot;, mapWidget.getMap().getProjection());
+    	
+        bounds = new Bounds(lower.lon(), lower.lat(), upper.lon(), upper.lat());
+        mapWidget.getMap().setCenter(bounds.getCenterLonLat(), 
+        		mapWidget.getMap().getZoomForExtent(bounds, false));
+        
+        mapWidget.getMap().updateSize();
+       
+    }
+
+	public void setMainSite(Integer mainSiteId) {
+		this.mainSiteId = mainSiteId;
+	}
+	
+	private CountryDTO getCountry() {
+		return country;
+	}
+	
+	public void addSiteEventListeners() {
+		// Site event listeners
+		siteListener = new Listener&lt;SiteEvent&gt;() {
+			public void handleEvent(SiteEvent be) {
+				if (be.getType() == SiteEvent.CREATED) {
+					onSiteCreated(be.getEntity());
+				} else if (be.getType() == SiteEvent.UPDATED) {
+					onSiteUpdated(be.getEntity());
+				} else if (be.getType() == SiteEvent.DELETED) {
+					onSiteDeleted(be.getEntity());
+				} else if (be.getType() == SiteEvent.MAIN_SITE_CREATED) {
+					onMainSiteCreated(be.getEntity());
+				} else if (be.getType() == SiteEvent.MAIN_SITE_UPDATED) {
+					onMainSiteUpdated(be.getEntity());
+				}
+			}
+		};
+
+		eventBus.addListener(SiteEvent.CREATED, siteListener);
+		eventBus.addListener(SiteEvent.UPDATED, siteListener);
+		eventBus.addListener(SiteEvent.DELETED, siteListener);
+
+		eventBus.addListener(SiteEvent.MAIN_SITE_CREATED,siteListener);
+		eventBus.addListener(SiteEvent.MAIN_SITE_UPDATED,siteListener);
+		
+	}
+	
+	public void shutdown() {
+		eventBus.removeListener(SiteEvent.CREATED, siteListener);
+		eventBus.removeListener(SiteEvent.UPDATED, siteListener);
+		eventBus.removeListener(SiteEvent.DELETED, siteListener);
+
+		eventBus.removeListener(SiteEvent.MAIN_SITE_UPDATED, siteListener);
+		eventBus.removeListener(SiteEvent.MAIN_SITE_CREATED, siteListener);
+	}
+
+	private void onSiteCreated(final SiteDTO site) {
+    	doLoadSites();
+	}
+
+	private void onSiteUpdated(final SiteDTO site) {
+    	doLoadSites();
+	}
+
+	private void onSiteDeleted(final SiteDTO site) {
+    	doLoadSites();
+	}
+
+	private void onMainSiteUpdated(final SiteDTO site) {
+    	this.mainSiteId = site.getId();
+    	doLoadSites();
+	}
+
+	private void onMainSiteCreated(final SiteDTO site) {
+    	this.mainSiteId = site.getId();
+    	doLoadSites();
+	}
+
+
+	private void addSite(SiteDTO site, Style pointStyle) {
+		LonLat lonLat = new LonLat(site.getX(), site.getY());
+		lonLat.transform(&quot;EPSG:4326&quot;, mapWidget.getMap().getProjection());
+		
+		Point point = new Point(lonLat.lon(), lonLat.lat());
+		VectorFeature marker = new VectorFeature(point, pointStyle);
+		
+		sites.put(site.getId(), marker);
+		vectorLayer.addFeature(marker);
+		
+		bounds.extend(lonLat);
+		mapWidget.getMap().setCenter(bounds.getCenterLonLat(), 
+				mapWidget.getMap().getZoomForExtent(bounds, false));
+	}
+	
+	
+	private void updateSite(SiteDTO site) {
+		VectorFeature marker = sites.get(site.getId());
+		
+		LonLat lonLat = new LonLat(site.getX(), site.getY());
+		lonLat.transform(&quot;EPSG:4326&quot;, mapWidget.getMap().getProjection());
+
+		marker.move(lonLat);		
+		sites.put(site.getId(), marker);
+
+		bounds.extend(lonLat);
+		mapWidget.getMap().setCenter(bounds.getCenterLonLat(), 
+				mapWidget.getMap().getZoomForExtent(bounds, false));
+	}
+	
+	
+	private void removeSite(SiteDTO site) {
+		VectorFeature marker = sites.get(site.getId());
+		
+		vectorLayer.removeFeature(marker);
+		sites.remove(site.getId());
+	}
+}
Index: /src/main/java/org/sigmah/client/page/entry/SiteColumnModelBuilder.java
===================================================================
--- /src/main/java/org/sigmah/client/page/entry/SiteColumnModelBuilder.java	(revision 1591)
+++ /src/main/java/org/sigmah/client/page/entry/SiteColumnModelBuilder.java	(working copy)
@@ -6,6 +6,7 @@
 
 import org.sigmah.client.dispatch.Dispatcher;
 import org.sigmah.client.i18n.I18N;
+import org.sigmah.client.icon.IconImageBundle;
 import org.sigmah.shared.command.GetSchema;
 import org.sigmah.shared.dao.Filter;
 import org.sigmah.shared.dto.ActivityDTO;
@@ -31,7 +32,9 @@
 import com.google.gwt.i18n.client.DateTimeFormat;
 import com.google.gwt.i18n.client.NumberFormat;
 import com.google.gwt.user.client.rpc.AsyncCallback;
+import com.google.gwt.user.client.ui.Image;
 
+
 /**
  * Helper class that builds the ColumnModel for the SiteGrid, based 
  * on the provided filter.
@@ -46,14 +49,16 @@
     private final AsyncCallback&lt;ColumnModel&gt; callback;
     private final Dispatcher dispatcher;
     private final Filter filter;
+    private final Integer mainSiteId;
     private final List&lt;ColumnConfig&gt; columns = new ArrayList&lt;ColumnConfig&gt;();
     private final Collection&lt;IndicatorDTO&gt; indicators;
 	
-	public SiteColumnModelBuilder(Dispatcher dispatch, Filter filter, Collection&lt;IndicatorDTO&gt; indicators, AsyncCallback&lt;ColumnModel&gt; callback) {
+	public SiteColumnModelBuilder(Dispatcher dispatch, Filter filter, Integer mainSiteId, Collection&lt;IndicatorDTO&gt; indicators, AsyncCallback&lt;ColumnModel&gt; callback) {
 		this.callback = callback;
 		this.filter = filter;
 		this.indicators = indicators;
 		this.dispatcher = dispatch;
+		this.mainSiteId = mainSiteId;
 		
         if(!filterIncludesSingleDatabase()) {
         	columns.add(createDatabaseColumn());
@@ -60,6 +65,7 @@
         }
         
         columns.add(createMappedColumn());
+        columns.add(createMainSiteColumn());
         
         if(filterIncludesSingleActivity()) {
         	addActivitySpecificColumns();
@@ -206,7 +212,36 @@
 		return new ColumnConfig(&quot;database&quot;, I18N.CONSTANTS.database(), 50);
 	}
 	
+	private ColumnConfig createMainSiteColumn() {
+       
+        final ColumnConfig mainSiteColumn = new ColumnConfig(&quot;siteType&quot;, &quot;&quot;, 25);
+        mainSiteColumn.setRenderer(new GridCellRenderer&lt;SiteDTO&gt;() {
 
+            @Override
+            public Object render(SiteDTO model, String property, ColumnData config,
+            		int rowIndex, int colIndex, ListStore listStore, Grid grid) {
+            	
+            	// Main site icon
+                final Image icon;
+                                             
+                if (mainSiteId != null &amp;&amp; mainSiteId == model.getId()) {
+                	//star
+                    icon = IconImageBundle.ICONS.mainSite().createImage();
+                    icon.setTitle(&quot;Main Site&quot;);
+                    
+                    icon.addStyleName(&quot;project-starred-icon&quot;);
+                } else {
+                	// Display no icon for simple sites
+                	icon = null;
+                }
+                
+                return icon;
+            }
+        });
+        
+        return mainSiteColumn;
+	}
+
     protected ColumnConfig createIndicatorColumn(IndicatorDTO indicator, String header) {
 
     	final NumberFormat format = IndicatorNumberFormats.forIndicator(indicator);
@@ -243,7 +278,7 @@
 	private ColumnConfig createLocation2Column() {
 		TextField&lt;String&gt; locationAxeField = new TextField&lt;String&gt;();
 
-		ColumnConfig axeColumn = new ColumnConfig(&quot;locationAxe&quot;, I18N.CONSTANTS.axe(), 75);
+		ColumnConfig axeColumn = new ColumnConfig(&quot;locationAxe&quot;, I18N.CONSTANTS.axeColumnTitle(), 75);
 		axeColumn.setEditor(new CellEditor(locationAxeField));
 		return axeColumn;
 	}
Index: /src/main/java/org/sigmah/client/page/entry/SiteGridPanel.java
===================================================================
--- /src/main/java/org/sigmah/client/page/entry/SiteGridPanel.java	(revision 1591)
+++ /src/main/java/org/sigmah/client/page/entry/SiteGridPanel.java	(working copy)
@@ -12,6 +12,7 @@
 import org.sigmah.client.EventBus;
 import org.sigmah.client.dispatch.Dispatcher;
 import org.sigmah.client.dispatch.monitor.MaskingAsyncMonitor;
+import org.sigmah.client.dispatch.remote.Authentication;
 import org.sigmah.client.event.SiteEvent;
 import org.sigmah.client.i18n.I18N;
 import org.sigmah.client.icon.IconImageBundle;
@@ -29,7 +30,9 @@
 import org.sigmah.shared.command.result.SiteResult;
 import org.sigmah.shared.command.result.VoidResult;
 import org.sigmah.shared.dao.Filter;
+import org.sigmah.shared.domain.profile.GlobalPermissionEnum;
 import org.sigmah.shared.dto.IndicatorDTO;
+import org.sigmah.shared.dto.profile.ProfileUtils;
 import org.sigmah.shared.dto.SchemaDTO;
 import org.sigmah.shared.dto.SiteDTO;
 import org.sigmah.shared.dto.UserDatabaseDTO;
@@ -51,6 +54,7 @@
 import com.extjs.gxt.ui.client.event.SelectionProvider;
 import com.extjs.gxt.ui.client.store.ListStore;
 import com.extjs.gxt.ui.client.store.Record;
+import com.extjs.gxt.ui.client.widget.button.Button;
 import com.extjs.gxt.ui.client.widget.ContentPanel;
 import com.extjs.gxt.ui.client.widget.Info;
 import com.extjs.gxt.ui.client.widget.Label;
@@ -74,6 +78,8 @@
 
     private Listener&lt;SiteEvent&gt; siteChangedListener;
     private Listener&lt;SiteEvent&gt; siteCreatedListener;
+    private Listener&lt;SiteEvent&gt; mainSiteUpdatedListener;
+    private Listener&lt;SiteEvent&gt; mainSiteCreatedListener;
     private List&lt;Shutdownable&gt; subComponents = new ArrayList&lt;Shutdownable&gt;();
 
     public static final int PAGE_SIZE = 25;
@@ -80,6 +86,7 @@
 
     protected final EventBus eventBus;
     protected final Dispatcher service;
+    protected final Authentication authentication;
 
     private PagingLoader&lt;SiteResult&gt; loader;
     private ListStore&lt;SiteDTO&gt; store;
@@ -93,9 +100,13 @@
     private Integer siteIdToSelectOnNextLoad;
 
     private boolean siteUpdated;
+    
+    private Integer mainSiteId;
 
     @Inject
-    public SiteGridPanel(EventBus eventBus, Dispatcher service, IStateManager stateMgr) {
+    public SiteGridPanel(EventBus eventBus, Dispatcher service, 
+    		Authentication authentication, IStateManager stateMgr) {
+    	this.authentication = authentication;
         this.eventBus = eventBus;
         this.service = service;
         this.siteUpdated = false;
@@ -118,6 +129,7 @@
                 }
             }
         });
+        
         eventBus.addListener(SiteEvent.UPDATED, new Listener&lt;SiteEvent&gt;() {
 
             @Override
@@ -127,6 +139,36 @@
                 }
             }
         });
+        
+        eventBus.addListener(SiteEvent.DELETED, new Listener&lt;SiteEvent&gt;() {
+
+            @Override
+            public void handleEvent(SiteEvent be) {
+                if (be.getEntityName().equals(&quot;Site&quot;)) {
+                    onSiteDeleted(be);
+                }
+            }
+        });
+        
+        eventBus.addListener(SiteEvent.MAIN_SITE_CREATED, new Listener&lt;SiteEvent&gt;() {
+
+            @Override
+            public void handleEvent(SiteEvent be) {
+                if (be.getEntityName().equals(&quot;Site&quot;)) {
+                    onMainSiteCreated(be);
+                }
+            }
+        });
+        
+        eventBus.addListener(SiteEvent.MAIN_SITE_UPDATED, new Listener&lt;SiteEvent&gt;() {
+
+            @Override
+            public void handleEvent(SiteEvent be) {
+                if (be.getEntityName().equals(&quot;Site&quot;)) {
+                    onMainSiteUpdated(be);
+                }
+            }
+        });
     }
 
     /*
@@ -161,9 +203,6 @@
 
             @Override
             public void loaderBeforeLoad(LoadEvent le) {
-                // toolBar.setActionEnabled(UIActions.add, currentActivity.getDatabase().isEditAllowed());
-                toolBar.setActionEnabled(UIActions.edit, false);
-                toolBar.setActionEnabled(UIActions.delete, false);
                 if (grid != null) {
                     grid.mask();
                 }
@@ -204,7 +243,38 @@
     public void load(Filter filter) {
         load(filter, Collections.&lt;IndicatorDTO&gt; emptySet());
     }
+    
+    
+    /**
+     * Loads the sites using the given filter and with the given mainSite. 
+     * This must be called by the container.
+     * 
+     * @param filter
+     */
+    public void load(Filter filter, Integer mainSiteId) {
+    	this.mainSiteId = mainSiteId;
+    	     
+		if (ProfileUtils.isGranted(this.authentication, GlobalPermissionEnum.MANAGE_MAIN_SITE)) {
+			toolBar.setActionEnabled(UIActions.manageMainSite, true);
+		}
+			
+		if (canManageSites()) {
+			toolBar.setActionEnabled(UIActions.add, true);
+		}
+		
+    	// By default the label is &quot;Create&quot;. If the project has a main site, use
+    	// the &quot;Edit&quot; label for this button.
+    	if (mainSiteId != null) {
+    		((Button) toolBar.getItemByItemId(UIActions.manageMainSite)).setText(I18N.CONSTANTS.editMainSiteButton());
+    	} else {
+    		// Disable creating sites until a main site is created.
+    		toolBar.setActionEnabled(UIActions.add, false);
+    	}
+    	
+        load(filter, Collections.&lt;IndicatorDTO&gt; emptySet());
+    }
 
+    
     /**
      * Loads the sites using the given filter, and including columns for the supplied indicators. This must be called by
      * the container.
@@ -218,8 +288,9 @@
         this.siteIdToSelectOnNextLoad = 0;
         loader.setOffset(0);
         loader.load();
-        new SiteColumnModelBuilder(service, filter, indicators, new AsyncCallback&lt;ColumnModel&gt;() {
 
+        new SiteColumnModelBuilder(service, filter,  this.mainSiteId, indicators, new AsyncCallback&lt;ColumnModel&gt;() {
+
             @Override
             public void onSuccess(ColumnModel result) {
                 initGrid(result);
@@ -231,6 +302,7 @@
             }
         });
     }
+   
 
     /**
      * Gets this grid's ActionToolBar. Consumers of this widget can add additional buttons.
@@ -249,15 +321,27 @@
     private void initToolBar() {
         toolBar = new ActionToolBar();
         toolBar.setListener(this);
+
         toolBar.addSaveSplitButton();
         toolBar.add(new SeparatorToolItem());
-
+        
+        toolBar.addButton(UIActions.manageMainSite, 
+        		I18N.CONSTANTS.createMainSiteButton(), IconImageBundle.ICONS.mainSite());
+        toolBar.add(new SeparatorToolItem());
+        
         toolBar.addButton(UIActions.add, I18N.CONSTANTS.newSite(), IconImageBundle.ICONS.add());
         toolBar.addEditButton();
         toolBar.addDeleteButton(I18N.CONSTANTS.deleteSite());
 
         toolBar.add(new SeparatorToolItem());
+        
+        
+    	toolBar.setActionEnabled(UIActions.manageMainSite, false);
+        toolBar.setActionEnabled(UIActions.add, false);
+    	toolBar.setActionEnabled(UIActions.edit, false);
+    	toolBar.setActionEnabled(UIActions.delete, false);
 
+
         // toolBar.addExcelExportButton();
 
         setTopComponent(toolBar);
@@ -285,7 +369,8 @@
     }
 
     public void addActionListener(Listener&lt;ComponentEvent&gt; listener) {
-        toolBar.addListener(Events.Select, listener);
+    	toolBar.addListener(Events.Select, listener);
+
     }
 
     @Override
@@ -302,7 +387,6 @@
      * @param model
      */
     private void initGrid(ColumnModel model) {
-
         if (grid == null) {
             grid = new EditorGrid&lt;SiteDTO&gt;(store, model);
             grid.setClicksToEdit(ClicksToEdit.TWO);
@@ -312,6 +396,7 @@
                 public void handleEvent(GridEvent&lt;SiteDTO&gt; event) {
                     siteUpdated = true;
                     toolBar.setDirty(true);
+
                 }
             });
 
@@ -341,11 +426,17 @@
             save();
         } else if (UIActions.delete.equals(actionId)) {
             delete();
+        } else if(UIActions.manageMainSite.equals(actionId)) {
+        	autoSelectMainSite();
         }
     }
 
     private void save() {
-        toolBar.setSaving();
+    	
+    	// Save can only be clicked from the toolbar. ToolBar does not exist
+    	// =&gt; this point cannot be reached.
+    	toolBar.setSaving();
+
         // defensive copy, this may change while we're saving
         final List&lt;Record&gt; dirty = new ArrayList&lt;Record&gt;(store.getModifiedRecords());
         service.execute(SavingHelper.createUpdateCommand(store), null, new AsyncCallback&lt;BatchResult&gt;() {
@@ -353,8 +444,9 @@
             @Override
             public void onFailure(Throwable caught) {
                 Info.display(I18N.CONSTANTS.serverError(), I18N.CONSTANTS.saveError());
-                siteUpdated = true;
+                siteUpdated = true;    
                 toolBar.setDirty(true);
+
             }
 
             @Override
@@ -361,6 +453,7 @@
             public void onSuccess(BatchResult result) {
                 siteUpdated = false;
                 toolBar.setDirty(false);
+                
                 for (Record record : dirty) {
                     record.commit(false);
                 }
@@ -390,6 +483,7 @@
                                 @Override
                                 public void onSuccess(VoidResult result) {
                                     store.remove(site);
+                                    eventBus.fireEvent(new SiteEvent(SiteEvent.DELETED, SiteGridPanel.this, site));
                                 }
                             });
                     }
@@ -396,6 +490,15 @@
                 }
             });
     }
+    
+    private void autoSelectMainSite() {
+    	if (this.mainSiteId != null) {
+    		SiteDTO model = store.findModel(&quot;id&quot;, this.mainSiteId);
+            if (model != null) {
+                grid.getSelectionModel().setSelection(Collections.singletonList(model));
+            }
+    	}
+    }
 
     private void onSiteCreated(SiteEvent se) {
         if (store.getCount() &lt; PAGE_SIZE) {
@@ -417,12 +520,46 @@
             store.update(site);
         }
     }
+    
+    private void onSiteDeleted(SiteEvent se) {
+        SiteDTO site = store.findModel(&quot;id&quot;, se.getSiteId());
+        if (site != null) {
+        	store.remove(site);
+        }
+    }
 
+    private void onMainSiteCreated(SiteEvent se) {
+    	this.mainSiteId = se.getEntity().getId();
+    	
+    	// reload the grid 
+    	load(filter, mainSiteId);
+    	
+    	// By default the label is &quot;Create&quot;. If the user creates a main site, use
+    	// the &quot;Edit&quot; label for this button.
+    	if (mainSiteId != null) {
+    		((Button) toolBar.getItemByItemId(UIActions.manageMainSite)).setText(I18N.CONSTANTS.editMainSiteButton());
+			if (canManageSites()) {
+				toolBar.setActionEnabled(UIActions.add, true);
+			}
+    	} 
+    	
+        onSiteCreated(se);
+    }
+
+    private void onMainSiteUpdated(SiteEvent se) {
+    	this.mainSiteId = se.getEntity().getId();
+    	onSiteUpdated(se);
+    }
+    
     public void shutdown() {
 
         eventBus.removeListener(SiteEvent.UPDATED, siteChangedListener);
         eventBus.removeListener(SiteEvent.CREATED, siteCreatedListener);
+        eventBus.removeListener(SiteEvent.DELETED, siteCreatedListener);
 
+        eventBus.removeListener(SiteEvent.MAIN_SITE_CREATED, mainSiteCreatedListener);
+        eventBus.removeListener(SiteEvent.MAIN_SITE_UPDATED, mainSiteUpdatedListener);
+        
         for (Shutdownable subComponet : subComponents) {
             subComponet.shutdown();
         }
@@ -430,8 +567,11 @@
 
     protected void onLoaded(LoadEvent le) {
         PagingResult result = (PagingResult) le.getData();
+        
+
         toolBar.setActionEnabled(UIActions.export, result.getTotalLength() != 0);
 
+        
         if (siteIdToSelectOnNextLoad != null) {
             SiteDTO model = store.findModel(&quot;id&quot;, siteIdToSelectOnNextLoad);
             if (model != null) {
@@ -443,25 +583,41 @@
 
     public void onSelectionChanged(SelectionChangedEvent&lt;SiteDTO&gt; event) {
 
-        toolBar.setActionEnabled(UIActions.delete, false);
-        toolBar.setActionEnabled(UIActions.edit, false);
+		// Enable toolbar buttons for selection
+		toolBar.setActionEnabled(UIActions.delete, false);
+		toolBar.setActionEnabled(UIActions.edit, false);
 
-        if (!event.getSelection().isEmpty()) {
-            isEditable(event.getSelectedItem(), new AsyncCallback&lt;Boolean&gt;() {
+    	
+		if (!event.getSelection().isEmpty()) {
 
-                @Override
-                public void onFailure(Throwable caught) {
-                }
+			// Disable the toolbar for the main site
+			// It should be handled only through the Set main site button
+			// from project &gt; map
 
-                @Override
-                public void onSuccess(Boolean editable) {
-                    toolBar.setActionEnabled(UIActions.delete, editable);
-                    toolBar.setActionEnabled(UIActions.edit, editable);
-                }
-            });
-        }
+			if (this.mainSiteId == null
+					|| this.mainSiteId != event.getSelectedItem().getId()) {
 
-        fireEvent(Events.SelectionChange, event);
+				// Not the main site, check editable
+				isEditable(event.getSelectedItem(),
+						new AsyncCallback&lt;Boolean&gt;() {
+
+							@Override
+							public void onFailure(Throwable caught) {
+							}
+
+							@Override
+							public void onSuccess(Boolean editable) {
+								if (canManageSites()) {
+									toolBar.setActionEnabled(UIActions.delete, editable);
+									toolBar.setActionEnabled(UIActions.edit, editable);
+								}
+							}
+						});
+			}
+
+		}
+
+		fireEvent(Events.SelectionChange, event);
     }
 
     private void isEditable(final SiteDTO selectedSite, final AsyncCallback&lt;Boolean&gt; callback) {
@@ -504,4 +660,8 @@
             service.execute(cmd, null, callback);
         }
     }
+    
+    private boolean canManageSites() {
+    	return (ProfileUtils.isGranted(this.authentication, GlobalPermissionEnum.MANAGE_SITES));
+    }
 }
Index: /src/main/java/org/sigmah/client/page/entry/SiteMap.java
===================================================================
--- /src/main/java/org/sigmah/client/page/entry/SiteMap.java	(revision 1591)
+++ /src/main/java/org/sigmah/client/page/entry/SiteMap.java	(working copy)
@@ -58,6 +58,8 @@
 import com.google.gwt.maps.client.geom.LatLng;
 import com.google.gwt.maps.client.geom.LatLngBounds;
 import com.google.gwt.maps.client.geom.Point;
+import com.google.gwt.maps.client.geom.Size;
+import com.google.gwt.maps.client.overlay.Icon; 
 import com.google.gwt.maps.client.overlay.Marker;
 import com.google.gwt.maps.client.overlay.MarkerOptions;
 import com.google.gwt.maps.client.overlay.Overlay;
@@ -96,6 +98,7 @@
      * Maps siteIds to markers
      */
     private Map&lt;Integer, Marker&gt; sites;
+	private SitePointList sitePoints;
 
     private Listener&lt;SiteEvent&gt; siteListener; 
 
@@ -105,9 +108,16 @@
     private Menu contextMenu;
     
     private CountryDTO country;
+    private Integer mainSiteId;
 
     private Status status;
     
+    /* Options for markers to be displayed on the map */
+    private Icon siteIcon;
+    private Icon mainSiteIcon;
+	private MarkerOptions siteOptions;
+	private MarkerOptions mainSiteOptions;
+    
     @Inject
     public SiteMap(EventBus eventBus, Dispatcher service) {
         this.eventBus = eventBus;
@@ -126,7 +136,7 @@
     			activity.getDatabase().getCountry(),
     			Filter.filter().onActivity(activity.getId()));
     }
-    
+
     /**
      * Loads the sites for the given Activity
      * 
@@ -142,53 +152,9 @@
     	}
     }
 
-    private void onSiteChanged(SiteDTO site) {
-
-    }
-
-    private void onSiteCreated(SiteDTO site) {
-
-    }
-
-    private void onSiteSelected(SiteEvent se) {
-        if (se.getSource() != this) {
-            if (se.getEntity() != null &amp;&amp; !se.getEntity().hasCoords()) {
-                BoundingBoxDTO bounds = AdminBoundsHelper.calculate(country, se.getEntity());
-                LatLngBounds llBounds = llBoundsForBounds(bounds);
-
-                if (!llBounds.containsBounds(map.getBounds())) {
-                    zoomToBounds(llBounds);
-                }
-            } else {
-                highlightSite(se.getSiteId(), true);
-            }
-        }
-    }
-    
-    private CountryDTO getCountry() {
-    	return country;
-    }
-
-
-    public void shutdown() {
-        eventBus.removeListener(SiteEvent.SELECTED, siteListener);
-        eventBus.removeListener(SiteEvent.CREATED, siteListener);
-        eventBus.removeListener(SiteEvent.UPDATED, siteListener);
-    }
-
-    public void onSiteDropped(Record record, double lat, double lng) {
-        record.set(&quot;x&quot;, lng);
-        record.set(&quot;y&quot;, lat);
-        updateSiteCoords(((SiteDTO) record.getModel()).getId(), lat, lng);
-
-    }
-
-    public BoundingBoxDTO getSiteBounds(SiteDTO site) {
-        return AdminBoundsHelper.calculate(getCountry(), site);
-    }
-
 	private void loadMap() {
 		status.setBusy(I18N.CONSTANTS.loadingGoogleMaps());
+
 		MapApiLoader.load(new MaskingAsyncMonitor(this, I18N.CONSTANTS.loadingComponent()), new AsyncCallback&lt;Void&gt;() {
 
             @Override
@@ -202,7 +168,7 @@
             @Override
             public void onSuccess(Void result) {
                 removeAll();
-
+               
                 BoundingBoxDTO countryBounds = country.getBounds();
                 LatLng boundsFromActivity = LatLng.newInstance(countryBounds.getCenterY(), countryBounds.getCenterX());
 				map = new MapWidget(boundsFromActivity, 8);
@@ -213,8 +179,9 @@
                 map.addControl(new SmallMapControl());
 
                 setLayout(new FitLayout());
+                
                 add(map);
-
+                
                 map.addMapClickHandler(new MapClickHandler() {
                     @Override
                     public void onClick(MapClickEvent event) {
@@ -224,6 +191,7 @@
                         }
                     }
                 });
+                
                 map.addMapRightClickHandler(new MapRightClickHandler() {
                     public void onRightClick(MapRightClickEvent event) {
                         if (event.getOverlay() != null) {
@@ -249,19 +217,22 @@
 
                 addListener(Events.AfterLayout, resizeListener);
                 addListener(Events.Resize, resizeListener);
-
+            	addSiteEventListeners();
+                
                 new MapDropTarget(SiteMap.this);
 
-                layout();
-                
+            	setMarkerConfigurations();
+            	
+            	layout();
+            	
                 doLoadSites();
             }
         });
 	}
 
-
 	private void doLoadSites() {
 		status.setBusy(I18N.CONSTANTS.loading());
+		
 		service.execute(new GetSitePoints(filter), null, new AsyncCallback&lt;SitePointList&gt;() {
             @Override
             public void onFailure(Throwable throwable) {
@@ -274,58 +245,13 @@
             			Integer.toString(points.getPoints().size()), 
             			Integer.toString(points.getWithoutCoordinates())));
         	
-            	addSitesToMap(points);
-
-                siteListener = new Listener&lt;SiteEvent&gt;() {
-                    public void handleEvent(SiteEvent be) {
-                        if (be.getType() == SiteEvent.SELECTED) {
-                            onSiteSelected(be);
-                        } else if (be.getType() == SiteEvent.CREATED) {
-                            onSiteCreated(be.getEntity());
-                        } else if (be.getType() == SiteEvent.UPDATED) {
-                            onSiteChanged(be.getEntity());
-                        }
-                    }
-                };
-
-                eventBus.addListener(SiteEvent.SELECTED, siteListener);
-                eventBus.addListener(SiteEvent.CREATED, siteListener);
-                eventBus.addListener(SiteEvent.UPDATED, siteListener);
+             	sitePoints = points;
+             	addSitesToMap(points);
             }
         });
 	}
-
-
-
-    private int siteIdFromOverlay(Overlay overlay) {
-        if (overlay == highlitMarker) {
-            return markerIds.get(currentHighlightedMarker);
-        } else {
-            return markerIds.get(overlay);
-        }
-    }
-
-    /**
-     * Attempts to pan to the center of the bounds and
-     * zoom to the necessary zoom level. If the map widget is not
-     * rendered or is in a funk because of resizing, the zoom
-     * is deferred until a Resize or AfterLayout event is received.
-     *
-     * @param bounds
-     */
-    private void zoomToBounds(LatLngBounds bounds) {
-
-        int zoomLevel = map.getBoundsZoomLevel(bounds);
-        if (zoomLevel == 0) {
-            pendingZoom = bounds;
-        } else {
-            map.setCenter(bounds.getCenter(), zoomLevel);
-            pendingZoom = null;
-        }
-    }
-
-    public void addSitesToMap(final SitePointList points) {
-
+	
+	public void addSitesToMap(final SitePointList points) {
         if (markerMgr == null) {
             OverlayManagerOptions options = new OverlayManagerOptions();
             options.setMaxZoom(map.getCurrentMapType().getMaximumResolution());
@@ -336,17 +262,26 @@
                 markerMgr.removeMarker(marker);
             }
         }
+        
         markerIds = new HashMap&lt;Marker, Integer&gt;();
         sites = new HashMap&lt;Integer, Marker&gt;();
 
         List&lt;Marker&gt; markers = new ArrayList&lt;Marker&gt;(points.getPoints().size());
-
+        
         for (SitePointDTO point : points.getPoints()) {
-
-            Marker marker = new Marker(LatLng.newInstance(point.getY(), point.getX()));
-            markerIds.put(marker, point.getSiteId());
-            sites.put(point.getSiteId(), marker);
-            markers.add(marker);
+            if (mainSiteId != null &amp;&amp; point.getSiteId() == mainSiteId) {
+                final Marker marker = new Marker(LatLng.newInstance(point.getY(), 
+                		point.getX()), mainSiteOptions);   
+                
+                markerIds.put(marker, point.getSiteId());
+                sites.put(point.getSiteId(), marker);
+                markers.add(marker);
+            } else {
+				final Marker marker = new Marker(LatLng.newInstance(point.getY(), point.getX()));
+				markerIds.put(marker, point.getSiteId());
+				sites.put(point.getSiteId(), marker);
+				markers.add(marker);
+            }
         }
 
         markerMgr.addOverlays(markers, 0);
@@ -354,26 +289,173 @@
 			
 			@Override
 			public void execute() {
-				markerMgr.refresh();
-				
-				if(points.getPoints().size() == 1) {
-					SitePointDTO p = points.getPoints().get(0);
-					map.setCenter(LatLng.newInstance(p.getY(), p.getX()));
-				} else {
-					zoomToBounds(llBoundsForBounds(points.getBounds()));
-				}
+				refresh(points);
 			}
 		});
+    }
+	
+    public void  refreshView() {
+    	refresh(sitePoints);
+    }
+    
+	private void refresh(SitePointList points) {
+		markerMgr.refresh();
 
+		if (points.getPoints().size() == 0) {
+			map.setCenter(LatLng.newInstance(0, 0), 1);
+		} else if (points.getPoints().size() == 1) {
+			SitePointDTO p = points.getPoints().get(0);
+			map.setCenter(LatLng.newInstance(p.getY(), p.getX()));
+			zoomToBounds(llBoundsForBounds(points.getBounds()));
+		} else {
+			zoomToBounds(llBoundsForBounds(points.getBounds()));
+		}
+
+		if (pendingZoom != null) {
+			zoomToBounds(pendingZoom);
+		}
+	}
+
+    /**
+     * Attempts to pan to the center of the bounds and
+     * zoom to the necessary zoom level. If the map widget is not
+     * rendered or is in a funk because of resizing, the zoom
+     * is deferred until a Resize or AfterLayout event is received.
+     *
+     * @param bounds
+     */
+	private void zoomToBounds(LatLngBounds bounds) {
+
+		int zoomLevel = map.getBoundsZoomLevel(bounds);
+		if (zoomLevel == 0) {
+			pendingZoom = bounds;
+		} else {
+			map.setCenter(bounds.getCenter(), zoomLevel);
+			pendingZoom = null;
+		}
+	}
+
+	private LatLngBounds llBoundsForBounds(BoundingBoxDTO bounds) {
+		LatLngBounds llbounds = LatLngBounds.newInstance(
+				LatLng.newInstance(bounds.getY2(), bounds.getX1()),
+				LatLng.newInstance(bounds.getY1(), bounds.getX2()));
+		return llbounds;
+	}
+
+	public BoundingBoxDTO getSiteBounds(SiteDTO site) {
+		return AdminBoundsHelper.calculate(getCountry(), site);
+	}
+
+	private CountryDTO getCountry() {
+		return country;
+	}
+
+	public void setMainSite(Integer mainSiteId) {
+		this.mainSiteId = mainSiteId;
+	}
+
+	public void onSiteDropped(Record record, double lat, double lng) {
+		record.set(&quot;x&quot;, lng);
+		record.set(&quot;y&quot;, lat);
+		updateSiteCoords(((SiteDTO) record.getModel()).getId(), lat, lng);
+	}
+
+	public void addSiteEventListeners() {
+		// Site event listeners
+		siteListener = new Listener&lt;SiteEvent&gt;() {
+			public void handleEvent(SiteEvent be) {
+				if (be.getType() == SiteEvent.CREATED) {
+					onSiteCreated(be.getEntity());
+				} else if (be.getType() == SiteEvent.UPDATED) {
+					onSiteUpdated(be.getEntity());
+				} else if (be.getType() == SiteEvent.DELETED) {
+					onSiteDeleted(be.getEntity());
+				} else if (be.getType() == SiteEvent.MAIN_SITE_CREATED) {
+					onMainSiteCreated(be.getEntity());
+				} else if (be.getType() == SiteEvent.MAIN_SITE_UPDATED) {
+					onMainSiteUpdated(be.getEntity());
+				}
+			}
+		};
+
+		eventBus.addListener(SiteEvent.CREATED, siteListener);
+		eventBus.addListener(SiteEvent.UPDATED, siteListener);
+		eventBus.addListener(SiteEvent.DELETED, siteListener);
+
+		eventBus.addListener(SiteEvent.MAIN_SITE_CREATED,siteListener);
+		eventBus.addListener(SiteEvent.MAIN_SITE_UPDATED,siteListener);	
+	}
+
+    private void onSiteUpdated(final SiteDTO site) {
+    	doLoadSites();
     }
 
-    private LatLngBounds llBoundsForBounds(BoundingBoxDTO bounds) {
-        LatLngBounds llbounds = LatLngBounds.newInstance(
-                LatLng.newInstance(bounds.getY2(), bounds.getX1()),
-                LatLng.newInstance(bounds.getY1(), bounds.getX2()));
-        return llbounds;
+    private void onSiteCreated(final SiteDTO site) {
+    	doLoadSites();
     }
+    
+    private void onSiteDeleted(final SiteDTO site) {
+    	doLoadSites();
+    }
+    
+    private void onMainSiteUpdated(final SiteDTO site) {
+    	this.mainSiteId = site.getId();
+    	doLoadSites();
+    }
 
+    private void onMainSiteCreated(final SiteDTO site) {
+    	this.mainSiteId = site.getId();
+    	doLoadSites();
+    }
+    
+
+    private void onSiteSelected(SiteEvent se) {
+        if (se.getSource() != this) {
+            if (se.getEntity() != null &amp;&amp; !se.getEntity().hasCoords()) {
+                BoundingBoxDTO bounds = AdminBoundsHelper.calculate(country, se.getEntity());
+                LatLngBounds llBounds = llBoundsForBounds(bounds);
+
+                if (!llBounds.containsBounds(map.getBounds())) {
+                    zoomToBounds(llBounds);
+                }
+            } else {
+                highlightSite(se.getSiteId(), true);
+            }
+        }
+    }
+
+    public void shutdown() {
+        eventBus.removeListener(SiteEvent.SELECTED, siteListener);
+        eventBus.removeListener(SiteEvent.CREATED, siteListener);
+        eventBus.removeListener(SiteEvent.UPDATED, siteListener);
+        eventBus.removeListener(SiteEvent.DELETED, siteListener);
+        
+        eventBus.removeListener(SiteEvent.MAIN_SITE_UPDATED, siteListener);
+        eventBus.removeListener(SiteEvent.MAIN_SITE_CREATED, siteListener);
+    }
+
+	
+	private void setMarkerConfigurations() {
+		mainSiteIcon = Icon
+				.newInstance(&quot;https://raw.githubusercontent.com/somzzz/Sigmah_resources/master/resources/markerStar.png&quot;);
+		mainSiteIcon.setIconSize(Size.newInstance(20, 34));
+		mainSiteIcon.setIconAnchor(Point.newInstance((mainSiteIcon
+				.getIconSize().getWidth() / 2), mainSiteIcon.getIconSize()
+				.getHeight())); // lower middle point
+		mainSiteOptions = MarkerOptions.newInstance();
+		mainSiteOptions.setIcon(mainSiteIcon);
+		mainSiteOptions.setTitle(I18N.CONSTANTS.mainSiteLabel());
+	}
+
+    private int siteIdFromOverlay(Overlay overlay) {
+        if (overlay == highlitMarker) {
+            return markerIds.get(currentHighlightedMarker);
+        } else {
+            return markerIds.get(overlay);
+        }
+    }
+
+
     public void updateSiteCoords(int siteId, double lat, double lng) {
         Marker marker = sites.get(siteId);
         if (marker != null) {
Index: /src/main/java/org/sigmah/client/page/project/design/ProjectIndicatorsContainer.java
===================================================================
--- /src/main/java/org/sigmah/client/page/project/design/ProjectIndicatorsContainer.java	(revision 1591)
+++ /src/main/java/org/sigmah/client/page/project/design/ProjectIndicatorsContainer.java	(working copy)
@@ -3,17 +3,11 @@
 import org.sigmah.client.EventBus;
 import org.sigmah.client.dispatch.Dispatcher;
 import org.sigmah.client.i18n.I18N;
-import org.sigmah.client.page.common.toolbar.UIActions;
 import org.sigmah.client.page.config.design.DesignPanel;
-import org.sigmah.client.page.config.design.ProjectSiteGridPanel;
-import org.sigmah.client.page.entry.SiteMap;
-import org.sigmah.client.page.entry.editor.SiteForm;
-import org.sigmah.client.page.entry.editor.SiteFormDialog;
 import org.sigmah.client.page.project.ProjectSubPresenter;
 import org.sigmah.shared.dao.Filter;
 import org.sigmah.shared.dto.IndicatorDTO;
 import org.sigmah.shared.dto.ProjectDTO;
-import org.sigmah.shared.dto.SiteDTO;
 import org.sigmah.shared.report.model.DimensionType;
 
 import com.extjs.gxt.ui.client.Style;
@@ -22,8 +16,6 @@
 import com.extjs.gxt.ui.client.util.Margins;
 import com.extjs.gxt.ui.client.widget.Component;
 import com.extjs.gxt.ui.client.widget.LayoutContainer;
-import com.extjs.gxt.ui.client.widget.TabItem;
-import com.extjs.gxt.ui.client.widget.TabPanel;
 import com.extjs.gxt.ui.client.widget.layout.BorderLayout;
 import com.extjs.gxt.ui.client.widget.layout.BorderLayoutData;
 import com.extjs.gxt.ui.client.widget.layout.FitLayout;
@@ -37,21 +29,11 @@
 	private final Dispatcher service;
 	private final EventBus eventBus;
 
-	private TabPanel tabPanel;
-	private TabItem mapTabItem;
-	private TabItem sitesTabItem;
-
-	private ProjectSiteGridPanel siteEditor;
-	private SiteMap siteMap;
-
 	private ProjectDTO project;
 
 	@Inject
-	public ProjectIndicatorsContainer(ProjectSiteGridPanel siteEditor, SiteMap siteMap, final DesignPanel designPanel,
-	                Dispatcher service, EventBus eventBus) {
+	public ProjectIndicatorsContainer(final DesignPanel designPanel, Dispatcher service, EventBus eventBus) {
 
-		this.siteEditor = siteEditor;
-		this.siteMap = siteMap;
 		this.designPanel = designPanel;
 		this.designPanel.setHeaderVisible(false);
 
@@ -62,40 +44,11 @@
 		borderLayout.setContainerStyle(&quot;x-border-layout-ct main-background&quot;);
 		setLayout(borderLayout);
 
-		// setIcon(IconImageBundle.ICONS.design());
-		// map tab panel
-		tabPanel = new TabPanel();
-		tabPanel.setPlain(true);
-
-		// map tab item
-		mapTabItem = new TabItem(I18N.CONSTANTS.map());
-		mapTabItem.setLayout(new FitLayout());
-		mapTabItem.setEnabled(false);
-		mapTabItem.setAutoHeight(true);
-		mapTabItem.setEnabled(true);
-		mapTabItem.add(siteMap);
-		tabPanel.add(mapTabItem);
-
-		// sites tab item
-		sitesTabItem = new TabItem(I18N.CONSTANTS.sites());
-		sitesTabItem.setLayout(new FitLayout());
-		sitesTabItem.setEnabled(false);
-		sitesTabItem.setAutoHeight(true);
-		sitesTabItem.setEnabled(true);
-		sitesTabItem.add(siteEditor);
-		tabPanel.add(sitesTabItem);
-
 		BorderLayoutData centerLayout = new BorderLayoutData(Style.LayoutRegion.CENTER);
 		centerLayout.setMargins(new Margins(0, 0, 0, 0));
 		centerLayout.setSplit(true);
 		centerLayout.setCollapsible(true);
 
-		BorderLayoutData layout = new BorderLayoutData(Style.LayoutRegion.EAST);
-		layout.setSplit(true);
-		layout.setCollapsible(true);
-		layout.setSize(375);
-		layout.setMargins(new Margins(0, 0, 0, 5));
-
 		add(designPanel, centerLayout);
 		designPanel.getMappedIndicator().addValueChangeHandler(new ValueChangeHandler&lt;IndicatorDTO&gt;() {
 
@@ -104,20 +57,6 @@
 				onMappedIndicatorChanged(event.getValue());
 			}
 		});
-
-		add(tabPanel, layout);
-
-		siteEditor.addActionListener(new Listener&lt;ComponentEvent&gt;() {
-
-			@Override
-			public void handleEvent(ComponentEvent be) {
-				if (UIActions.add.equals(be.getComponent().getItemId())) {
-					addSite();
-				} else if (UIActions.edit.equals(be.getComponent().getItemId())) {
-					editSite();
-				}
-			}
-		});
 	}
 
 	@Override
@@ -126,11 +65,6 @@
 
 		// load design panel
 		designPanel.load(project.getId());
-
-		// load site grid
-		Filter siteFilter = new Filter();
-		siteFilter.addRestriction(DimensionType.Database, project.getId());
-		siteEditor.load(siteFilter);
 	}
 
 	private void onMappedIndicatorChanged(IndicatorDTO value) {
@@ -137,34 +71,8 @@
 		Filter filter = new Filter();
 		filter.addRestriction(DimensionType.Indicator, value.getId());
 		filter.addRestriction(DimensionType.Database, project.getId());
-
-		siteMap.loadSites(project.getCountry(), filter);
 	}
 
-	private void addSite() {
-
-		final int projectId = project.getId();
-
-		SiteDTO site = new SiteDTO();
-		site.setDatabaseId(projectId);
-		// site.setPartner(projectPresenter.getCurrentProjectDTO().getOrgUnitId());
-
-		final SiteForm form = new SiteForm(service, project.getCountry());
-
-		final SiteFormDialog dialog = new SiteFormDialog(eventBus, service, form);
-		dialog.create(site);
-	}
-
-	private void editSite() {
-		if (!siteEditor.getSelection().isEmpty()) {
-			SiteDTO site = siteEditor.getSelection().get(0);
-			final SiteForm form = new SiteForm(service, project.getCountry());
-
-			final SiteFormDialog dialog = new SiteFormDialog(eventBus, service, form);
-			dialog.edit(site);
-		}
-	}
-
 	@Override
 	public Component getView() {
 		return (Component) this;
@@ -180,12 +88,11 @@
 
 	@Override
 	public boolean hasValueChanged() {
-		return (siteEditor.hasValueChanged() || designPanel.isIndicatorUpdated());
+		return (designPanel.isIndicatorUpdated());
 	}
 
 	@Override
 	public void forgetAllChangedValues() {
-		siteEditor.setSiteUpdated(false);
 		designPanel.setIndicatorUpdated(false);
 	}
 
Index: /src/main/java/org/sigmah/client/page/project/map/MapDisplayPresenter.java
===================================================================
--- /src/main/java/org/sigmah/client/page/project/map/MapDisplayPresenter.java	(revision 0)
+++ /src/main/java/org/sigmah/client/page/project/map/MapDisplayPresenter.java	(working copy)
@@ -0,0 +1,132 @@
+package org.sigmah.client.page.project.map;
+
+import java.util.ArrayList;
+
+import org.sigmah.client.dispatch.Dispatcher;
+import org.sigmah.client.dispatch.monitor.MaskingAsyncMonitor;
+import org.sigmah.client.EventBus;
+import org.sigmah.client.i18n.I18N;
+import org.sigmah.client.page.entry.OSMSiteMap;
+import org.sigmah.client.page.entry.SiteMap;
+import org.sigmah.client.page.project.ProjectSubPresenter;
+import org.sigmah.shared.command.GetSites;
+import org.sigmah.shared.command.result.SiteResult;
+import org.sigmah.shared.dao.Filter;
+import org.sigmah.shared.dto.ProjectDTO;
+import org.sigmah.shared.dto.SiteDTO;
+import org.sigmah.shared.report.model.DimensionType;
+
+import com.extjs.gxt.ui.client.event.ComponentEvent;
+import com.extjs.gxt.ui.client.event.Events;
+import com.extjs.gxt.ui.client.event.Listener;
+import com.extjs.gxt.ui.client.widget.Component;
+import com.extjs.gxt.ui.client.widget.ContentPanel;
+import com.extjs.gxt.ui.client.widget.TabItem;
+import com.extjs.gxt.ui.client.widget.TabPanel;
+import com.extjs.gxt.ui.client.widget.layout.FitLayout;
+import com.google.gwt.user.client.rpc.AsyncCallback;
+import com.google.inject.ImplementedBy;
+import com.google.inject.Inject;
+
+
+public class MapDisplayPresenter implements ProjectSubPresenter {
+	
+	/* View managed by this presenter */ 
+	@ImplementedBy(MapDisplayView.class)
+	public static abstract class View extends ContentPanel {
+		 public abstract ContentPanel getContentPanel();
+		 
+		 public abstract TabPanel getTabPanel();
+	}
+	
+	private View view;
+	private final Dispatcher dispatcher;
+	private final EventBus eventBus;
+	
+	private ProjectDTO project;
+	private Integer mainSiteId;
+	
+	private SiteMap googleSiteMap;
+	private OSMSiteMap osmSiteMap;
+	
+	@Inject
+	public MapDisplayPresenter(EventBus eventBus, Dispatcher dispatcher,
+			final View view, SiteMap siteMap) {
+		this.eventBus = eventBus;
+		this.dispatcher = dispatcher;
+		this.view = view;
+		this.googleSiteMap = siteMap;
+		
+		this.osmSiteMap = new OSMSiteMap(this.eventBus, this.dispatcher);
+
+		TabItem osmMapTabItem = new TabItem(I18N.CONSTANTS.openStreetMap());
+		osmMapTabItem.setLayout(new FitLayout());
+		osmMapTabItem.setEnabled(false);
+		osmMapTabItem.setAutoHeight(true);
+		osmMapTabItem.setEnabled(true);
+		osmMapTabItem.add(this.osmSiteMap);
+		osmMapTabItem.addListener(Events.Select, new Listener&lt;ComponentEvent&gt;() {
+			public void handleEvent(ComponentEvent be) {
+				osmSiteMap.refreshView();
+			}
+		});
+		
+		this.view.getTabPanel().add(osmMapTabItem);
+
+		TabItem googleSiteMapTabItem = new TabItem(I18N.CONSTANTS.googleMaps());
+		googleSiteMapTabItem.setLayout(new FitLayout());
+		googleSiteMapTabItem.setEnabled(false);
+		googleSiteMapTabItem.setAutoHeight(true);
+		googleSiteMapTabItem.setEnabled(true);
+		googleSiteMapTabItem.add(this.googleSiteMap);
+		googleSiteMapTabItem.addListener(Events.Select,new Listener&lt;ComponentEvent&gt;() {
+			public void handleEvent(ComponentEvent be) {
+				googleSiteMap.refreshView();
+			}
+		});
+		
+		this.view.getTabPanel().add(googleSiteMapTabItem);
+	}
+	
+	@Override
+	public void loadProject(ProjectDTO project) {
+		this.project = project;
+		
+		if (project.getMainSite() != null) {
+			mainSiteId = project.getMainSite().getId();
+		}
+
+		Filter filter = new Filter();
+		filter.addRestriction(DimensionType.Database, project.getId());
+		
+		googleSiteMap.setMainSite(this.mainSiteId);
+		googleSiteMap.loadSites(project.getCountry(), filter);
+		
+		osmSiteMap.setMainSite(this.mainSiteId);
+		osmSiteMap.loadSites(project.getCountry(), filter);
+	}
+
+	@Override
+    public Component getView() {
+		return this.view;
+    }
+
+	@Override
+    public void discardView() {
+    	this.view = null;
+    }
+    
+	@Override
+    public void viewDidAppear() {
+    	
+    }
+
+	@Override
+    public boolean hasValueChanged() {
+    	return false;
+    }
+
+	@Override
+    public void forgetAllChangedValues() {
+    }
+}
Index: /src/main/java/org/sigmah/client/page/project/map/MapDisplayView.java
===================================================================
--- /src/main/java/org/sigmah/client/page/project/map/MapDisplayView.java	(revision 0)
+++ /src/main/java/org/sigmah/client/page/project/map/MapDisplayView.java	(working copy)
@@ -0,0 +1,40 @@
+package org.sigmah.client.page.project.map;
+
+import org.sigmah.client.i18n.I18N;
+import org.sigmah.client.page.entry.SiteMap;
+
+import com.extjs.gxt.ui.client.widget.Container;
+import com.extjs.gxt.ui.client.widget.ContentPanel;
+import com.extjs.gxt.ui.client.widget.TabPanel;
+import com.extjs.gxt.ui.client.widget.layout.FitLayout;
+
+import org.gwtopenmaps.openlayers.client.MapOptions;
+import org.gwtopenmaps.openlayers.client.MapWidget;
+import org.gwtopenmaps.openlayers.client.layer.OSM;
+import org.gwtopenmaps.openlayers.client.LonLat;
+
+
+public class MapDisplayView extends MapDisplayPresenter.View {
+
+	private TabPanel tabPanel;
+
+	public MapDisplayView() {
+		setLayout(new FitLayout());
+		setHeaderVisible(false);
+		setBorders(true);
+
+		tabPanel = new TabPanel();
+		tabPanel.setPlain(true);
+		add(tabPanel);
+	}
+
+	@Override
+	public ContentPanel getContentPanel() {
+		return this;
+	}
+	
+	@Override
+	public TabPanel getTabPanel() {
+		return tabPanel;
+	}
+}
Index: /src/main/java/org/sigmah/client/page/project/map/ProjectMainSiteForm.java
===================================================================
--- /src/main/java/org/sigmah/client/page/project/map/ProjectMainSiteForm.java	(revision 0)
+++ /src/main/java/org/sigmah/client/page/project/map/ProjectMainSiteForm.java	(working copy)
@@ -0,0 +1,285 @@
+package org.sigmah.client.page.project.map;
+
+import java.util.HashMap;
+import java.util.Map;
+
+import org.sigmah.client.dispatch.Dispatcher;
+import org.sigmah.client.EventBus;
+import org.sigmah.client.event.SiteEvent;
+import org.sigmah.client.i18n.I18N;
+import org.sigmah.client.icon.IconImageBundle;
+import org.sigmah.client.i18n.UIConstants;
+import org.sigmah.client.page.config.form.ModelFormPanel;
+import org.sigmah.client.page.entry.editor.AdminFieldSetPresenter;
+import org.sigmah.client.page.entry.editor.LocationFieldSet;
+import org.sigmah.client.page.entry.editor.MapFieldSet;
+import org.sigmah.client.page.entry.editor.MapPresenter;
+import org.sigmah.shared.command.CreateEntity;
+import org.sigmah.shared.command.Delete;
+import org.sigmah.shared.command.GetSites;
+import org.sigmah.shared.command.UpdateEntity;
+import org.sigmah.shared.command.result.CommandResult;
+import org.sigmah.shared.command.result.CreateResult;
+import org.sigmah.shared.command.result.SiteResult;
+import org.sigmah.shared.command.result.VoidResult;
+import org.sigmah.shared.dao.Filter;
+import org.sigmah.shared.dto.BoundingBoxDTO;
+import org.sigmah.shared.dto.CountryDTO;
+import org.sigmah.shared.dto.PartnerDTO;
+import org.sigmah.shared.dto.ProjectDTO;
+import org.sigmah.shared.dto.SiteDTO;
+import org.sigmah.shared.report.model.DimensionType;
+
+import com.extjs.gxt.ui.client.Style.Scroll;
+import com.extjs.gxt.ui.client.event.ButtonEvent;
+import com.extjs.gxt.ui.client.event.Events;
+import com.extjs.gxt.ui.client.event.Listener;
+import com.extjs.gxt.ui.client.widget.button.Button;
+import com.extjs.gxt.ui.client.widget.form.FieldSet;
+import com.extjs.gxt.ui.client.widget.Info;
+import com.extjs.gxt.ui.client.widget.layout.FlowLayout;
+import com.extjs.gxt.ui.client.widget.MessageBox;
+import com.extjs.gxt.ui.client.widget.Status;
+import com.google.gwt.user.client.rpc.AsyncCallback;
+
+/*
+ * Form that Creates / Edits the main location of a project.
+ * The main location is actually a SITE and is referenced in
+ * the dto &gt; ProjectDTO and domain &gt; Project as the mainSite
+ * property. 
+ */
+public class ProjectMainSiteForm extends ModelFormPanel {
+
+	private Dispatcher dispatcher;
+	private EventBus eventBus;
+
+	// Button bar
+	private Status status;
+	private Button saveButton;
+
+	// The map and coordinate fields
+	private MapPresenter.View mapView;
+	private MapPresenter mapPresenter;
+
+	// Admin region
+	private AdminFieldSetPresenter adminPresenter;
+
+	private CountryDTO country;
+	private SiteDTO mainSite;
+	private Integer orgUnitID;
+	private Integer projectDatabaseID;
+	private ProjectDTO currentProject;
+
+	// Properties
+	private Map&lt;String, Object&gt; projectLocationProperties;
+
+	public ProjectMainSiteForm(Dispatcher dispatcher, EventBus eventBus,
+			ProjectDTO currentProject,
+			final AsyncCallback&lt;CommandResult&gt; callback) {
+
+		this.dispatcher = dispatcher;
+		this.eventBus = eventBus;
+		this.currentProject = currentProject;
+		this.country = currentProject.getCountry();
+		this.orgUnitID = currentProject.getOrgUnitId();
+		this.projectDatabaseID = currentProject.getId();
+
+		setHeaderVisible(false);
+		setBodyStyle(&quot;padding: 3px&quot;);
+		setLayout(new FlowLayout());
+		setScrollMode(Scroll.AUTOY);
+
+		
+		// Status bar with buttons
+
+		status = new Status();
+		status.setWidth(200);
+		getButtonBar().add(status);
+
+		saveButton = new Button(I18N.CONSTANTS.save());
+		saveButton.setIcon(IconImageBundle.ICONS.save());
+		saveButton.addListener(Events.OnClick, new Listener&lt;ButtonEvent&gt;() {
+			public void handleEvent(ButtonEvent be) {
+				manageMainLocation(callback);
+			}
+		});
+
+		addButton(saveButton);
+		
+		// First register all the fields required for the main project location
+
+		// Location
+		LocationFieldSet locationFieldSet = new LocationFieldSet(
+				country.getAdminLevels(), I18N.CONSTANTS.location());
+		add(locationFieldSet);
+
+		adminPresenter = new AdminFieldSetPresenter(dispatcher, country,
+				locationFieldSet);
+		adminPresenter.setListener(new AdminFieldSetPresenter.Listener() {
+			@Override
+			public void onBoundsChanged(String name, BoundingBoxDTO bounds) {
+				mapPresenter.setBounds(name, bounds);
+			}
+
+			@Override
+			public void onModified() {
+			}
+		});
+
+		// Map &amp; Coordinates
+		MapFieldSet mapFieldSet = new MapFieldSet(this.country);
+		this.mapView = mapFieldSet;
+
+		mapPresenter = new MapPresenter(mapView);
+		add((FieldSet) mapView);
+
+		mapPresenter.setBounds(this.country.getName(), this.country.getBounds());
+
+		registerField(((MapFieldSet) mapView).getLngField());
+		registerField(((MapFieldSet) mapView).getLatField());
+		
+		// Register all the fields on the form
+		registerAll();
+	}
+
+	
+	/*
+	 * Loads the main location on the form.
+	 * 
+	 * If the main location has been previously set, we display the existing
+	 * information on the form.
+	 */
+	public void setSite(SiteDTO site) {
+		if (site != null) {
+			this.mainSite = site;
+			adminPresenter.setSite(site);
+			mapPresenter.setSite(site, adminPresenter.getBoundsName(),
+					adminPresenter.getBounds());
+			updateForm(site);
+		}
+	}
+
+	
+	private void manageMainLocation(final AsyncCallback&lt;CommandResult&gt; callback) {
+		if (!this.isValid(false)) {
+			MessageBox.alert(I18N.CONSTANTS.createFormIncomplete(),
+					I18N.MESSAGES.createFormIncompleteDetails(I18N.CONSTANTS
+							.pleaseCompleteForm()), null);
+			return;
+		}
+
+		if (this.mainSite == null) {
+			createMainLocation(callback);
+		} else {
+			updateMainLocation(callback);
+		}
+	}
+
+	
+	/*
+	 * Handles creation of the project location. 
+	 * Create: adds a new entry in the Site table &amp; co, 
+	 * adds the newly created site id to the project table &gt; main_location_id 
+	 */
+	private void createMainLocation(final AsyncCallback&lt;CommandResult&gt; callback) {
+		
+		projectLocationProperties = getAllValues();
+		projectLocationProperties.put(&quot;databaseId&quot;, projectDatabaseID);
+
+		// Only the partner ID is used for creation, the second string argument
+		// is not relevant in this case. (Check initial design &amp; usage of this 
+		// property for purpose)
+		projectLocationProperties.put(&quot;partner&quot;, new PartnerDTO(orgUnitID, &quot;partner&quot;));
+
+		dispatcher.execute(new CreateEntity(&quot;Site&quot;, projectLocationProperties),
+				null, new AsyncCallback&lt;CreateResult&gt;() {
+
+					@Override
+					public void onFailure(Throwable caught) {
+						callback.onFailure(caught);
+					}
+
+					@Override
+					public void onSuccess(CreateResult result) {
+						if (result != null) {
+							final CreateResult siteResult = result;
+							
+							final SiteDTO newSite = new SiteDTO(result.getNewId());
+							newSite.setProperties(projectLocationProperties);
+							
+							// Add the main location site id to the project entity
+							HashMap&lt;String, Object&gt; changes = new HashMap&lt;String, Object&gt;();
+							changes.put(&quot;mainSite&quot;, result.getNewId());
+
+							dispatcher.execute(new UpdateEntity(&quot;Project&quot;,
+									currentProject.getId(), changes), null,
+									new AsyncCallback&lt;VoidResult&gt;() {
+										@Override
+										public void onFailure(Throwable caught) {
+
+											// We delete the site created to avoid keeping 
+											// stray main locations in the DB (which are not
+											// known by the project entity).
+											deleteMainLocation(newSite);
+										}
+
+										@Override
+										public void onSuccess(VoidResult result) {
+											Info.display(I18N.CONSTANTS.saved(), I18N.CONSTANTS.saved());
+											eventBus.fireEvent(new SiteEvent(SiteEvent.MAIN_SITE_CREATED, 
+													this, newSite));
+											
+											callback.onSuccess(siteResult);
+										}
+
+									});
+						} else {
+							Throwable t = new Throwable(
+									&quot;ProjectLocation : creation result is null&quot;);
+							callback.onFailure(t);
+						}
+					}
+				});
+
+	}
+
+	/*
+	 * Update: updates the info in the Site table &amp; co 
+	 */
+	private void updateMainLocation(final AsyncCallback&lt;CommandResult&gt; callback) {
+		projectLocationProperties = getModified();
+		dispatcher.execute(new UpdateEntity(mainSite, projectLocationProperties),
+				null, new AsyncCallback&lt;VoidResult&gt;() {
+
+					@Override
+					public void onFailure(Throwable caught) {
+						callback.onFailure(caught);
+					}
+
+					@Override
+					public void onSuccess(VoidResult result) {
+						callback.onSuccess(result);
+						Info.display(I18N.CONSTANTS.saved(), I18N.CONSTANTS.saved());
+						mainSite.setProperties(projectLocationProperties);
+						
+						eventBus.fireEvent(new SiteEvent(SiteEvent.MAIN_SITE_UPDATED,
+								this, mainSite));
+					}
+				});
+	}
+	
+	private void deleteMainLocation(final SiteDTO site) {
+        dispatcher.execute(new Delete(site), null,
+        		new AsyncCallback&lt;VoidResult&gt;() {
+
+        	@Override
+            public void onFailure(Throwable caught) {
+            }
+
+            @Override
+            public void onSuccess(VoidResult result) {
+                 eventBus.fireEvent(new SiteEvent(SiteEvent.DELETED, null, site));
+            }
+        });
+	}
+}
Index: /src/main/java/org/sigmah/client/page/project/map/ProjectMapPresenter.java
===================================================================
--- /src/main/java/org/sigmah/client/page/project/map/ProjectMapPresenter.java	(revision 0)
+++ /src/main/java/org/sigmah/client/page/project/map/ProjectMapPresenter.java	(working copy)
@@ -0,0 +1,176 @@
+package org.sigmah.client.page.project.map;
+
+import java.util.ArrayList;
+
+import org.sigmah.client.EventBus;
+import org.sigmah.client.SigmahInjector;
+import org.sigmah.client.dispatch.Dispatcher;
+import org.sigmah.client.dispatch.monitor.MaskingAsyncMonitor;
+import org.sigmah.shared.command.GetProject;
+import org.sigmah.shared.command.GetSites;
+import org.sigmah.shared.command.result.CreateResult;
+import org.sigmah.shared.command.result.SiteResult;
+import org.sigmah.shared.dao.Filter;
+import org.sigmah.shared.dto.ProjectDTO;
+import org.sigmah.shared.dto.SiteDTO;
+import org.sigmah.client.event.ProjectEvent;
+import org.sigmah.client.i18n.I18N;
+import org.sigmah.client.page.project.ProjectPresenter;
+import org.sigmah.client.page.project.ProjectSubPresenter;
+import org.sigmah.client.page.project.SubPresenter;
+import org.sigmah.shared.report.model.DimensionType;
+
+import com.extjs.gxt.ui.client.event.Events;
+import com.extjs.gxt.ui.client.event.Listener;
+import com.extjs.gxt.ui.client.Style;
+import com.extjs.gxt.ui.client.util.Margins;
+import com.extjs.gxt.ui.client.widget.Component;
+import com.extjs.gxt.ui.client.widget.ContentPanel;
+import com.extjs.gxt.ui.client.widget.layout.BorderLayoutData;
+import com.extjs.gxt.ui.client.widget.layout.FitLayout;
+import com.google.gwt.user.client.rpc.AsyncCallback;
+import com.google.inject.Inject;
+
+public class ProjectMapPresenter implements ProjectSubPresenter {
+
+	// We still use a view as gxt Component because that's how a SubPresenter is defined
+	public static abstract class View extends ContentPanel {
+		public abstract void addPanelToMainContainer(Component contentPanel,
+				BorderLayoutData layout);
+	}
+	
+	private View view;
+	private final Dispatcher dispatcher;
+	private final EventBus eventBus;
+	private final SigmahInjector injector;
+	private final ProjectPresenter projectPresenter;	
+	
+	private ProjectDTO currentProject;
+	private SiteDTO mainSite;
+	
+	private ProjectSubPresenter[] subPresenters;
+
+	
+	public ProjectMapPresenter(EventBus eventBus, Dispatcher dispatcher,
+			SigmahInjector injector, ProjectPresenter projectPresenter) {
+		this.eventBus = eventBus;
+		this.dispatcher = dispatcher;
+		this.injector = injector;
+		this.projectPresenter = projectPresenter;
+
+		subPresenters = new ProjectSubPresenter[] {
+				injector.getSitesManagementPresenter(),
+				injector.getMapDisplayPresenter() };
+	}
+
+	@Override
+	public void loadProject(final ProjectDTO project) {
+		this.currentProject = project;
+
+		for (ProjectSubPresenter presenter : subPresenters) {
+			presenter.loadProject(currentProject);
+		}
+	}
+
+	@Override
+	public Component getView() {
+		if (view == null) {
+			view = new ProjectMapView();
+			
+			// Add sites management and map display components (views)
+			subPresenters[0].getView().setHeight(&quot;100%&quot;);
+			subPresenters[1].getView().setHeight(&quot;100%&quot;);
+
+			BorderLayoutData centerLayout = new BorderLayoutData(Style.LayoutRegion.CENTER);
+			centerLayout.setMargins(new Margins(0, 0, 0, 0));
+			centerLayout.setSplit(true);
+			centerLayout.setCollapsible(true);
+			view.addPanelToMainContainer(subPresenters[0].getView(), centerLayout);
+
+			BorderLayoutData layout = new BorderLayoutData(Style.LayoutRegion.EAST);
+			layout.setSplit(true);
+			layout.setCollapsible(false);
+			layout.setSize(500);
+			layout.setMargins(new Margins(0, 0, 0, 5));
+			view.addPanelToMainContainer(subPresenters[1].getView(), layout);
+		}
+
+		return view;
+	}
+	
+	@Override
+	public void discardView() {
+		this.view = null;
+	}
+
+	@Override
+	public void viewDidAppear() {
+	}
+
+	@Override
+	public boolean hasValueChanged() {
+		return false;
+	}
+
+	@Override
+	public void forgetAllChangedValues() {
+	}
+	
+	
+	/*
+	 * The project information has been changed and we need to
+	 * refresh the view.
+	 * 
+	 * Also fire ProjectEvent.CHANGED.
+	 */
+	public void reload(ProjectDTO project) {
+		dispatcher.execute(new GetProject(project.getId()), 
+				null, 
+				new AsyncCallback&lt;ProjectDTO&gt;() {
+			@Override
+			public void onFailure(Throwable t) {
+			}
+
+			@Override
+			public void onSuccess(ProjectDTO result) {
+				
+				// Announce parent presenter eventually. The only changes to the project 
+				// on this tab involve the project main site which is not relevant anywhere
+				// else atm. Call ProjectPresenter.reload here if it is relevant.
+				
+				loadProject(result);
+				
+				eventBus.fireEvent(new ProjectEvent(ProjectEvent.CHANGED, projectPresenter
+						.getCurrentProjectDTO().getId())); 
+			}	
+		});
+	}
+	
+	private void setMainSite(ProjectDTO project) {
+		if (project.getMainSite() != null) {
+			Filter filter = new Filter();
+			filter.addRestriction(DimensionType.Database, project.getId());
+			filter.addRestriction(DimensionType.Site, project.getMainSite().getId());
+
+			GetSites cmd = new GetSites();
+			cmd.setFilter(filter);
+
+			MaskingAsyncMonitor mask = null;
+			if (view != null) {
+				mask = new MaskingAsyncMonitor(view, I18N.CONSTANTS.loading());
+			}
+
+			dispatcher.execute(cmd, mask, new AsyncCallback&lt;SiteResult&gt;() {
+				@Override
+				public void onFailure(Throwable caught) {
+					mainSite = null;
+				}
+
+				@Override
+				public void onSuccess(SiteResult result) {
+					mainSite = ((ArrayList&lt;SiteDTO&gt;) result.getData()).get(0);
+				}
+			});
+		}
+	}
+}
Index: /src/main/java/org/sigmah/client/page/project/map/ProjectMapView.java
===================================================================
--- /src/main/java/org/sigmah/client/page/project/map/ProjectMapView.java	(revision 0)
+++ /src/main/java/org/sigmah/client/page/project/map/ProjectMapView.java	(working copy)
@@ -0,0 +1,71 @@
+package org.sigmah.client.page.project.map;
+
+import org.sigmah.client.i18n.I18N;
+import org.sigmah.client.icon.IconImageBundle;
+
+import com.extjs.gxt.ui.client.Style.HorizontalAlignment;
+import com.extjs.gxt.ui.client.widget.button.Button;
+import com.extjs.gxt.ui.client.widget.Component;
+import com.extjs.gxt.ui.client.widget.ContentPanel;
+import com.extjs.gxt.ui.client.widget.LayoutContainer;
+import com.extjs.gxt.ui.client.widget.layout.BorderLayout;
+import com.extjs.gxt.ui.client.widget.layout.BorderLayoutData;
+import com.extjs.gxt.ui.client.widget.toolbar.SeparatorToolItem;
+import com.extjs.gxt.ui.client.widget.toolbar.ToolBar;
+
+import org.sigmah.client.page.config.design.ProjectSiteGridPanel;
+
+
+public class ProjectMapView extends ProjectMapPresenter.View {
+
+    // Toolbar buttons.
+    private Button exportHXL;
+    
+    private ContentPanel mapPanel;
+    private ContentPanel sitesPanel;
+
+    /**
+     * Builds the main panel.
+     * 
+     * @return main panel
+     */
+    public ProjectMapView() {
+		BorderLayout borderLayout = new BorderLayout();
+		borderLayout.setContainerStyle(&quot;join-background&quot;);
+		setLayout(borderLayout);
+        setHeaderVisible(false);
+        setBorders(true);
+		
+        // Toolbar.
+        final ToolBar toolBar = buildToolbar();
+        setTopComponent(toolBar);
+    }
+    
+    /**
+     * Builds the actions toolbar.
+     * 
+     * @return The actions toolbar.
+     */
+    private ToolBar buildToolbar() {
+
+        // Buttons
+    	
+    	// Add the exportHXL button for issue #630 - HXL export
+    	
+    	/*
+        exportHXL = new Button(&quot;Export HXL&quot;, IconImageBundle.ICONS.save());
+        exportHXL.setEnabled(false);
+        */
+
+        // Actions toolbar.
+        final ToolBar toolBar = new ToolBar();
+        toolBar.setAlignment(HorizontalAlignment.LEFT);
+        toolBar.setBorders(false);
+		
+        return toolBar;
+    }
+    
+    public void addPanelToMainContainer(Component view, BorderLayoutData layout) {
+    	add(view, layout);
+    }
+}
Index: /src/main/java/org/sigmah/client/page/project/map/SitesManagementPresenter.java
===================================================================
--- /src/main/java/org/sigmah/client/page/project/map/SitesManagementPresenter.java	(revision 0)
+++ /src/main/java/org/sigmah/client/page/project/map/SitesManagementPresenter.java	(working copy)
@@ -0,0 +1,174 @@
+package org.sigmah.client.page.project.map;
+
+import java.util.ArrayList;
+
+import org.sigmah.client.dispatch.Dispatcher;
+import org.sigmah.client.dispatch.monitor.MaskingAsyncMonitor;
+import org.sigmah.client.EventBus;
+import org.sigmah.client.i18n.I18N;
+import org.sigmah.client.page.common.toolbar.UIActions;
+import org.sigmah.client.page.config.design.ProjectSiteGridPanel;
+import org.sigmah.client.page.entry.editor.SiteForm;
+import org.sigmah.client.page.entry.editor.SiteFormDialog;
+import org.sigmah.client.page.project.ProjectSubPresenter;
+import org.sigmah.shared.command.GetSites;
+import org.sigmah.shared.command.result.CommandResult;
+import org.sigmah.shared.command.result.SiteResult;
+import org.sigmah.shared.dao.Filter;
+import org.sigmah.shared.dto.ProjectDTO;
+import org.sigmah.shared.dto.SiteDTO;
+import org.sigmah.shared.report.model.DimensionType;
+
+import com.extjs.gxt.ui.client.event.ComponentEvent;
+import com.extjs.gxt.ui.client.event.Listener;
+import com.extjs.gxt.ui.client.widget.Component;
+import com.extjs.gxt.ui.client.widget.ContentPanel;
+import com.extjs.gxt.ui.client.widget.layout.FitLayout;
+import com.extjs.gxt.ui.client.widget.Window;
+import com.google.gwt.user.client.rpc.AsyncCallback;
+import com.google.inject.ImplementedBy;
+import com.google.inject.Inject;
+
+
+public class SitesManagementPresenter implements ProjectSubPresenter {
+	
+	/* View managed by this presenter */ 
+	@ImplementedBy(SitesManagementView.class)
+	public static abstract class View extends ContentPanel {
+		public abstract ContentPanel getContentPanel();
+	}
+	
+	private View view;
+	private final Dispatcher dispatcher;
+	private final EventBus eventBus;
+	
+	private ProjectDTO project;
+	private Integer mainSiteId;
+	
+	private final ProjectSiteGridPanel siteEditor;
+	
+	@Inject
+	public SitesManagementPresenter(EventBus eventBus, Dispatcher dispatcher,
+			final View view, ProjectSiteGridPanel siteEditor) {
+		this.eventBus = eventBus;
+		this.dispatcher = dispatcher;
+		this.view = view;
+		this.siteEditor = siteEditor;
+		
+		siteEditor.addActionListener(new Listener&lt;ComponentEvent&gt;() {
+
+			@Override
+			public void handleEvent(ComponentEvent be) {
+				if (UIActions.add.equals(be.getComponent().getItemId())) {
+					addSite();
+				} else if (UIActions.edit.equals(be.getComponent().getItemId())) {
+					editSite();
+				} else if (UIActions.manageMainSite.equals(be.getComponent().getItemId())) {
+					manageMainSite();
+				}
+			}
+		});
+		
+		this.view.add(siteEditor);
+	}
+	
+	@Override
+	public void loadProject(ProjectDTO project) {
+		this.project = project;
+		
+		if (project.getMainSite() != null) {
+			this.mainSiteId = project.getMainSite().getId();		
+		}
+		
+		Filter siteFilter = new Filter();
+		siteFilter.addRestriction(DimensionType.Database, project.getId());
+	
+		siteEditor.load(siteFilter, this.mainSiteId);	
+	}    
+
+	private void addSite() {
+		final int projectId = project.getId();
+		
+		SiteDTO site = new SiteDTO();
+		site.setDatabaseId(projectId);
+		
+		final SiteForm form = new SiteForm(dispatcher, project.getCountry());
+		final SiteFormDialog dialog = new SiteFormDialog(eventBus, dispatcher, form);
+		
+		dialog.create(site);
+	}
+
+	private void editSite() {
+		if (!siteEditor.getSelection().isEmpty()) {
+			SiteDTO site = siteEditor.getSelection().get(0);
+			final SiteForm form = new SiteForm(dispatcher, project.getCountry());
+
+			final SiteFormDialog dialog = new SiteFormDialog(eventBus, dispatcher, form);
+			dialog.edit(site);
+		}
+	}
+	
+	private void manageMainSite() {
+		SiteDTO mainSite = null;
+
+		if (!siteEditor.getSelection().isEmpty()) {
+			mainSite = siteEditor.getSelection().get(0);
+		}
+		
+		int width = 500;
+		int height = 475;
+		String title = I18N.CONSTANTS.projectMainSite();
+		final Window window = new Window();
+		window.setHeading(title);
+		window.setSize(width, height);
+		window.setPlain(true);
+		window.setModal(true);
+		window.setBlinkModal(true);
+		window.setLayout(new FitLayout());
+
+		final ProjectMainSiteForm form = new ProjectMainSiteForm(dispatcher,
+				eventBus, project, new AsyncCallback&lt;CommandResult&gt;() {
+
+					@Override
+					public void onFailure(Throwable t) {
+						window.hide();
+					}
+
+					@Override
+					public void onSuccess(CommandResult result) {
+						window.hide();
+					}
+				});
+
+		// Load the mainSite on the form
+		form.setSite(mainSite);
+		window.add(form);
+		window.show();
+
+	}
+	
+	@Override
+    public Component getView() {
+		return this.view;
+    }
+
+	@Override
+    public void discardView() {
+    	this.view = null;
+    }
+    
+    @Override
+    public void viewDidAppear() {
+    	
+    }
+
+    @Override
+    public boolean hasValueChanged() {
+    	return siteEditor.hasValueChanged();
+    }
+
+    @Override
+    public void forgetAllChangedValues() {
+    	siteEditor.setSiteUpdated(false);
+    }
+}
Index: /src/main/java/org/sigmah/client/page/project/map/SitesManagementView.java
===================================================================
--- /src/main/java/org/sigmah/client/page/project/map/SitesManagementView.java	(revision 0)
+++ /src/main/java/org/sigmah/client/page/project/map/SitesManagementView.java	(working copy)
@@ -0,0 +1,25 @@
+package org.sigmah.client.page.project.map;
+
+import org.sigmah.client.i18n.I18N;
+import org.sigmah.client.icon.IconImageBundle;
+import org.sigmah.client.page.config.design.ProjectSiteGridPanel;
+
+import com.extjs.gxt.ui.client.widget.ContentPanel;
+import com.extjs.gxt.ui.client.widget.layout.FitLayout;
+
+
+public class SitesManagementView extends SitesManagementPresenter.View {	
+
+    public SitesManagementView() {	
+        setLayout(new FitLayout());
+        setHeaderVisible(true);
+        setBorders(true);
+        setHeading(I18N.CONSTANTS.projectSitesManagement());
+    }
+    
+    @Override
+    public ContentPanel getContentPanel() {
+        return this;
+    }
+
+}
Index: /src/main/java/org/sigmah/client/page/project/ProjectPresenter.java
===================================================================
--- /src/main/java/org/sigmah/client/page/project/ProjectPresenter.java	(revision 1591)
+++ /src/main/java/org/sigmah/client/page/project/ProjectPresenter.java	(working copy)
@@ -11,6 +11,7 @@
 
 import org.sigmah.client.AppEvents;
 import org.sigmah.client.EventBus;
+import org.sigmah.client.SigmahInjector;
 import org.sigmah.client.cache.UserLocalCache;
 import org.sigmah.client.dispatch.AsyncMonitor;
 import org.sigmah.client.dispatch.Dispatcher;
@@ -33,6 +34,7 @@
 import org.sigmah.client.page.project.design.ProjectIndicatorsContainer;
 import org.sigmah.client.page.project.details.ProjectDetailsPresenter;
 import org.sigmah.client.page.project.logframe.ProjectLogFramePresenter;
+import org.sigmah.client.page.project.map.ProjectMapPresenter;
 import org.sigmah.client.page.project.pivot.ProjectPivotContainer;
 import org.sigmah.client.page.project.reports.ProjectReportsPresenter;
 import org.sigmah.client.ui.ExportSpreadsheetFormButton;
@@ -59,6 +61,9 @@
 import org.sigmah.shared.dto.layout.LayoutGroupDTO;
 import org.sigmah.shared.dto.profile.ProfileUtils;
 
+
+
+
 import com.allen_sauer.gwt.log.client.Log;
 import com.extjs.gxt.ui.client.Style.Orientation;
 import com.extjs.gxt.ui.client.event.ButtonEvent;
@@ -136,6 +141,7 @@
 
 	private ProjectState currentState;
 	private ToggleAnchor currentTab;
+	 
 	/**
 	 * The current displayed project.
 	 */
@@ -168,8 +174,8 @@
 
 	@Inject
 	public ProjectPresenter(final Dispatcher dispatcher, View view, Authentication authentication,
-	                final EventBus eventBus, final UserLocalCache cache, ProjectIndicatorsContainer projectIndicators,
-	                ProjectPivotContainer pivot) {
+	                final EventBus eventBus, final UserLocalCache cache, final SigmahInjector injector,
+	                ProjectIndicatorsContainer projectIndicators, ProjectPivotContainer pivot) {
 
 		if (MAIN_TABS.isEmpty()) {
 			MAIN_TABS.add(I18N.CONSTANTS.projectTabDashboard());
@@ -178,6 +184,11 @@
 				MAIN_TABS.add(I18N.CONSTANTS.projectTabLogFrame());
 			if (ProfileUtils.isGranted(authentication, GlobalPermissionEnum.VIEW_INDICATOR)) {
 				MAIN_TABS.add(I18N.CONSTANTS.projectTabIndicators());
+			}
+			if (ProfileUtils.isGranted(authentication, GlobalPermissionEnum.VIEW_MAPTAB)) {
+				MAIN_TABS.add(I18N.CONSTANTS.projectMap());
+			}
+			if (ProfileUtils.isGranted(authentication, GlobalPermissionEnum.VIEW_INDICATOR)) {
 				MAIN_TABS.add(I18N.CONSTANTS.projectTabDataEntry());
 			}
 			if (ProfileUtils.isGranted(authentication, GlobalPermissionEnum.VIEW_AGENDA))
@@ -194,13 +205,17 @@
 		// For development.
 		// final DummyPresenter dummyPresenter = new DummyPresenter();
 
-		this.presenters
-		                .add(new ProjectDashboardPresenter(dispatcher, eventBus, authentication, this, cache));
+		this.presenters.add(new ProjectDashboardPresenter(dispatcher, eventBus, authentication, this, cache));
 		this.presenters.add(new ProjectDetailsPresenter(eventBus, dispatcher, authentication, this, cache));
 		if (ProfileUtils.isGranted(authentication, GlobalPermissionEnum.VIEW_LOGFRAME))
 			this.presenters.add(new ProjectLogFramePresenter(eventBus, dispatcher, authentication, this));
 		if (ProfileUtils.isGranted(authentication, GlobalPermissionEnum.VIEW_INDICATOR)) {
 			this.presenters.add(projectIndicators);
+		}
+		if (ProfileUtils.isGranted(authentication, GlobalPermissionEnum.VIEW_MAPTAB)) {
+			this.presenters.add(new ProjectMapPresenter(eventBus, dispatcher, injector, this));
+		}
+		if (ProfileUtils.isGranted(authentication, GlobalPermissionEnum.VIEW_INDICATOR)) {
 			this.presenters.add(pivot);
 		}
 		if (ProfileUtils.isGranted(authentication, GlobalPermissionEnum.VIEW_AGENDA))
@@ -207,6 +222,7 @@
 			this.presenters.add(new ProjectCalendarPresenter(dispatcher, authentication, this));
 		this.presenters.add(new ProjectReportsPresenter(authentication, dispatcher, eventBus, this));
 
+		
 		for (int i = 0; i &lt; MAIN_TABS.size(); i++) {
 			final int index = i;
 
@@ -555,7 +571,7 @@
 			gridLayout.setCellSpacing(0);
 			gridLayout.setWidth(&quot;100%&quot;);
 			gridLayout.setHeight(&quot;100%&quot;);
-
+			
 			for (int i = 0; i &lt; gridLayout.getColumnCount() - 1; i++) {
 				gridLayout.getColumnFormatter().setWidth(i, &quot;325px&quot;);
 			}
@@ -574,7 +590,9 @@
 
 				gridLayout.setWidget(groupLayout.getRow(), groupLayout.getColumn(), groupPanel);
 
+				// !!!!!!!!!!!!!!!!!
 				if (groupLayout.getLayoutConstraintsDTO() != null) {
+
 					for (final LayoutConstraintDTO constraint : groupLayout.getLayoutConstraintsDTO()) {
 
 						final FlexibleElementDTO element = constraint.getFlexibleElementDTO();
@@ -661,7 +679,6 @@
 		}
 		// Default banner.
 		else {
-
 			panel.setLayout(new FormLayout());
 
 			final LabelField codeField = new LabelField();
Index: /src/main/java/org/sigmah/client/page/table/drilldown/DrillDownEditor.java
===================================================================
--- /src/main/java/org/sigmah/client/page/table/drilldown/DrillDownEditor.java	(revision 1591)
+++ /src/main/java/org/sigmah/client/page/table/drilldown/DrillDownEditor.java	(working copy)
@@ -32,7 +32,7 @@
     private Listener&lt;PivotCellEvent&gt; eventListener;
 
     public DrillDownEditor(EventBus eventBus, Dispatcher service, IStateManager stateMgr, DateUtil dateUtil) {
-    	super(eventBus, service, stateMgr);    	
+    	super(eventBus, service, null, stateMgr);    	
     	this.dateUtil = dateUtil;
 
     	setHeading(I18N.CONSTANTS.drilldown());
Index: /src/main/java/org/sigmah/client/SigmahInjector.java
===================================================================
--- /src/main/java/org/sigmah/client/SigmahInjector.java	(revision 1591)
+++ /src/main/java/org/sigmah/client/SigmahInjector.java	(working copy)
@@ -48,6 +48,8 @@
 import org.sigmah.client.page.project.ProjectModule;
 import org.sigmah.client.page.project.ProjectPageLoader;
 import org.sigmah.client.page.project.ProjectPresenter;
+import org.sigmah.client.page.project.map.SitesManagementPresenter;
+import org.sigmah.client.page.project.map.MapDisplayPresenter;
 import org.sigmah.client.page.report.ReportListPagePresenter;
 import org.sigmah.client.page.report.ReportModule;
 import org.sigmah.client.page.report.ReportPreviewPresenter;
@@ -89,6 +91,10 @@
     // Required by the 'Project' page
     ProjectPresenter getProjectPresenter();
     
+    // Required by the 'Project &gt; Map' page
+    SitesManagementPresenter getSitesManagementPresenter();
+    MapDisplayPresenter getMapDisplayPresenter();
+    
     // Required by the 'Org unit' page
     OrgUnitPresenter getOrgUnitPresenter();
     OrgUnitPageLoader registerOrgUnitPageLoader();
Index: /src/main/java/org/sigmah/public/sigmah.css
===================================================================
--- /src/main/java/org/sigmah/public/sigmah.css	(revision 1591)
+++ /src/main/java/org/sigmah/public/sigmah.css	(working copy)
@@ -863,6 +863,52 @@
 	border-bottom: solid 1px #EDEDED;
 	padding: 5px 0 2px 2px;
 }
+
+/* --------------------------------------------- Project/Map */
+.project-map-tabPanel {
+	background-color: rgb(245, 222, 179);
+}
+
+.project-map-tabPanel .gwt-TabPanelBottom  {
+	height: 100%;
+	width: 100%;
+	border: 2px solid;
+	border-color: rgb(222, 184, 135);
+	background-color: white;
+}
+
+.project-map-tabPanel .gwt-TabBar {
+  	background-color: rgb(245, 222, 179);
+}
+
+.project-map-tabPanel .gwt-TabBarItem  {
+	font-family: tahoma, arial, helvetica, sans-serif;
+	font-size: 13px;
+	border: 2px solid;
+	border-color: rgb(222, 184, 135);
+	border-top-left-radius: 10px;
+	border-top-right-radius: 10px;
+	background-color: rgb(245, 222, 179);
+}
+
+.project-map-tabPanel .gwt-TabBarItem-selected  {
+	font-family: tahoma, arial, helvetica, sans-serif;
+	font-size: 13px;
+	font-weight: bold;
+	border: 2px solid;
+	border-color: rgb(222, 184, 135);
+	border-top-left-radius: 10px;
+	border-top-right-radius: 10px;
+	background-color: rgb(222, 184, 135);
+}
+
+.project-map-Label {
+	font-family: tahoma, arial, helvetica, sans-serif;
+	font-size: 13px;
+	text-align: center;
+	background-color: rgb(245, 222, 179);
+}
+
 /* --------------------------------------------- Reports */
 .project-report {
 	padding-top: 4px;
Index: /src/main/java/org/sigmah/server/policy/ProjectPolicy.java
===================================================================
--- /src/main/java/org/sigmah/server/policy/ProjectPolicy.java	(revision 1591)
+++ /src/main/java/org/sigmah/server/policy/ProjectPolicy.java	(working copy)
@@ -43,6 +43,7 @@
 import org.sigmah.shared.domain.logframe.LogFrameModel;
 import org.sigmah.shared.domain.reminder.MonitoredPointList;
 import org.sigmah.shared.domain.reminder.ReminderList;
+import org.sigmah.shared.domain.Site;
 import org.sigmah.shared.domain.value.Value;
 import org.sigmah.shared.dto.element.BudgetSubFieldDTO;
 
@@ -393,7 +394,6 @@
 
 	@Override
 	public void update(User user, Object entityId, PropertyMap changes) {
-
 		for (Map.Entry&lt;String, Object&gt; entry : changes.entrySet()) {
 
 			if (&quot;fundingId&quot;.equals(entry.getKey())) {
@@ -427,8 +427,24 @@
 				em.merge(project);
 				em.remove(projectFunding);
 
-			} else if (&quot;dateDeleted&quot;.equals(entry.getKey())) {
+			}
+			
+			else if (&quot;mainSite&quot;.equals(entry.getKey())) {
 				// Get the current project
+				Project project = em.find(Project.class, entityId);
+
+				// Get the project main location entity object
+				Site mainLocationSite = em.getReference(Site.class, entry.getValue());
+
+				// Add it to the current project
+				project.setMainSite(mainLocationSite);
+
+				// Save
+				em.merge(project);
+			}
+
+			else if (&quot;dateDeleted&quot;.equals(entry.getKey())) {
+				// Get the current project
 				UserDatabase project = em.find(UserDatabase.class, entityId);
 
 				// Mark the project in the state &quot;deleted&quot; (but don't delete it
@@ -447,7 +463,7 @@
 
 					((Project) project).getFunded().clear();
 					((Project) project).getFunding().clear();
-				}
+				} 
 
 				// Save
 				em.merge(project);
Index: /src/main/java/org/sigmah/shared/domain/profile/GlobalPermissionEnum.java
===================================================================
--- /src/main/java/org/sigmah/shared/domain/profile/GlobalPermissionEnum.java	(revision 1591)
+++ /src/main/java/org/sigmah/shared/domain/profile/GlobalPermissionEnum.java	(working copy)
@@ -123,7 +123,29 @@
 	/**
 	 * Show global export button in projects list
 	 */
-	GLOBAL_EXPORT;
+	GLOBAL_EXPORT,
+	
+	/**
+	 * For viewing Project &gt; Map
+	 */
+	VIEW_MAPTAB,
+	
+	/**
+	 * For setting/editing the main location(site)
+	 */
+	MANAGE_MAIN_SITE,
+	
+	/**
+	 * For cretaing/editing sites
+	 */
+	MANAGE_SITES,
+	
+	/**
+	 * For exporting HXL data
+	 */
+	EXPORT_HXL;
+	
+	
 
 	public static String getName(GlobalPermissionEnum gp) {
 		String gpName = &quot;default&quot;;
@@ -191,6 +213,18 @@
 		case GLOBAL_EXPORT:
 			gpName = I18N.CONSTANTS.globalExport();
 			break;
+		case VIEW_MAPTAB:
+			gpName = I18N.CONSTANTS.VIEW_MAPTAB();
+			break;
+		case MANAGE_MAIN_SITE:
+			gpName = I18N.CONSTANTS.MANAGE_MAIN_SITE();
+			break;
+		case MANAGE_SITES:
+			gpName = I18N.CONSTANTS.MANAGE_SITES();
+			break;
+		case EXPORT_HXL:
+			gpName = I18N.CONSTANTS.EXPORT_HXL();
+			break;
 
 		default:
 			gpName = null;
Index: /src/main/java/org/sigmah/shared/domain/Project.java
===================================================================
--- /src/main/java/org/sigmah/shared/domain/Project.java	(revision 1591)
+++ /src/main/java/org/sigmah/shared/domain/Project.java	(working copy)
@@ -30,6 +30,7 @@
 import org.sigmah.shared.domain.logframe.LogFrame;
 import org.sigmah.shared.domain.reminder.MonitoredPointList;
 import org.sigmah.shared.domain.reminder.ReminderList;
+import org.sigmah.shared.domain.Site;
 
 @Entity
 public class Project extends UserDatabase {
@@ -52,6 +53,7 @@
 	private Integer amendmentRevision;
 	private User manager;
 	private Integer activityAdvancement;
+	private Site mainSite;
 
 	protected Set&lt;User&gt; favoriteUsers;
 
@@ -286,5 +288,19 @@
 	public void setActivityAdvancement(Integer activityAdvancement) {
 		this.activityAdvancement = activityAdvancement;
 	}
+	
 
+	// Avoid using column name with &quot;location&quot; as the DB contains a location
+	// table which has nothing to do with this siteId.
+	@OneToOne(optional = true, fetch = FetchType.LAZY)
+	@JoinColumn(name = &quot;mainSite&quot;, nullable = true)
+	public Site getMainSite() {
+		return mainSite;
+	}
+
+	public void setMainSite(Site site) {
+		this.mainSite = site;
+	}
+	
+
 }
Index: /src/main/java/org/sigmah/shared/dto/ProjectDTO.java
===================================================================
--- /src/main/java/org/sigmah/shared/dto/ProjectDTO.java	(revision 1591)
+++ /src/main/java/org/sigmah/shared/dto/ProjectDTO.java	(working copy)
@@ -19,6 +19,7 @@
 import org.sigmah.shared.dto.reminder.MonitoredPointListDTO;
 import org.sigmah.shared.dto.reminder.ReminderDTO;
 import org.sigmah.shared.dto.reminder.ReminderListDTO;
+import org.sigmah.shared.dto.SiteDTO;
 import org.sigmah.shared.dto.value.ValueDTO;
 
 import com.extjs.gxt.ui.client.data.BaseModelData;
@@ -352,6 +353,7 @@
 	public void setManager(UserDTO manager) {
 		set(&quot;manager&quot;, manager);
 	}
+	
 
 	public MonitoredPointListDTO getPointsList() {
 		return get(&quot;pointsList&quot;);
@@ -420,6 +422,15 @@
 	public void setCurrentAmendment(AmendmentDTO currentAmendment) {
 		set(&quot;currentAmendment&quot;, currentAmendment);
 	}
+	
+	// The project main site
+	public void setMainSite(SiteDTO mainSite) {
+		set(&quot;mainSite&quot;, mainSite);
+	}
+	
+	public SiteDTO getMainSite() {
+		return get(&quot;mainSite&quot;);
+	}
 
 	@Override
 	public int getOrgUnitId() {
Index: /src/main/java/org/sigmah/Sigmah.gwt.xml
===================================================================
--- /src/main/java/org/sigmah/Sigmah.gwt.xml	(revision 1591)
+++ /src/main/java/org/sigmah/Sigmah.gwt.xml	(working copy)
@@ -21,6 +21,7 @@
     &lt;inherits name=&quot;com.google.gwt.inject.Inject&quot;/&gt;
     &lt;inherits name=&quot;com.extjs.gxt.charts.Chart&quot;/&gt;
     &lt;inherits name=&quot;com.google.code.gaxb.Annotations&quot;/&gt;
+    &lt;inherits name='org.gwtopenmaps.openlayers.OpenLayers'/&gt;
     
     	&lt;!-- Configure Logging --&gt;
 	&lt;define-property name=&quot;log_level&quot; values=&quot;TRACE&quot; /&gt;
Index: /src/main/resources/org/sigmah/server/bootstrap/SigmahHostController.html
===================================================================
--- /src/main/resources/org/sigmah/server/bootstrap/SigmahHostController.html	(revision 1591)
+++ /src/main/resources/org/sigmah/server/bootstrap/SigmahHostController.html	(working copy)
@@ -60,10 +60,16 @@
     &lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;../SigmahAuthToken&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;gxt/flash/swfobject.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot;&gt;
+    
     	&lt;!--ClientDictionaries--&gt;
     &lt;/script&gt;
+    
     &lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;Sigmah.nocache.js&quot;&gt;&lt;/script&gt;
     
+    &lt;script src=&quot;http://www.openlayers.org/api/OpenLayers.js&quot;&gt;&lt;/script&gt;
+	&lt;script src=&quot;http://www.openstreetmap.org/openlayers/OpenStreetMap.js&quot;&gt;&lt;/script&gt;
+	
+    
     &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;gxt/css/gxt-all.css&quot;/&gt;
     &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;gxt/themes/sigmah/css/xtheme-sigmah.css&quot;/&gt;
     &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;activityInfo.css&quot;/&gt;
Index: /pom.xml
===================================================================
--- /pom.xml	(revision 1591)
+++ /pom.xml	(working copy)
@@ -191,6 +191,12 @@
 			&lt;/exclusions&gt;
 		&lt;/dependency&gt;
 		
+		&lt;dependency&gt;
+  			&lt;groupId&gt;org.gwtopenmaps.openlayers&lt;/groupId&gt;
+  			&lt;artifactId&gt;gwt-openlayers-client&lt;/artifactId&gt;
+  			&lt;version&gt;1.0&lt;/version&gt;
+		&lt;/dependency&gt;
+		
 		&lt;!-- Rebar- client persistence --&gt;
 			
 		&lt;dependency&gt;
@@ -218,7 +224,6 @@
 			&lt;scope&gt;test&lt;/scope&gt;
 		&lt;/dependency&gt;
 
-
 		&lt;!-- Dependency Injection Framework --&gt;		
 		
 		&lt;dependency&gt;
</pre></span>
<br />
<a href="file_downloaddcec.php?file_id=227&amp;type=bug"><img src="images/fileicons/png.gif" alt="png file icon" width="16" height="16" border="0" /></a>&#160;<a href="file_downloaddcec.php?file_id=227&amp;type=bug">markerStar.png</a> [<a href="file_downloaddcec.php?file_id=227&amp;type=bug" target="_blank">^</a>] (1,389 bytes) <span class="italic">2014-12-05 21:52</span>
<br /><a href="file_downloaddcec.php?file_id=227&amp;type=bug"><img alt="" style="border: 0; max-height:250px;" src="file_downloadf2ba.php?file_id=227&amp;type=bug&amp;show_inline=1&amp;file_show_inline_token=20180725562c80cc84a52138d5d011eb3cc04746af07a923" /></a><br />
<br /><a href="file_download9664.php?file_id=228&amp;type=bug"><img src="images/fileicons/png.gif" alt="png file icon" width="16" height="16" border="0" /></a>&#160;<a href="file_download9664.php?file_id=228&amp;type=bug">star.png</a> [<a href="file_download9664.php?file_id=228&amp;type=bug" target="_blank">^</a>] (3,275 bytes) <span class="italic">2014-12-05 21:52</span>
<br /><a href="file_download9664.php?file_id=228&amp;type=bug"><img alt="" style="border: 0; max-height:250px;" src="file_download3f98.php?file_id=228&amp;type=bug&amp;show_inline=1&amp;file_show_inline_token=201807253946a2544b1fcb8f6fbca6444bd0930ba166faa6" /></a></td></tr><tr align="center"><td align="center" colspan="6"><table><tr class="vcenter"><td class="center"></td><td class="center"></td><td class="center"></td><td class="center"></td></tr></table></td></tr></table><br />

<div id="relationships_open"><table class="width100" cellspacing="1">
<tr class="row-2" valign="top">
	<td width="15%" class="form-title" colspan="2">
		<a href="#" onclick="ToggleDiv( 'relationships' ); return false;"
			><img border="0" src="images/minus.html" alt="-" /></a>&#160;Relationships	</td>
</tr>
<tr>
	<td colspan="2"><table border="0" width="100%" cellpadding="0" cellspacing="1"><tr bgcolor="#fcbdbd"><td><span class="nowrap">related to</span>&#160;</td><td><a href="view1ce3.html?id=630">0000630</a></td><td><span class="issue-status" title="open">new</span></td><td>&#160;</td><td>HXL export&#160;</td></tr>
</table></td>
</tr>
</table>

</div><div id="relationships_closed" class="hidden"><table class="width100" cellspacing="1">
<tr>
	<td class="form-title">
		<a href="#" onclick="ToggleDiv( 'relationships' ); return false;"
			><img border="0" src="images/plus.html" alt="+" /></a>&#160;Relationships	</td>
</tr>
</table>

</div>
<a name="bugnotes" id="bugnotes" /><br />

<div id="bugnotes_open"><table class="width100" cellspacing="1">
<tr>
	<td class="form-title" colspan="2">
<a href="#" onclick="ToggleDiv( 'bugnotes' ); return false;"
			><img border="0" src="images/minus.html" alt="-" /></a>&#160;		Notes	</td>
</tr>
<tr class="bugnote" id="c1404">
        <td class="bugnote-public">
				<span class="small">(<a href="view4a10.html?id=612#c1404" title="Direct link to note">0001404)</a></span><br />
		<a href="view_user_page6258.php?id=21">ewach</a>		<span class="small">(reporter)</span>
				<br />
		<span class="small">2014-03-21 09:58</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		Hi all !<br />
<br />
Juste one short morning and not very elaborated feedback (sorry for that). But I was wondering how &quot;clear&quot; would be this sub-tab for the users. I have indeed the feeling that we mix different type of sites : project sites, data collection and/or activity site (use for M&amp;E sub-tab or even, one day, for AI export...). <br />
Therefore I think (i) that we shoud cleary differentiate &quot;main project sites&quot; (single one used for HXL If I'm not wrong) from data collection site (which could be several villages) and/or activities sites (which could be different water points or distribution points) and/or even NGO &quot;bases&quot;/office(ii) we should still be able to manage data collection site (i.e. at least to create new ones) from plan/performing monitoring task M&amp;E sub-tab (iii) ideally be able to manage the sites both from org unit and projects (as mentionned in indicators 2.0 docs) to avoid &quot;wrong&quot; duplication in each project...<br />
I hope that i'm not too much confusing... Best,	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1411">
        <td class="bugnote-public">
				<span class="small">(<a href="view4a10.html?id=612#c1411" title="Direct link to note">0001411)</a></span><br />
		<a href="view_user_page0b30.html?id=2">osarrat</a>		<span class="small">(administrator)</span>
				<br />
		<span class="small">2014-05-23 15:32</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		I'm adding in &quot;Additional information&quot; a link to the alpha version of the HXL standard, which is still under discussion.<br />
<br />
ewach, are you basing your fear of confusion from the textual description or from the mockup?<br />
In my opinion, the screen shown in the mockup is quite obvious... but since I've designed it myself, there might be a bias!<br />
Tell me your opinion about the mockup? :)<br />
	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1412">
        <td class="bugnote-public">
				<span class="small">(<a href="view4a10.html?id=612#c1412" title="Direct link to note">0001412)</a></span><br />
		<a href="view_user_page3ebc.html?id=64">somzzz</a>		<span class="small">(developer)</span>
				<br />
		<span class="small">2014-05-24 10:06</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		Hello ewach, osarrat!<br />
<br />
I have attached my own version of the mock-up, it is based on the one osarrat created with slight modifications. osarrat, I would like to know if you have any suggestions/changes that could be made to it before I start working on it.<br />
<br />
Also, ewach, the location pinned on the map and used for HXL export is a first level national administrative area. It clearly differentiates (in my opinion) from the list of sites which represent smaller areas. Naturally, the sites should be within the main region pinned on the map, however the software will impose no restrictions (as was discussed so far). Please let me know if it is clearer.	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1413">
        <td class="bugnote-public">
				<span class="small">(<a href="view4a10.html?id=612#c1413" title="Direct link to note">0001413)</a></span><br />
		<a href="view_user_page6258.php?id=21">ewach</a>		<span class="small">(reporter)</span>
				<br />
		<span class="small">2014-05-25 13:59</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		Hi all,<br />
<br />
First of all thanks for all the additional information and mock-ups !<br />
<br />
To be honest, i'm today a little bit confused / lost with this sub-tab (it's also related to the fact that it's a long time that I din't read again the related features). <br />
<br />
But my main concern is : is this &quot;map&quot; sub-tab dedicated only to the management of HXL sites (i.e. projet location - one or several)  or will it be also used for &quot;data collections&quot; sites management (used in future M&amp;E subtab) ?<br />
<br />
In the first case (only used for HXL sites), I will find it quite confusing for the user to have to manage &quot;geographical information&quot; in two different places without link between them !<br />
<br />
In the second case (management of all sites), I think that we will need to imagine different levels or types of site (main projet location, activities site or data collection site, NGO office etc.) to avoid the mess into the list of site.<br />
<br />
Finally, on the last mock-up, in &quot;project shared data&quot; box I have the feeling that a site will be only related to one single type of activity. Ii it right ? Does-it mean that for a multi-sectoral projet we will have to create several sites ?<br />
<br />
I hope that my comment is clearer than the previous one ;). Best,	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1414">
        <td class="bugnote-public">
				<span class="small">(<a href="view4a10.html?id=612#c1414" title="Direct link to note">0001414)</a></span><br />
		<a href="view_user_page0b30.html?id=2">osarrat</a>		<span class="small">(administrator)</span>
				<br />
		<span class="small">2014-05-26 11:11</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		So far, the &quot;Map&quot; sub-tab is planned to have 2 purposes:<br />
- manage the list of sites used for indicators monitoring<br />
- set optionnally a single project location which could be shared through the HXL standard<br />
<br />
The pre-alpha version of the HXL standard allow to share several locations for a single project. I would rather suggest not to go in this direction for our first version of this sub-tab. We should wait maybe to have more extended activities management features able to link activities with sites before going into an export of HXL data for several sites of a project.<br />
Consequently, there should be no confusion: the sites have nothing to do with HXL.<br />
<br />
somzzz, your last mockup is nice but has a flaw: some organisations won't choose to use this HXL feature. As a consequence, I would more support a solution where the exportation is done through a button which could be easily hidden, and through a popup to fill all requested information that this button will open.<br />
In my opinion, next step is to finalize the full design of this feature: which information should be collected from the user according to the alpha version of the standard? how should we export/publish this information (do we start tor un a triple store service in Sigmah? do we use the UNOCHA one (if still active)?), etc.<br />
<br />
Thinking about this mockup, another question comes up: should the &quot;set project location&quot; feature only set project location for the HXL format, or should we create an internal project location feature which could be extended with other information for exportation in HXL format?<br />
I would be more incline towards the first option for two reasons. (i) There is no mean to exploit inside Sigmah the project location information, no general maps, or anything else. (ii) Having the project location feature available only in HXL format would be simpler for the user, and would encourage more users to use the HXL export.	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1424">
        <td class="bugnote-public">
				<span class="small">(<a href="view4a10.html?id=612#c1424" title="Direct link to note">0001424)</a></span><br />
		<a href="view_user_page3ebc.html?id=64">somzzz</a>		<span class="small">(developer)</span>
				<br />
		<span class="small">2014-06-12 23:28</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		According to all that has been discussed, I have done a basic filtering of the HXL Data Dictionary from the alpha standard to decide what information should be exported through this feature. There is room for improvement.<br />
<br />
The link below is a Google spreadsheet with the same format as the HXL Data Dictionary (for ease of access). I added the columns Priority and Observations explain which information might be relevant and why.<br />
<br />
<a href="https://docs.google.com/spreadsheets/d/1QV1HPMn2ptMzohZ4FvLVpORKZLUoeQNOZ5MTYvzsMbg/edit?usp=sharing">https://docs.google.com/spreadsheets/d/1QV1HPMn2ptMzohZ4FvLVpORKZLUoeQNOZ5MTYvzsMbg/edit?usp=sharing</a> [<a href="https://docs.google.com/spreadsheets/d/1QV1HPMn2ptMzohZ4FvLVpORKZLUoeQNOZ5MTYvzsMbg/edit?usp=sharing" target="_blank">^</a>]<br />
<br />
The final structure of the HXL export data will be decided after a meeting with the adoption focal points. <br />
<br />
Until then, please let me know if you have any comments or suggestions on the spreadsheet above.	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1427">
        <td class="bugnote-public">
				<span class="small">(<a href="view4a10.html?id=612#c1427" title="Direct link to note">0001427)</a></span><br />
		<a href="view_user_page0b30.html?id=2">osarrat</a>		<span class="small">(administrator)</span>
				<br />
		<span class="small">2014-06-15 10:42</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		Good work with this spreadsheet!<br />
<br />
Could you open it for comments or edition to ease the communication on it? :)<br />
<br />
Regarding the methodology to collect data, since we plan to export only the simplest data (position, time, organization of the project), I think this field is not really relevant for us.<br />
Regarding the number of people in need etc., some organization will use fields to collect this information, some other will use indicators. I think that trying to export this information should not be our first priority.	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1428">
        <td class="bugnote-public">
				<span class="small">(<a href="view4a10.html?id=612#c1428" title="Direct link to note">0001428)</a></span><br />
		<a href="view_user_page3ebc.html?id=64">somzzz</a>		<span class="small">(developer)</span>
				<br />
		<span class="small">2014-06-15 11:22</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		I've changed the permissions of the spreadsheet and anybody should be able to edit it. To make it easier to see who changes what, I recommend using different font colours. <br />
<br />
I agree with you, osarrat, that the methodology fields and number of people/etc ones are not very relevant and are not a priority. They are now marked as fields not included in the export (-).	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1430">
        <td class="bugnote-public">
				<span class="small">(<a href="view4a10.html?id=612#c1430" title="Direct link to note">0001430)</a></span><br />
		<a href="view_user_page0b30.html?id=2">osarrat</a>		<span class="small">(administrator)</span>
				<br />
		<span class="small">2014-06-18 17:27</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		New version of the mockup, with a clearer interface according to ewach... but I agree with him that it is much clearer now ! (no confusion possible between &quot;site&quot; and &quot;project location&quot;)	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1432">
        <td class="bugnote-public">
				<span class="small">(<a href="view4a10.html?id=612#c1432" title="Direct link to note">0001432)</a></span><br />
		<a href="view_user_page0b30.html?id=2">osarrat</a>		<span class="small">(administrator)</span>
				<br />
		<span class="small">2014-06-19 11:27</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		A few ideas to distinguish project location and sites :<br />
- on the map, project location must have a different graphical pin than the sites<br />
- in the table, the project location should be titled exactly the way  as in the button, ie: &quot;Project Location (Main Site)&quot;<br />
- in the table, the project location should have closed to it the same graphical unique pin as it has on the map	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1444">
        <td class="bugnote-public">
				<span class="small">(<a href="view4a10.html?id=612#c1444" title="Direct link to note">0001444)</a></span><br />
		<a href="view_user_page3ebc.html?id=64">somzzz</a>		<span class="small">(developer)</span>
				<br />
		<span class="small">2014-06-23 22:05</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		Regarding the new version of the mock-up, displaying the project location on the map and in the sites list involves storing it in the Sigmah DB once it has been set. Our previous discussions focused around not storing it, but using it only for the HXL export directly in the standard format.<br />
<br />
Of course, the main project location can simply be used for the HXL export and storing it is out of question if we choose this approach. But displaying it on the map/site list is not possible if so. <br />
<br />
The new approach is feasible nevertheless. Internally, both the sites list and the map use SiteDTOs which provide the basic attributes we are interested in for the project location (coordinates, country, admin region). This means the existing functions for sites can easily be used to handle the project location and display it on both components. Also, the location can be stored as a site without many modifications to the DB structure (maybe none).<br />
<br />
To sum it up, the main project location is a site with some special attributes necessary for the HXL export. It can be set and displayed on the UI. This brings up a couple of questions:<br />
1) What information about the project location should we store? (all details necessary for the export or just the information necessary to display the main location on the map and list)<br />
2) Information stored can be changed. Should it be possible too change any details about the project location after setting it?<br />
3) In close connection to question no 2: Is it necessary to export the HXL data<br />
during the same session with setting the project location?<br />
<br />
A possible solution is to store all the information mainly because the DB allows it and it is more robust. The project location can be set in a different session from the one with the export. Changing it should be possible until the moment of the HXL export. After the HXL export, the information will be displayed on the UI components, but it won't allow any changes. Both the &quot;Set project location&quot; and &quot;Export HXL&quot; buttons will be disabled at this point.<br />
<br />
In order to distinguish between the Main location and the other sites, osarrat's suggestions are great.<br />
For the map, I've done a quick search and some tests and it is possible to use any icon from this website [0] directly. These icons should be available permanently as they are provided by Google. I believe the icon at [1] is easily distinghuishable between the common markers for sites and suits our purpose. For a more specific icon, somebody should create it in Photoshop first, which I admit to be no good at.<br />
For the sites list, keeping in mind that it is almost the same component from the &quot;Manage indicators&quot; tab with some modifications, adding a new column at the beginning to specify a comment such as &quot;Project Loctaion (Main Site)&quot; + a graphical icon next to it is possible.<br />
<br />
[0] - <a href="https://sites.google.com/site/gmapicons/">https://sites.google.com/site/gmapicons/</a> [<a href="https://sites.google.com/site/gmapicons/" target="_blank">^</a>]<br />
[1] - <a href="../../maps.google.com/mapfiles/arrow.png">http://maps.google.com/mapfiles/arrow.png</a> [<a href="../../maps.google.com/mapfiles/arrow.png" target="_blank">^</a>]	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1450">
        <td class="bugnote-public">
				<span class="small">(<a href="view4a10.html?id=612#c1450" title="Direct link to note">0001450)</a></span><br />
		<a href="view_user_page0b30.html?id=2">osarrat</a>		<span class="small">(administrator)</span>
				<br />
		<span class="small">2014-06-25 14:44</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		First of all, a few other ideas I haven't yet the time to report from last week's adoption focal point meeting :<br />
- Four global privileges should be added to handle the Map sub-tab generally: &quot;View Map sub-tab&quot;, &quot;Edit Sites&quot;, &quot;Edit Main Site&quot;, &quot;Publish HXL information&quot; (no profile can have one of the 3 last privileges without ahving the first one).<br />
- When a user clicks on the &quot;Publish project location to HXL&quot; button, a popup will open with a table of all unpublished projects (checkbox, code, title, orgunit) with only the current project selected: from this list he can decide to publish the current project or add any other project to the selection for publication. When publishing a project to HXL, the user having the required privilege will have to check all the information to be published before clicking on the final &quot;Publish&quot; button.<br />
<br />
My propositions of replies to your questions :<br />
1) For the main location we should store in the database as a site only the information necessary to display it on the map and in the list.<br />
2) Yes, the project location should be editable after being edited a first time. Even once it has been published, all information could be changed, including information already exported to HXL. If those information are modified, the project location will again appear in the list of projects to publish in the popup for HXL exportation.<br />
3) No, setting HXL information and publishing them are 2 actions done in two separate popup.<br />
<br />
And I have another complete new idea for implementation of this feature that I open on sigmah-dev for debate.	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1472">
        <td class="bugnote-public">
				<span class="small">(<a href="view4a10.html?id=612#c1472" title="Direct link to note">0001472)</a></span><br />
		<a href="view_user_page0b30.html?id=2">osarrat</a>		<span class="small">(administrator)</span>
				<br />
		<span class="small">2014-07-25 12:08</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		somzzz, according to our latest meeting, I think it would logical to maybe divide this issue <a href="view4a10.html?id=612" title="[closed] Project Map sub-tab with OpenStreetMap and Project Location" class="resolved">0000612</a> into 2 issues :<br />
- 612 renamed &quot;Project Map sub-tab with OpenStreetMap and Project Location&quot;<br />
- a new one called &quot;HXL export&quot;<br />
<br />
Are you ok with this?	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1473">
        <td class="bugnote-public">
				<span class="small">(<a href="view4a10.html?id=612#c1473" title="Direct link to note">0001473)</a></span><br />
		<a href="view_user_page3ebc.html?id=64">somzzz</a>		<span class="small">(developer)</span>
				<br />
		<span class="small">2014-07-25 12:23</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		Yes, osarrat. I believe it is a very good idea.	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1474">
        <td class="bugnote-public">
				<span class="small">(<a href="view4a10.html?id=612#c1474" title="Direct link to note">0001474)</a></span><br />
		<a href="view_user_page0b30.html?id=2">osarrat</a>		<span class="small">(administrator)</span>
				<br />
		<span class="small">2014-07-25 12:31</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		Issue renamed to &quot;Project Map sub-tab with OpenStreetMap and Project Location&quot; to change the scope of the feature.<br />
Another issue is in creation for HXL export.	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1502">
        <td class="bugnote-public">
				<span class="small">(<a href="view4a10.html?id=612#c1502" title="Direct link to note">0001502)</a></span><br />
		<a href="view_user_page3ebc.html?id=64">somzzz</a>		<span class="small">(developer)</span>
				<br />
		<span class="small">2014-12-05 21:58</span><br />
		<span class="small">edited on:&#32;2014-12-05 22:01</span><br />		<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		Added patch for issue 612. <br />
<br />
In order to successfully launch Sigmah, add the following resources (find them attached to the issue):<br />
<br />
markerStar.png , star.png<br />
<br />
to the following path:<br />
<br />
/src/main/java/org/sigmah/client/icon/<br />
<br />
Note: This patch does not include Renato's work on global permissions and needs to be updated once his patch is integrated (issue 0000616).<br />
<br />
	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote" id="c1657">
        <td class="bugnote-public">
				<span class="small">(<a href="view4a10.html?id=612#c1657" title="Direct link to note">0001657)</a></span><br />
		<a href="view_user_page0b30.html?id=2">osarrat</a>		<span class="small">(administrator)</span>
				<br />
		<span class="small">2015-05-04 09:15</span><br />
				<br /><div class="small">
				</div>
	</td>
	<td class="bugnote-note-public">
		Issue closed because correct behavior checked on v2.0 .<br />
<br />
Congratulations for this good work somzzz!	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
</table>

</div><div id="bugnotes_closed" class="hidden">
<table class="width100" cellspacing="1">
<tr>
	<td class="form-title" colspan="2">
		<a href="#" onclick="ToggleDiv( 'bugnotes' ); return false;"
			><img border="0" src="images/plus.html" alt="+" /></a>&#160;		Notes	</td>
</tr>
</table>
</div>
<a name="history" id="history" /><br />

<div id="history_open"><table class="width100" cellspacing="0">
<tr>
	<td class="form-title" colspan="4">
<a href="#" onclick="ToggleDiv( 'history' ); return false;"
			><img border="0" src="images/minus.html" alt="-" /></a>&#160;Issue History	</td>
</tr>
<tr class="row-category-history">
	<td class="small-caption">
		Date Modified	</td>
	<td class="small-caption">
		Username	</td>
	<td class="small-caption">
		Field	</td>
	<td class="small-caption">
		Change	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-02-10 11:28	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		New Issue	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-03-04 11:10	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		File Added: GenericMap.png	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-03-10 11:11	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Description Updated	</td>
	<td class="small-caption">
		<a href="bug_revision_view_pagea1ce.php?rev_id=450#r450">View Revisions</a>	</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-03-21 09:58	</td>
	<td class="small-caption">
		<a href="view_user_page6258.php?id=21">ewach</a>	</td>
	<td class="small-caption">
		Note Added: 0001404	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-05-23 15:25	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Assigned To	</td>
	<td class="small-caption">
		 =&gt; somzzz	</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-05-23 15:25	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Status	</td>
	<td class="small-caption">
		new =&gt; assigned	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-05-23 15:32	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Note Added: 0001411	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-05-23 15:32	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Additional Information Updated	</td>
	<td class="small-caption">
		<a href="bug_revision_view_pagedf76.php?rev_id=459#r459">View Revisions</a>	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-05-24 09:54	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		File Added: img.png	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-05-24 10:06	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		Note Added: 0001412	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-05-25 13:59	</td>
	<td class="small-caption">
		<a href="view_user_page6258.php?id=21">ewach</a>	</td>
	<td class="small-caption">
		Note Added: 0001413	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-05-26 11:11	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Note Added: 0001414	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-06-12 23:28	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		Note Added: 0001424	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-06-15 10:42	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Note Added: 0001427	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-06-15 11:22	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		Note Added: 0001428	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-06-18 17:24	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		File Deleted: GenericMap.png	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-06-18 17:24	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		File Added: GenericMap.png	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-06-18 17:27	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Note Added: 0001430	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-06-19 11:27	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Note Added: 0001432	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-06-23 22:05	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		Note Added: 0001444	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-06-25 14:44	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Note Added: 0001450	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-07-25 12:08	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Note Added: 0001472	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-07-25 12:23	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		Note Added: 0001473	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-07-25 12:31	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Note Added: 0001474	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-07-25 12:31	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Summary	</td>
	<td class="small-caption">
		Project Map sub-tab for HXL export =&gt; Project Map sub-tab with OpenStreetMap and Project Location	</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-07-25 12:31	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Description Updated	</td>
	<td class="small-caption">
		<a href="bug_revision_view_pageb68c.php?rev_id=469#r469">View Revisions</a>	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-07-25 12:31	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Additional Information Updated	</td>
	<td class="small-caption">
		<a href="bug_revision_view_page5c45.php?rev_id=470#r470">View Revisions</a>	</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-07-25 12:33	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Relationship added	</td>
	<td class="small-caption">
		related to 0000630	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-08-12 17:30	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		File Deleted: img.png	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-08-12 17:30	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		File Added: empty.png	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-08-12 17:31	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		File Added: main_site.png	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-08-12 17:31	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		File Added: layer_tool.png	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-08-12 17:31	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		File Added: sites.png	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-08-12 17:53	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		File Deleted: sites.png	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-08-12 17:53	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		File Added: popup.png	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-12-05 21:50	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		File Added: 0000612.patch	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-12-05 21:52	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		File Added: markerStar.png	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-12-05 21:52	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		File Added: star.png	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2014-12-05 21:58	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		Note Added: 0001502	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2014-12-05 22:01	</td>
	<td class="small-caption">
		<a href="view_user_page3ebc.html?id=64">somzzz</a>	</td>
	<td class="small-caption">
		Note Edited: 0001502	</td>
	<td class="small-caption">
		<a href="bug_revision_view_paged229.php?bugnote_id=1502#r492">View Revisions</a>	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2015-05-04 09:15	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Note Added: 0001657	</td>
	<td class="small-caption">
			</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2015-05-04 09:15	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Status	</td>
	<td class="small-caption">
		assigned =&gt; closed	</td>
</tr>
<tr class="row-2">
	<td class="small-caption">
		2015-05-04 09:15	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Resolution	</td>
	<td class="small-caption">
		open =&gt; fixed	</td>
</tr>
<tr class="row-1">
	<td class="small-caption">
		2015-05-04 09:15	</td>
	<td class="small-caption">
		<a href="view_user_page0b30.html?id=2">osarrat</a>	</td>
	<td class="small-caption">
		Fixed in Version	</td>
	<td class="small-caption">
		 =&gt; 2.0	</td>
</tr>
</table>
</div><div id="history_closed" class="hidden"><table class="width100" cellspacing="0">
<tr>
	<td class="form-title" colspan="4">
	<a href="#" onclick="ToggleDiv( 'history' ); return false;"
			><img border="0" src="images/plus.html" alt="+" /></a>&#160;Issue History	</td>
</tr>
</table>

</div>	<br />
	<hr size="1" />
<table border="0" width="100%" cellspacing="0" cellpadding="0"><tr valign="top"><td>	<address>Copyright &copy; 2000 - 2018 MantisBT Team</address>
</td><td>
	<div align="right"><a href="http://www.mantisbt.org/" title="Free Web Based Bug Tracker"><img src="images/mantis_logo.html" width="145" height="50" alt="Powered by Mantis Bugtracker" border="0" /></a></div>
</td></tr></table>
</body>

<!-- Mirrored from www.sigmah.org/issues/view.php?id=612 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 25 Jul 2018 14:56:16 GMT -->
</html>
