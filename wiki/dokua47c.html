<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">

<!-- Mirrored from wiki.sigmah.org/doku.php?id=administratorguide:solrinstallation&do=edit by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 05 Jul 2018 16:55:37 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <title>✎ administratorguide:solrinstallation [Sigmah wiki]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="noindex,nofollow"/>
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.sigmah.org/lib/exe/opensearch.php" title="Sigmah wiki"/>
<link rel="start" href="http://wiki.sigmah.org/"/>
<link rel="contents" href="http://wiki.sigmah.org/doku.php?id=administratorguide:solrinstallation&amp;do=index" title="Sitemap"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="http://wiki.sigmah.org/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="http://wiki.sigmah.org/feed.php?mode=list&amp;ns=administratorguide"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="http://wiki.sigmah.org/doku.php?do=export_xhtml&amp;id=administratorguide:solrinstallation"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="http://wiki.sigmah.org/doku.php?do=export_raw&amp;id=administratorguide:solrinstallation"/>
<link rel="stylesheet" type="text/css" href="http://wiki.sigmah.org/lib/exe/css.php?t=dokuwiki&amp;tseed=74cd2fc0434d10331b9bc01ea3827dea"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='administratorguide';var JSINFO = {"id":"administratorguide:solrinstallation","namespace":"administratorguide"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://wiki.sigmah.org/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="http://wiki.sigmah.org/lib/exe/js.php?t=dokuwiki&amp;tseed=74cd2fc0434d10331b9bc01ea3827dea"></script>
<!--<![endif]-->
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="http://wiki.sigmah.org/lib/tpl/dokuwiki/images/favicon.ico" />
<link rel="apple-touch-icon" href="http://wiki.sigmah.org/lib/tpl/dokuwiki/images/apple-touch-icon.png" />
    </head>

<body>
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_edit tpl_dokuwiki     ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1><a href="http://wiki.sigmah.org/doku.php?id=start"  accesskey="h" title="[H]"><img src="http://wiki.sigmah.org/lib/tpl/dokuwiki/images/logo.png" width="64" height="64" alt="" /> <span>Sigmah wiki</span></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li><a href="http://wiki.sigmah.org/doku.php?id=administratorguide:solrinstallation&amp;do=register"  class="action register" rel="nofollow" title="Register">Register</a></li><li><a href="http://wiki.sigmah.org/doku.php?id=administratorguide:solrinstallation&amp;do=login&amp;sectok="  class="action login" rel="nofollow" title="Log In">Log In</a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
            <form action="http://wiki.sigmah.org/doku.php?id=start" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" placeholder="Search" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><button type="submit" title="Search">Search</button><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="http://wiki.sigmah.org/doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="administratorguide:solrinstallation" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="">Show page</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Recent Changes</option><option value="media">Media Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="login">Log In</option><option value="register">Register</option></optgroup></select><button type="submit">&gt;</button></div></form>            </div>
            <ul>
                <li><a href="http://wiki.sigmah.org/doku.php?id=administratorguide:solrinstallation&amp;do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Recent Changes [R]">Recent Changes</a></li><li><a href="http://wiki.sigmah.org/doku.php?id=administratorguide:solrinstallation&amp;do=media&amp;ns=administratorguide"  class="action media" rel="nofollow" title="Media Manager">Media Manager</a></li><li><a href="http://wiki.sigmah.org/doku.php?id=administratorguide:solrinstallation&amp;do=index"  class="action index" accesskey="x" rel="nofollow" title="Sitemap [X]">Sitemap</a></li>            </ul>
        </div>

    </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                                        <div class="trace"><span class="bchead">Trace:</span> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=model:user_unit"  class="breadcrumbs" title="model:user_unit">user_unit</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=model:user_unit_profiles"  class="breadcrumbs" title="model:user_unit_profiles">user_unit_profiles</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=model:value"  class="breadcrumbs" title="model:value">value</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=ssoc:ideas4gsoc2017"  class="breadcrumbs" title="ssoc:ideas4gsoc2017">ideas4gsoc2017</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=ssoc:ideas4gsoc2016"  class="breadcrumbs" title="ssoc:ideas4gsoc2016">ideas4gsoc2016</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=ssoc:ideas4soc2015"  class="breadcrumbs" title="ssoc:ideas4soc2015">ideas4soc2015</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=ssoc:ideas4gsoc2014"  class="breadcrumbs" title="ssoc:ideas4gsoc2014">ideas4gsoc2014</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=ssoc:ideas4gsoc2013"  class="breadcrumbs" title="ssoc:ideas4gsoc2013">ideas4gsoc2013</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=ssoc:ideas4gsoc2012"  class="breadcrumbs" title="ssoc:ideas4gsoc2012">ideas4gsoc2012</a></bdi> <span class="bcsep">•</span> <span class="curid"><bdi><a href="http://wiki.sigmah.org/doku.php?id=ssoc:sigmahsummerofcode"  class="breadcrumbs" title="ssoc:sigmahsummerofcode">sigmahsummerofcode</a></bdi></span></div>
                    </div>
    


    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">
                
                <div class="pageId"><span>administratorguide:solrinstallation</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    
<p>
This page is read only. You can view the source, but not change it. Ask your administrator if you think this is wrong.
</p>
    <div class="editBox" role="application">

    <div class="toolbar group">
        <div id="draft__status"></div>
        <div id="tool__bar"></div>
    </div>
    <form id="dw__editform" method="post" action="#" accept-charset="utf-8"><div class="no">
<input type="hidden" name="sectok" value="" /><input type="hidden" name="id" value="administratorguide:solrinstallation" /><input type="hidden" name="rev" value="0" /><input type="hidden" name="date" value="1502716295" /><input type="hidden" name="prefix" value="." /><input type="hidden" name="suffix" value="" /><input type="hidden" name="changecheck" value="05dabc90f283438a577d1cb658d4b126" /><input type="hidden" name="target" value="section" /><textarea name="wikitext" id="wiki__text" dir="auto" class="edit" cols="80" rows="10" tabindex="1" readonly="readonly">
# Introduction #

Solr is a Java-based search server which Sigmah relies on to carry out search over fields like projects, contacts and org-units. An instance of the Solr server needs to be installed on the server-side, and a Solr &quot;core&quot; (an index) needs to be setup for a particular organization to facilitate searching within an instance of Sigmah.

This installation guide describes the technical procedure to install Solr and set up a  Solr Core, covering both Windows and Linux platforms.

## Prerequisites ##

For better performance and security, it is recommended to maintain an installation environment for Sigmah with latest versions of the following 4 key components:

* **Java 1.8 and above**
* **PostgreSQL 9 and above**
* **Tomcat 7 and above**

Refer to the instructions for installation of Sigmah for the above 3.

* **You will also require the latest version of Sigmah (v2.2) with the search feature included.**

Currently, you can find the code for this here: https://github.com/sigmah-dev/sigmah/pull/97.
Although yet to be merged, it contains a working version of the search feature. 


## Installing Solr ##

The latest Solr version is available at http://lucene.apache.org/solr/mirrors-solr-latest-redir.html

(The version of Solr used for testing Sigmah's search feature is 6.5.0 )

For Linux/Unix/OSX systems, download the .tgz file. For Windows systems, download the .zip file. When getting started, all you need to do is extract the Solr distribution archive to a directory of your choice. When you're ready to setup Solr for a production environment, please refer to the instructions provided at https://cwiki.apache.org/confluence/display/solr/Taking+Solr+to+Production. To keep things simple for now, extract the Solr distribution archive to your local home directory.

For example, on Linux, do:

```
$ cd ~/
$ tar -zxf solr-x.y.z.tgz
```

## Running Solr ##

You can start Solr by running the following command from the Solr directory:

On Linux:

```
$ bin/solr start
```

On Windows:
```
bin\solr.cmd start
```
This will start Solr in the background, listening on default port 8983.
To change the port Solr listens on, you can use the -p parameter when starting, such as:

```
$ bin/solr start -p 8984
```

Solr can be stopped with (add specific port number if it is not running on the default port):

```
$ bin/solr stop -p 8983
```

To confirm that Solr is running, open the admin console in a browser: http://localhost:8983/solr/

##Downloading required jars for Sigmah##

Download the postgresql jar from here: https://jdbc.postgresql.org/download.html and paste it in {solr installation directory}/solr-6.x.0/contrib/dataimporthandler/lib.


##Creating a new Solr core for Sigmah##

Each organization has a separate core or index which has to be linked to the Sigmah instance.
Download/clone the latest version of Sigmah containing the search feature.

Go to &quot;sigmah/src/main/resources/solr\_config&quot; and copy the folder &quot;Test\_Sigmah&quot;. 
This folder is a core with the necessary configuration files for Sigmah.

Paste it inside {solr installation directory}/solr-6.x.0/server/solr/.

Alternately in Linux:

```
$ cp sigmah/src/main/resources/solr_config/Test_Sigmah ~/home/{your-username}/solr-6.x.0/server/solr/
```

In this copy, open the file Test_Sigmah/conf/data-config.xml in a text editor. 
You will see the lines:

```
&lt;dataSource driver=&quot;org.postgresql.Driver&quot;
  url=&quot;jdbc:postgresql://localhost:5432/sigmah_demo?zeroDateTimeBehavior=convertToNull&quot;
  user=&quot;sigmah&quot;
  password=&quot;hamsig&quot; /&gt;
```

In place of &quot;sigmah\_demo&quot;, write the name of the sigmah database linked to the organization. 
Replace the values in user and password with the username and password of the database.

Restart the Solr Server in case it was still running.

Go to the admin panel, click on &quot;Core Selector&quot; dropdown on the left-hand side, and you should see &quot;Test\_Sigmah&quot;. Click on it.

Alternately, open http://localhost:8983/solr/#/Test_Sigmah in your browser.

If either of these failed, it means that Solr has not been installed correctly in the first step.


##Changing the name of the core##

In order to change the name of the core from Test_Sigmah to something more appropriate:

Open {solr installation directory}/solr-6.x.0/server/solr/Test_Sigmah/core.properties. You will see:

```name=Test_Sigmah```

Replace Test_Sigmah with the name of your choice.

Change the name of the folder Test_Sigmah to the same name. Then, restart the Solr server.

The name of the core is important. It forms a part of the url using which an admin connects to the Solr server.


##Carrying out a full data import of the database##

Before going any further, carry out a full data import. This basically takes all the required tables in your database and puts them into the Solr index.

Go to the 'Data Import' tab in the options below 'Test_Sigmah' and press the 'Execute' button for full-import command.
Press 'Refresh Status' until the UI says 'Indexing Completed. Added/Updated X documents...'

{{:administratorguide:7a2ef76f-12a9-45d6-8450-7c26158972d9.jpg|



}}

If it doesn't say this after a minute or so and seems to be stuck in a loop, check the 'Logging' tab in the Solr admin, if it says there are errors, then there could be some mistake in the config files.

Also check the connection with the database and the database version.

##Integrating Solr with an instance of Sigmah##

First of all, check that the schema of the database is upto-date, and migrate any changes. The changes to the schema made for including the search feature can be found here (as of now): 

https://github.com/indianauthority97/sigmah/blob/bec9e807d9a725b308c9da154574b9e68489aa5d/src/main/resources/db/migration/V21__solr_core_url_field.sql

Compile and run the war file on the Tomcat Server.

When you open the new instance of Sigmah, you won't see any search bar. It will probably complain with a message like &quot;Solr Server connection is not available.&quot;

In any case, the first thing to do is to connect Sigmah with the solr core you just created.

Go to Administration -&gt; Settings -&gt; Solr Search Settings. It has a text field called &quot;Solr Core Url&quot;.

Enter the full URL for the solr core, ```http://{server-ip:port}/solr/{solr-core-name}```.

For example if the solr core is on your local system, enter:

```
http://localhost:8983/solr/Test_Sigmah
```

{{:administratorguide:image.jpg|}}


Save the changes.

If it gives a message saying &quot;Successfully updated Solr Core!&quot;, you're good to go.

Otherwise, if it says &quot;Failed to update Solr Core!&quot;, re-check the url you entered, and that the solr server is up and running.

  

The next step is to permit the user to carry out search.

Go to Administration -&gt; Users -&gt; Profiles.

Edit the profiles for which you want to permit searching. In the popup for editing, go to Global Authorisations -&gt; Others. A new permission &quot;Search&quot; should be there. Tick it and save the changes.

{{:administratorguide:image_1_.jpg|}}

Reload Sigmah on your browser.

A few seconds after loading, the search bar should appear. If it doesn't, try logging out and then logging back in.

##Notes##

An automatic background job on the server side keeps indexing the database as well as files every 10 minutes to Solr. This ensures that any changes made to databases and files keep showing up in Solr, and ultimately to the user carrying out the search.

However, this operation can also be carried out manually by the admin from the front-end, and should be done right after entering the solr core url. 

In Administration -&gt; Settings -&gt; Solr Search Settings, the &quot;Manual Index&quot; button is for this purpose.


##Sources##


- https://cwiki.apache.org/confluence/display/solr/Installing+Solr

- http://www.sigmah.org/issues/view.php?id=535

Work is still going on for the search feature at:

- https://github.com/sigmah-dev/sigmah/pull/97


</textarea>
<div id="wiki__editbar" class="editBar">
<div id="size__ctl">
</div>
</div>
</div></form>
</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>administratorguide/solrinstallation.txt</bdi> · Last modified: 2017/08/14 15:11 by <bdi>indianauthority97</bdi></div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="http://wiki.sigmah.org/doku.php?id=administratorguide:solrinstallation&amp;do="  class="action show" accesskey="v" rel="nofollow" title="Show page [V]"><span>Show page</span></a></li><li><a href="http://wiki.sigmah.org/doku.php?id=administratorguide:solrinstallation&amp;do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]"><span>Old revisions</span></a></li><li><a href="http://wiki.sigmah.org/doku.php?id=administratorguide:solrinstallation&amp;do=backlink"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license" class="urlextern">CC Attribution-Share Alike 4.0 International</a></bdi></div>
    <div class="buttons">
        <a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license"><img src="http://wiki.sigmah.org/lib/images/license/button/cc-by-sa.png" alt="CC Attribution-Share Alike 4.0 International" /></a>        <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="http://wiki.sigmah.org/lib/tpl/dokuwiki/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://php.net/" title="Powered by PHP" ><img
            src="http://wiki.sigmah.org/lib/tpl/dokuwiki/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="http://wiki.sigmah.org/lib/tpl/dokuwiki/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="http://wiki.sigmah.org/lib/tpl/dokuwiki/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="http://wiki.sigmah.org/lib/tpl/dokuwiki/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img src="http://wiki.sigmah.org/lib/exe/indexer.php?id=administratorguide%3Asolrinstallation&amp;1530808784" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div></body>

<!-- Mirrored from wiki.sigmah.org/doku.php?id=administratorguide:solrinstallation&do=edit by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 05 Jul 2018 16:55:37 GMT -->
</html>
