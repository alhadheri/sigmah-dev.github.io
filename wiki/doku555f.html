<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">

<!-- Mirrored from wiki.sigmah.org/doku.php?id=administratorguide:dataseparation&do=edit by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 05 Jul 2018 16:55:08 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <title>✎ administratorguide:dataseparation [Sigmah wiki]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="noindex,nofollow"/>
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.sigmah.org/lib/exe/opensearch.php" title="Sigmah wiki"/>
<link rel="start" href="http://wiki.sigmah.org/"/>
<link rel="contents" href="http://wiki.sigmah.org/doku.php?id=administratorguide:dataseparation&amp;do=index" title="Sitemap"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="http://wiki.sigmah.org/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="http://wiki.sigmah.org/feed.php?mode=list&amp;ns=administratorguide"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="http://wiki.sigmah.org/doku.php?do=export_xhtml&amp;id=administratorguide:dataseparation"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="http://wiki.sigmah.org/doku.php?do=export_raw&amp;id=administratorguide:dataseparation"/>
<link rel="stylesheet" type="text/css" href="http://wiki.sigmah.org/lib/exe/css.php?t=dokuwiki&amp;tseed=74cd2fc0434d10331b9bc01ea3827dea"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='administratorguide';var JSINFO = {"id":"administratorguide:dataseparation","namespace":"administratorguide"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://wiki.sigmah.org/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="http://wiki.sigmah.org/lib/exe/js.php?t=dokuwiki&amp;tseed=74cd2fc0434d10331b9bc01ea3827dea"></script>
<!--<![endif]-->
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="http://wiki.sigmah.org/lib/tpl/dokuwiki/images/favicon.ico" />
<link rel="apple-touch-icon" href="http://wiki.sigmah.org/lib/tpl/dokuwiki/images/apple-touch-icon.png" />
    </head>

<body>
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_edit tpl_dokuwiki     ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1><a href="http://wiki.sigmah.org/doku.php?id=start"  accesskey="h" title="[H]"><img src="http://wiki.sigmah.org/lib/tpl/dokuwiki/images/logo.png" width="64" height="64" alt="" /> <span>Sigmah wiki</span></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li><a href="http://wiki.sigmah.org/doku.php?id=administratorguide:dataseparation&amp;do=register"  class="action register" rel="nofollow" title="Register">Register</a></li><li><a href="http://wiki.sigmah.org/doku.php?id=administratorguide:dataseparation&amp;do=login&amp;sectok="  class="action login" rel="nofollow" title="Log In">Log In</a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
            <form action="http://wiki.sigmah.org/doku.php?id=start" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" placeholder="Search" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><button type="submit" title="Search">Search</button><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="http://wiki.sigmah.org/doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="administratorguide:dataseparation" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="">Show page</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Recent Changes</option><option value="media">Media Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="login">Log In</option><option value="register">Register</option></optgroup></select><button type="submit">&gt;</button></div></form>            </div>
            <ul>
                <li><a href="http://wiki.sigmah.org/doku.php?id=administratorguide:dataseparation&amp;do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Recent Changes [R]">Recent Changes</a></li><li><a href="http://wiki.sigmah.org/doku.php?id=administratorguide:dataseparation&amp;do=media&amp;ns=administratorguide"  class="action media" rel="nofollow" title="Media Manager">Media Manager</a></li><li><a href="http://wiki.sigmah.org/doku.php?id=administratorguide:dataseparation&amp;do=index"  class="action index" accesskey="x" rel="nofollow" title="Sitemap [X]">Sitemap</a></li>            </ul>
        </div>

    </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                                        <div class="trace"><span class="bchead">Trace:</span> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=model:user_unit"  class="breadcrumbs" title="model:user_unit">user_unit</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=model:user_unit_profiles"  class="breadcrumbs" title="model:user_unit_profiles">user_unit_profiles</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=model:value"  class="breadcrumbs" title="model:value">value</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=ssoc:ideas4gsoc2017"  class="breadcrumbs" title="ssoc:ideas4gsoc2017">ideas4gsoc2017</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=ssoc:ideas4gsoc2016"  class="breadcrumbs" title="ssoc:ideas4gsoc2016">ideas4gsoc2016</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=ssoc:ideas4soc2015"  class="breadcrumbs" title="ssoc:ideas4soc2015">ideas4soc2015</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=ssoc:ideas4gsoc2014"  class="breadcrumbs" title="ssoc:ideas4gsoc2014">ideas4gsoc2014</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=ssoc:ideas4gsoc2013"  class="breadcrumbs" title="ssoc:ideas4gsoc2013">ideas4gsoc2013</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.sigmah.org/doku.php?id=ssoc:ideas4gsoc2012"  class="breadcrumbs" title="ssoc:ideas4gsoc2012">ideas4gsoc2012</a></bdi> <span class="bcsep">•</span> <span class="curid"><bdi><a href="http://wiki.sigmah.org/doku.php?id=ssoc:sigmahsummerofcode"  class="breadcrumbs" title="ssoc:sigmahsummerofcode">sigmahsummerofcode</a></bdi></span></div>
                    </div>
    


    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">
                
                <div class="pageId"><span>administratorguide:dataseparation</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    
<p>
This page is read only. You can view the source, but not change it. Ask your administrator if you think this is wrong.
</p>
    <div class="editBox" role="application">

    <div class="toolbar group">
        <div id="draft__status"></div>
        <div id="tool__bar"></div>
    </div>
    <form id="dw__editform" method="post" action="#" accept-charset="utf-8"><div class="no">
<input type="hidden" name="sectok" value="" /><input type="hidden" name="id" value="administratorguide:dataseparation" /><input type="hidden" name="rev" value="0" /><input type="hidden" name="date" value="1443617718" /><input type="hidden" name="prefix" value="." /><input type="hidden" name="suffix" value="" /><input type="hidden" name="changecheck" value="09ebf84d3a39ab870204d6486b961c11" /><input type="hidden" name="target" value="section" /><textarea name="wikitext" id="wiki__text" dir="auto" class="edit" cols="80" rows="10" tabindex="1" readonly="readonly">
# Goal of these scripts #
The data separation scripts were intended to extract organization data from one MySQL database and to insert it into several PostgreSQL databases. Each PostgreSQL instance corresponds to one organization. The main goal of this project was to increase data security by splitting data from each organization.

# How to : #
## Run it with the command line ##
These scripts needs Pentaho Data Integration in order to work properly (an open-source version exists under the name [Pentaho Data Integration Community Edition](http://kettle.pentaho.com)).

Go to the root of this software. Use this command line for running the script in Linux :
```
kitchen.sh 
-file=&quot;$$MAIN_SCRIPT_PATH$$&quot; 
-param=&quot;DATA_SEPARATION_DESCRIPTOR=$$DATA_SEPARATION_DESCRIPTOR_PATH$$&quot;
-param=&quot;OUTPUT_DIRECTORY=$$OUTPUT_DIRECTORY$$&quot; &gt; $$LOG_FILE$$
```

This script is also runnable on Windows with this command line :
```
Kitchen.bat 
/file:&quot;$$MAIN_SCRIPT_PATH$$&quot;
/param:&quot;DATA_SEPARATION_DESCRIPTOR=$$DATA_SEPARATION_DESCRIPTOR_PATH$$&quot;
/param:&quot;OUTPUT_DIRECTORY=$$OUTPUT_DIRECTORY$$&quot; &gt; $$LOG_FILE$$
```

These command lines contains some variables :
  * **$$MAIN\_SCRIPT\_PATH$$** is the absolute path of the main script of these script. Its name is already DataSeparation.kjb and is placed in the root of the project.
  * **$$DATA\_SEPARATION\_DESCRIPTOR\_PATH$$** is the absolute path of the XML file descriptor used to set parameters in the script.
  * **$$OUTPUT\_DIRECTORY$$** is the absolute path of the directory where log files will be written. Don't forget to end this path with a forward slash on Linux or a double backslash on Windows.
  * **$$LOG\_FILE$$** is the absolute or relative path of the file where will be written the output of the PDI script.

## Define the XML file descriptor ##
The XML file descriptor is made for defining access parameters of each database which will be used by the script and for linking a database with an organization and the place where data file will be stored.

The element **`&lt;data-separation&gt;`** is the root of the document. It contains two others elements :
**`&lt;central-base&gt;`** for defining the central instance with MySQL and **`&lt;organizations&gt;`** for defining target instance with PostgreSQL.

The first one contains the element **`&lt;mysql-connection&gt;`** that defines the connection of the MySQL database of the central instance. This element indicates the IP address of the database with **`&lt;host&gt;`**, the port of MySQL with **`&lt;port&gt;`**, the name of the database with **`&lt;database&gt;`** and the user with **`&lt;user&gt;`**. The used has a name and a password (defined by **`&lt;name&gt;`** and **`&lt;password&gt;`**).

The element **`&lt;target-base&gt;`** has also the element **`&lt;file-repository&gt;`** that gives information on where files are stored and how they can be accessed (in other words these files can be accessed locally or with a specific protocol ?). This element use an attribute to specify the type of the access. Actually this attribute can have only one possible value : _“local”_ which indicates that files can be accessed locally on the hard drive.
This element has also an element different depending on the type of the previous attribute.
When the attribute has the value _“local”_, the sub-element is named **`&lt;local-path&gt;`** and indicates the absolute path of the directory where all files are stored. Dont forget to end the path with a forward slash if you run the script on Linux or a backslash if you used a Windows OS.

This is an example that defines a central instance :
```
&lt;data-separation&gt;
    &lt;central-base&gt;
        &lt;mysql-connection&gt;
            &lt;host&gt;127.0.0.1&lt;/host&gt;
            &lt;port&gt;3306&lt;/port&gt;
            &lt;database&gt;sigmah&lt;/database&gt;
            &lt;user&gt;
                &lt;name&gt;username&lt;/name&gt;
                &lt;password&gt;password&lt;/password&gt;
            &lt;/user&gt;
        &lt;/mysql-connection&gt;
        &lt;file-repository type=”local”&gt;
            &lt;local-path&gt;/my_repository/&lt;/local-path&gt;
        &lt;/file-repository&gt;
    &lt;/central-base&gt;
    [...]
&lt;/data-separation&gt;
```

The element **`&lt;organizations&gt;`** contains several elements **`&lt;organization&gt;`**. Each element **`&lt;organization&gt;`** possess an id (defined by **`&lt;id&gt;`**) that corresponds to the value of the primary key on the central database of the organization you want to move.
It has also a name (defined by **`&lt;name&gt;`**). This name is only used for naming some log files. The value is not very important and is not necessarily the same name that the field name on the table Organization in the database. It has also an element **`&lt;postgres-connection&gt;`** that is the same as the element **`&lt;mysql-connection&gt;`** excepted that it has also an element that defines the schema (with the element **`&lt;schema&gt;`**) used on the PostgreSQL database. And it has also the element **`&lt;file-repository&gt;`** like the element **`&lt;central-base&gt;`**.

That is an example that defines a list of organizations.
```
&lt;data-separation&gt;
    [...]
    &lt;organizations&gt;
        &lt;organization&gt;
            &lt;id&gt;5&lt;/id&gt;
            &lt;name&gt;MyNGO&lt;/name&gt;
            &lt;postgres-connection&gt;
                &lt;host&gt;127.0.0.1&lt;/host&gt;
                &lt;port&gt;5432&lt;/port&gt;
                &lt;database&gt;sigmah&lt;/database&gt;
                &lt;user&gt;
                    &lt;name&gt;username&lt;/name&gt;
                    &lt;password&gt;password&lt;/password&gt;
                &lt;/user&gt;
            &lt;/postgres-connection&gt;
        &lt;/organization&gt;
        &lt;organization&gt;
            [...]
        &lt;/organization&gt;
        [...]
    &lt;/organizations&gt;
&lt;/data-separation&gt;
```

### Example of the XML file descriptor ###
Here is an example of the XML file descriptor. In this file, the central database is split in two database : one for the NGO named &quot;First NGO&quot; and another one for the NGO named &quot;Second NGO&quot;.
```
&lt;data-separation&gt;
    &lt;central-base&gt;
        &lt;mysql-connection&gt;
            &lt;host&gt;mysqldb.host.com&lt;/host&gt;
            &lt;port&gt;3306&lt;/port&gt;
            &lt;database&gt;sigmah&lt;/database&gt;
            &lt;user&gt;
                &lt;name&gt;mysql_user&lt;/name&gt;
                &lt;password&gt;mysql_password&lt;/password&gt;
            &lt;/user&gt;
        &lt;/mysql-connection&gt;
        &lt;file-repository type=&quot;local&quot;&gt;
            &lt;local-path&gt;/var/sigmah/&lt;/local-path&gt;
        &lt;/file-repository&gt;
    &lt;/central-base&gt;
    &lt;organizations&gt;
        &lt;organization&gt;
            &lt;id&gt;5&lt;/id&gt;
            &lt;name&gt;First NGO&lt;/name&gt;
            &lt;postgres-connection&gt;
                &lt;host&gt;first.ngo.com&lt;/host&gt;
                &lt;port&gt;5432&lt;/port&gt;
                &lt;database&gt;sigmah&lt;/database&gt;
                &lt;schema&gt;public&lt;/schema&gt;
                &lt;user&gt;
                    &lt;name&gt;pg_user&lt;/name&gt;
                    &lt;password&gt;pg_password&lt;/password&gt;
                &lt;/user&gt;
            &lt;/postgres-connection&gt;
            &lt;file-repository type=&quot;local&quot;&gt;
                &lt;local-path&gt;/var/first_ngo/&lt;/local-path&gt;
            &lt;/file-repository&gt;
        &lt;/organization&gt;
        &lt;organization&gt;
            &lt;id&gt;7&lt;/id&gt;
            &lt;name&gt;Second NGO&lt;/name&gt;
            &lt;postgres-connection&gt;
                &lt;host&gt;second_ngo.uk&lt;/host&gt;
                &lt;port&gt;5555&lt;/port&gt;
                &lt;database&gt;sigmah&lt;/database&gt;
                &lt;schema&gt;sigmah_schema&lt;/schema&gt;
                &lt;user&gt;
                    &lt;name&gt;sngo&lt;/name&gt;
                    &lt;password&gt;sngo&lt;/password&gt;
                &lt;/user&gt;
            &lt;/postgres-connection&gt;
            &lt;file-repository type=&quot;local&quot;&gt;
                &lt;local-path&gt;/home/sngo/sigmah_repository/&lt;/local-path&gt;
            &lt;/file-repository&gt;
        &lt;/organization&gt;
    &lt;/organizations&gt;
&lt;/data-separation&gt;
```</textarea>
<div id="wiki__editbar" class="editBar">
<div id="size__ctl">
</div>
</div>
</div></form>
</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>administratorguide/dataseparation.txt</bdi> · Last modified: 2015/09/30 14:55 (external edit)</div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="http://wiki.sigmah.org/doku.php?id=administratorguide:dataseparation&amp;do="  class="action show" accesskey="v" rel="nofollow" title="Show page [V]"><span>Show page</span></a></li><li><a href="http://wiki.sigmah.org/doku.php?id=administratorguide:dataseparation&amp;do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]"><span>Old revisions</span></a></li><li><a href="http://wiki.sigmah.org/doku.php?id=administratorguide:dataseparation&amp;do=backlink"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license" class="urlextern">CC Attribution-Share Alike 4.0 International</a></bdi></div>
    <div class="buttons">
        <a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license"><img src="http://wiki.sigmah.org/lib/images/license/button/cc-by-sa.png" alt="CC Attribution-Share Alike 4.0 International" /></a>        <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="http://wiki.sigmah.org/lib/tpl/dokuwiki/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://php.net/" title="Powered by PHP" ><img
            src="http://wiki.sigmah.org/lib/tpl/dokuwiki/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="http://wiki.sigmah.org/lib/tpl/dokuwiki/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="http://wiki.sigmah.org/lib/tpl/dokuwiki/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="http://wiki.sigmah.org/lib/tpl/dokuwiki/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img src="http://wiki.sigmah.org/lib/exe/indexer.php?id=administratorguide%3Adataseparation&amp;1530808775" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div></body>

<!-- Mirrored from wiki.sigmah.org/doku.php?id=administratorguide:dataseparation&do=edit by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 05 Jul 2018 16:55:08 GMT -->
</html>
